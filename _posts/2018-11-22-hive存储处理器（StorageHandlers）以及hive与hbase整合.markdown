---
layout:     post
title:      hive存储处理器（StorageHandlers）以及hive与hbase整合
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <p style="font-size:14px;color:rgb(85,85,85);line-height:28px;background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;">此篇文章基于hive官方英文文档翻译，官方的英文地址为：</p><p style="font-size:14px;color:rgb(85,85,85);line-height:28px;background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;">1.https://cwiki.apache.org/confluence/display/Hive/StorageHandlers</p><p style="font-size:14px;color:rgb(85,85,85);line-height:28px;background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;">2.https://cwiki.apache.org/confluence/display/Hive/HBaseIntegration</p><p style="font-size:14px;color:rgb(85,85,85);line-height:28px;background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"> </p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:16px;"><span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>一</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em> </em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>存储处理器介绍</em></span></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>通过</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HIVE</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>存储处理器，不但可以让</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>基于</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hbase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>实现，还可以支持</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>cassandra JDBC</em></span><span lang="en-us" xml:lang="en-us" style="font-family:SimSun;"><em> MongoDB </em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>以及</em></span><span lang="en-us" xml:lang="en-us" style="font-family:SimSun;"><em> Google Spreadsheets</em></span></span><span style="font-size:14px;"> </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HIVE</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>存储器的实现原理基于</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HIVE</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>以及</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>Hadoop</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的可扩展性实现：</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>输入格式化（</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>input formats</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>）</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>输出格式化（</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>output formats</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>）</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>序列化</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>/</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>反序列化包（</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>serialization/deserialization librarises</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>）</em></span></span><span style="font-size:14px;"> </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>除了依据以上可扩展性，存储处理器还需要实现新的元数据钩子接口，这个接口允许使用</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HIVE</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>DDL</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>语句来定义和管理</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>自己的元数据以及其它系统的目录（此目录个人理解为其它系统的元数据目录）</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">一些术语：</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HIVE</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>本身有的概念：</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em></em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>被管理的表即内部表（</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>managed</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>）：元数据由</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>管理，并且数据也存储在</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的体系里面</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>外部表（</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>external table</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>）：表的定义被外部的元数据目录所管理，数据也存储在外部系统中</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>存储处理器的概念：</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>本地（</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>native</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>）表：</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>不需要借助存储处理器就可以直接管理和访问的表</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>非本地（</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>non-native</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>）表</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>:</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>需要通过存储处理器才能管理和访问的表</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"> </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>内部表</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em> </em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>外部表</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em> </em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>和</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em> </em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>本地表</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em> </em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>非本地表</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em> </em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>形成交叉，就有了下面四种形式的概念定义：</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>被管理的本地表（</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>managed native</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>）：通过</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>CREATE</em></span><span lang="en-us" xml:lang="en-us" style="font-family:SimSun;"><em> TABLE</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>创建的表</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>外部本地表</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>(external native)</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>：通过</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>CREATE</em></span><span lang="en-us" xml:lang="en-us" style="font-family:SimSun;"><em> EXTERNAL TABLE</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>创建，但是没有带</em></span><span lang="en-us" xml:lang="en-us" style="font-family:SimSun;"><em>STORED BY</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>子句</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>被管理的非本地表（）</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>managed non-native):</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>通过</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>CREATE</em></span><span lang="en-us" xml:lang="en-us" style="font-family:SimSun;"><em> TABLE </em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>创建，同时有</em></span><span lang="en-us" xml:lang="en-us" style="font-family:SimSun;"><em>STORED BY</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>子句，</em></span><span lang="en-us" xml:lang="en-us" style="font-family:SimSun;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>在元数据中存储表定义，但是不创建任何文件（我的理解是存放数据的目录文件，</em></span><span lang="en-us" xml:lang="en-us" style="font-family:SimSun;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>在定义好表结构后会创建对应的目录来存储对应的数据），</em></span><span lang="en-us" xml:lang="en-us" style="font-family:SimSun;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>存储处理器向存储数据的系统发出一个请求来创建一个一致的对象结构；</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>外部非本地（</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>external non-native</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>）：通过</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>CREATE</em></span><span lang="en-us" xml:lang="en-us" style="font-family:SimSun;"><em> EXTERNAL TABLE</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>创建，并且带有</em></span><span lang="en-us" xml:lang="en-us" style="font-family:SimSun;"><em>STORED BY</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>子句；</em></span><span lang="en-us" xml:lang="en-us" style="font-family:SimSun;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>在自己的元数据中注册表的定义信息，并且通过调用存储处理器来检查这些注册在</em></span><span lang="en-us" xml:lang="en-us" style="font-family:SimSun;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>中的信息是否与其它系统中原来定义的信息一致</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>通过</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>创建表结构的</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>DDL</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>语句：</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">CREATE [EXTERNAL] TABLE [IF NOT EXISTS] table_name</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">  [(col_name data_type [COMMENT col_comment], ...)]</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">  [COMMENT table_comment]</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">  [PARTITIONED BY (col_name data_type [col_comment], col_name data_type [COMMENT col_comment], ...)]</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">  [CLUSTERED BY (col_name, col_name, ...) [SORTED BY (col_name, ...)] INTO num_buckets BUCKETS]</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">  [</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">   [ROW FORMAT row_format] [STORED AS file_format]</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">   | STORED BY 'storage.handler.class.name' [WITH SERDEPROPERTIES (...)]</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">  ]</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">  [LOCATION hdfs_path]</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">  [AS select_statement]</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">具体的使用样例，会在下面详细说明</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"> </p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span><span style="font-size:16px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>二</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em> Hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>与</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>Hbase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的整合</em></span></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>和</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>Hbase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的整合通过</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>Hbase handler jar</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>包实现，它的形式为</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive-hbase-x.y.z.jar ,</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>这个处理器需要依赖</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hadoop0.20</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>以上版本，并且只在</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hadoop-0.20.x hbase-0.92.0 </em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>和</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>zookeeper-3.3.4 </em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>上进行过测试。如果</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hbase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>版本不是</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>0.92</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>则需要基于你使用的版本重新编译对应的</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>存储处理器。</em></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"> </p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>为了创建一张可以被</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>管理的</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hbase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的表，需要在</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>ddl</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>语句</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>CREATE</em></span><span lang="en-us" xml:lang="en-us" style="font-family:SimSun;"><em> TABLE </em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>后面加入语句</em></span><span lang="en-us" xml:lang="en-us" style="font-family:SimSun;"><em>STORED BY</em></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">CREATE TABLE hbase_table_1(key int, value string)</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">WITH SERDEPROPERTIES ("hbase.columns.mapping" = ":key,cf1:val")</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">TBLPROPERTIES ("hbase.table.name" = "xyz");</p><p lang="en-us" xml:lang="en-us" style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"> </p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span lang="en-us" xml:lang="en-us" style="font-style:italic;">Hbase.table.name</span><span lang="zh-cn" xml:lang="zh-cn" style="font-style:italic;">属性是可选的，用它来指定此表在</span><span lang="en-us" xml:lang="en-us" style="font-style:italic;">hbase</span><span lang="zh-cn" xml:lang="zh-cn" style="font-style:italic;">中的名字，这就是说，允许同一个表在</span><span lang="en-us" xml:lang="en-us" style="font-style:italic;">hive</span><span lang="zh-cn" xml:lang="zh-cn" style="font-style:italic;">和</span><span lang="en-us" xml:lang="en-us" style="font-style:italic;">hbase</span><span lang="zh-cn" xml:lang="zh-cn" style="font-style:italic;">中有不同的名字。上述语句中，在</span><span lang="en-us" xml:lang="en-us" style="font-style:italic;">hive</span><span lang="zh-cn" xml:lang="zh-cn" style="font-style:italic;">中的表名叫</span><span lang="en-us" xml:lang="en-us" style="font-style:italic;">hbase_talbe_1,</span><span lang="zh-cn" xml:lang="zh-cn" style="font-style:italic;">在</span><span lang="en-us" xml:lang="en-us" style="font-style:italic;">hbase</span><span lang="zh-cn" xml:lang="zh-cn" style="font-style:italic;">中，此表名叫</span><span lang="en-us" xml:lang="en-us" style="font-style:italic;">xyz</span><span lang="zh-cn" xml:lang="zh-cn" style="font-style:italic;">。如果不指定，两个名字则会是相同的。</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">  </p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>当执行完命令后，就可以在</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HBase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>shell</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>中看到一张新的空表，如下：</em></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">$ hbase shell</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">HBase Shell; enter 'help&lt;RETURN&gt;' for list of supported commands.</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">Version: 0.20.3, r902334, Mon Jan 25 13:13:08 PST 2010</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">hbase(main):001:0&gt; list</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">xyz                                                                                                          </p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">1 row(s) in 0.0530 seconds</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">hbase(main):002:0&gt; describe "xyz"</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">DESCRIPTION                                                             ENABLED                              </p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"> {NAME =&gt; 'xyz', FAMILIES =&gt; [{NAME =&gt; 'cf1', COMPRESSION =&gt; 'NONE', VE true                                 </p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"> RSIONS =&gt; '3', TTL =&gt; '2147483647', BLOCKSIZE =&gt; '65536', IN_MEMORY =&gt;                                      </p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">  'false', BLOCKCACHE =&gt; 'true'}]}                                                                           </p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">1 row(s) in 0.0220 seconds</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">hbase(main):003:0&gt; scan "xyz"</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">ROW                          COLUMN+CELL                                                                     </p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">0 row(s) in 0.0060 seconds</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"> </p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>上面的输出中没有列</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>val</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的信息，虽然在建表语句中已经指定了这个列名。这是因为在</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hbase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>中只有列族的名字才会被定义在表级的元数据中，列族中的列只定义在行级别的元数据中。</em></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"> </p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>下面的语句是定义怎么把数据从</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>中加载进入</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HBase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的表，表</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>pokes</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>是</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>中已经存在的一个表，并且表中有数据。</em></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">INSERT OVERWRITE TABLE hbase_table_1 SELECT * FROM pokes WHERE foo=98;</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>然后，在</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>Hbase shell</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>中验证数据是否已经加载：</em></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">hbase(main):009:0&gt; scan "xyz"</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">ROW                          COLUMN+CELL                                                                     </p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"> 98                          column=cf1:val, timestamp=1267737987733, value=val_98                           </p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">1 row(s) in 0.0110 seconds</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"> </p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>通过</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的语句查询表的结果如下：</em></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">hive&gt; select * from hbase_table_1;</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">Total MapReduce jobs = 1</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">Launching Job 1 out of 1</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">...</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">OK</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">98        val_98</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">Time taken: 4.582 seconds</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"> </p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">Inserting large amounts of data may be slow due to WAL overhead; if you would like to disable this, make sure you have HIVE-1383 (as of Hive 0.6), and then issue this command before the INSERT:</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">set hive.hbase.wal.enabled=false;</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">Warning: disabling WAL may lead to data loss if an HBase failure occurs, so only use this if you have some other recovery strategy available.</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"> </p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>如果想基于已经存在的</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hbase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>表创建</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>可访问的表，则需要用</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>CREATE</em></span><span lang="en-us" xml:lang="en-us" style="font-family:SimSun;"><em> EXTERNAL TABLE</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>，如下：</em></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">CREATE EXTERNAL TABLE hbase_table_2(key int, value string)</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">WITH SERDEPROPERTIES ("hbase.columns.mapping" = "cf1:val")</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;">TBLPROPERTIES("hbase.table.name" = "some_existing_table");</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>hbase.columns.mapping属性项是必须存在的，它代表的是</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hbase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>表的列族以及列的定义信息。</em></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"> </p><p style="font-size:18pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>与</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hbase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的列匹配</em></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>有两种</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>SERDEPROPERTIES</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>配置信息来控制</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HBase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>列到</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HIve</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的映射</em></span></span></p><p lang="en-us" xml:lang="en-us" style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span style="font-family:Calibri;">1.</span><span style="font-family:SimSun;">hbase.columns,mapping</span></span></p><p lang="en-us" xml:lang="en-us" style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">2.hbase.table.default.storage.type</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"><span lang="en-us" xml:lang="en-us" style="font-style:italic;">  </span><span lang="zh-cn" xml:lang="zh-cn" style="font-style:italic;">这个属性可以有</span><span lang="en-us" xml:lang="en-us" style="font-style:italic;">String</span><span lang="zh-cn" xml:lang="zh-cn" style="font-style:italic;">和二进制两种类型的值，默认是</span><span lang="en-us" xml:lang="en-us" style="font-style:italic;">String</span><span lang="zh-cn" xml:lang="zh-cn" style="font-style:italic;">；这个选项只有在</span><span lang="en-us" xml:lang="en-us" style="font-style:italic;">hive0.9</span><span lang="zh-cn" xml:lang="zh-cn" style="font-style:italic;">这个版本可用，</span><span lang="en-us" xml:lang="en-us" style="font-style:italic;">     </span><span lang="zh-cn" xml:lang="zh-cn" style="font-style:italic;">并且在早期的版本中，只有</span><span lang="en-us" xml:lang="en-us" style="font-style:italic;">String</span><span lang="zh-cn" xml:lang="zh-cn" style="font-style:italic;">类型可用</span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">当前列匹配使用起来显得有点笨重和憋手：</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>1.</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>每个</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的列，都需要在参数</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hbase.columns.mapping</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>中指定一个对应的条目（比如：</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>a</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>：</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>b</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>或者：</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>key</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>就叫一个条目），多个列之间的条目通过逗号分隔；也就是说，如果某个表有</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>n</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>个列，则参数</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hbase.columns.mapping</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的值中就有</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>n</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>个以逗号分隔的条目。比如：</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>"hbase.columns.mapping" = ":key,a:b,a:c,d:e"</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em> </em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>代表有两个列族，一个是</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>a</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>一个是</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>d</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>，</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>a</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>列族中有两列，分别为</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>b</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>和</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>c</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span style="font-family:'宋体';">注意，</span><span style="font-family:SimSun;">hbase.columns.mapping的值</span><span style="font-family:'宋体';">中是不允许出现空格的</span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体';"><span style="font-size:14px;"> </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>2.</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>每个匹配条目的形式必须是：</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>key</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>或者列族名：</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>[</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>列名</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>][#(binary|string)](</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>前面带有</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>#</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>标识的是在</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive0.9</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>才添加的，早期的版本把所有都当作</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>String</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>类型</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>)</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>       1</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:'宋体';"><em>）如果没有给列或者列族指定类型，</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hbase.table.default.storage.type</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:'宋体';"><em>的值会被当作这些列或者列族的类</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>  </em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:'宋体';"><em>型</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>        2</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:'宋体';"><em>）表示类型的值（</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>binary|string</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:'宋体';"><em>）的任何前缀都可以被用来表示这个类型，比如</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>#b</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:'宋体';"><em>就代表了</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>#binary</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>        3</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:'宋体';"><em>）如果指定列的类型为二进制（</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>binary</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:'宋体';"><em>）字节，则在</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HBase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:'宋体';"><em>的单元格的存储类型也必须为二进制字节</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>3.</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>必须窜至一个：</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>key</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的形式匹配条目（不支持复合</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>key</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的形式）</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>4.</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>在</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive0.6</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>版本以前，是通过第一个条目来作为关键字（</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>key</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>）字段，从</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>0.6</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>以后，都需要直接通过：</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>key</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的方式来指定</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>5.</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>当前没有办法可以访问到</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HBase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的时间撮属性，并且查询总是访问到最新的数据（这条主要是因为</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hbase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>单元格数据存储是有版本的，根据时间撮）</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>6. </em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>因为</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HBase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的列定义没有包含有数据类型信息，所以在存储的时候，会把所有的其它类型都转换为</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>string </em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>代表；所以，列数据类型不支持自定义</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>7. </em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>没有必要对</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HBase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的所有列族都进行映射，但是没有被映射的列族不能通过访问</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>Hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>表读取到数据；可以把多个</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>Hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>表映射到同一个</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HBase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的表</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"> </p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">下面的章节提供更加详细的例子，来说明当前各种不同的列映射</span></p><p style="font-size:12pt;color:rgb(85,85,85);font-weight:bold;background-color:rgb(255,255,255);clear:both;font-family:SimSun;">多个列和列族</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>下面的例子包含三个</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>Hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>表的列以及两个</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HBase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>表的列族，其中一个列族包括两个列</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">CREATE TABLE hbase_table_1(key int, value1 string, value2 int, value3 int)</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">WITH SERDEPROPERTIES (</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">"hbase.columns.mapping" = ":key,a:b,a:c,d:e"</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">);</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">INSERT OVERWRITE TABLE hbase_table_1 SELECT foo, bar, foo+1, foo+2</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">FROM pokes WHERE foo=98 OR foo=100;</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>上面的例子中，</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>拥有除去可以外的列为三个，</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>value1 value2 value3</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>，对应的</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HBase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>表为两个列族，分别为</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>a</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>和</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>d</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>，其中</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>a</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>包括两列（</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>b</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>和</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>c</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>）；值的对应关系从左到右一一对应，</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>a</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>列族中的</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>b</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>列对应</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>value1</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>，</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>c</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>列对应</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>value2</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>，</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>d</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>列族的</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>e</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>列对应</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>value3</em></span></span><span style="font-size:14px;"> </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-style:italic;">下面是从</span><span lang="en-us" xml:lang="en-us" style="font-style:italic;">HBase</span><span lang="zh-cn" xml:lang="zh-cn" style="font-style:italic;">中查看的结果：</span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">hbase(main):014:0&gt; describe "hbase_table_1"</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">DESCRIPTION                                                             ENABLED                              </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> {NAME =&gt; 'hbase_table_1', FAMILIES =&gt; [{NAME =&gt; 'a', COMPRESSION =&gt; 'N true                                 </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> ONE', VERSIONS =&gt; '3', TTL =&gt; '2147483647', BLOCKSIZE =&gt; '65536', IN_M                                      </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> EMORY =&gt; 'false', BLOCKCACHE =&gt; 'true'}, {NAME =&gt; 'd', COMPRESSION =&gt;                                       </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> 'NONE', VERSIONS =&gt; '3', TTL =&gt; '2147483647', BLOCKSIZE =&gt; '65536', IN                                      </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> _MEMORY =&gt; 'false', BLOCKCACHE =&gt; 'true'}]}                                                                 </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">1 row(s) in 0.0170 seconds</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">hbase(main):015:0&gt; scan "hbase_table_1"</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">ROW                          COLUMN+CELL                                                                     </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> 100                         column=a:b, timestamp=1267740457648, value=val_100                              </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> 100                         column=a:c, timestamp=1267740457648, value=101                                  </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> 100                         column=d:e, timestamp=1267740457648, value=102                                  </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> 98                          column=a:b, timestamp=1267740457648, value=val_98                               </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> 98                          column=a:c, timestamp=1267740457648, value=99                                   </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> 98                          column=d:e, timestamp=1267740457648, value=100                                  </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">2 row(s) in 0.0240 seconds</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>同一张表在</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>Hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>中的查询结果是：</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">hive&gt; select * from hbase_table_1;</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">Total MapReduce jobs = 1</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">Launching Job 1 out of 1</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">...</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">OK</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">100        val_100        101        102</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">98        val_98        99        100</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">Time taken: 4.054 seconds</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> </span></p><p style="font-size:12pt;color:rgb(85,85,85);font-weight:bold;background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>Hive MAP(</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>集合</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>)</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>与</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>Hbase </em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>列族的映射</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>下面是</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>Hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>MAP</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>数据类型与</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>Hbase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>列族的映射例子。每行都可以包含不同的列组合，列名与</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>map</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的可以对应，</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>values</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>与列值对应。</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">CREATE TABLE hbase_table_1(value map&lt;string,int&gt;, row_key int)</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">WITH SERDEPROPERTIES (</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">"hbase.columns.mapping" = "cf:,:key"</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">);</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">INSERT OVERWRITE TABLE hbase_table_1 SELECT map(bar, foo), foo FROM pokes</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">WHERE foo=98 OR foo=100;</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>其中</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>cf</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>表示列族，冒号后面为空，它与</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>Hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>表的列</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>value</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>对应，即</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>value</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>key</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>为</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>cf</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>列族的列，可以通过下面</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HBase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的查询来理解</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>key</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>为列名，</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>value</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>为值的用法。</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">hbase(main):012:0&gt; scan "hbase_table_1"</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">ROW                          COLUMN+CELL                                                                     </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> 100                         column=cf:val_100, timestamp=1267739509194, value=100                           </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> 98                          column=cf:val_98, timestamp=1267739509194, value=98                             </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">2 row(s) in 0.0080 seconds</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>cf</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>为列族名，</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>val_100</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>为</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>表中</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>MAP</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>（集合）的</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>key</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>，</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>100</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>为</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>MAP</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>（集合）中的</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>val_100</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的值</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>下面是对应的</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的查询显示结果：</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">hive&gt; select * from hbase_table_1;</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">Total MapReduce jobs = 1</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">Launching Job 1 out of 1</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">...</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">OK</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">{"val_100":100}        100</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">{"val_98":98}        98</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">Time taken: 3.808 seconds</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>注意：</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>MAP</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>（集合）的</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>key</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>必须是</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>string</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>类型，否则会失败，因为</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>key</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>是</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HBase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>列的名字；如下的定义将会失败</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">CREATE TABLE hbase_table_1(key int, value map&lt;int,int&gt;)</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">WITH SERDEPROPERTIES (</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">"hbase.columns.mapping" = ":key,cf:"</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">);</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">FAILED: Error in metadata: java.lang.RuntimeException: MetaException(message:org.apache.hadoop.hive.serde2.SerDeException org.apache.hadoop.hive.hbase.HBaseSerDe: hbase column family 'cf:' should be mapped to map&lt;string,?&gt; but is mapped to map&lt;int,int&gt;)</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>注意：当</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hbase.columns.mapping</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>中有“：</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>key,cf:</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>”这样的值，即列族冒号后面为空时，表示</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>Hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>中对应的类型为集合</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>map</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>，如果不是，则创建表会失败</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">CREATE TABLE hbase_table_1(key int, value string)</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">WITH SERDEPROPERTIES (</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">"hbase.columns.mapping" = ":key,cf:"</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">);</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">FAILED: Error in metadata: java.lang.RuntimeException: MetaException(message:org.apache.hadoop.hive.serde2.SerDeException</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">org.apache.hadoop.hive.hbase.HBaseSerDe: hbase column family 'cf:' should be mapped to map&lt;string,?&gt; but is mapped to string)</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> </span></p><p style="font-size:12pt;color:rgb(85,85,85);font-weight:bold;background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">hbase.columns.mapping中值类型用法列举</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>如果没有指定值的类型，比如</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>cf</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>：</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>val</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>，则采用配置hbase.table.default.storage.type的值为数据类型</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>1.</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>当不配置hbase.table.default.storage.type时，它默认是</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>string</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>，如果有二进制的数据类型，则如下定义：</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">CREATE TABLE hbase_table_1 (key int, value string, foobar double)</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">WITH SERDEPROPERTIES (</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">"hbase.columns.mapping" = ":key#b,cf:val,cf:foo#b"</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">);</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>2.</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>如果显示的指定hbase.table.default.storage.type为</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>binary</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>时，如果类型有</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>string</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>类型，则需要指定，如：</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">CREATE TABLE hbase_table_1 (key int, value string, foobar double)</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">WITH SERDEPROPERTIES (</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">"hbase.columns.mapping" = ":key,cf:val#s,cf:foo",</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">"hbase.table.default.storage.type" = "binary"</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">);</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> </span><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-style:italic;">cf:val#s</span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em> </em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-style:italic;">中的</span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>#s</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-style:italic;">就表示类型为</span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>string</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-style:italic;">，cf:foo没有配置类型，则采用hbase.table.default.storage.type的配置，为</span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>binary</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> </span></p><p style="font-size:12pt;color:rgb(85,85,85);font-weight:bold;background-color:rgb(255,255,255);clear:both;font-family:SimSun;">添加时间戳</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>当用</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>给</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HBase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的表添加记录时，时间戳默认为当前时间，如果想改变这个值，可以通过设置</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>SERDEPROPERIES</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>属性的可选配置项</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hbase.put.timestamp,</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>当这个配置项为</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>-1</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的时候，就是默认策略，即添加记录为当前时间戳</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">CREATE TABLE hbase_table_1 (key int, value string, foobar double)</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">WITH SERDEPROPERTIES (</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">"hbase.columns.mapping" = ":key,cf:val#s,cf:foo",</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">"hbase.table.default.storage.type" = "binary"</span></p><p lang="en-us" xml:lang="en-us" style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:Calibri;"><span style="font-size:14px;">"hbase.put.timestamp" = "2013-03-17 09:04:30"</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">)</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"> </p><p style="font-size:12pt;color:rgb(85,85,85);font-weight:bold;background-color:rgb(255,255,255);clear:both;font-family:SimSun;">主键唯一性</p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HBase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>与</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>Hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的表有一个细微的差别，就是</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HBase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>的表有一个主键，并且需要唯一，但是</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>Hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>没有；如果不能保证这个主键的唯一，则</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HBase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>存储的时候，只能存储其中一个，这会导致查询的时候，</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>总能找到正确的值，而</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HBase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>出来的结果就不确定</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>如下，在</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>hive</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>中查询：</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">CREATE TABLE pokes2(foo INT, bar STRING);</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">INSERT OVERWRITE TABLE pokes2 SELECT * FROM pokes;</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">-- this will return 3</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">SELECT COUNT(1) FROM POKES WHERE foo=498;</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">-- this will also return 3</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">SELECT COUNT(1) FROM pokes2 WHERE foo=498;</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span style="font-size:14px;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>同一张表在</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HBase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>中查询，就会出来不确定的结果：</em></span></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">CREATE TABLE pokes3(foo INT, bar STRING)</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">WITH SERDEPROPERTIES (</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">"hbase.columns.mapping" = ":key,cf:bar"</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">);</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">INSERT OVERWRITE TABLE pokes3 SELECT * FROM pokes;</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">-- this will return 1 instead of 3</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;">SELECT COUNT(1) FROM pokes3 WHERE foo=498;</span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"><span style="font-size:14px;"> </span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:SimSun;"> </p><p style="font-size:12pt;color:rgb(85,85,85);font-weight:bold;background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>覆盖（</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>Overwrite</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>）</em></span></p><p style="font-size:10pt;color:rgb(85,85,85);background-color:rgb(255,255,255);clear:both;font-family:'宋体', 'Arial Narrow', arial, serif;"><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>当执行</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>OVERWRITE</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>时，</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>HBase</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>中已经存在的记录是不会被删除的；但是，如果存在的记录与新纪录的主键（</em></span><span lang="en-us" xml:lang="en-us" style="font-family:Calibri;"><em>key</em></span><span lang="zh-cn" xml:lang="zh-cn" style="font-family:SimSun;"><em>）是一样的，则老数据会被覆盖</em></span></p>            </div>
                </div>