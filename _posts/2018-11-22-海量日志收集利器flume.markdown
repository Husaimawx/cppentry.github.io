---
layout:     post
title:      海量日志收集利器flume
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<div id="article_content" class="article_content tracking-ad" style="line-height:26px;font-family:Arial;">
<div class="markdown_views" style="font-family:'microsoft yahei';color:rgb(63,63,63);">
<h2 id="一flume是什么" style="font-weight:100;line-height:1.3em;">
<span><span style="font-size:14px;">一、Flume是什么</span></span></h2>
<p>
<span style="font-size:14px;">　　Flume是一个分布式、可靠、和高可用的海量日志聚合的系统，支持在系统中定制各类数据发送方，用于收集数据；同时，Flume提供对数据进行简单处理，并写到各种数据接受方（可定制）的能力。</span></p>
<h2 id="二-fulme-有什么特点" style="font-weight:100;line-height:1.3em;">
<span style="font-size:14px;"><a name="t1" style="color:rgb(79,161,219);"></a><span>二 、Fulme 有什么特点</span></span></h2>
<p>
<span style="font-size:14px;">Fulme 特点如下： <br>
1、可靠性</span></p>
<p>
<span style="font-size:14px;">　　当节点出现故障时，日志能够被传送到其他节点上而不会丢失。Flume提供了三种级别的可靠性保障，从强到弱依次分别为：end-to-end（收到数据agent首先将event写到磁盘上，当数据传送成功后，再删除；如果数据发送失败，可以重新发送。），Store on failure（这也是scribe采用的策略，当数据接收方crash时，将数据写到本地，待恢复后，继续发送），Best effort（数据发送到接收方后，不会进行确认）。</span></p>
<p>
<span style="font-size:14px;">2、可扩展性 <br>
　 <br>
　　Flume采用了三层<a href="http://lib.csdn.net/base/architecture" rel="nofollow" class="replace_word" title="大型网站架构知识库" style="color:rgb(223,52,52);font-weight:bold;">架构</a>，分别为agent，collector和storage，每一层均可以水平扩展。其中，所有agent和collector由master统一管理，这使得系统容易监控和维护，且master允许有多个（使用ZooKeeper进行管理和负载均衡），这就避免了单点故障问题。</span></p>
<p>
<span style="font-size:14px;">3、可管理性</span></p>
<p>
<span style="font-size:14px;">　　所有agent和colletor由master统一管理，这使得系统便于维护。多master情况，Flume利用ZooKeeper和gossip，保证动态配置数据的一致性。用户可以在master上查看各个数据源或者数据流执行情况，且可以对各个数据源配置和动态加载。Flume提供了web 和shell script command两种形式对数据流进行管理。</span></p>
<p>
<span style="font-size:14px;">4、功能可扩展性</span></p>
<p>
<span style="font-size:14px;">　　用户可以根据需要添加自己的agent，collector或者storage。此外，Flume自带了很多组件，包括各种agent（file， syslog等），collector和storage（file，HDFS等）。</span></p>
<p>
<span style="font-size:14px;">5、文档丰富，社区活跃</span></p>
<p>
<span style="font-size:14px;">　　Flume 已经成为 <a href="http://lib.csdn.net/base/hadoop" rel="nofollow" class="replace_word" title="Hadoop知识库" style="color:rgb(223,52,52);font-weight:bold;">Hadoop</a> 生态系统的标配，它的文档比较丰富，社区比较活跃，方便我们学习。</span></p>
<h2 id="三flume-ng基本架构" style="font-weight:100;line-height:1.3em;">
<span style="font-size:14px;"><a name="t2" style="color:rgb(79,161,219);"></a><span>三、Flume NG基本架构</span></span></h2>
<p>
<span style="font-size:14px;">　　Flume NG是一个分布式、可靠、可用的系统，它能够将不同数据源的海量日志数据进行高效收集、聚合、移动，最后存储到一个中心化数据存储系统中。由原来的Flume OG到现在的Flume NG，进行了架构重构，并且现在NG版本完全不兼容原来的OG版本。经过架构重构后，Flume NG更像是一个轻量的小工具，非常简单，容易适应各种方式日志收集，并支持failover和负载均衡。</span></p>
<p>
<span style="font-size:14px;">　　Flume NG 的架构图如下所示。 <br>
　　<img src="https://img-blog.csdn.net/20160504213859027" alt="这里写图片描述" title="" style="border:none;">　　　 <br>
根据上图我们可以了解到Flume 的一些核心概念：</span></p>
<p>
<span style="font-size:14px;">1、Event：一个数据单元，带有一个可选的消息头。</span></p>
<p>
<span style="font-size:14px;">2、Flow：Event从源点到达目的点的迁移的抽象。</span></p>
<p>
<span style="font-size:14px;">3、Client：操作位于源点处的Event，将其发送到Flume Agent。</span></p>
<p>
<span style="font-size:14px;">4、Agent：一个独立的Flume进程，包含组件Source、Channel、Sink。</span></p>
<p>
<span style="font-size:14px;">5、Source：用来消费传递到该组件的Event。</span></p>
<p>
<span style="font-size:14px;">6、Channel：中转Event的一个临时存储，保存有Source组件传递过来的Event。</span></p>
<p>
<span style="font-size:14px;">7、Sink：从Channel中读取并移除Event，将Event传递到Flow Pipeline中的下一个Agent（如果有的话）</span></p>
<p>
<span style="font-size:14px;">在了解了Flume的核心概念之后，下面我们对各个核心概念进行深入剖析： <br><span>Event</span></span></p>
<p>
<span style="font-size:14px;">1、Event 是Flume数据传输的基本单元。</span></p>
<p>
<span style="font-size:14px;">2、Flume 以事件的形式将数据从源头传输到最终的目的。</span></p>
<p>
<span style="font-size:14px;">3、Event 由可选的header和载有数据的一个byte array构成。</span></p>
<p>
<span style="font-size:14px;">1）载有的数据对Flume是不透明的。</span></p>
<p>
<span style="font-size:14px;">2）Header 是容纳了key-value字符串对的无序集合，key在集合内是唯一的。</span></p>
<p>
<span style="font-size:14px;">3）Header 可以在上下文路由中使用扩展。 <br><span>Client</span></span></p>
<p>
<span style="font-size:14px;">1、Client 是一个将原始log包装成events并且发送它们到一个或者多个agent的实体。</span></p>
<p>
<span style="font-size:14px;">2、Client 在Flume的拓扑结构中不是必须的，它的目的是从数据源系统中解耦Flume <br><span>Agent</span></span></p>
<p>
<span style="font-size:14px;">1、一个Agent包含Source、Channel、Sink和其他组件。</span></p>
<p>
<span style="font-size:14px;">2、它利用这些组件将events从一个节点传输到另一个节点或最终目的地。</span></p>
<p>
<span style="font-size:14px;">3、agent是Flume流的基础部分。</span></p>
<p>
<span style="font-size:14px;">4、Flume 为这些组件提供了配置、生命周期管理、监控支持。</span></p>
<p>
<span><span style="font-size:14px;">Agent之Source</span></span></p>
<p>
<span style="font-size:14px;"><img src="https://img-blog.csdn.net/20160504214853644" alt="这里写图片描述" title="" style="border:none;"></span></p>
<p>
<span style="font-size:14px;">1、Source负责接收event或通过特殊机制产生event，并将events批量的放到一个或多个Channel。</span></p>
<p>
<span style="font-size:14px;">2、Source包含event驱动和轮询两种类型。</span></p>
<p>
<span style="font-size:14px;">3、Source 有不同的类型。</span></p>
<p>
<span style="font-size:14px;">1）与系统集成的Source：Syslog，NetCat。</span></p>
<p>
<span style="font-size:14px;">2）自动生成事件的Source：Exec</span></p>
<p>
<span style="font-size:14px;">3）用于Agent和Agent之间的通信的IPC Source：Avro、Thrift。</span></p>
<p>
<span style="font-size:14px;">4、Source必须至少和一个Channel关联。</span></p>
<p>
<span><span style="font-size:14px;">Agent之Channel与Sink</span></span></p>
<p>
<span style="font-size:14px;">Agent之Channel与Sink 的结构图如下所示：</span></p>
<p>
<span style="font-size:14px;"><img src="https://img-blog.csdn.net/20160504214813577" alt="这里写图片描述" title="" style="border:none;"> <br><span>Agent之Channel</span></span></p>
<p>
<span style="font-size:14px;">1、Channel位于Source和Sink之间，用于缓存进来的event。</span></p>
<p>
<span style="font-size:14px;">2、当Sink成功的将event发送到吓一跳的Channel或最终目的地，event才Channel中移除。</span></p>
<p>
<span style="font-size:14px;">3、不同的Channel提供的持久化水平也是不一样的：</span></p>
<p>
<span style="font-size:14px;">1）Memory Channel：volatile。</span></p>
<p>
<span style="font-size:14px;">2）File Channel：基于WAL实现。</span></p>
<p>
<span style="font-size:14px;">3）JDBC Channel：基于嵌入Database实现。</span></p>
<p>
<span style="font-size:14px;">4、Channel支持事物，提供较弱的顺序保证。</span></p>
<p>
<span style="font-size:14px;">5、Channel可以和任何数量的Source和Sink工作。</span></p>
<p>
<span><span style="font-size:14px;">Agent之Sink</span></span></p>
<p>
<span style="font-size:14px;">1、Sink负责将event传输到吓一跳或最终目的，成功完成后将event从Channel移除。</span></p>
<p>
<span style="font-size:14px;">2、有不同类型的Sink：</span></p>
<p>
<span style="font-size:14px;">1）存储event到最终目的的终端Sink。比如HDFS，<a href="http://lib.csdn.net/base/hbase" rel="nofollow" class="replace_word" title="Hbase知识库" style="color:rgb(223,52,52);font-weight:bold;">Hbase</a>。</span></p>
<p>
<span style="font-size:14px;">2）自动消耗的Sink。比如：Null Sink。</span></p>
<p>
<span style="font-size:14px;">3）用于Agent间通信的IPC sink：Avro。</span></p>
<p>
<span style="font-size:14px;">3、Sink必须作用于一个确切的Channel。</span></p>
<h2 id="四flume-ng安装部署" style="font-weight:100;line-height:1.3em;">
<span style="font-size:14px;"><a name="t3" style="color:rgb(79,161,219);"></a><span>四、Flume NG安装部署</span></span></h2>
<p>
<span style="font-size:14px;">　　下面我们来安装部署 Flume NG，这里我们安装配置两个节点cloud003、cloud004，以Avro Source+Memory Channel+HDFS Sink结合方式为例： <br>
　　1、下载flume安装包。 <br>
　　apache-flume-1.6.0-bin.tar.gz安装包分别解压到cloud003、cloud004节点上的/usr/<a href="http://lib.csdn.net/base/java" rel="nofollow" class="replace_word" title="Java 知识库" style="color:rgb(223,52,52);font-weight:bold;">Java</a>/<a href="http://lib.csdn.net/base/hadoop" rel="nofollow" class="replace_word" title="Hadoop知识库" style="color:rgb(223,52,52);font-weight:bold;">hadoop</a>/app/目录下。这里我们以cloud003为例，cloud004同样操作。</span></p>
<pre class="prettyprint" style="font-family:'Source Code Pro', monospace;line-height:1.45;color:rgb(51,51,51);background-color:rgba(128,128,128,.05);border:0px solid rgb(136,136,136);"><code class="hljs java has-numbering" style="display:block;background:transparent;color:inherit;font-family:'Source Code Pro', monospace;"><span style="font-size:14px;">[hadoop<span class="hljs-annotation" style="color:rgb(155,133,157);">@cloud</span>003 app]$ tar -zxvf apache-flume-<span class="hljs-number" style="color:rgb(0,102,102);">1.6</span><span class="hljs-number" style="color:rgb(0,102,102);">.0</span>-bin.tar.gz <span class="hljs-comment" style="color:rgb(136,0,0);">//解压</span>
[hadoop<span class="hljs-annotation" style="color:rgb(155,133,157);">@cloud</span>003 app]$ mv apache-flume-<span class="hljs-number" style="color:rgb(0,102,102);">1.6</span><span class="hljs-number" style="color:rgb(0,102,102);">.0</span>-bin flume <span class="hljs-comment" style="color:rgb(136,0,0);">//修改文件名称</span></span></code></pre><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;opacity:0;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li></ul><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li></ul><p>
<span style="font-size:14px;">2、在cloud003节点上，进入flume/conf目录。</span></p>
<pre class="prettyprint" style="font-family:'Source Code Pro', monospace;line-height:1.45;color:rgb(51,51,51);background-color:rgba(128,128,128,.05);border:0px solid rgb(136,136,136);"><code class="hljs avrasm has-numbering" style="display:block;background:transparent;color:inherit;font-family:'Source Code Pro', monospace;"><span style="font-size:14px;">[hadoop@cloud003 app]$ cd flume/conf
[hadoop@cloud003 conf]$ ls
flume-conf<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.properties</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.template</span>  flume-env<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.ps</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.template</span>  flume-env<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sh</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.template</span>  log4j<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.properties</span></span></code></pre><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;opacity:0;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li><li><span style="font-size:14px;">3</span></li></ul><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li><li><span style="font-size:14px;">3</span></li></ul><p>
<span style="font-size:14px;">需要通过flume-conf.properties.template复制一个flume-conf.properties配置文件。</span></p>
<pre class="prettyprint" style="font-family:'Source Code Pro', monospace;line-height:1.45;color:rgb(51,51,51);background-color:rgba(128,128,128,.05);border:0px solid rgb(136,136,136);"><code class="hljs avrasm has-numbering" style="display:block;background:transparent;color:inherit;font-family:'Source Code Pro', monospace;"><span style="font-size:14px;">[hadoop@cloud003 conf]$ <span class="hljs-keyword" style="color:rgb(0,0,136);">cp</span> flume-conf<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.properties</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.template</span> flume-conf<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.properties</span>
[hadoop@cloud003 conf]$ ls
flume-conf<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.properties</span>   flume-conf<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.properties</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.template</span>  flume-env<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.ps</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.template</span>  flume-env<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sh</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.template</span>  log4j<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.properties</span></span></code></pre><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;opacity:0;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li><li><span style="font-size:14px;">3</span></li></ul><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li><li><span style="font-size:14px;">3</span></li></ul><p>
<span style="font-size:14px;">修改cloud003节点上的flume-conf.properties配置文件。这里收集日志文件到收集端。配置参数的详细说明可以参考官方文档。</span></p>
<pre class="prettyprint" style="font-family:'Source Code Pro', monospace;line-height:1.45;color:rgb(51,51,51);background-color:rgba(128,128,128,.05);border:0px solid rgb(136,136,136);"><code class="hljs avrasm has-numbering" style="display:block;background:transparent;color:inherit;font-family:'Source Code Pro', monospace;"><span style="font-size:14px;">[hadoop@cloud003 conf]$ vi flume-conf<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.properties</span>
 <span class="hljs-preprocessor" style="color:rgb(68,68,68);">#定义source、channel、sink 名称</span>
 a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sources</span>  = <span class="hljs-built_in" style="color:rgb(102,0,102);">r1</span>       //这里的a1命名可以自定义，但需要跟后面启动配置名称一致就可以
 a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sinks</span> =  k1
 a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.channels</span>  = c1

 <span class="hljs-preprocessor" style="color:rgb(68,68,68);">#定义并配置r1</span>
 a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sources</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.r</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.channels</span> = c1    
 a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sources</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.r</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.type</span> = avro  //source类型
 a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sources</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.r</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.bind</span> = <span class="hljs-number" style="color:rgb(0,102,102);">0.0</span><span class="hljs-number" style="color:rgb(0,102,102);">.0</span><span class="hljs-number" style="color:rgb(0,102,102);">.0</span>   //默认绑定本机
 a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sources</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.r</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.port</span>=<span class="hljs-number" style="color:rgb(0,102,102);">41414</span>   //默认端口

 <span class="hljs-preprocessor" style="color:rgb(68,68,68);"># 定义并配置k1</span>
 a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sinks</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.k</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.channel</span> = c1
 a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sinks</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.k</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.type</span> = avro    //sink类型
 a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sinks</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.k</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.hostname</span> = cloud004    //将数据传递给cloud004
 a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sinks</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.k</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.port</span> = <span class="hljs-number" style="color:rgb(0,102,102);">41414</span>   //默认端口号

 <span class="hljs-preprocessor" style="color:rgb(68,68,68);">#定义并配置c1</span>
 a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.channels</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.c</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.type</span>=FILE   //channel类型</span></code></pre><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;opacity:0;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li><li><span style="font-size:14px;">3</span></li><li><span style="font-size:14px;">4</span></li><li><span style="font-size:14px;">5</span></li><li><span style="font-size:14px;">6</span></li><li><span style="font-size:14px;">7</span></li><li><span style="font-size:14px;">8</span></li><li><span style="font-size:14px;">9</span></li><li><span style="font-size:14px;">10</span></li><li><span style="font-size:14px;">11</span></li><li><span style="font-size:14px;">12</span></li><li><span style="font-size:14px;">13</span></li><li><span style="font-size:14px;">14</span></li><li><span style="font-size:14px;">15</span></li><li><span style="font-size:14px;">16</span></li><li><span style="font-size:14px;">17</span></li><li><span style="font-size:14px;">18</span></li><li><span style="font-size:14px;">19</span></li><li><span style="font-size:14px;">20</span></li></ul><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li><li><span style="font-size:14px;">3</span></li><li><span style="font-size:14px;">4</span></li><li><span style="font-size:14px;">5</span></li><li><span style="font-size:14px;">6</span></li><li><span style="font-size:14px;">7</span></li><li><span style="font-size:14px;">8</span></li><li><span style="font-size:14px;">9</span></li><li><span style="font-size:14px;">10</span></li><li><span style="font-size:14px;">11</span></li><li><span style="font-size:14px;">12</span></li><li><span style="font-size:14px;">13</span></li><li><span style="font-size:14px;">14</span></li><li><span style="font-size:14px;">15</span></li><li><span style="font-size:14px;">16</span></li><li><span style="font-size:14px;">17</span></li><li><span style="font-size:14px;">18</span></li><li><span style="font-size:14px;">19</span></li><li><span style="font-size:14px;">20</span></li></ul><p>
<span style="font-size:14px;">3、在cloud004节点上，进入flume/conf目录。</span></p>
<pre class="prettyprint" style="font-family:'Source Code Pro', monospace;line-height:1.45;color:rgb(51,51,51);background-color:rgba(128,128,128,.05);border:0px solid rgb(136,136,136);"><code class="hljs avrasm has-numbering" style="display:block;background:transparent;color:inherit;font-family:'Source Code Pro', monospace;"><span style="font-size:14px;">[hadoop@cloud004 app]$ cd flume/conf
[hadoop@cloud004 conf]$ ls
flume-conf<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.properties</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.template</span>  flume-env<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.ps</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.template</span>  flume-env<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sh</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.template</span>  log4j<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.properties</span></span></code></pre><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;opacity:0;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li><li><span style="font-size:14px;">3</span></li></ul><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li><li><span style="font-size:14px;">3</span></li></ul><p>
<span style="font-size:14px;">需要通过flume-conf.properties.template复制一个flume-conf.properties配置文件。</span></p>
<pre class="prettyprint" style="font-family:'Source Code Pro', monospace;line-height:1.45;color:rgb(51,51,51);background-color:rgba(128,128,128,.05);border:0px solid rgb(136,136,136);"><code class="hljs avrasm has-numbering" style="display:block;background:transparent;color:inherit;font-family:'Source Code Pro', monospace;"><span style="font-size:14px;">[hadoop@cloud004 conf]$ <span class="hljs-keyword" style="color:rgb(0,0,136);">cp</span> flume-conf<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.properties</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.template</span> flume-conf<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.properties</span>
[hadoop@cloud004 conf]$ ls
flume-conf<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.properties</span>   flume-conf<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.properties</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.template</span>  flume-env<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.ps</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.template</span>  flume-env<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sh</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.template</span>  log4j<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.properties</span></span></code></pre><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;opacity:0;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li><li><span style="font-size:14px;">3</span></li></ul><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li><li><span style="font-size:14px;">3</span></li></ul><p>
<span style="font-size:14px;">修改cloud004节点上的flume-conf.properties配置文件。从cloud003端接收数据，然后写入到HDFS文件系统中。配置参数的详细说明可以参考官方文档。</span></p>
<pre class="prettyprint" style="font-family:'Source Code Pro', monospace;line-height:1.45;color:rgb(51,51,51);background-color:rgba(128,128,128,.05);border:0px solid rgb(136,136,136);"><code class="hljs avrasm has-numbering" style="display:block;background:transparent;color:inherit;font-family:'Source Code Pro', monospace;"><span style="font-size:14px;">[hadoop@cloud004 conf]$ vi flume-conf<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.properties</span>
<span class="hljs-preprocessor" style="color:rgb(68,68,68);"># 定义source、channel、sink 名称</span>
a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sources</span> = <span class="hljs-built_in" style="color:rgb(102,0,102);">r1</span>
a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sinks</span> = k1
a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.channels</span> = c1

<span class="hljs-preprocessor" style="color:rgb(68,68,68);">#定义并配置 r1</span>
a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sources</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.r</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.type</span>  = avro  //这里要跟cloud003端的sink类型一致
a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sources</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.r</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.bind</span>  = <span class="hljs-number" style="color:rgb(0,102,102);">0.0</span><span class="hljs-number" style="color:rgb(0,102,102);">.0</span><span class="hljs-number" style="color:rgb(0,102,102);">.0</span>
a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sources</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.r</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.port</span>  = <span class="hljs-number" style="color:rgb(0,102,102);">41414</span>
a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sources</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.r</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.channels</span> = c1

<span class="hljs-preprocessor" style="color:rgb(68,68,68);">#定义并配置k1</span>
a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sinks</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.k</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.channel</span> = c1
a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sinks</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.k</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.type</span>=hdfs   //sink的输出类型为hdfs
a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sinks</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.k</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.hdfs</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.path</span>=hdfs://cloud001:<span class="hljs-number" style="color:rgb(0,102,102);">9000</span>/data/flume   //hdfs上传文件路径
a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.sinks</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.k</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.hdfs</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.fileType</span>=DataStream

<span class="hljs-preprocessor" style="color:rgb(68,68,68);">#定义并配置c1</span>
a1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.channels</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.c</span>1<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.type</span>=File</span></code></pre><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;opacity:0;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li><li><span style="font-size:14px;">3</span></li><li><span style="font-size:14px;">4</span></li><li><span style="font-size:14px;">5</span></li><li><span style="font-size:14px;">6</span></li><li><span style="font-size:14px;">7</span></li><li><span style="font-size:14px;">8</span></li><li><span style="font-size:14px;">9</span></li><li><span style="font-size:14px;">10</span></li><li><span style="font-size:14px;">11</span></li><li><span style="font-size:14px;">12</span></li><li><span style="font-size:14px;">13</span></li><li><span style="font-size:14px;">14</span></li><li><span style="font-size:14px;">15</span></li><li><span style="font-size:14px;">16</span></li><li><span style="font-size:14px;">17</span></li><li><span style="font-size:14px;">18</span></li><li><span style="font-size:14px;">19</span></li><li><span style="font-size:14px;">20</span></li></ul><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li><li><span style="font-size:14px;">3</span></li><li><span style="font-size:14px;">4</span></li><li><span style="font-size:14px;">5</span></li><li><span style="font-size:14px;">6</span></li><li><span style="font-size:14px;">7</span></li><li><span style="font-size:14px;">8</span></li><li><span style="font-size:14px;">9</span></li><li><span style="font-size:14px;">10</span></li><li><span style="font-size:14px;">11</span></li><li><span style="font-size:14px;">12</span></li><li><span style="font-size:14px;">13</span></li><li><span style="font-size:14px;">14</span></li><li><span style="font-size:14px;">15</span></li><li><span style="font-size:14px;">16</span></li><li><span style="font-size:14px;">17</span></li><li><span style="font-size:14px;">18</span></li><li><span style="font-size:14px;">19</span></li><li><span style="font-size:14px;">20</span></li></ul><p>
<span style="font-size:14px;">4、首先要保证 Hadoop 集群正常运行，这里cloud001是Namenode。</span></p>
<pre class="prettyprint" style="font-family:'Source Code Pro', monospace;line-height:1.45;color:rgb(51,51,51);background-color:rgba(128,128,128,.05);border:0px solid rgb(136,136,136);"><code class="hljs ruby has-numbering" style="display:block;background:transparent;color:inherit;font-family:'Source Code Pro', monospace;"><span style="font-size:14px;">[hadoop<span class="hljs-variable" style="color:rgb(102,0,102);">@cloud001</span> hadoop]<span class="hljs-variable" style="color:rgb(102,0,102);">$ </span>jps
<span class="hljs-number" style="color:rgb(0,102,102);">2625</span> <span class="hljs-constant">JournalNode</span>
<span class="hljs-number" style="color:rgb(0,102,102);">1563</span> <span class="hljs-constant">QuorumPeerMain</span>
<span class="hljs-number" style="color:rgb(0,102,102);">18808</span> <span class="hljs-constant">NameNode</span>
<span class="hljs-number" style="color:rgb(0,102,102);">26146</span> <span class="hljs-constant">Jps</span>
<span class="hljs-number" style="color:rgb(0,102,102);">3583</span> <span class="hljs-constant">ResourceManager</span></span></code></pre><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;opacity:0;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li><li><span style="font-size:14px;">3</span></li><li><span style="font-size:14px;">4</span></li><li><span style="font-size:14px;">5</span></li><li><span style="font-size:14px;">6</span></li></ul><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li><li><span style="font-size:14px;">3</span></li><li><span style="font-size:14px;">4</span></li><li><span style="font-size:14px;">5</span></li><li><span style="font-size:14px;">6</span></li></ul><p>
<span style="font-size:14px;">5、首先在cloud004节点上启动Agent，保证能接受传过来的数据，然后传递给hdfs。</span></p>
<pre class="prettyprint" style="font-family:'Source Code Pro', monospace;line-height:1.45;color:rgb(51,51,51);background-color:rgba(128,128,128,.05);border:0px solid rgb(136,136,136);"><code class="hljs avrasm has-numbering" style="display:block;background:transparent;color:inherit;font-family:'Source Code Pro', monospace;"><span style="font-size:14px;">[hadoop@cloud003 flume]$ bin/flume-ng agent -c ./conf/ -f conf/flume-conf<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.properties</span> -Dflume<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.root</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.logger</span>=INFO,console -n a1
<span class="hljs-label">Info:</span> Including Hadoop libraries found via (/usr/java/hadoop/bin/hadoop) for HDFS access
<span class="hljs-label">Info:</span> Excluding /usr/java/hadoop/share/hadoop/common/lib/slf4j-api-<span class="hljs-number" style="color:rgb(0,102,102);">1.7</span><span class="hljs-number" style="color:rgb(0,102,102);">.5</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.jar</span> from classpath
<span class="hljs-label">Info:</span> Excluding /usr/java/hadoop/share/hadoop/common/lib/slf4j-log4j12-<span class="hljs-number" style="color:rgb(0,102,102);">1.7</span><span class="hljs-number" style="color:rgb(0,102,102);">.5</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.jar</span> from classpath
<span class="hljs-label">Info:</span> Including Hive libraries found via () for Hive access
<span class="hljs-number" style="color:rgb(0,102,102);">2015</span>-<span class="hljs-number" style="color:rgb(0,102,102);">08</span>-<span class="hljs-number" style="color:rgb(0,102,102);">25</span> <span class="hljs-number" style="color:rgb(0,102,102);">08</span>:<span class="hljs-number" style="color:rgb(0,102,102);">54</span>:<span class="hljs-number" style="color:rgb(0,102,102);">22</span>,<span class="hljs-number" style="color:rgb(0,102,102);">018</span> (conf-file-poller-<span class="hljs-number" style="color:rgb(0,102,102);">0</span>) [INFO - org<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.apache</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.flume</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.node</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.PollingPropertiesFileConfigurationProvider</span>$FileWatcherRunnable<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.run</span>(PollingPropertiesFileConfigurationProvider<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.java</span>:<span class="hljs-number" style="color:rgb(0,102,102);">133</span>)] Reloading configuration file:conf/flume-conf<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.properties</span>
<span class="hljs-number" style="color:rgb(0,102,102);">2015</span>-<span class="hljs-number" style="color:rgb(0,102,102);">08</span>-<span class="hljs-number" style="color:rgb(0,102,102);">25</span> <span class="hljs-number" style="color:rgb(0,102,102);">08</span>:<span class="hljs-number" style="color:rgb(0,102,102);">54</span>:<span class="hljs-number" style="color:rgb(0,102,102);">22</span>,<span class="hljs-number" style="color:rgb(0,102,102);">033</span> (conf-file-poller-<span class="hljs-number" style="color:rgb(0,102,102);">0</span>) [INFO - org<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.apache</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.flume</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.conf</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.FlumeConfiguration</span>$AgentConfiguration<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.addProperty</span>(FlumeConfiguration<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.java</span>:<span class="hljs-number" style="color:rgb(0,102,102);">1017</span>)] Processing:k1
<span class="hljs-number" style="color:rgb(0,102,102);">2015</span>-<span class="hljs-number" style="color:rgb(0,102,102);">08</span>-<span class="hljs-number" style="color:rgb(0,102,102);">25</span> <span class="hljs-number" style="color:rgb(0,102,102);">08</span>:<span class="hljs-number" style="color:rgb(0,102,102);">54</span>:<span class="hljs-number" style="color:rgb(0,102,102);">22</span>,<span class="hljs-number" style="color:rgb(0,102,102);">829</span> (lifecycleSupervisor-<span class="hljs-number" style="color:rgb(0,102,102);">1</span>-<span class="hljs-number" style="color:rgb(0,102,102);">0</span>) [INFO - org<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.apache</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.flume</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.instrumentation</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.MonitoredCounterGroup</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.start</span>(MonitoredCounterGroup<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.java</span>:<span class="hljs-number" style="color:rgb(0,102,102);">96</span>)] Component type: CHANNEL, name: c1 started
<span class="hljs-number" style="color:rgb(0,102,102);">2015</span>-<span class="hljs-number" style="color:rgb(0,102,102);">08</span>-<span class="hljs-number" style="color:rgb(0,102,102);">25</span> <span class="hljs-number" style="color:rgb(0,102,102);">08</span>:<span class="hljs-number" style="color:rgb(0,102,102);">54</span>:<span class="hljs-number" style="color:rgb(0,102,102);">22</span>,<span class="hljs-number" style="color:rgb(0,102,102);">830</span> (conf-file-poller-<span class="hljs-number" style="color:rgb(0,102,102);">0</span>) [INFO - org<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.apache</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.flume</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.node</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.Application</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.startAllComponents</span>(Application<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.java</span>:<span class="hljs-number" style="color:rgb(0,102,102);">173</span>)] Starting Sink k1
<span class="hljs-number" style="color:rgb(0,102,102);">2015</span>-<span class="hljs-number" style="color:rgb(0,102,102);">08</span>-<span class="hljs-number" style="color:rgb(0,102,102);">25</span> <span class="hljs-number" style="color:rgb(0,102,102);">08</span>:<span class="hljs-number" style="color:rgb(0,102,102);">54</span>:<span class="hljs-number" style="color:rgb(0,102,102);">22</span>,<span class="hljs-number" style="color:rgb(0,102,102);">830</span> (conf-file-poller-<span class="hljs-number" style="color:rgb(0,102,102);">0</span>) [INFO - org<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.apache</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.flume</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.node</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.Application</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.startAllComponents</span>(Application<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.java</span>:<span class="hljs-number" style="color:rgb(0,102,102);">184</span>)] Starting Source <span class="hljs-built_in" style="color:rgb(102,0,102);">r1</span>
<span class="hljs-number" style="color:rgb(0,102,102);">2015</span>-<span class="hljs-number" style="color:rgb(0,102,102);">08</span>-<span class="hljs-number" style="color:rgb(0,102,102);">25</span> <span class="hljs-number" style="color:rgb(0,102,102);">08</span>:<span class="hljs-number" style="color:rgb(0,102,102);">54</span>:<span class="hljs-number" style="color:rgb(0,102,102);">22</span>,<span class="hljs-number" style="color:rgb(0,102,102);">832</span> (lifecycleSupervisor-<span class="hljs-number" style="color:rgb(0,102,102);">1</span>-<span class="hljs-number" style="color:rgb(0,102,102);">4</span>) [INFO - org<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.apache</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.flume</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.source</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.AvroSource</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.start</span>(AvroSource<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.java</span>:<span class="hljs-number" style="color:rgb(0,102,102);">228</span>)] Starting Avro source <span class="hljs-built_in" style="color:rgb(102,0,102);">r1</span>: { bindAddress: <span class="hljs-number" style="color:rgb(0,102,102);">0.0</span><span class="hljs-number" style="color:rgb(0,102,102);">.0</span><span class="hljs-number" style="color:rgb(0,102,102);">.0</span>, port: <span class="hljs-number" style="color:rgb(0,102,102);">41414</span> }...
<span class="hljs-number" style="color:rgb(0,102,102);">2015</span>-<span class="hljs-number" style="color:rgb(0,102,102);">08</span>-<span class="hljs-number" style="color:rgb(0,102,102);">25</span> <span class="hljs-number" style="color:rgb(0,102,102);">08</span>:<span class="hljs-number" style="color:rgb(0,102,102);">54</span>:<span class="hljs-number" style="color:rgb(0,102,102);">22</span>,<span class="hljs-number" style="color:rgb(0,102,102);">835</span> (lifecycleSupervisor-<span class="hljs-number" style="color:rgb(0,102,102);">1</span>-<span class="hljs-number" style="color:rgb(0,102,102);">1</span>) [INFO - org<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.apache</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.flume</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.instrumentation</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.MonitoredCounterGroup</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.register</span>(MonitoredCounterGroup<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.java</span>:<span class="hljs-number" style="color:rgb(0,102,102);">120</span>)] Monitored counter group for type: SINK, name: k1: Successfully registered new MBean.
<span class="hljs-number" style="color:rgb(0,102,102);">2015</span>-<span class="hljs-number" style="color:rgb(0,102,102);">08</span>-<span class="hljs-number" style="color:rgb(0,102,102);">25</span> <span class="hljs-number" style="color:rgb(0,102,102);">08</span>:<span class="hljs-number" style="color:rgb(0,102,102);">54</span>:<span class="hljs-number" style="color:rgb(0,102,102);">22</span>,<span class="hljs-number" style="color:rgb(0,102,102);">835</span> (lifecycleSupervisor-<span class="hljs-number" style="color:rgb(0,102,102);">1</span>-<span class="hljs-number" style="color:rgb(0,102,102);">1</span>) [INFO - org<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.apache</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.flume</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.instrumentation</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.MonitoredCounterGroup</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.start</span>(MonitoredCounterGroup<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.java</span>:<span class="hljs-number" style="color:rgb(0,102,102);">96</span>)] Component type: SINK, name: k1 started
<span class="hljs-number" style="color:rgb(0,102,102);">2015</span>-<span class="hljs-number" style="color:rgb(0,102,102);">08</span>-<span class="hljs-number" style="color:rgb(0,102,102);">25</span> <span class="hljs-number" style="color:rgb(0,102,102);">08</span>:<span class="hljs-number" style="color:rgb(0,102,102);">54</span>:<span class="hljs-number" style="color:rgb(0,102,102);">23</span>,<span class="hljs-number" style="color:rgb(0,102,102);">326</span> (lifecycleSupervisor-<span class="hljs-number" style="color:rgb(0,102,102);">1</span>-<span class="hljs-number" style="color:rgb(0,102,102);">4</span>) [INFO - org<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.apache</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.flume</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.instrumentation</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.MonitoredCounterGroup</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.register</span>(MonitoredCounterGroup<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.java</span>:<span class="hljs-number" style="color:rgb(0,102,102);">120</span>)] Monitored counter group for type: SOURCE, name: <span class="hljs-built_in" style="color:rgb(102,0,102);">r1</span>: Successfully registered new MBean.
<span class="hljs-number" style="color:rgb(0,102,102);">2015</span>-<span class="hljs-number" style="color:rgb(0,102,102);">08</span>-<span class="hljs-number" style="color:rgb(0,102,102);">25</span> <span class="hljs-number" style="color:rgb(0,102,102);">08</span>:<span class="hljs-number" style="color:rgb(0,102,102);">54</span>:<span class="hljs-number" style="color:rgb(0,102,102);">23</span>,<span class="hljs-number" style="color:rgb(0,102,102);">327</span> (lifecycleSupervisor-<span class="hljs-number" style="color:rgb(0,102,102);">1</span>-<span class="hljs-number" style="color:rgb(0,102,102);">4</span>) [INFO - org<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.apache</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.flume</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.instrumentation</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.MonitoredCounterGroup</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.start</span>(MonitoredCounterGroup<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.java</span>:<span class="hljs-number" style="color:rgb(0,102,102);">96</span>)] Component type: SOURCE, name: <span class="hljs-built_in" style="color:rgb(102,0,102);">r1</span> started
<span class="hljs-number" style="color:rgb(0,102,102);">2015</span>-<span class="hljs-number" style="color:rgb(0,102,102);">08</span>-<span class="hljs-number" style="color:rgb(0,102,102);">25</span> <span class="hljs-number" style="color:rgb(0,102,102);">08</span>:<span class="hljs-number" style="color:rgb(0,102,102);">54</span>:<span class="hljs-number" style="color:rgb(0,102,102);">23</span>,<span class="hljs-number" style="color:rgb(0,102,102);">328</span> (lifecycleSupervisor-<span class="hljs-number" style="color:rgb(0,102,102);">1</span>-<span class="hljs-number" style="color:rgb(0,102,102);">4</span>) [INFO - org<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.apache</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.flume</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.source</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.AvroSource</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.start</span>(AvroSource<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.java</span>:<span class="hljs-number" style="color:rgb(0,102,102);">253</span>)] Avro source <span class="hljs-built_in" style="color:rgb(102,0,102);">r1</span> started.</span></code></pre><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;opacity:0;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li><li><span style="font-size:14px;">3</span></li><li><span style="font-size:14px;">4</span></li><li><span style="font-size:14px;">5</span></li><li><span style="font-size:14px;">6</span></li><li><span style="font-size:14px;">7</span></li><li><span style="font-size:14px;">8</span></li><li><span style="font-size:14px;">9</span></li><li><span style="font-size:14px;">10</span></li><li><span style="font-size:14px;">11</span></li><li><span style="font-size:14px;">12</span></li><li><span style="font-size:14px;">13</span></li><li><span style="font-size:14px;">14</span></li><li><span style="font-size:14px;">15</span></li><li><span style="font-size:14px;">16</span></li></ul><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li><li><span style="font-size:14px;">3</span></li><li><span style="font-size:14px;">4</span></li><li><span style="font-size:14px;">5</span></li><li><span style="font-size:14px;">6</span></li><li><span style="font-size:14px;">7</span></li><li><span style="font-size:14px;">8</span></li><li><span style="font-size:14px;">9</span></li><li><span style="font-size:14px;">10</span></li><li><span style="font-size:14px;">11</span></li><li><span style="font-size:14px;">12</span></li><li><span style="font-size:14px;">13</span></li><li><span style="font-size:14px;">14</span></li><li><span style="font-size:14px;">15</span></li><li><span style="font-size:14px;">16</span></li></ul><p>
<span style="font-size:14px;">需要注意的是：-n a1中的参数值a1必须与flume-conf.properties配置文件的a1名称一致。</span></p>
<p>
<span style="font-size:14px;">6、在cloud003节点上，启动Avro Client，发送数据给cloud004节点的agent。</span></p>
<pre class="prettyprint" style="font-family:'Source Code Pro', monospace;line-height:1.45;color:rgb(51,51,51);background-color:rgba(128,128,128,.05);border:0px solid rgb(136,136,136);"><code class="hljs avrasm has-numbering" style="display:block;background:transparent;color:inherit;font-family:'Source Code Pro', monospace;"><span style="font-size:14px;">[hadoop@cloud003 flume]$ bin/flume-ng avro-client -c ./conf/ -H cloud004 -p <span class="hljs-number" style="color:rgb(0,102,102);">41414</span> -F /usr/java/hadoop/app/flume/mydata/<span class="hljs-number" style="color:rgb(0,102,102);">2.</span>log -Dflume<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.root</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.logger</span>=DEBUG,console
<span class="hljs-label">Info:</span> Including Hadoop libraries found via (/usr/java/hadoop/bin/hadoop) for HDFS access
<span class="hljs-label">Info:</span> Excluding /usr/java/hadoop/share/hadoop/common/lib/slf4j-api-<span class="hljs-number" style="color:rgb(0,102,102);">1.7</span><span class="hljs-number" style="color:rgb(0,102,102);">.5</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.jar</span> from classpath
<span class="hljs-label">Info:</span> Excluding /usr/java/hadoop/share/hadoop/common/lib/slf4j-log4j12-<span class="hljs-number" style="color:rgb(0,102,102);">1.7</span><span class="hljs-number" style="color:rgb(0,102,102);">.5</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.jar</span> from classpath
<span class="hljs-label">Info:</span> Including Hive libraries found via () for Hive access
<span class="hljs-number" style="color:rgb(0,102,102);">2015</span>-<span class="hljs-number" style="color:rgb(0,102,102);">08</span>-<span class="hljs-number" style="color:rgb(0,102,102);">25</span> <span class="hljs-number" style="color:rgb(0,102,102);">09</span>:<span class="hljs-number" style="color:rgb(0,102,102);">10</span>:<span class="hljs-number" style="color:rgb(0,102,102);">42</span>,<span class="hljs-number" style="color:rgb(0,102,102);">629</span> (main) [DEBUG - org<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.apache</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.flume</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.api</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.NettyAvroRpcClient</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.configure</span>(NettyAvroRpcClient<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.java</span>:<span class="hljs-number" style="color:rgb(0,102,102);">499</span>)] Batch size string = <span class="hljs-number" style="color:rgb(0,102,102);">5</span>
<span class="hljs-number" style="color:rgb(0,102,102);">2015</span>-<span class="hljs-number" style="color:rgb(0,102,102);">08</span>-<span class="hljs-number" style="color:rgb(0,102,102);">25</span> <span class="hljs-number" style="color:rgb(0,102,102);">09</span>:<span class="hljs-number" style="color:rgb(0,102,102);">10</span>:<span class="hljs-number" style="color:rgb(0,102,102);">42</span>,<span class="hljs-number" style="color:rgb(0,102,102);">672</span> (main) [WARN - org<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.apache</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.flume</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.api</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.NettyAvroRpcClient</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.configure</span>(NettyAvroRpcClient<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.java</span>:<span class="hljs-number" style="color:rgb(0,102,102);">634</span>)] Using default maxIOWorkers
<span class="hljs-number" style="color:rgb(0,102,102);">2015</span>-<span class="hljs-number" style="color:rgb(0,102,102);">08</span>-<span class="hljs-number" style="color:rgb(0,102,102);">25</span> <span class="hljs-number" style="color:rgb(0,102,102);">09</span>:<span class="hljs-number" style="color:rgb(0,102,102);">10</span>:<span class="hljs-number" style="color:rgb(0,102,102);">43</span>,<span class="hljs-number" style="color:rgb(0,102,102);">548</span> (main) [DEBUG - org<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.apache</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.flume</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.client</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.avro</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.AvroCLIClient</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.run</span>(AvroCLIClient<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.java</span>:<span class="hljs-number" style="color:rgb(0,102,102);">234</span>)] Finished
<span class="hljs-number" style="color:rgb(0,102,102);">2015</span>-<span class="hljs-number" style="color:rgb(0,102,102);">08</span>-<span class="hljs-number" style="color:rgb(0,102,102);">25</span> <span class="hljs-number" style="color:rgb(0,102,102);">09</span>:<span class="hljs-number" style="color:rgb(0,102,102);">10</span>:<span class="hljs-number" style="color:rgb(0,102,102);">43</span>,<span class="hljs-number" style="color:rgb(0,102,102);">548</span> (main) [DEBUG - org<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.apache</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.flume</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.client</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.avro</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.AvroCLIClient</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.run</span>(AvroCLIClient<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.java</span>:<span class="hljs-number" style="color:rgb(0,102,102);">237</span>)] Closing reader
<span class="hljs-number" style="color:rgb(0,102,102);">2015</span>-<span class="hljs-number" style="color:rgb(0,102,102);">08</span>-<span class="hljs-number" style="color:rgb(0,102,102);">25</span> <span class="hljs-number" style="color:rgb(0,102,102);">09</span>:<span class="hljs-number" style="color:rgb(0,102,102);">10</span>:<span class="hljs-number" style="color:rgb(0,102,102);">43</span>,<span class="hljs-number" style="color:rgb(0,102,102);">550</span> (main) [DEBUG - org<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.apache</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.flume</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.client</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.avro</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.AvroCLIClient</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.run</span>(AvroCLIClient<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.java</span>:<span class="hljs-number" style="color:rgb(0,102,102);">241</span>)] Closing RPC client
<span class="hljs-number" style="color:rgb(0,102,102);">2015</span>-<span class="hljs-number" style="color:rgb(0,102,102);">08</span>-<span class="hljs-number" style="color:rgb(0,102,102);">25</span> <span class="hljs-number" style="color:rgb(0,102,102);">09</span>:<span class="hljs-number" style="color:rgb(0,102,102);">10</span>:<span class="hljs-number" style="color:rgb(0,102,102);">43</span>,<span class="hljs-number" style="color:rgb(0,102,102);">567</span> (main) [DEBUG - org<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.apache</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.flume</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.client</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.avro</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.AvroCLIClient</span><span class="hljs-preprocessor" style="color:rgb(68,68,68);">.main</span>(AvroCLIClient<span class="hljs-preprocessor" style="color:rgb(68,68,68);">.java</span>:<span class="hljs-number" style="color:rgb(0,102,102);">84</span>)] Exiting</span></code></pre><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;opacity:0;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li><li><span style="font-size:14px;">3</span></li><li><span style="font-size:14px;">4</span></li><li><span style="font-size:14px;">5</span></li><li><span style="font-size:14px;">6</span></li><li><span style="font-size:14px;">7</span></li><li><span style="font-size:14px;">8</span></li><li><span style="font-size:14px;">9</span></li><li><span style="font-size:14px;">10</span></li><li><span style="font-size:14px;">11</span></li></ul><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li><li><span style="font-size:14px;">3</span></li><li><span style="font-size:14px;">4</span></li><li><span style="font-size:14px;">5</span></li><li><span style="font-size:14px;">6</span></li><li><span style="font-size:14px;">7</span></li><li><span style="font-size:14px;">8</span></li><li><span style="font-size:14px;">9</span></li><li><span style="font-size:14px;">10</span></li><li><span style="font-size:14px;">11</span></li></ul><p>
<span style="font-size:14px;">需要注意：-H cloud004中的cloud004是agent节点地址，-F /usr/java/hadoop/app/flume/mydata/2.log 是发送的日志文件内容。</span></p>
<p>
<span style="font-size:14px;">7、查看HDFS上同步过来的数据。</span></p>
<pre class="prettyprint" style="font-family:'Source Code Pro', monospace;line-height:1.45;color:rgb(51,51,51);background-color:rgba(128,128,128,.05);border:0px solid rgb(136,136,136);"><code class="hljs haskell has-numbering" style="display:block;background:transparent;color:inherit;font-family:'Source Code Pro', monospace;"><span style="font-size:14px;">[hadoop@cloud001 hadoop]$ hadoop fs -ls /<span class="hljs-typedef"><span class="hljs-keyword" style="color:rgb(0,0,136);">data</span>/flume/</span>
<span class="hljs-type" style="color:rgb(102,0,102);">Found</span> <span class="hljs-number" style="color:rgb(0,102,102);">1</span> items
-rw-r<span class="hljs-comment" style="color:rgb(136,0,0);">--r--   3 hadoop supergroup         21 2015-08-25 09:11 /data/flume/FlumeData.1440465043429</span></span></code></pre><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;opacity:0;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li><li><span style="font-size:14px;">3</span></li></ul><ul class="pre-numbering" style="width:50px;background-color:rgb(238,238,238);border-right:1px solid rgb(221,221,221);list-style:none;text-align:right;"><li><span style="font-size:14px;">1</span></li><li><span style="font-size:14px;">2</span></li><li><span style="font-size:14px;">3</span></li></ul></div>
</div>
<div class="bdsharebuttonbox tracking-ad bdshare-button-style0-16" style="font-family:Arial, Console, Verdana, 'Courier New';">
<a href="http://blog.csdn.net/u010330043/article/details/51318407#" rel="nofollow" class="bds_more" style="color:rgb(51,51,51);line-height:16px;"></a><a href="http://blog.csdn.net/u010330043/article/details/51318407#" rel="nofollow" class="bds_qzone" title="分享到QQ空间" style="color:rgb(255,153,0);line-height:16px;"></a><a href="http://blog.csdn.net/u010330043/article/details/51318407#" rel="nofollow" class="bds_tsina" title="分享到新浪微博" style="color:rgb(255,153,0);line-height:16px;"></a><a href="http://blog.csdn.net/u010330043/article/details/51318407#" rel="nofollow" class="bds_tqq" title="分享到腾讯微博" style="color:rgb(255,153,0);line-height:16px;"></a><a href="http://blog.csdn.net/u010330043/article/details/51318407#" rel="nofollow" class="bds_renren" title="分享到人人网" style="color:rgb(255,153,0);line-height:16px;"></a><a href="http://blog.csdn.net/u010330043/article/details/51318407#" rel="nofollow" class="bds_weixin" title="分享到微信" style="color:rgb(255,153,0);line-height:16px;"></a></div>
<div id="digg" style="clear:both;width:182px;text-align:center;font-family:Arial, Console, Verdana, 'Courier New';">
</div>
            </div>
                </div>