---
layout:     post
title:      Flume监听文件目录sink至hdfs配置
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<table cellspacing="0" cellpadding="0" style="border-collapse:collapse;table-layout:fixed;font-family:Tahoma, Helvetica, SimSun, sans-serif;font-size:12px;line-height:18px;"><tbody><tr><td class="t_f" id="postmessage_291" style="font-size:14px;">
<span style="color:#330000;"><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">一：flume介绍</span></span></span></span><br><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">        Flume是一个分布式、可靠、和高可用的海量日志聚合的系统，支持在系统中定制各类数据发送方，用于收集数据；同时，Flume提供对数据进行简单处理，并写到各种数据接受方（可定制）的能力。，Flume架构分为三个部分
 源-Source，接收器-Sink，通道-Channel。</span></span></span></span><br><br><br><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">二：配置文件</span></span></span></span><br><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">    此配置文件source为一个目录，注意，该目录下的文件应为只读，不可写，且文件名不能相同，采用的channels为file，sink为hdfs，此处往hdfs写的策略是当时间达到3600s或者文件大小达到128M。</span></span></span></span><br><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.sources = spooldirSource</span></span></span></span><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.channels = fileChannel</span></span></span></span><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.sinks = hdfsSink</span></span></span></span><br><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.sources.spooldirSource.type=spooldir</span></span></span></span><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.sources.spooldirSource.spoolDir=/data/lwq/new_log</span></span></span></span><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.sources.spooldirSource.channels=fileChannel</span></span></span></span><br><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.sinks.hdfsSink.type=hdfs</span></span></span></span><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.sinks.hdfsSink.hdfs.path=hdfs://dev228:8020/raw/lwq/%y-%m-%d</span></span></span></span><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.sinks.hdfsSink.hdfs.filePrefix=lwq</span></span></span></span><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.sinks.sink1.hdfs.round = true</span></span></span></span><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;"># Number of seconds to wait before
 rolling current file (0 = never roll based on time interval)</span></span></span></span><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.sinks.hdfsSink.hdfs.rollInterval
 = 3600</span></span></span></span><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;"># File size to trigger roll, in bytes
 (0: never roll based on file size)</span></span></span></span><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.sinks.hdfsSink.hdfs.rollSize
 = 128000000</span></span></span></span><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.sinks.hdfsSink.hdfs.rollCount
 = 0</span></span></span></span><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.sinks.hdfsSink.hdfs.batchSize
 = 1000</span></span></span></span><br><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">#Rounded down to the highest multiple
 of this (in the unit configured using hdfs.roundUnit), less than current time.</span></span></span></span><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.sinks.hdfsSink.hdfs.roundValue
 = 1</span></span></span></span><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.sinks.hdfsSink.hdfs.roundUnit
 = minute</span></span></span></span><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.sinks.hdfsSink.hdfs.useLocalTimeStamp
 = true</span></span></span></span><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.sinks.hdfsSink.channel=fileChannel</span></span></span></span><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.sinks.hdfsSink.hdfs.fileType
 = DataStream</span></span></span></span><br><br><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.channels.fileChannel.type =
 file</span></span></span></span><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.channels.fileChannel.checkpointDir=/usr/share/apache-flume-1.5.0-bin/checkpoint</span></span></span></span><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">agent1.channels.fileChannel.dataDirs=/usr/share/apache-flume-1.5.0-bin/dataDir</span></span></span></span><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">复制代码</span></span></span></span><br><br><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">三：启动命令</span></span></span></span><br><br><br><br><span style="font-family:Verdana, Arial, helvetica, 'sans-seriff';"><span style="font-size:12px;"><span><span style="font-weight:700;">  ${FLUME_HOME}/bin/flume-ng agent
 --conf ./conf/ -f conf/flume-site.xml -Dflume.root.logger=DEBUG,console -n agent1 &gt; log.log 2&gt;&amp;1 &amp;</span></span></span></span><br><br></span></td>
</tr></tbody></table>            </div>
                </div>