---
layout:     post
title:      Hbase测试&打补丁（HBASE-5415.patch）
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">操作系统：CentOS</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">Hbase版本：0.92.0</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">（1）下载到/opt目录下，解压缩，改名后：/opt/hbase</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">（2）修改配置/opt/hbase/conf/hbase-env.sh，填写JDK目录：export JAVA_HOME=/opt/jdk</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">（3）修改配置/opt/hbase/conf/hbase-site.xml</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">&lt;?xml version="1.0"?&gt;</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">&lt;configuration&gt;</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">  &lt;property&gt;</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">      &lt;name&gt;hbase.rootdir&lt;/name&gt;</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">      &lt;value&gt;/opt/hbase&lt;/value&gt;</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">  &lt;/property&gt;</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">&lt;/configuration&gt;</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">（4）启动：./opt/hbase/bin/start-hbase.sh（停止是stop-hbase.sh）</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">（5）进入hbase的shell：./opt/hbase/bin/hbase shell</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">（6）创建数据：create 'test', 'cf'</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">（7）其它测试</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">（8）在测试list命令时候出现问题：</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">hbase(main):001:0&gt; list</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">TABLE</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">ERROR: undefined method `map' for nil:NilClass</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">检查日志（./opt/hbase/logs/）发现：</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">......</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">hbase.TableExistsException: No descriptor for src</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">......</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">google搜索发现可能需要打补丁：HBASE-5415.patch（</span><a href="https://issues.apache.org/jira/browse/HBASE-5415" rel="nofollow" style="color:rgb(102,102,153);text-decoration:none;font-size:13px;line-height:21px;">https://issues.apache.org/jira/browse/HBASE-5415</a><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">）</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">（9）下载补丁到/opt目录下，</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">（10）在./opt/hbase目录下执行命令：patch -p0 &lt; ../HBASE-5415.patch</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">（11）重新编译Hbase：</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">下载maven，解压缩后到./opt/hbase目录下执行命令：</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">./opt/apache-maven-3.0.4/bin/mvn package -Dmaven.test.skip.exec=true -Prelease</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">执行了两遍才成功（第一遍失败了）</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">（12）maven会生成target/目录，拷贝重新编译的hbase（我给改了个名）hbase-rebuild-0.92.0.tar.gz到/opt目录下</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">（13）给旧目录改个名（别忘了先停止旧的hbase），然后解压缩hbase-rebuild-0.92.0.tar.gz</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">（14）重新执行最开始的流程后，list命令就没有问题了：</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">hbase(main):001:0&gt; list</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">TABLE</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">test</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">1 row(s) in 0.4070 seconds</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">hbase(main):002:0&gt; exit</span><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><br style="color:rgb(17,17,17);font-size:13px;line-height:21px;"><span style="color:rgb(17,17,17);font-size:13px;line-height:21px;">累死了，好麻烦啊啊啊啊啊啊</span>
            </div>
                </div>