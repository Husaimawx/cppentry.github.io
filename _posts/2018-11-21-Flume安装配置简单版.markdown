---
layout:     post
title:      Flume安装配置简单版
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <div class="article-title-box" style="padding:0px;margin:0px 0px 16px;color:rgb(51,51,51);font-family:'SF Pro Display', Roboto, Noto, Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;font-size:14px;line-height:22px;"><h6 class="title-article" style="padding:0px;margin-top:0px;margin-bottom:0px;font-size:24px;">Flume学习笔记（一）安装与简单使用</h6></div><div class="article-info-box" style="padding:0px 0px 14px;margin:0px;border-bottom:1px solid rgb(227,227,227);color:rgb(51,51,51);font-family:'SF Pro Display', Roboto, Noto, Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;font-size:14px;line-height:22px;"><div class="article-bar-top d-flex" style="padding:0px;margin:0px;color:rgb(133,133,133);"><span class="time" style="margin-right:14px;">2016年07月26日 13:56:46</span><div class="float-right" style="padding:0px;margin:0px 0px 0px auto;float:right;"><span class="read-count" style="margin-right:14px;">阅读数：11895</span></div></div></div><div class="article_content clearfix csdn-tracking-statistics" style="padding:0px;margin:0px;"><div class="markdown_views" style="padding:0px;margin:0px;font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;"><blockquote style="border-left-color:rgb(221,223,228);background-color:rgb(238,240,244);"><p style="list-style-type:none;font-size:14px;color:rgb(153,153,153);line-height:22px;">本文环境如下： <br>操作系统：CentOS 7.2.1511 64位 <br>Flume版本：1.6.0</p></blockquote><h2 style="padding:0px;"><a></a>1. 系统需求</h2><p style="list-style-type:none;">Flume需要Java 1.6及以上（推荐1.7），对Agent监控目录的读写权限。</p><h2 style="padding:0px;"><a></a>2. 下载软件包</h2><p style="list-style-type:none;">到Flume官网上<code style="font-size:14px;line-height:22px;padding:4px 2px 0px;">http://flume.apache.org/download.html</code>下载软件包,例如：</p><pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs lasso has-numbering">wget <span class="hljs-string">"http://mirrors.cnnic.cn/apache/flume/1.6.0/apache-flume-1.6.0-bin.tar.gz"</span>
tar <span class="hljs-attribute">-xzvf</span> apache<span class="hljs-attribute">-flume</span><span class="hljs-subst">-</span><span class="hljs-number">1.6</span><span class="hljs-number">.0</span><span class="hljs-attribute">-bin</span><span class="hljs-built_in">.</span>tar<span class="hljs-built_in">.</span>gz
mv flume<span class="hljs-subst">-</span><span class="hljs-number">1.6</span><span class="hljs-number">.0</span> /opt</code></pre><ul class="pre-numbering"><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">1</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">2</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">3</li></ul><h2 style="padding:0px;"><a></a>3. 简单示例</h2><h3 style="padding:0px;"><a></a>3.1 修改配置文件</h3><pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs avrasm has-numbering">vi /opt/flume-<span class="hljs-number">1.6</span><span class="hljs-number">.0</span>/conf/flume<span class="hljs-preprocessor">.conf</span></code></pre><ul class="pre-numbering"><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">1</li></ul><p style="list-style-type:none;">输入以下内容</p><pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs avrasm has-numbering"><span class="hljs-preprocessor"># 指定Agent的组件名称</span>
a1<span class="hljs-preprocessor">.sources</span> = <span class="hljs-built_in">r1</span>
a1<span class="hljs-preprocessor">.sinks</span> = k1
a1<span class="hljs-preprocessor">.channels</span> = c1

<span class="hljs-preprocessor"># 指定Flume source(要监听的路径)</span>
a1<span class="hljs-preprocessor">.sources</span><span class="hljs-preprocessor">.r</span>1<span class="hljs-preprocessor">.type</span> = spooldir
a1<span class="hljs-preprocessor">.sources</span><span class="hljs-preprocessor">.r</span>1<span class="hljs-preprocessor">.spoolDir</span> = /root/path

<span class="hljs-preprocessor"># 指定Flume sink</span>
a1<span class="hljs-preprocessor">.sinks</span><span class="hljs-preprocessor">.k</span>1<span class="hljs-preprocessor">.type</span> = logger

<span class="hljs-preprocessor"># 指定Flume channel</span>
a1<span class="hljs-preprocessor">.channels</span><span class="hljs-preprocessor">.c</span>1<span class="hljs-preprocessor">.type</span> = memory
a1<span class="hljs-preprocessor">.channels</span><span class="hljs-preprocessor">.c</span>1<span class="hljs-preprocessor">.capacity</span> = <span class="hljs-number">1000</span>
a1<span class="hljs-preprocessor">.channels</span><span class="hljs-preprocessor">.c</span>1<span class="hljs-preprocessor">.transactionCapacity</span> = <span class="hljs-number">100</span>

<span class="hljs-preprocessor"># 绑定source和sink到channel上</span>
a1<span class="hljs-preprocessor">.sources</span><span class="hljs-preprocessor">.r</span>1<span class="hljs-preprocessor">.channels</span> = c1
a1<span class="hljs-preprocessor">.sinks</span><span class="hljs-preprocessor">.k</span>1<span class="hljs-preprocessor">.channel</span> = c1</code></pre><ul class="pre-numbering"><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">1</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">2</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">3</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">4</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">5</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">6</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">7</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">8</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">9</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">10</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">11</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">12</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">13</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">14</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">15</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">16</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">17</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">18</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">19</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">20</li></ul><h3 style="padding:0px;"><a></a>3.2 启动flume agent</h3><pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs brainfuck has-numbering"><span class="hljs-comment">cd</span> <span class="hljs-comment">/opt/flume</span><span class="hljs-literal">-</span><span class="hljs-comment">1</span><span class="hljs-string">.</span><span class="hljs-comment">6</span><span class="hljs-string">.</span><span class="hljs-comment">0</span>
<span class="hljs-comment">bin/flume</span><span class="hljs-literal">-</span><span class="hljs-comment">ng</span> <span class="hljs-comment">agent</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">conf</span> <span class="hljs-comment">conf</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">conf</span><span class="hljs-literal">-</span><span class="hljs-comment">file</span> <span class="hljs-comment">conf/flume</span><span class="hljs-string">.</span><span class="hljs-comment">conf</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">name</span> <span class="hljs-comment">a1</span> <span class="hljs-literal">-</span><span class="hljs-comment">Dflume</span><span class="hljs-string">.</span><span class="hljs-comment">root</span><span class="hljs-string">.</span><span class="hljs-comment">logger=INFO</span><span class="hljs-string">,</span><span class="hljs-comment">console</span></code></pre><ul class="pre-numbering"><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">1</li><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">2</li></ul><table style="width:852px;text-align:center;"><thead><tr><th style="margin:0px;vertical-align:middle;">参数</th><th style="margin:0px;vertical-align:middle;">作用</th><th style="margin:0px;vertical-align:middle;">举例</th></tr></thead><tbody><tr><td style="margin:0px;vertical-align:middle;">–conf 或 -c</td><td style="margin:0px;vertical-align:middle;">指定配置文件夹，包含flume-env.sh和log4j的配置文件</td><td style="margin:0px;vertical-align:middle;">–conf conf</td></tr><tr><td style="margin:0px;vertical-align:middle;">–conf-file 或 -f</td><td style="margin:0px;vertical-align:middle;">配置文件地址</td><td style="margin:0px;vertical-align:middle;">–conf-file conf/flume.conf</td></tr><tr><td style="margin:0px;vertical-align:middle;">–name 或 -n</td><td style="margin:0px;vertical-align:middle;">agent名称</td><td style="margin:0px;vertical-align:middle;">–name a1</td></tr><tr><td style="margin:0px;vertical-align:middle;">-z</td><td style="margin:0px;vertical-align:middle;">zookeeper连接字符串</td><td style="margin:0px;vertical-align:middle;">-z zkhost:2181,zkhost1:2181</td></tr><tr><td style="margin:0px;vertical-align:middle;">-p</td><td style="margin:0px;vertical-align:middle;">zookeeper中的存储路径前缀</td><td style="margin:0px;vertical-align:middle;">-p /flume</td></tr></tbody></table><h3 style="padding:0px;"><a></a>3.3 写入日志内容</h3><pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs rust has-numbering">vi <span class="hljs-number">1</span>.<span class="hljs-keyword">log</span></code></pre><ul class="pre-numbering"><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">1</li></ul><p style="list-style-type:none;">写入<code style="font-size:14px;line-height:22px;padding:4px 2px 0px;">Hello Flume.</code>作为测试内容。然后拷贝到flume监听路径。</p><pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs rust has-numbering">cp <span class="hljs-number">1</span>.<span class="hljs-keyword">log</span>  /root/path/</code></pre><ul class="pre-numbering"><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">1</li></ul><p style="list-style-type:none;">接着就可以在前一个终端看到刚刚采集的内容了,如下：</p><pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs css has-numbering">2016<span class="hljs-tag">-06-27</span> 10<span class="hljs-pseudo">:02</span><span class="hljs-pseudo">:58</span>,322 (<span class="hljs-tag">SinkRunner-PollingRunner-DefaultSinkProcessor</span>) <span class="hljs-attr_selector">[INFO - org.apache.flume.sink.LoggerSink.process(LoggerSink.java:94)]</span> <span class="hljs-tag">Event</span>: <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">headers</span>:<span class="hljs-value">{</span></span></span>} <span class="hljs-tag">body</span>: 48 65 6<span class="hljs-tag">C</span> 6<span class="hljs-tag">C</span> 6<span class="hljs-tag">F</span> 20 77 6<span class="hljs-tag">F</span> 72 6<span class="hljs-tag">C</span> 64 0<span class="hljs-tag">D</span>             <span class="hljs-tag">Hello</span> <span class="hljs-tag">Flume</span>. }</code></pre><ul class="pre-numbering"><li style="padding-right:8px;padding-left:8px;color:rgb(153,153,153);">1</li></ul><p style="list-style-type:none;">至此flume已经能够正常运行。</p></div></div>            </div>
                </div>