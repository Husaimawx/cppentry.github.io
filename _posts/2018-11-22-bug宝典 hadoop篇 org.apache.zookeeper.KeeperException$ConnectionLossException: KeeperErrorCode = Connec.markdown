---
layout:     post
title:      bug宝典 hadoop篇 org.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = Connec
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								<div class="article-copyright">
					版权声明：本文为博主原创文章，未经博主允许不得转载。					https://blog.csdn.net/warrah/article/details/56012963				</div>
								            <div id="content_views" class="markdown_views prism-atom-one-dark">
							<!-- flowchart 箭头图标 勿删 -->
							<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path></svg>
							<p>采用hue删除hbase中的表之后，hbase中的表都不见了。执行<code>hbase shell</code>，出现下面的异常：</p>

<pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-number">2017</span>-<span class="hljs-number">02</span>-<span class="hljs-number">20</span> <span class="hljs-number">14</span>:<span class="hljs-number">40</span>:<span class="hljs-number">31</span>,<span class="hljs-number">246</span> ERROR [main] zookeeper<span class="hljs-preprocessor">.ZooKeeperWatcher</span>: hconnection-<span class="hljs-number">0x504ceb560</span>x0, quorum=localhost:<span class="hljs-number">2181</span>, baseZNode=/hbase Received unexpected KeeperException, re-throwing exception
<span class="hljs-label">org.apache.zookeeper.KeeperException$ConnectionLossException:</span> KeeperErrorCode = ConnectionLoss for /hbase/hbaseid
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.zookeeper</span><span class="hljs-preprocessor">.KeeperException</span><span class="hljs-preprocessor">.create</span>(KeeperException<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">99</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.zookeeper</span><span class="hljs-preprocessor">.KeeperException</span><span class="hljs-preprocessor">.create</span>(KeeperException<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">51</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.zookeeper</span><span class="hljs-preprocessor">.ZooKeeper</span><span class="hljs-preprocessor">.exists</span>(ZooKeeper<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1045</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hbase</span><span class="hljs-preprocessor">.zookeeper</span><span class="hljs-preprocessor">.RecoverableZooKeeper</span><span class="hljs-preprocessor">.exists</span>(RecoverableZooKeeper<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">221</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hbase</span><span class="hljs-preprocessor">.zookeeper</span><span class="hljs-preprocessor">.ZKUtil</span><span class="hljs-preprocessor">.checkExists</span>(ZKUtil<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">541</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hbase</span><span class="hljs-preprocessor">.zookeeper</span><span class="hljs-preprocessor">.ZKClusterId</span><span class="hljs-preprocessor">.readClusterIdZNode</span>(ZKClusterId<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">65</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hbase</span><span class="hljs-preprocessor">.client</span><span class="hljs-preprocessor">.ZooKeeperRegistry</span><span class="hljs-preprocessor">.getClusterId</span>(ZooKeeperRegistry<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">105</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hbase</span><span class="hljs-preprocessor">.client</span><span class="hljs-preprocessor">.ConnectionManager</span>$HConnectionImplementation<span class="hljs-preprocessor">.retrieveClusterId</span>(ConnectionManager<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">880</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hbase</span><span class="hljs-preprocessor">.client</span><span class="hljs-preprocessor">.ConnectionManager</span>$HConnectionImplementation.&lt;init&gt;(ConnectionManager<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">636</span>)
        at sun<span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.NativeConstructorAccessorImpl</span><span class="hljs-preprocessor">.newInstance</span>0(Native Method)
        at sun<span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.NativeConstructorAccessorImpl</span><span class="hljs-preprocessor">.newInstance</span>(NativeConstructorAccessorImpl<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">57</span>)
        at sun<span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.DelegatingConstructorAccessorImpl</span><span class="hljs-preprocessor">.newInstance</span>(DelegatingConstructorAccessorImpl<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">45</span>)
        at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.Constructor</span><span class="hljs-preprocessor">.newInstance</span>(Constructor<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">526</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hbase</span><span class="hljs-preprocessor">.client</span><span class="hljs-preprocessor">.ConnectionFactory</span><span class="hljs-preprocessor">.createConnection</span>(ConnectionFactory<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">238</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hbase</span><span class="hljs-preprocessor">.client</span><span class="hljs-preprocessor">.ConnectionFactory</span><span class="hljs-preprocessor">.createConnection</span>(ConnectionFactory<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">218</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hbase</span><span class="hljs-preprocessor">.client</span><span class="hljs-preprocessor">.ConnectionFactory</span><span class="hljs-preprocessor">.createConnection</span>(ConnectionFactory<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">119</span>)
        at sun<span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.NativeMethodAccessorImpl</span><span class="hljs-preprocessor">.invoke</span>0(Native Method)
        at sun<span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.NativeMethodAccessorImpl</span><span class="hljs-preprocessor">.invoke</span>(NativeMethodAccessorImpl<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">57</span>)
        at sun<span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.DelegatingMethodAccessorImpl</span><span class="hljs-preprocessor">.invoke</span>(DelegatingMethodAccessorImpl<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">43</span>)
        at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.Method</span><span class="hljs-preprocessor">.invoke</span>(Method<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">606</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.javasupport</span><span class="hljs-preprocessor">.JavaMethod</span><span class="hljs-preprocessor">.invokeDirectWithExceptionHandling</span>(JavaMethod<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">450</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.javasupport</span><span class="hljs-preprocessor">.JavaMethod</span><span class="hljs-preprocessor">.invokeStaticDirect</span>(JavaMethod<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">362</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.java</span><span class="hljs-preprocessor">.invokers</span><span class="hljs-preprocessor">.StaticMethodInvoker</span><span class="hljs-preprocessor">.call</span>(StaticMethodInvoker<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">58</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.runtime</span><span class="hljs-preprocessor">.callsite</span><span class="hljs-preprocessor">.CachingCallSite</span><span class="hljs-preprocessor">.cacheAndCall</span>(CachingCallSite<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">312</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.runtime</span><span class="hljs-preprocessor">.callsite</span><span class="hljs-preprocessor">.CachingCallSite</span><span class="hljs-preprocessor">.call</span>(CachingCallSite<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">169</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.ast</span><span class="hljs-preprocessor">.CallOneArgNode</span><span class="hljs-preprocessor">.interpret</span>(CallOneArgNode<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">57</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.ast</span><span class="hljs-preprocessor">.InstAsgnNode</span><span class="hljs-preprocessor">.interpret</span>(InstAsgnNode<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">95</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.ast</span><span class="hljs-preprocessor">.NewlineNode</span><span class="hljs-preprocessor">.interpret</span>(NewlineNode<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">104</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.ast</span><span class="hljs-preprocessor">.BlockNode</span><span class="hljs-preprocessor">.interpret</span>(BlockNode<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">71</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.evaluator</span><span class="hljs-preprocessor">.ASTInterpreter</span><span class="hljs-preprocessor">.INTERPRET</span>_METHOD(ASTInterpreter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">74</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.internal</span><span class="hljs-preprocessor">.runtime</span><span class="hljs-preprocessor">.methods</span><span class="hljs-preprocessor">.InterpretedMethod</span><span class="hljs-preprocessor">.call</span>(InterpretedMethod<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">169</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.internal</span><span class="hljs-preprocessor">.runtime</span><span class="hljs-preprocessor">.methods</span><span class="hljs-preprocessor">.DefaultMethod</span><span class="hljs-preprocessor">.call</span>(DefaultMethod<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">191</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.runtime</span><span class="hljs-preprocessor">.callsite</span><span class="hljs-preprocessor">.CachingCallSite</span><span class="hljs-preprocessor">.cacheAndCall</span>(CachingCallSite<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">302</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.runtime</span><span class="hljs-preprocessor">.callsite</span><span class="hljs-preprocessor">.CachingCallSite</span><span class="hljs-preprocessor">.callBlock</span>(CachingCallSite<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">144</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.runtime</span><span class="hljs-preprocessor">.callsite</span><span class="hljs-preprocessor">.CachingCallSite</span><span class="hljs-preprocessor">.call</span>(CachingCallSite<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">148</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.RubyClass</span><span class="hljs-preprocessor">.newInstance</span>(RubyClass<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">822</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.RubyClass</span>$i$newInstance<span class="hljs-preprocessor">.call</span>(RubyClass$i$newInstance<span class="hljs-preprocessor">.gen</span>:<span class="hljs-number">65535</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.internal</span><span class="hljs-preprocessor">.runtime</span><span class="hljs-preprocessor">.methods</span><span class="hljs-preprocessor">.JavaMethod</span>$JavaMethodZeroOrNBlock<span class="hljs-preprocessor">.call</span>(JavaMethod<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">249</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.runtime</span><span class="hljs-preprocessor">.callsite</span><span class="hljs-preprocessor">.CachingCallSite</span><span class="hljs-preprocessor">.cacheAndCall</span>(CachingCallSite<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">292</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.runtime</span><span class="hljs-preprocessor">.callsite</span><span class="hljs-preprocessor">.CachingCallSite</span><span class="hljs-preprocessor">.call</span>(CachingCallSite<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">135</span>)
        at home<span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.application</span><span class="hljs-preprocessor">.hbase</span><span class="hljs-preprocessor">.bin</span><span class="hljs-preprocessor">.hirb</span>.__file__(/home/hadoop/application/hbase/bin/hirb<span class="hljs-preprocessor">.rb</span>:<span class="hljs-number">118</span>)
        at home<span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.application</span><span class="hljs-preprocessor">.hbase</span><span class="hljs-preprocessor">.bin</span><span class="hljs-preprocessor">.hirb</span><span class="hljs-preprocessor">.load</span>(/home/hadoop/application/hbase/bin/hirb<span class="hljs-preprocessor">.rb</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.Ruby</span><span class="hljs-preprocessor">.runScript</span>(Ruby<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">697</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.Ruby</span><span class="hljs-preprocessor">.runScript</span>(Ruby<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">690</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.Ruby</span><span class="hljs-preprocessor">.runNormally</span>(Ruby<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">597</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.Ruby</span><span class="hljs-preprocessor">.runFromMain</span>(Ruby<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">446</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.Main</span><span class="hljs-preprocessor">.doRunFromMain</span>(Main<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">369</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.Main</span><span class="hljs-preprocessor">.internalRun</span>(Main<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">258</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.Main</span><span class="hljs-preprocessor">.run</span>(Main<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">224</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.Main</span><span class="hljs-preprocessor">.run</span>(Main<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">208</span>)
        at org<span class="hljs-preprocessor">.jruby</span><span class="hljs-preprocessor">.Main</span><span class="hljs-preprocessor">.main</span>(Main<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">188</span>)
HBase Shell<span class="hljs-comment">; enter 'help&lt;RETURN&gt;' for list of supported commands.</span></code></pre>

<p>在检查hbase的日志</p>



<pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-number">2017</span>-<span class="hljs-number">02</span>-<span class="hljs-number">20</span> <span class="hljs-number">14</span>:<span class="hljs-number">52</span>:<span class="hljs-number">21</span>,<span class="hljs-number">536</span> INFO  [dashuju174:<span class="hljs-number">16000.</span>activeMasterManager-SendThread(localhost:<span class="hljs-number">2181</span>)] zookeeper<span class="hljs-preprocessor">.ClientCnxn</span>: Opening socket connection to server localhost/<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">2181.</span> Will not attempt to authenticate using SASL (unknown error)
<span class="hljs-number">2017</span>-<span class="hljs-number">02</span>-<span class="hljs-number">20</span> <span class="hljs-number">14</span>:<span class="hljs-number">52</span>:<span class="hljs-number">21</span>,<span class="hljs-number">536</span> WARN  [dashuju174:<span class="hljs-number">16000.</span>activeMasterManager-SendThread(localhost:<span class="hljs-number">2181</span>)] zookeeper<span class="hljs-preprocessor">.ClientCnxn</span>: Session <span class="hljs-number">0x35a4a9f919c0012</span> for server null, unexpected error, closing socket connection <span class="hljs-keyword">and</span> attempting reconnect
<span class="hljs-label">java.net.ConnectException:</span> Connection refused
    at sun<span class="hljs-preprocessor">.nio</span><span class="hljs-preprocessor">.ch</span><span class="hljs-preprocessor">.SocketChannelImpl</span><span class="hljs-preprocessor">.checkConnect</span>(Native Method)
    at sun<span class="hljs-preprocessor">.nio</span><span class="hljs-preprocessor">.ch</span><span class="hljs-preprocessor">.SocketChannelImpl</span><span class="hljs-preprocessor">.finishConnect</span>(SocketChannelImpl<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">739</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.zookeeper</span><span class="hljs-preprocessor">.ClientCnxnSocketNIO</span><span class="hljs-preprocessor">.doTransport</span>(ClientCnxnSocketNIO<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">361</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.zookeeper</span><span class="hljs-preprocessor">.ClientCnxn</span>$SendThread<span class="hljs-preprocessor">.run</span>(ClientCnxn<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1081</span>)</code></pre>

<p>重启zookeeper，就好了</p>            </div>
						<link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-9e5741c4b9.css" rel="stylesheet">
                </div>