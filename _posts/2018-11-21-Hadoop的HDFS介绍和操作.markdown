---
layout:     post
title:      Hadoop的HDFS介绍和操作
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <p>一、HDFS概述</p><p>        HDFS（Hadoop Distributed File System）：分布式文件系统<br></p><p>二、操作HDFS</p><p>        1、通过Web Console：50070、50090<br></p><p>        2、命令行<br></p><p>            （1）操作命令 hdfs dfs ****<br></p><p>                    -mkdir 创建目录<br></p><p>                     举例：hdfs dfs -mkdir /aaa<br></p><p>                                hdfs dfs -mkdir -p /bbb/ccc      -p表示如果父目录不存在 则先创建父目录</p><p>                    -ls    查看某个目录<br></p><p>                    -ls -R 查看某个目录，包括子目录，简写：-lsr<br></p><p>                    -put  上传数据    hdfs dfs -put data.txt /input<br></p><p>                    -copyFromLocal 上传数据     hdfs dfs -copyFromLocal data.txt /input<br></p><p>                    -moveFromLocal 上传数据（相当于ctrl + x 剪切）<br></p><p>                    -copyToLocal    下载数据<br></p><p>                    -get        下载数据<br></p><p>                    -rm 删除目录<br></p><p>                    -rm -r 删除目录（递归删除包括子目录）简写 -rmr<br></p><p></p><p>                            hdfs dfs -rmr /tools        </p><p>开启回收站后删除日志对比：</p><p>        未开启回收站删除日志：<br></p><span style="white-space:pre;">	</span>rmr: DEPRECATED: Please use 'rm -r' instead.<br><span style="white-space:pre;">	</span>开启回收站日志：<br>18/04/09 21:35:40 INFO fs.TrashPolicyDefault: Namenode trash configuration: Deletion interval = 0 minutes, Emptier interval = 0 minutes.<br>Deleted /tools ---&gt; 成功删除（对比：回收站）<br><p>                    -getmerge    把某个目录下的文件先合并，再下载（提高效率）<br></p><p>                        [root@bigdata111 temp]# vi student01.txt<br><span style="white-space:pre;">			</span>[root@bigdata111 temp]# vi student02.txt<br><span style="white-space:pre;">			</span>[root@bigdata111 temp]# hdfs dfs -mkdir /students<br><span style="white-space:pre;">			</span>[root@bigdata111 temp]# hdfs dfs -put student0*.txt /students<br><span style="white-space:pre;">			</span>[root@bigdata111 temp]# hdfs dfs -ls /students<br></p><p><span style="white-space:pre;">			</span>[root@bigdata111 temp]# hdfs dfs -getmerge /students ~/temp/allstudent.txt</p><p>                    -cp    复制文件    hdfs dfs -cp /input/data.txt /input/data2.txt<br></p><p>                    -mv    移动文件    hdfs dfs -cp /input/data.txt /students<br></p><p>                    -count: hdfs dfs -count /students<br></p><p>                                     1                    2                29                        /students<br></p><p>                                目录个数        文件个数        文件总计大小        输入路径<br></p><p>                    -du 每个文件的大小<br></p><p>                        [root@bigdata111 temp]# hdfs dfs -du /students<br><span style="white-space:pre;">				</span>19  /students/student01.txt<br></p><p><span style="white-space:pre;">				</span>10  /students/student02.txt</p><p>                   -text、-cat     查看文件内容<br></p><p>                        hdfs dfs -cat /students/student01.txt<br></p><p>                    balancer:平衡操作<br></p><p>            （2）管理命令    hdfs dfsadmin ****<br></p><p>                    -report ： 输出HDFS的报告（Summary）<br></p><p>                    -safemode：安全模式<br></p><p>                     [root@bigdata111 temp]# hdfs dfsadmin -safemode<br><span style="white-space:pre;">		    </span>Usage: hdfs dfsadmin [-safemode enter | leave | get | wait]<br><span style="white-space:pre;">		    </span>[root@bigdata111 temp]# hdfs dfsadmin -safemode get<br><span style="white-space:pre;">		    </span>Safe mode is OFF<br><span style="white-space:pre;">	            </span>[root@bigdata111 temp]# hdfs dfsadmin -safemode enter<br><span style="white-space:pre;">		   </span>Safe mode is ON<br><span style="white-space:pre;">		    </span>[root@bigdata111 temp]# hdfs dfs -mkdir /aaaa<br><span style="white-space:pre;">		    </span>mkdir: Cannot create directory /aaaa. Name node is in safe mode.<br><span style="white-space:pre;">		    </span>[root@bigdata111 temp]# hdfs dfsadmin -safemode leave<br><span style="white-space:pre;">		    </span>Safe mode is OFF<br></p><p>         3、Java程序<br></p><p>                    依赖的jar包：<br></p><p>                        $HADOOP_HOME/share/hadoop/common/*.jar<br><span style="white-space:pre;">			</span>$HADOOP_HOME/share/hadoop/common/lib/*.jar<br><span style="white-space:pre;">			</span>$HADOOP_HOME/share/hadoop/hdfs/*.jar<br></p><p><span style="white-space:pre;">			</span>$HADOOP_HOME/share/hadoop/hdfs/lib/*.jar</p><p>                （1）创建一个目录和HDFS的权限<br></p><p>                        mkdir<br></p><p>                            程序里创建文件的时候可能会有权限限制，可以通过以下方式解决<br></p><p>                            /*<br>                             *  四种方式，执行程序：<br>                             *  1、设置一个属性<br>                             *  2、使用-D参数<br>                             *  3、改变目录的权限  hdfs dfs -chmod 777 /folder2<br>                             *  4、dfs.permissions  ---&gt; false  禁用HDFS的权限检查功能<br></p><p>                             */</p><p>                        &lt;!--是否开启HDFS的权限检查，默认true--&gt;<br><span style="white-space:pre;">				</span>&lt;property&gt;<br><span style="white-space:pre;">				</span>   &lt;name&gt;dfs.permissions&lt;/name&gt;<br><span style="white-space:pre;">				</span>   &lt;value&gt;false&lt;/value&gt;<br><span style="white-space:pre;">				</span>&lt;/property&gt;<br></p><p>                （2）上传数据、下载数据<br></p><p>                （3）获取元信息<br></p><p>三、HDFS原理解析（画图）------&gt;非常重要</p><p>       NameNode缓存元信息，默认：1000M<br></p><p>        hadoop-env.sh    改变参数设置<br></p><p>        # The maximum amount of heap to use, in MB. Default is 1000.<br><span style="white-space:pre;">	</span>#export HADOOP_HEAPSIZE=<br></p><p><span style="white-space:pre;">	</span>#export HADOOP_NAMENODE_INIT_HEAPSIZE=""</p><p>        如果内存崩溃，会使用日志进行恢复<br></p><p>        1、数据上传的过程（原理）<br></p><p>            <img src="https://img-blog.csdn.net/20180424220054777?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTEwODEyNDQ=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></p><p>        2、数据下载的过程（原理）<br></p><p><img src="https://img-blog.csdn.net/20180424224107251?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTEwODEyNDQ=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></p><p>四、HDFS的高级功能<br><span style="white-space:pre;">	</span>1、回收站<br><span style="white-space:pre;">		</span>补充：Oracle的回收站<br><span style="white-space:pre;">		</span>恢复：闪回（flashback）<br><span style="white-space:pre;">			</span>(1) 闪回表  flashback table<br><span style="white-space:pre;">			</span>(2) 闪回删除  flashback drop<br><span style="white-space:pre;">			</span>(3) 闪回查询 flashback query<br><span style="white-space:pre;">			</span>(4) 闪回事务查询 flashback transaction query   -----&gt; 可以撤销一个已经提交了的事务<br><span style="white-space:pre;">			</span>(5) 闪回数据库 flashback database <br><span style="white-space:pre;">			</span>(6) 闪回版本查询 flashback verion query<br><span style="white-space:pre;">			</span>(7) 闪回数据归档  flashback data archive<br><span style="white-space:pre;">			</span><br><span style="white-space:pre;">		</span>HDFS的回收站：默认禁用<br><span style="white-space:pre;">			</span>参数： core-site.xml <br><span style="white-space:pre;">			</span>单位：分钟<br><span style="white-space:pre;">				</span>&lt;property&gt;<br><span style="white-space:pre;">				</span>   &lt;name&gt;fs.trash.interval&lt;/name&gt;<br><span style="white-space:pre;">				</span>   &lt;value&gt;1440&lt;/value&gt;<br><span style="white-space:pre;">				</span>&lt;/property&gt;<br><span style="white-space:pre;">			</span>没有回收站<br><span style="white-space:pre;">				</span>日志：<br>18/04/09 21:35:40 INFO fs.TrashPolicyDefault: Namenode trash configuration: Deletion interval = 0 minutes, Emptier interval = 0 minutes.<br>Deleted /tools ---&gt; 成功删除（对比：回收站）<span style="white-space:pre;">			</span><br><span style="white-space:pre;">		</span>回收站<br>Moved:'hdfs://bigdata111:9000/tools/a.zip'to trash at: hdfs://bigdata111:9000/user/root/.Trash/Current<br><span style="white-space:pre;">				</span><br><span style="white-space:pre;">		</span>HDFS回收站的本质：ctrl +x 移动到一个隐藏目录<br><span style="white-space:pre;">		</span>查看回收站<br><span style="white-space:pre;">		</span> hdfs dfs -lsr /user/root/.Trash/Current<br><span style="white-space:pre;">		</span>从回收站中恢复<br><span style="white-space:pre;">		</span>hdfs dfs -cp /user/root/.Trash/Current/tools/a.zip /tools<span style="white-space:pre;">			</span><br>                [-expunge] 清空回收站<br><span style="white-space:pre;">	</span>2、快照：snapshot（是一种备份）<br><span style="white-space:pre;">		</span>本质：cp命令<br><span style="white-space:pre;">		</span>管理命令<br>                [-allowSnapshot &lt;snapshotDir&gt;]<br>                [-disallowSnapshot &lt;snapshotDir&gt;]<br><span style="white-space:pre;">		</span>操作命令<br>                [-createSnapshot &lt;snapshotDir&gt; [&lt;snapshotName&gt;]]<br>                [-deleteSnapshot &lt;snapshotDir&gt; &lt;snapshotName&gt;]<br>                [-renameSnapshot &lt;snapshotDir&gt; &lt;oldName&gt; &lt;newName&gt;]<br><span style="white-space:pre;">		</span><br><span style="white-space:pre;">		</span>(*) 默认禁用<br><span style="white-space:pre;">		</span>(*) 针对目录开启快照<br><span style="white-space:pre;">				</span>hdfs dfsadmin -allowSnapshot /students<br><span style="white-space:pre;">		</span>(*) 创建一个备份<br><span style="white-space:pre;">				</span>hdfs dfs -createSnapshot /students backup_student_0411_01<br><span style="white-space:pre;">				</span><br><span style="white-space:pre;">				</span>日志：Created snapshot /students/.snapshot/backup_student_0411_01<br><span style="white-space:pre;">		</span><br><span style="white-space:pre;">			</span>hdfs dfs -put student03.txt /students<br><span style="white-space:pre;">			</span>hdfs dfs -createSnapshot /students backup_student_0411_02<br><span style="white-space:pre;">			</span><br><span style="white-space:pre;">		</span>(*) 对比快照<br><span style="white-space:pre;">			</span>hdfs snapshotDiff /students backup_student_0411_01 backup_student_0411_02<br><span style="white-space:pre;">				</span>M       .<br><span style="white-space:pre;">				</span>+       ./student03.txt<br><span style="white-space:pre;">				</span><br><span style="white-space:pre;">			</span>hdfs lsSnapshottableDir<br><span style="white-space:pre;">			</span>通过网页查看<br><span style="white-space:pre;">			</span><br><span style="white-space:pre;">		</span>(*)恢复快照<br>                hdfs dfs -cp /input/.snapshot/backup_input_01/data.txt /input<br><span style="white-space:pre;">		</span>补充：Oracle数据库快照: 一般做异步更新<br><span style="white-space:pre;">				</span>create snapshot aaaa as 子查询 更新时间<br><span style="white-space:pre;">		</span><br><span style="white-space:pre;">			</span>Oracle数据库备份<br><span style="white-space:pre;">				</span>exp、expdp、数据泵 ----&gt; 逻辑备份 导出数据<br><span style="white-space:pre;">				</span>rman: recovery manager<br><span style="white-space:pre;">	</span>3、配额（quota）<br><span style="white-space:pre;">		</span>（1）名称配额: 限制某个目录下，文件的个数<br><span style="white-space:pre;">			</span>[-setQuota &lt;quota&gt; &lt;dirname&gt;...&lt;dirname&gt;]<br><span style="white-space:pre;">			</span>[-clrQuota &lt;dirname&gt;...&lt;dirname&gt;]<span style="white-space:pre;">	</span><br><span style="white-space:pre;">			</span><br><span style="white-space:pre;">			</span>hdfs dfs -mkdir /folder1<br></p><p><span style="white-space:pre;">			</span>hdfs dfsadmin -setQuota 3 /folder1</p><span style="white-space:pre;">			</span>实际是：N-1<br><span style="white-space:pre;">		</span>（2）空间配额: 限制某个目录下，文件的大小<br><span style="white-space:pre;">			</span>[-setSpaceQuota &lt;quota&gt; [-storageType &lt;storagetype&gt;] &lt;dirname&gt;...&lt;dirname&gt;]<br><span style="white-space:pre;">			</span>[-clrSpaceQuota [-storageType &lt;storagetype&gt;] &lt;dirname&gt;...&lt;dirname&gt;]<span style="white-space:pre;">		</span><br><span style="white-space:pre;">			</span><br><span style="white-space:pre;">			</span>hdfs dfs -mkdir /folder2<br><span style="white-space:pre;">			</span><br><span style="white-space:pre;">			</span>设置空间配额：1M<br><span style="white-space:pre;">			</span>hdfs dfsadmin -setSpaceQuota 1M /folder2<br><span style="white-space:pre;">			</span><br><span style="white-space:pre;">			</span>错误：<br><span style="white-space:pre;">			</span>The DiskSpace quota of /folder2 is exceeded: quota = 1048576 B = 1 MB but diskspace consumed = 134217728 B = 128 MB<br><span style="white-space:pre;">			</span><br><span style="white-space:pre;">			</span>注意：设置的值一定不能小于128M<br><span style="white-space:pre;">				</span><br><span style="white-space:pre;">	</span>4、安全模式：safemode<br><span style="white-space:pre;">		</span>（*）HDFS启动的过程中，经历安全模式<br><span style="white-space:pre;">		</span>（*）参考讲义：P23<br><span style="white-space:pre;">		</span><br><span style="white-space:pre;">	</span>5、简介：HDFS的集群<br><span style="white-space:pre;">		</span>（1）联盟Federation<br><span style="white-space:pre;">		</span>（2）HA（高可用性 high availability）<br>                  <img src="https://img-blog.csdn.net/20180424224747382" alt=""><br><br>五、HDFS的底层原理<br><span style="white-space:pre;">	</span>1、代理对象：Java Proxy<br><span style="white-space:pre;">		</span>（*）来源：客户端得到的是NameNodeProxies（NameNode代理对象）<br><p><span style="white-space:pre;">		</span>（*）是包装设计模式，用来增强类或者方法的功能</p><p>                    <img src="https://img-blog.csdn.net/20180424224846120" alt=""><br></p><span style="white-space:pre;">		</span>（*）代理对象的应用场景：数据库的连接池（JDBC）<br><span style="white-space:pre;">			</span>(1) BDCP<br><span style="white-space:pre;">			</span>(2) C3P0<br><span style="white-space:pre;">			<img src="https://img-blog.csdn.net/20180424224833476" alt=""></span><br><span style="white-space:pre;">		</span>（*）搭建MySQL数据库<br><span style="white-space:pre;">				</span>  tar -xvf mysql-5.7.19-1.el7.x86_64.rpm-bundle.tar<br><span style="white-space:pre;">		</span><br><span style="white-space:pre;">				</span>在虚拟机上安装MySQL：<br><span style="white-space:pre;">				</span>yum remove mysql-libs <br><span style="white-space:pre;">				</span>rpm -ivh mysql-community-common-5.7.19-1.el7.x86_64.rpm<br><span style="white-space:pre;">				</span>rpm -ivh mysql-community-libs-5.7.19-1.el7.x86_64.rpm<br><span style="white-space:pre;">				</span>rpm -ivh mysql-community-client-5.7.19-1.el7.x86_64.rpm<br><span style="white-space:pre;">				</span>rpm -ivh mysql-community-server-5.7.19-1.el7.x86_64.rpm<br><span style="white-space:pre;">				</span>rpm -ivh mysql-community-devel-5.7.19-1.el7.x86_64.rpm  （可选）<br><span style="white-space:pre;">							</span><br><span style="white-space:pre;">				</span>启动MySQL：service mysqld start<br><span style="white-space:pre;">				</span>或者：systemctl start mysqld.service<br><span style="white-space:pre;">				</span>查看root用户的密码：cat /var/log/mysqld.log | grep password<br><span style="white-space:pre;">				</span>登录后修改密码：alter user 'root'@'localhost' identified by 'Welcome_1';<br><span style="white-space:pre;">				</span>MySQL数据库的配置：<br><span style="white-space:pre;">				</span>创建一个新的数据库：create database hive;<br><span style="white-space:pre;">				</span>创建一个新的用户：<br><span style="white-space:pre;">				</span>create user 'hiveowner'@'%' identified by 'Welcome_1';<br><span style="white-space:pre;">				</span>给该用户授权<br><span style="white-space:pre;">				</span>grant all on hive.* TO 'hiveowner'@'%'; <br><span style="white-space:pre;">				</span>grant all on hive.* TO 'hiveowner'@'localhost' identified by 'Welcome_1';<span style="white-space:pre;">		</span><br><span style="white-space:pre;">						</span>   <br><span style="white-space:pre;">	</span>2、什么是RPC？ remote procedure call 远程过程调用（协议）<br><p>                <img src="https://img-blog.csdn.net/20180424224857294" alt=""><br></p><p><br></p><p><br></p><p>        <br></p><p><br></p><p><br></p><p><br></p>            </div>
                </div>