---
layout:     post
title:      Hive官方文档-Hive Tutorial
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<h1 id="tutorial" style='margin:0.8em 0px; font-size:2.6em; font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); padding:0px'>
Hive Tutorial</h1>
<ul style='margin:0px 0px 1.7em; padding:0px; list-style-position:initial; line-height:27.2px; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
<li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Hive Tutorial</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Concepts <br style="">
<ul style="margin:0px 0px 1.7em; padding:0px; list-style:disc; line-height:27.2px">
<li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">What Is Hive</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">What Hive Is NOT</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Getting Started</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Data Units</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Type System</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Built In Operators and Functions</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Language Capabilities</li></ul>
</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Usage and Examples <br style="">
<ul style="margin:0px 0px 1.7em; padding:0px; list-style:disc; line-height:27.2px">
<li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Creating, Showing, Altering, and Dropping Tables</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Loading Data</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Querying and Inserting Data</li></ul>
</li></ul>
<h1 id="概念" style='margin:0.8em 0px; font-size:2.6em; font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); padding:0px'>
<a target="_blank" name="t1" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>概念</h1>
<h2 id="hive是什么" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:2.15em; padding:0px'>
<a target="_blank" name="t2" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>Hive是什么</h2>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
Hive是一个基于Apache Hadoop的数据仓库。对于数据存储与处理，Hadoop提供了主要的扩展和容错能力。</p>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
Hive设计的初衷是：对于大量的数据，使得数据汇总，查询和分析更加简单。它提供了SQL，允许用户更加简单地进行查询，汇总和数据分析。同时，Hive的SQL给予了用户多种方式来集成自己的功能，然后做定制化的查询，例如用户自定义函数（User Defined Functions，UDFs).</p>
<h2 id="hive不适合做什么" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:2.15em; padding:0px'>
<a target="_blank" name="t3" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>Hive不适合做什么</h2>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
Hive不是为在线事务处理而设计。它最适合用于传统的数据仓库任务。</p>
<h2 id="getting-started" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:2.15em; padding:0px'>
<a target="_blank" name="t4" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>Getting Started</h2>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
对于Hive, HiveServer2 和Beeline的设置详情，请参考<a target="_blank" href="https://cwiki.apache.org/confluence/display/Hive/GettingStarted" rel="nofollow" style="background:transparent; color:rgb(202,12,22); margin:0px; padding:0px; outline:0px">指南</a>。</p>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
对于学习Hive，这些<a target="_blank" href="https://cwiki.apache.org/confluence/display/Hive/Books+about+Hive" rel="nofollow" style="background:transparent; color:rgb(202,12,22); margin:0px; padding:0px; outline:0px">书单</a>可能对你有所用处。</p>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
以下部分提供了一个关于Hive系统功能的教程。先描述数据类型，表和分区的概念，然后使用例子来描述Hive的功能。</p>
<h2 id="数据单元" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:2.15em; padding:0px'>
<a target="_blank" name="t5" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>数据单元</h2>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
根据颗粒度的顺序，Hive数据被组织成： <br style="">
- 数据库（Databases）：命名空间功能，为了避免表，视图，分区，列等等的命名冲突。数据库也可以用于加强用户或用户组的安全。</p>
<ul style='margin:0px 0px 1.7em; padding:0px; list-style-position:initial; line-height:27.2px; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
<li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">
<p style="margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal">
表（Tables）：相同数据库的同类数据单元。例如表<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>page_views</code>，表的每行包含以下列：</p>
<ul style="margin:0px 0px 1.7em; padding:0px; list-style:disc; line-height:27.2px">
<li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">timestamp －这是一个<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>INT</code>类型，是当页面被访问时的UNIX时间戳。</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">userid －这是一个<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>BIGINT</code>类型，用于惟一识别访问页面的用户。</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">page_url －这是一个<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>STRING</code>类型，用于存储页面地址。</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">referer_url －这是一个<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>STRING</code>类型，用于存储用户是从哪个页面跳转到本页面的地址。</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">IP －这是一个<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>STRING</code>类型，用于存储页面请求的IP地址。</li></ul>
</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">
<p style="margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal">
分区（Partitions）：每个表可以有一个或多个用于决定数据如何存储的分区键。分区（除存储单元之外）也允许用户有效地识别满足指定条件的行；例如，<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>STRING</code>类型的<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>date_partition</code>和<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>STRING</code>的<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>country_partition</code>。这些分区键的每个惟一的值定义了表的一个分区。例如，所有的“2009－12－23”日期的“US”数据是表<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>page_views</code>的一个分区。（注意区分，分区键与分区，如果分区键有两个，每个分区键有三个不同的值，则共有6个分区）。因此，如果你只在日期为“2009－12－23”的“US”数据上执行分析，你将只会在表的相关数据上执行查询，这将有效地加速分析。然而要注意，那仅仅是因为有个分区叫2009-12-23，并不意味着它包含了所有数据，或者说，这些数据仅仅是那个日期的数据。用户需要保证分区名字与数据内容之间的关系。分区列是虚拟列，它们不是数据本身的一部分，而是源于数据加载。</p>
</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">
<p style="margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal">
桶（Buckets or Clusters）：每个分区的数据，基于表的一些列的哈希函数值，又被分割成桶。例如，表<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>page_views</code>可能通过<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>userid</code>分成桶，<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>userid</code>是表<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>page_view</code>的一个列，不同于分区列。这些桶可以被用于有效地抽样数据。</p>
</li></ul>
<h2 id="类型系统" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; padding:0px'>
<span style='color:rgb(46,48,51); font-family:Arial,"Microsoft YaHei",微软雅黑,宋体,"Malgun Gothic",Meiryo,sans-serif; line-height:18px'><span style="font-size:18px">注意，不需要对表进行分区或套接，但是这些抽象允许系统在查询处理过程中删除大量数据，从而导致查询执行速度更快。</span></span><br>
</h2>
<h2 id="类型系统" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:2.15em; padding:0px'>
<a target="_blank" name="t6" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>类型系统</h2>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
Hive支持原始类型和复要类型，如下所述，查看<a target="_blank" href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Types" rel="nofollow" style="background:transparent; color:rgb(202,12,22); margin:0px; padding:0px; outline:0px">Hive Data Types</a></p>
<h2 id="原始类型" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:2.15em; padding:0px'>
<a target="_blank" name="t7" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>原始类型</h2>
<ul style='margin:0px 0px 1.7em; padding:0px; list-style-position:initial; line-height:27.2px; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
<li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">类型与表的列相关。支持以下原始类型：</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Integers（整型） <br style="">
<ul style="margin:0px 0px 1.7em; padding:0px; list-style:disc; line-height:27.2px">
<li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">TINYINT －1位的整型</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">SMALLINT －2位的整型</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">INT －4位的整型</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">BIGINT －8位的整型</li></ul>
</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">布尔类型 <br style="">
<ul style="margin:0px 0px 1.7em; padding:0px; list-style:disc; line-height:27.2px">
<li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">BOOLEAN －TRUE/FALSE</li></ul>
</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">浮点数 <br style="">
<ul style="margin:0px 0px 1.7em; padding:0px; list-style:disc; line-height:27.2px">
<li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">FLOAT －单精度</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">DOUBLE －双精度</li></ul>
</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">定点数 <br style="">
-DECIMAL －用户可以指定范围和小数点位数</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">字符串 <br style="">
-STRING －在特定的字符集中的一个字符串序列 <br style="">
-VARCHAR －在特定的字符集中的一个有最大长度限制的字符串序列 <br style="">
-CHAR －在特定的字符集中的一个指定长度的字符串序列</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">日期和时间 <br style="">
-TIMESTAMP －一个特定的时间点，精确到纳秒。 <br style="">
-DATE －一个日期</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">二进制 <br style="">
-BINARY －一个二进制位序列</li></ul>
<h2 id="复杂类型" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:2.15em; padding:0px'>
<a target="_blank" name="t8" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>复杂类型</h2>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
复杂类型可以由原始类型和其他组合类型构建： <br style="">
- 结构体类型（Stuct): 使用点（.)来访问类型内部的元素。例如，有一列<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>c</code>，它是一个结构体类型{a INT; b INT}，字段a可以使用表达式<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>c.a</code>来访问。 <br style="">
- Map(key-value键值对)：使用<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>['元素名']</code>来访问元素。例如，有一个Map<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>M</code>，包含<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>'group'-&gt;gid</code>的映射，则gid的值可以使用<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>M['group']</code>来访问。 <br style="">
- 数组：数组中的元素是相同的类型。可以使用<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>[n]</code>来访问数组元素，<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>n</code>是数组下标，以0开始。例如有一个数组A，有元素<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>['a','b','c']</code>，则<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>A[1]</code>返回<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>'b'</code>。</p>
<h2 id="内置运算符和函数" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:2.15em; padding:0px'>
<a target="_blank" name="t9" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>内置运算符和函数</h2>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
<span style='color:rgb(46,48,51); font-family:Arial,"Microsoft YaHei",微软雅黑,宋体,"Malgun Gothic",Meiryo,sans-serif; line-height:18px'>下面列出的操作符和函数不一定是最新的。(Hive运营商和udf有更多的当前信息。)在Beeline或Hive CLI中，使用这些命令来显示最新的文档:</span><br>
</p>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
<span style='color:rgb(46,48,51); font-family:Arial,"Microsoft YaHei",微软雅黑,宋体,"Malgun Gothic",Meiryo,sans-serif; line-height:18px'></span></p><pre><code class="language-sql">SHOW FUNCTIONS;
DESCRIBE FUNCTION &lt;function_name&gt;;
DESCRIBE FUNCTION EXTENDED &lt;function_name&gt;;</code></pre>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
注意：Hive所有关键词的大小写都不敏感，包括Hive运算符和函数的名字。</p>
<h2 id="内置运算" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:2.15em; padding:0px'>
<a target="_blank" name="t10" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>内置运算</h2>
<ul style='margin:0px 0px 1.7em; padding:0px; list-style-position:initial; line-height:27.2px; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
<li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">关系运算 <br style="">
<img src="https://img-blog.csdn.net/20161219205800288?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3Ryb25neW91bmc4OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" style="border:0px; vertical-align:middle; outline:0px; margin-top:15px; margin-bottom:15px; max-width:100%"></li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">数学运算 <br style="">
<img src="https://img-blog.csdn.net/20161219205841272?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3Ryb25neW91bmc4OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" style="border:0px; vertical-align:middle; outline:0px; margin-top:15px; margin-bottom:15px; max-width:100%"></li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">逻辑运算 <br style="">
<img src="https://img-blog.csdn.net/20161219205859679?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3Ryb25neW91bmc4OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" style="border:0px; vertical-align:middle; outline:0px; margin-top:15px; margin-bottom:15px; max-width:100%"></li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">复杂类型的运算 <br style="">
<img src="https://img-blog.csdn.net/20161219205930357?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3Ryb25neW91bmc4OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" style="border:0px; vertical-align:middle; outline:0px; margin-top:15px; margin-bottom:15px; max-width:100%"></li></ul>
<h2 id="内置函数" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:2.15em; padding:0px'>
<a target="_blank" name="t11" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>内置函数</h2>
<ul style='margin:0px 0px 1.7em; padding:0px; list-style-position:initial; line-height:27.2px; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
<li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Hive支持以下内置函数 <br style="">
<img src="https://img-blog.csdn.net/20161219205953842?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3Ryb25neW91bmc4OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" style="border:0px; vertical-align:middle; outline:0px; margin-top:15px; margin-bottom:15px; max-width:100%"><br style="">
<img src="https://img-blog.csdn.net/20161219210014148?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3Ryb25neW91bmc4OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" style="border:0px; vertical-align:middle; outline:0px; margin-top:15px; margin-bottom:15px; max-width:100%"></li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Hive支持以下内置聚合函数 <br style="">
<img src="https://img-blog.csdn.net/20161219210026155?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3Ryb25neW91bmc4OA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title="" style="border:0px; vertical-align:middle; outline:0px; margin-top:15px; margin-bottom:15px; max-width:100%"></li></ul>
<h2 id="语言能力" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:2.15em; padding:0px'>
<a target="_blank" name="t12" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>语言能力</h2>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
Hive’s SQL提供了基本的SQL操作。这些操作工作于表或分区上。这些操作是： <br style="">
- 可以使用<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>WHERE</code>从表中筛选行 <br style="">
- 可以使用<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>SELECT</code>从表中查询指定的列 <br style="">
- 两个表之间可以join <br style="">
- 可以在多个<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>group by</code>的列上使用聚合 <br style="">
- 可以存储查询结构到另一个表 <br style="">
- 可以下载表的内容到本地目录 <br style="">
- 可以存储查询结果到hadoop的分布式文件系统目录上 <br style="">
- 可以管理表和分区（创建，删除和修改） <br style="">
- 可以使用自定义的脚本，来定制map/reduce作业</p>
<h1 id="使用和实例" style='margin:0.8em 0px; font-size:2.6em; font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); padding:0px'>
<a target="_blank" name="t13" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>使用和实例</h1>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
以下的例子有一些不是最新的，更多最新的信息，可以参考<a target="_blank" href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual" rel="nofollow" style="background:transparent; color:rgb(202,12,22); margin:0px; padding:0px; outline:0px">LanguageManual</a>。</p>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
以下的例子强调了Hive系统的显著特征。详细的查询测试用例和相应的查询结果可以在<a target="_blank" href="http://svn.apache.org/viewvc/hive/trunk/ql/src/test/queries/clientpositive/" rel="nofollow" style="background:transparent; color:rgb(202,12,22); margin:0px; padding:0px; outline:0px">Hive Query
 Test Cases’</a>上找到。</p>
<ul style='margin:0px 0px 1.7em; padding:0px; list-style-position:initial; line-height:27.2px; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
<li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">创建，显示，修改，和删除表</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">加载数据</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">查询和插入数据</li></ul>
<h2 id="创建显示修改和删除表" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:2.15em; padding:0px'>
<a target="_blank" name="t14" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>创建，显示，修改，和删除表</h2>
<h3 id="创建表" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:1.7em; padding:0px'>
<a target="_blank" name="t15" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>创建表</h3>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
以下例子创建表<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>page_view</code>：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs vbnet has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'>CREATE TABLE page_view(viewTime INT, userid BIGINT,
                page_url <span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">STRING</span>, referrer_url <span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">STRING</span>,
                ip <span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">STRING</span> COMMENT <span class="hljs-comment" style="margin:0px; padding:0px; color:rgb(136,0,0)">'IP Address of the User')</span>
COMMENT <span class="hljs-comment" style="margin:0px; padding:0px; color:rgb(136,0,0)">'This is the page view table'</span>
PARTITIONED <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span>(dt <span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">STRING</span>, country <span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">STRING</span>)
STORED <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">AS</span> SEQUENCEFILE;</code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">4</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">5</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">6</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
在这个例子中，表的列被指定相应的类型。备注（Comments)可以基于列级别，也可以是表级别。另外，使用<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>PARTITIONED</code>关键词定义的分区列与数据列是不同的，分区列实际上不存储数据。当使用这种方式创建表的时候，我们假设数据文件的内容，字段之间以ASCII 001（ctrl-A)分隔，行之间以换行分隔。</p>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
如果数据不是以上述格式组织的，我们也可以指定分隔符，如下：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">CREATE</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> page_view(viewTime <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INT</span>, userid BIGINT,
                page_url STRING, referrer_url STRING,
                ip STRING COMMENT <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'IP Address of the User'</span>)
COMMENT <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'This is the page view table'</span>
PARTITIONED <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span>(dt STRING, country STRING)
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">ROW</span> FORMAT DELIMITED
        FIELDS TERMINATED <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span> <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'1'</span>
STORED <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">AS</span> SEQUENCEFILE;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">4</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">5</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">6</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">7</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">8</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
目前，行分隔符不能指定，因为它不是由Hive决定，而是由Hadoop分隔符。</p>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
对表的指定列进行分桶，是一个好的方法，它可以有效地对数据集进行抽样查询。如果没有分桶，则会进行随机抽样，由于在查询的时候，需要扫描所有数据，因此，效率不高。以下例子描述了，在表<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>page_view</code>的<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>userid</code>列上进行分桶的例子：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">CREATE</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> page_view(viewTime <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INT</span>, userid BIGINT,
                page_url STRING, referrer_url STRING,
                ip STRING COMMENT <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'IP Address of the User'</span>)
COMMENT <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'This is the page view table'</span>
PARTITIONED <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span>(dt STRING, country STRING)
CLUSTERED <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span>(userid) SORTED <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span>(viewTime) <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INTO</span> <span class="hljs-number" style="margin:0px; padding:0px; color:rgb(0,102,102)">32</span> BUCKETS
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">ROW</span> FORMAT DELIMITED
        FIELDS TERMINATED <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span> <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'1'</span>
        COLLECTION ITEMS TERMINATED <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span> <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'2'</span>
        MAP KEYS TERMINATED <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span> <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'3'</span>
STORED <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">AS</span> SEQUENCEFILE;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">4</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">5</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">6</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">7</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">8</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">9</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">10</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">11</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
以上例子，通过一个<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>userid</code>的哈希函数，表被分成32个桶。在每个桶中的数据，是以<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>viewTime</code>升序进行存储。这样组织数据允许用户有效地在这n个桶上进行抽样。合适的排序使得内部操作充分利用熟悉的数据结构来进行更加有效的查询。</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs lasso has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'>CREATE TABLE page_view(viewTime INT, userid BIGINT,
                page_url <span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">STRING</span>, referrer_url <span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">STRING</span>,
                friends <span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">ARRAY</span><span class="hljs-subst" style="margin:0px; padding:0px; color:rgb(0,0,0)">&lt;</span>BIGINT<span class="hljs-subst" style="margin:0px; padding:0px; color:rgb(0,0,0)">&gt;</span>, properties <span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">MAP</span><span class="hljs-subst" style="margin:0px; padding:0px; color:rgb(0,0,0)">&lt;</span><span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">STRING</span>, <span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">STRING</span><span class="hljs-subst" style="margin:0px; padding:0px; color:rgb(0,0,0)">&gt;</span>,
                ip <span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">STRING</span> COMMENT <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'IP Address of the User'</span>)
COMMENT <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'This is the page view table'</span>
PARTITIONED <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span>(dt <span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">STRING</span>, country <span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">STRING</span>)
CLUSTERED <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span>(userid) SORTED <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span>(viewTime) <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INTO</span> <span class="hljs-number" style="margin:0px; padding:0px; color:rgb(0,102,102)">32</span> BUCKETS
ROW FORMAT DELIMITED
        FIELDS TERMINATED <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span> <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'1'</span>
        COLLECTION ITEMS TERMINATED <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span> <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'2'</span>
        <span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">MAP</span> KEYS TERMINATED <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span> <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'3'</span>
STORED AS SEQUENCEFILE;</code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">4</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">5</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">6</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">7</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">8</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">9</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">10</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">11</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">12</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
在这个例子，<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>CLUSTERED BY</code>指定列进行分桶，以及创建多少个桶。行格式分隔符指定在hive表中，行如何存储。在这种分隔符情况下，指定了字段是如何结束，集合项（数组和map）如何结束，以及map的key是如何结束的。<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>STORED
 AS SEQUENCEFILE</code>表示这个数据是以二进制格式进行存储数据在hdfs上。对于以上例子的<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>ROW FORMAT</code>的值和<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>STORED
 AS</code>表示系统默认值。</p>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
表名和列名不区分大小写。</p>
<h3 id="浏览表和分区" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:1.7em; padding:0px'>
<a target="_blank" name="t16" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>浏览表和分区</h3>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SHOW</span> TABLES;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
列出数据库里的所有的表，也可以这么浏览：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SHOW</span> TABLES <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'page.*'</span>;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
这样将会列出以<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>page</code>开头的表，模式遵循Java正则表达式语法。</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SHOW</span> PARTITIONS page_view;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
列出表的分区。如果表没有分区，则抛出错误。</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs  has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'>DESCRIBE page_view;</code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
列出表的列和列的类型。</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs  has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'>DESCRIBE EXTENDED page_view;</code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
列出表的列和表的其他属性。这会打印很多信息，且输出的风格不是很友好，通常用于调试。</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs bash has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'>DESCRIBE EXTENDED page_view PARTITION (ds=<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'2016-08-08'</span>);</code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
列出列和分区的所有属性。这也会打印出许多信息，通常也是用于调试。</p>
<h3 id="修改表" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:1.7em; padding:0px'>
<a target="_blank" name="t17" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>修改表</h3>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
对已有的表进行重命名。如果表的新名字存在，则报错：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">ALTER</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> old_table_name RENAME <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TO</span> new_table_name;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
对已有表的列名进行重命名。要确保使用相同的列类型，且要包含对每个已存在列的一个入口(也就是说，就算不修改其他列的列名，也要把此列另上，否则，此列会丢失）。</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs r has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'>ALTER TABLE old_table_name REPLACE COLUMNS (col1 TYPE, <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">...</span>);</code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
对已有表增加列：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">ALTER</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> tab1 <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">ADD</span> COLUMNS (c1 <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INT</span> COMMENT <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'a new int column'</span>, c2 STRING <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">DEFAULT</span> <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'def val'</span>);</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
注意： <br style="">
模式的改变（例如增加列），保留了表的老分区，以免它是一个分区表。所有对这些列或老分区的查询都会隐式地返回一个<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>null</code>值或这些列指定的默认值。</p>
<h3 id="删除表和分区" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:1.7em; padding:0px'>
<a target="_blank" name="t18" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>删除表和分区</h3>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
删除表是相当，表的删除会删除已经建立在表上的任意索引。相关命令是：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">DROP</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> pv_users;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
要删除分区。修改表删除分区：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">ALTER</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> pv_users <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">DROP</span> PARTITION (ds=<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'2016-08-08'</span>)</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
注意：此表或分区的任意数据都将被删除，而且可能无法恢复。</p>
<h2 id="加载数据" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:2.15em; padding:0px'>
<a target="_blank" name="t19" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>加载数据</h2>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
要加载数据到Hive表有许多种方式。用户可以创建一个“外部表”来指向一个特定的HDFS路径。用这种方法，用户可以使用HDFS<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>put</code>或<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>copy</code>命令，复制一个文件到指定的位置，并且附上相应的行格式信息创建一个表指定这个位置。一旦完成，用户就可以转换数据和插入他们到任意其他的Hive表中。例如，如果文件<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>/tmp/pv_2016-06-08.txt</code>包含逗号分隔的页面访问记录。这需要以合适的分区加载到表<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>page_view</code>，以下命令可以完成这个目标：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">CREATE</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">EXTERNAL</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> page_view_stg(viewTime <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INT</span>, userid BIGINT,
                page_url STRING, referrer_url STRING,
                ip STRING COMMENT <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'IP Address of the User'</span>,
                country STRING COMMENT <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'country of origination'</span>)
COMMENT <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'This is the staging page view table'</span>
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">ROW</span> FORMAT DELIMITED FIELDS TERMINATED <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span> <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'44'</span> LINES TERMINATED <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span> <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'12'</span>
STORED <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">AS</span> TEXTFILE
LOCATION <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'/user/data/staging/page_view'</span>;</span>

hadoop dfs -put /tmp/pv_2016-06-08.txt /user/data/staging/page_view

FROM page_view_stg pvs
<span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INSERT</span> OVERWRITE <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> page_view PARTITION(dt=<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'2016-06-08'</span>, country=<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'US'</span>)
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">null</span>, <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">null</span>, pvs.ip
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">WHERE</span> pvs.country = <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'US'</span>;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">4</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">5</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">6</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">7</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">8</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">9</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">10</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">11</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">12</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">13</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">14</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">15</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
其中，‘44’是逗号的ASCII码，‘12’是换页符（NP from feed,new page）。<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>null</code>是作为目标表中的数组和map类型插入，如果指定了合适的行格式，这些值也可以来自外部表。</p>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
如果在HDFS上有一些历史数据，用户想增加一些元数据，以便于可以使用Hive来查询和操纵这些数据，这个方法是很有用的。</p>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
另外，系统也支持直接从本地文件系统上加载数据到Hive表。表的格式与输入文件的格式需要相同。如果文件<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>/tmp/pv_2016-06-08</code>包含了<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>US</code>数据，然后我们不需要像前面例子那样的任何筛选，这种情况的加载可以使用以下语法完成：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">LOAD</span> DATA <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">LOCAL</span> INPATH /tmp/pv_2016-<span class="hljs-number" style="margin:0px; padding:0px; color:rgb(0,102,102)">06</span>-<span class="hljs-number" style="margin:0px; padding:0px; color:rgb(0,102,102)">08</span>_us.txt <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INTO</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> page_view PARTITION(<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">date</span>=<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'2016-06-08'</span>, country=<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'US'</span>)</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
路径参数可以是一个目录（这种情况下，目录下的所有文件将被加载），一个文件，或一个通配符（这种情况下，所有匹配的文件会上传）。如果参数是目录，它不能包含子目录。同样，通配符只匹配文件名。</p>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
在输入文件<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>/tmp/pv_2016-06-08.txt</code>非常大的情况下，用户可以采用并行加载数据的方式（使用Hive的外部工具）。只要文件在HDFS上－以下语法可以用于加载数据到Hive表：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">LOAD</span> DATA INPATH <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'/user/data/pv_2016-06-08_us.txt'</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INTO</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> page_view PARTITION(<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">date</span>=<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'2016-06-08'</span>, country=<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'US'</span>)</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
对于这个例子，我们假设数组和map在文件中的值为<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>null</code>。</p>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
更多关于加载数据到表的信息，请参考<a target="_blank" href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML" rel="nofollow" style="background:transparent; color:rgb(202,12,22); margin:0px; padding:0px; outline:0px">Hive Data Manipulation Language</a>,创建外部表的另外一个例子请参考<a target="_blank" href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-ExternalTables" rel="nofollow" style="background:transparent; color:rgb(202,12,22); margin:0px; padding:0px; outline:0px">External
 Tables</a>。</p>
<h2 id="查询和插入数据" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:2.15em; padding:0px'>
<a target="_blank" name="t20" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>查询和插入数据</h2>
<ul style='margin:0px 0px 1.7em; padding:0px; list-style-position:initial; line-height:27.2px; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
<li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Simple Query</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Partition Based Query</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Joins</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Aggregations</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Multi Table/File Inserts</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Dynamic-Partition Insert</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Inserting into Local Files</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Sampling</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Union All</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Array Operations</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Map (Associative Arrays) Operations</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Custom Map/Reduce Scripts</li><li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">Co-Groups</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
Hive查询操作在文档<a target="_blank" href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Select" rel="nofollow" style="background:transparent; color:rgb(202,12,22); margin:0px; padding:0px; outline:0px">Select</a>,插入操作在文档<a target="_blank" href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML#LanguageManualDML-InsertingdataintoHiveTablesfromqueries" rel="nofollow" style="background:transparent; color:rgb(202,12,22); margin:0px; padding:0px; outline:0px">insert
 data into Hive Tables from queries</a>和<a target="_blank" href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML#LanguageManualDML-Writingdataintothefilesystemfromqueries" rel="nofollow" style="background:transparent; color:rgb(202,12,22); margin:0px; padding:0px; outline:0px">writing
 data into the filesystem from queries</a>。</p>
<h3 id="简单的查询" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:1.7em; padding:0px'>
<a target="_blank" name="t21" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>简单的查询</h3>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
对于所有的活跃用户，可以使用以下查询格式：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INSERT</span> OVERWRITE <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> user_active
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">user</span>.*
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">user</span>
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">WHERE</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">user</span>.active = <span class="hljs-number" style="margin:0px; padding:0px; color:rgb(0,102,102)">1</span>;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">4</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
注意：不像SQL，我们老是插入结果到表中。随后我们会描述，用户如何检查这些结果，甚至把结果导出到一个本地文件。你也可以在<a target="_blank" href="https://cwiki.apache.org/confluence/display/Hive/HiveServer2+Clients#HiveServer2Clients-Beeline%E2%80%93NewCommandLineShell" rel="nofollow" style="background:transparent; color:rgb(202,12,22); margin:0px; padding:0px; outline:0px">Beeline</a>或Hive<a target="_blank" href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Cli" rel="nofollow" style="background:transparent; color:rgb(202,12,22); margin:0px; padding:0px; outline:0px">CLI</a>执行以下查询：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">user</span>.*
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">user</span>
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">WHERE</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">user</span>.active = <span class="hljs-number" style="margin:0px; padding:0px; color:rgb(0,102,102)">1</span>;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
这在内部将会重写到一些临时文件，并在Hive客户端显示。</p>
<h3 id="基于查询的分区" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:1.7em; padding:0px'>
<a target="_blank" name="t22" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>基于查询的分区</h3>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
在一个查询中，要使用什么分区，是由系统根据<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>where</code>在分区列上条件自动的决定。例如，为了获取所有2008年3月份，从域名<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>xyz.com</code>过来的page_views，可以这么写查询：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INSERT</span> OVERWRITE <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> xyz_com_page_views
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> page_views.*
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> page_views
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">WHERE</span> page_views.<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">date</span> &gt;= <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'2008-03-01'</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">AND</span> page_views.<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">date</span> &lt;= <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'2008-03-31'</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">AND</span>
      page_views.referrer_url <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">like</span> <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'%xyz.com'</span>;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">4</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">5</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
注意：在这里使用的<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>page_views.date</code>是用<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>PARTITIONED
 BY(date DATATIME, country STRING)</code>定义的.如果你的分区命名不一样，那么不要指望<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>.date</code>能够做你想做的事情，即无法获得分区的优势。</p>
<h3 id="连接" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:1.7em; padding:0px'>
<a target="_blank" name="t23" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>连接</h3>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
表的连接可以使用以下命令：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INSERT</span> OVERWRITE <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> pv_users
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> pv.*, u.gender, u.age
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">user</span> u <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">JOIN</span> page_view pv <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">ON</span> (pv.userid = u.id)
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">WHERE</span> pv.<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">date</span> = <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'2008-03-03'</span>;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">4</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
想实现外连接，用户可以使用<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>LEFT OUTER</code>,<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>RIGHT OUTER</code>或<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>FULL
 OUTER</code>关键词来指示不同的外连接（左保留，右保留或两端都保留）。例如，想对上面的查询做一个<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>FULL OUTER</code>，相应的语法可以像下面这样：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INSERT</span> OVERWRITE <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> pv_users
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> pv.*, u.gender, u.age
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">user</span> u <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FULL</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">OUTER</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">JOIN</span> page_view pv <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">ON</span> (pv.userid = u.id)
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">WHERE</span> pv.<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">date</span> = <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'2008-03-03'</span>;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">4</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
为了检查key在另外一个表中是否存在，用户可以使用<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>LEFT SEMI JOIN</code>,正如以下例子一样：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INSERT</span> OVERWRITE <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> pv_users
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> u.*
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">user</span> u <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">LEFT</span> SEMI <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">JOIN</span> page_view pv <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">ON</span> (pv.userid = u.id)
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">WHERE</span> pv.<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">date</span> = <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'2008-03-03'</span>;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">4</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
为了连接多个表，可以使用以下语法：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INSERT</span> OVERWRITE <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> pv_friends
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> pv.*, u.gender, u.age, f.friends
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> page_view pv <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">JOIN</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">user</span> u <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">ON</span> (pv.userid = u.id) <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">JOIN</span> friend_list f <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">ON</span> (u.id = f.uid)
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">WHERE</span> pv.<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">date</span> = <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'2008-03-03'</span>;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">4</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
注意：Hive只支持<a target="_blank" href="http://en.wikipedia.org/wiki/Join_%28SQL%29#Equi-join" rel="nofollow" style="background:transparent; color:rgb(202,12,22); margin:0px; padding:0px; outline:0px">equi-joins</a>。所以，把最大的表放在<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>join</code>的最右边，可以得到最好的性能。</p>
<h3 id="聚合" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:1.7em; padding:0px'>
<a target="_blank" name="t24" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>聚合</h3>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
统计用户每个性别的人数，可以使用以下查询：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INSERT</span> OVERWRITE <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> pv_gender_sum
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> pv_users.gender, <span class="hljs-aggregate" style="margin:0px; padding:0px">count</span> (<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">DISTINCT</span> pv_users.userid)
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> pv_users
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">GROUP</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span> pv_users.gender;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">4</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
可以同时做多个聚合，然而，两个聚合函数不能同时用<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>DISTINCT</code>作用于不同的列，以下情况是可以的（<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>DISTINCT</code>作用于相同列）：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INSERT</span> OVERWRITE <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> pv_gender_agg
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> pv_users.gender, <span class="hljs-aggregate" style="margin:0px; padding:0px">count</span>(<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">DISTINCT</span> pv_users.userid), <span class="hljs-aggregate" style="margin:0px; padding:0px">count</span>(*), <span class="hljs-aggregate" style="margin:0px; padding:0px">sum</span>(<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">DISTINCT</span> pv_users.userid)
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> pv_users
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">GROUP</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span> pv_users.gender;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">4</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
然而，以下情况（<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>DISTINCT</code>作用于不同的列）是不允许的：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INSERT</span> OVERWRITE <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> pv_gender_agg
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> pv_users.gender, <span class="hljs-aggregate" style="margin:0px; padding:0px">count</span>(<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">DISTINCT</span> pv_users.userid), <span class="hljs-aggregate" style="margin:0px; padding:0px">count</span>(<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">DISTINCT</span> pv_users.ip)
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> pv_users
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">GROUP</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span> pv_users.gender;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">4</li></ul>
<h3 id="多表文件插入" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:1.7em; padding:0px'>
<a target="_blank" name="t25" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>多表/文件插入</h3>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
聚合或简单查询的输出可以插入到多个表中，或者甚至是HDFS文件（能够使用HDFS工具进行操纵）。例如，如果沿用前面的“性别分类”，例子如下：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'>FROM pv_users
<span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INSERT</span> OVERWRITE <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> pv_gender_sum
    <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> pv_users.gender, count_distinct(pv_users.userid)
    <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">GROUP</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span> pv_users.gender

<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INSERT</span> OVERWRITE DIRECTORY <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'/user/data/tmp/pv_age_sum'</span>
    <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> pv_users.age, count_distinct(pv_users.userid)
    <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">GROUP</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span> pv_users.age;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">4</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">5</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">6</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">7</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">8</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
第一个插入语句将结果插入到Hive表中，而第二个插入语句是将结果写到HDFS文件。</p>
<h3 id="动太分区插入" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:1.7em; padding:0px'>
<a target="_blank" name="t26" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>动太分区插入</h3>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
在前面的例子中，我们知道，在插入语句中，只能有一个分区。如果我们想加载到多个分区，我们必须像以下描述来使用多条插入语句：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'>FROM page_view_stg pvs
<span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INSERT</span> OVERWRITE <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> page_view PARTITION(dt=<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'2008-06-08'</span>, country=<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'US'</span>)
       <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">null</span>, <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">null</span>, pvs.ip <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">WHERE</span> pvs.country = <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'US'</span>
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INSERT</span> OVERWRITE <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> page_view PARTITION(dt=<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'2008-06-08'</span>, country=<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'CA'</span>)
       <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">null</span>, <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">null</span>, pvs.ip <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">WHERE</span> pvs.country = <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'CA'</span>
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INSERT</span> OVERWRITE <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> page_view PARTITION(dt=<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'2008-06-08'</span>, country=<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'UK'</span>)
       <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">null</span>, <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">null</span>, pvs.ip <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">WHERE</span> pvs.country = <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'UK'</span>;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">4</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">5</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">6</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">7</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
为了加载数据到全部的<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>country</code>分区到指定的日期。我们必须在输入数据中为每个<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>country</code>增加一条插入语句。这是非常不方便的，因为我们需要提前创建且知道已存在哪些<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>country</code>分区列表。如果哪天这些<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>country</code>列表变了，我们必须修改我们的插入语句，也应该创建相应的分区。这也是非常低效的，因为每个插入语句可能都是转换成一个MapReduce作业。</p>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
<a target="_blank" href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML#LanguageManualDML-DynamicPartitionInserts" rel="nofollow" style="background:transparent; color:rgb(202,12,22); margin:0px; padding:0px; outline:0px">动态分区插入（Dynamic-partition
 insert)(或multi-partition插入)</a>就是为了解决以上问题而设计的，它通过动态地决定在扫描数据的时候，哪些分区应该创建和填充。这个新的特征是在版本0.6.0加入的。在动态分区插入中，输入列被评估，这行应该插入到哪个分区。如果分区没有创建，它将自动创建这个分区。使用这个特征，我们仅仅需要插入语桀犬吠尧来创建和填充所有需要的分区。另外，因为只有一个插入语句，相应的也只有一个MapReduce作业。相比多个插入语句的情况，这将显著地提高性能且降低Hadoop集群负载。</p>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
以下是使用一个插入语句，加载数据到所有<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>country</code>分区的例子：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'>FROM page_view_stg pvs
<span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INSERT</span> OVERWRITE <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> page_view PARTITION(dt=<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'2008-06-08'</span>, country)
       <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">null</span>, <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">null</span>, pvs.ip, pvs.country</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
与多条插入语句相比，动态分区插入有一些语法上的不同： <br style="">
- <code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>country</code>出现在<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>PARTITION</code>后面，但是没有具体的值。这种情况，<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>country</code>就是一个动态分区列。另一方面，<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>dt</code>有一个值，这意味着它是一个静态的分区列。如果一个列是动态分区列，它的值将会使用输入列的值。目前，我们仅仅允许在分区条件的最后一列放置动态分区列，因为分区列的顺序，指示了它的层级次序（意味着<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>dt</code>是根分区，<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>country</code>是子分区）。我们不能这样指定分区（dt,country=’US’)，因为这表示，我们需要更新所有的日期的分区且它的<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>country</code>子分区是‘US’。</p>
<ul style='margin:0px 0px 1.7em; padding:0px; list-style-position:initial; line-height:27.2px; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
<li style="margin:0px 0px 0px 40px; padding:0px; list-style:disc">一个额外的<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>pvs.country</code>列被加入在查询语句中。这对动态分区列来说，相当于输入列。注意：对于静态分区列，我们不需要添加一个输入列，因为在PARTITION语句中，它的值已经知道。注意：动态分区列的值（不是名字）查出来是有序的，且是放在select语句的最后。</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
动态分区插入的语义： <br style="">
- 对于动态分区列，当已经此分区时，（例如，<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>country='CA'</code>已存在<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>dt</code>根分区下面）如果动态分区插入与输入数据中相同的值（’CA’），它将会被重写（overwritten)。</p>
<h3 id="插入到本地文件" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:1.7em; padding:0px'>
<a target="_blank" name="t27" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>插入到本地文件</h3>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
在某些场合，我们需要把输出写到一个本地文件，以便于能用excel表格打开。这可以使用以下命令：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INSERT</span> OVERWRITE <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">LOCAL</span> DIRECTORY <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'/tmp/pv_gender_sum'</span>
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> pv_gender_sum.*
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> pv_gender_sum;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li></ul>
<h3 id="抽样" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:1.7em; padding:0px'>
<a target="_blank" name="t28" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>抽样</h3>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
抽样语句允许用户对数据抽样查询，而不是全表查询。当前，抽样是对那些在<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>CREATE TABLE</code>语句的<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>CLUSTERED
 BY</code>修饰的列上。以下例子，我们从表<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>pv_gender_sum</code>表中的32个桶中，选择第3个桶。</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INSERT</span> OVERWRITE <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> pv_gender_sum_sample
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> pv_gender_sum.*
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> pv_gender_sum TABLESAMPLE(BUCKET <span class="hljs-number" style="margin:0px; padding:0px; color:rgb(0,102,102)">3</span> OUT <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">OF</span> <span class="hljs-number" style="margin:0px; padding:0px; color:rgb(0,102,102)">32</span>);</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
通常，<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>TABLESAMPLE</code>的语法像这样：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs vhdl has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'>TABLESAMPLE(BUCKET x <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">OUT</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">OF</span> y)</code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
这个<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>y</code>必须是桶的数量的因子或倍数，桶的数量是在创建表的时候指定的。抽样所选的桶由桶大小，y和x共同决定。如果y和桶大小相等，则抽样所选的桶是x对y的求模结果。</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs vhdl has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'>TABLESAMPLE(BUCKET <span class="hljs-number" style="margin:0px; padding:0px; color:rgb(0,102,102)">3</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">OUT</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">OF</span> <span class="hljs-number" style="margin:0px; padding:0px; color:rgb(0,102,102)">16</span>)</code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
这将抽样第3个和第19个桶。桶的编号从0开始。</p>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>tablesample</code>语句的另一方面：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs vhdl has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'>TABLESAMPLE(BUCKET <span class="hljs-number" style="margin:0px; padding:0px; color:rgb(0,102,102)">3</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">OUT</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">OF</span> <span class="hljs-number" style="margin:0px; padding:0px; color:rgb(0,102,102)">64</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">ON</span> userid)</code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
这将抽取第3个桶的一半。</p>
<h3 id="union-all" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:1.7em; padding:0px'>
<a target="_blank" name="t29" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>union all</h3>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
这个语言也支持<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>union all</code>，如果假设我们有两个不同的表，分别用来记录用户发布的视频和用户发布的评论，以下例子是一个union all 的结果与用户表再连接的查询：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INSERT</span> OVERWRITE <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> actions_users
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> u.id, actions.<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">date</span>
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> (
    <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> av.uid <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">AS</span> uid
    <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> action_video av
    <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">WHERE</span> av.<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">date</span> = <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'2008-06-03'</span>

    <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">UNION</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">ALL</span>

    <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> ac.uid <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">AS</span> uid
    <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> action_comment ac
    <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">WHERE</span> ac.<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">date</span> = <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'2008-06-03'</span>
    ) actions <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">JOIN</span> users u <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">ON</span>(u.id = actions.uid);</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">4</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">5</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">6</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">7</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">8</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">9</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">10</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">11</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">12</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">13</li></ul>
<h3 id="数组操作" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:1.7em; padding:0px'>
<a target="_blank" name="t30" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>数组操作</h3>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
表的数组列可以这样：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">CREATE</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> array_table (int_array_column ARRAY&lt;<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INT</span>&gt;);</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
假设pv.friends 是类型<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>ARRAY&lt;INT&gt;</code>（也就是一个整型数组），用户可以通过索引号获取数组中特定的元素，如下：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> pv.friends[<span class="hljs-number" style="margin:0px; padding:0px; color:rgb(0,102,102)">2</span>]
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> page_views pv;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
这个查询得到的是pv.friends里的第三个元素。</p>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
用户也可以使用函数<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>size</code>来获取数组的长度，如下：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> pv.userid, <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">size</span>(pv.friends)
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> page_view pv;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li></ul>
<h3 id="map关联数组操作" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:1.7em; padding:0px'>
<a target="_blank" name="t31" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>Map（关联数组）操作</h3>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
Map提供了类似于关联数组的集合。这样的结构不仅可以由程序创建。我们也将很快可以继承这个。假设pv.properties是类型<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>map&lt;String,String&gt;</code>，如下：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INSERT</span> OVERWRITE page_views_map
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> pv.userid, pv.properties[<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'page type'</span>]
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> page_views pv;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
这将查询表<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>page_views</code>的‘page_type‘属性。</p>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
与数组相似，也可以使用函数<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>size</code>来获取map的大小：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">size</span>(pv.properties)
<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> page_view pv;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li></ul>
<h3 id="定制mapreduce脚本" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:1.7em; padding:0px'>
<a target="_blank" name="t32" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>定制Map/Reduce脚本</h3>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
通过使用Hive语言原生支持的特征，用户可以插入他们自己定制的mapper和reducer在数据流中。例如，要运行一个定制的mapper脚本<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>script-map_script</code>和reducer脚本<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>script-reduce_script</code>)，用户可以执行以下命令，使用<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>TRANSFORM</code>来嵌入mapper和reducer脚本。</p>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
注意：在执行用户脚本之前，表的列会转换成字符串，且由<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>TAB</code>分隔，用户脚本的标准输出将会被作为以<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>TAB</code>分隔的字符串列。用户脚本可以输出调试信息到标准错误输出，这个信息也将显示hadoop的详细任务页面上。</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs vbnet has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> (
     <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> pv_users
     MAP pv_users.userid, pv_users.<span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">date</span>
     <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">USING</span> <span class="hljs-comment" style="margin:0px; padding:0px; color:rgb(136,0,0)">'map_script'</span>
     <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">AS</span> dt, uid
     CLUSTER <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span> dt) map_output

 INSERT OVERWRITE TABLE pv_users_reduced
     REDUCE map_output.dt, map_output.uid
     <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">USING</span> <span class="hljs-comment" style="margin:0px; padding:0px; color:rgb(136,0,0)">'reduce_script'</span>
     <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">AS</span> <span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">date</span>, count;</code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">4</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">5</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">6</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">7</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">8</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">9</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">10</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">11</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
map脚本样本（weekday_mapper.py)</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs livecodeserver has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'>import sys
import datetime

<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">for</span> <span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">line</span> <span class="hljs-operator" style="margin:0px; padding:0px">in</span> sys.<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">stdin</span>:
  <span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">line</span> = <span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">line</span>.strip()
  userid, unixtime = <span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">line</span>.<span class="hljs-built_in" style="margin:0px; padding:0px; color:rgb(102,0,102)">split</span>(<span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'\t'</span>)
  weekday = datetime.datetime.fromtimestamp(float(unixtime)).isoweekday()
  print <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">','</span>.join([userid, str(weekday)])</code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">4</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">5</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">6</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">7</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">8</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
当然，对于那些常见的select转换，MAP和REDUCE都是“语法糖”。内部查询也可以写成这样：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'><span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> TRANSFORM(pv_users.userid, pv_users.<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">date</span>) <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">USING</span> <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'map_script'</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">AS</span> dt, uid CLUSTER <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span> dt <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> pv_users;</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li></ul>
<h3 id="co-groups" style='font-family:"microsoft yahei"; font-weight:100; line-height:1.1; color:rgb(63,63,63); margin:0.8em 0px; font-size:1.7em; padding:0px'>
<a target="_blank" name="t33" style="background:transparent; color:rgb(79,161,219); margin:0px; padding:0px; outline:0px"></a>Co-Groups</h3>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
在使用map/reduce的群体中，<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>cogroup</code>是相当常见的操作，它是将来自多个表的数据发送到一个定制的reducer，使得行由表的指定列的值进行分组。在Hive的查询语言中，可以使用以下方式，通过使用<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>union
 all</code>和<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>cluster by</code>来实现此功能。假设我们想对来自表<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>actions_video</code>和<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>action_comment</code>的行对<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>uid</code>列进行分组，且需要发送他们到<code style='font-family:"Source Code Pro",monospace; font-size:14.4px; padding:2px 4px; white-space:nowrap'>reducer_script</code>定制的reducer，可以使用以下语法：</p>
<pre class="prettyprint" style='font-family:"Source Code Pro",monospace; font-size:14px; white-space:nowrap; padding:5px 5px 5px 60px; margin-top:0px; margin-bottom:1.7em; line-height:23.8px; color:rgb(51,51,51); word-break:break-all; word-wrap:break-word; position:relative; overflow-y:hidden; overflow-x:auto'><code class="hljs sql has-numbering" style='font-family:"Source Code Pro",monospace; font-size:12.6px; padding:0px; color:inherit; white-space:pre; background:transparent; display:block; overflow-x:auto; word-wrap:normal'>FROM (
     FROM (
             FROM action_video av
             <span class="hljs-operator" style="margin:0px; padding:0px"><span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> av.uid <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">AS</span> uid, av.id <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">AS</span> id, av.<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">date</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">AS</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">date</span>

            <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">UNION</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">ALL</span>

             <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">FROM</span> action_comment ac
             <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> ac.uid <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">AS</span> uid, ac.id <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">AS</span> id, ac.<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">date</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">AS</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">date</span>
     ) union_actions
     <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> union_actions.uid, union_actions.id, union_actions.<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">date</span>
     CLUSTER <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">BY</span> union_actions.uid) map

 <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">INSERT</span> OVERWRITE <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">TABLE</span> actions_reduced
     <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">SELECT</span> TRANSFORM(map.uid, map.id, map.<span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">date</span>) <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">USING</span> <span class="hljs-string" style="margin:0px; padding:0px; color:rgb(0,136,0)">'reduce_script'</span> <span class="hljs-keyword" style="margin:0px; padding:0px; color:rgb(0,0,136)">AS</span> (uid, id, reduced_val);</span></code></pre><ul class="pre-numbering" style="margin:0px; padding:6px 0px 40px; list-style:none; line-height:23.8px; position:absolute; width:50px; background-color:rgb(238,238,238); top:0px; left:0px; border-right:1px solid rgb(221,221,221); text-align:right"><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">1</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">2</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">3</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">4</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">5</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">6</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">7</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">8</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">9</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">10</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">11</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">12</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">13</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">14</li><li style="margin:0px; padding:0px 5px; list-style:none; color:rgb(153,153,153)">15</li></ul>
<p style='margin-top:0px; margin-bottom:1.7em; padding-top:0px; padding-bottom:0px; line-height:27.2px; word-wrap:break-word; word-break:normal; color:rgb(63,63,63); font-family:"microsoft yahei"; font-size:16px'>
翻译自： https://cwiki.apache.org/confluence/display/Hive/Tutorial</p>
            </div>
                </div>