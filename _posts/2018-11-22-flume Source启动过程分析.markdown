---
layout:     post
title:      flume Source启动过程分析
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								<div class="article-copyright">
					版权声明：本文为博主原创文章，未经博主允许不得转载。					https://blog.csdn.net/ty_laurel/article/details/53728655				</div>
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<p></p>
<h2 id="wiz_toc_0" style='margin:0px 0px 10px; padding:0px; font-size:20px; position:relative; font-family:Helvetica,"Hiragino Sans GB",微软雅黑,"Microsoft YaHei UI",SimSun,SimHei,arial,sans-serif'>
组件框图</h2>
<p></p>
<p style='margin-top:10px; margin-bottom:10px; font-size:15px; font-family:Helvetica,"Hiragino Sans GB",微软雅黑,"Microsoft YaHei UI",SimSun,SimHei,arial,sans-serif; line-height:24px'>
开始之前，先看下基本的组件框架图，熟悉了大致框架流程学习起来必然会更加轻松： <br>
<img src="file:///C:/Users/bjtianye1/Documents/My%20Knowledge/temp/30b802ec-0106-4edc-ba31-0400118055f2/128/index_files/dd82e6c6-23b1-4856-b682-0be11795f8bd.png" alt="" style="border:0px; max-width:100%; margin:2px 0px; height:auto!important"><img src="https://img-blog.csdn.net/20170117164832753?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdHlfbGF1cmVs/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<ol style='margin:10px 0px; padding-left:32px; font-family:Helvetica,"Hiragino Sans GB",微软雅黑,"Microsoft YaHei UI",SimSun,SimHei,arial,sans-serif; font-size:15px; line-height:24px'>
<li style="margin:0px 0px 5px">接收事件</li><li style="margin:0px 0px 5px">根据配置选择对应的Source运行器（EventDrivenSourceRunner 和 PollableSourceRunner）</li><li style="margin:5px 0px">处理器处理事件（Load-Balancing Sink 和 Failover Sink 处理器）</li><li style="margin:5px 0px">将事件传递给拦截器链</li><li style="margin:5px 0px">将每个事件传递给Channel选择器</li><li style="margin:5px 0px">返回写入事件的Channel列表</li><li style="margin:5px 0px">将所有事件写入每个必需的Channel，只有一个事务被打开</li><li style="margin:5px 0px">可选Channel（配置可选Channel后不管其是否写入成功）</li></ol>
<h2 id="wiz_toc_1" style='margin:20px 0px 10px; padding:0px; font-size:20px; position:relative; font-family:Helvetica,"Hiragino Sans GB",微软雅黑,"Microsoft YaHei UI",SimSun,SimHei,arial,sans-serif'>
程序入口</h2>
<p style='margin-top:10px; margin-bottom:10px; font-size:15px; font-family:Helvetica,"Hiragino Sans GB",微软雅黑,"Microsoft YaHei UI",SimSun,SimHei,arial,sans-serif; line-height:24px'>
flume从 Application.java 文件中的main方法开始运行，main方法开始就是对命令行参数进行解析，然后就是加载配置文件进一步调用相应方法。 <br>
Flume-ng支持两种加载配置文件模式，一种是静态配置，也就是只加载一次配置文件；第二种是基于Guava EventBus发布订阅模式的动态配置，只要对配置文件做了更改即便服务已经运行也是会使得更改被识别，即就是动态加载。</p>
<pre class="prettyprint linenums prettyprinted" style='margin-top:10px; margin-bottom:10px; border:1px solid rgb(225,225,232); font-size:13px; line-height:19px; overflow:auto; padding:0px; word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; background-color:rgb(247,247,249)'><ol class="linenums" style="margin:0px; padding:10px 10px 10px 40px!important; color:rgb(30,52,123)"><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="com" style="color:rgb(147,161,161); margin-top:0px">//hasOption方法:true if set, false if not</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="kwd" style="color:rgb(30,52,123); margin-top:0px">boolean</span><span class="pln" style="color:rgb(72,72,76)"> reload </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">!</span><span class="pln" style="color:rgb(72,72,76)">commandLine</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">hasOption</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="str" style="color:rgb(221,17,68)">"no-reload-conf"</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="kwd" style="color:rgb(30,52,123); margin-top:0px">if</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">isZkConfigured</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">  </span><span class="com" style="color:rgb(147,161,161)">//若是通过ZooKeeper配置的，则使用ZooKeeper参数启动，具体步骤和else中类似</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pun" style="color:rgb(147,161,161); margin-top:0px">}</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">else</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">   </span><span class="kwd" style="color:rgb(30,52,123)">if</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">reload</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          </span><span class="typ" style="color:teal">EventBus</span><span class="pln" style="color:rgb(72,72,76)"> eventBus </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">new</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">EventBus</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">agentName </span><span class="pun" style="color:rgb(147,161,161)">+</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="str" style="color:rgb(221,17,68)">"-event-bus"</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          </span><span class="com" style="color:rgb(147,161,161)">//PollingPropertiesFileConfigurationProvider该类是一个轮询操作，每隔30秒会去检查conf配置文件</span></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          </span><span class="typ" style="color:teal">PollingPropertiesFileConfigurationProvider</span><span class="pln" style="color:rgb(72,72,76)"> configurationProvider </span><span class="pun" style="color:rgb(147,161,161)">=</span></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">              </span><span class="kwd" style="color:rgb(30,52,123)">new</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">PollingPropertiesFileConfigurationProvider</span><span class="pun" style="color:rgb(147,161,161)">(</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">                  agentName</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> configurationFile</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> eventBus</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="lit" style="color:rgb(25,95,145)">30</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          components</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">add</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">configurationProvider</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          application </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">new</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">Application</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">components</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          eventBus</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="kwd" style="color:rgb(30,52,123)">register</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">application</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="pun" style="color:rgb(147,161,161)">}</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">else</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          </span><span class="com" style="color:rgb(147,161,161)">//静态加载配置文件，只加载一次</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          </span><span class="typ" style="color:teal">PropertiesFileConfigurationProvider</span><span class="pln" style="color:rgb(72,72,76)"> configurationProvider </span><span class="pun" style="color:rgb(147,161,161)">=</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">              </span><span class="kwd" style="color:rgb(30,52,123)">new</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">PropertiesFileConfigurationProvider</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">agentName</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> configurationFile</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          application </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">new</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">Application</span><span class="pun" style="color:rgb(147,161,161)">();</span></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          application</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">handleConfigurationEvent</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">configurationProvider</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getConfiguration</span><span class="pun" style="color:rgb(147,161,161)">());</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      application</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">start</span><span class="pun" style="color:rgb(147,161,161)">();</span><span class="pln" style="color:rgb(72,72,76)">    </span></code></li></ol></pre>
<p style='margin-top:10px; margin-bottom:10px; font-size:15px; font-family:Helvetica,"Hiragino Sans GB",微软雅黑,"Microsoft YaHei UI",SimSun,SimHei,arial,sans-serif; line-height:24px'>
启动flume时没有指定no-reload-conf（默认false）的话hasOption方法就返回false，因而reload为true。所以这下来就是创建PollingPropertiesFileConfigurationProvider对象动态加载配置文件。然后可以看到eventBus.register(application)语句，其作用就是将对象application注册在eventBus上，当配置文件发生变化，configurationProvider就会发布消息(发布者)， EventBus就会调用application中带有@Subscribe注解的方法handleConfigurationEvent(订阅者)。下边看看具体的handleConfigurationEvent方法实现了什么功能？</p>
<pre class="prettyprint linenums prettyprinted" style='margin-top:10px; margin-bottom:10px; border:1px solid rgb(225,225,232); font-size:13px; line-height:19px; overflow:auto; padding:0px; word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; background-color:rgb(247,247,249)'><ol class="linenums" style="margin:0px; padding:10px 10px 10px 40px!important; color:rgb(30,52,123)"><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="lit" style="color:rgb(25,95,145); margin-top:0px">@Subscribe</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">  </span><span class="kwd" style="color:rgb(30,52,123)">public</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">synchronized</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">void</span><span class="pln" style="color:rgb(72,72,76)"> handleConfigurationEvent</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">MaterializedConfiguration</span><span class="pln" style="color:rgb(72,72,76)"> conf</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    stopAllComponents</span><span class="pun" style="color:rgb(147,161,161)">();</span><span class="pln" style="color:rgb(72,72,76)">      </span><span class="com" style="color:rgb(147,161,161)">//停止组件,顺序 source-&gt;sink-&gt;channel</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    startAllComponents</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">conf</span><span class="pun" style="color:rgb(147,161,161)">);</span><span class="pln" style="color:rgb(72,72,76)">     </span><span class="com" style="color:rgb(147,161,161)">//启动组件，顺序 channel-&gt;sink-&gt;source</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">  </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li></ol></pre>
<p style='margin-top:10px; margin-bottom:10px; font-size:15px; font-family:Helvetica,"Hiragino Sans GB",微软雅黑,"Microsoft YaHei UI",SimSun,SimHei,arial,sans-serif; line-height:24px'>
该方法主要是实现了组件的启停功能，在每次调用前都会先停止所有组件，然后在启动组件，包括source、channel、sink。现在是研究具体的启动过程，那就进入startAllComponents方法看看。 <br>
调用 startAllComponents 方法，其中会按顺序启动channel、sink、source几个组件：</p>
<pre class="prettyprint linenums prettyprinted" style='margin-top:10px; margin-bottom:10px; border:1px solid rgb(225,225,232); font-size:13px; line-height:19px; overflow:auto; padding:0px; word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; background-color:rgb(247,247,249)'><ol class="linenums" style="margin:0px; padding:10px 10px 10px 40px!important; color:rgb(30,52,123)"><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="kwd" style="color:rgb(30,52,123); margin-top:0px">private</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">void</span><span class="pln" style="color:rgb(72,72,76)"> startAllComponents</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">MaterializedConfiguration</span><span class="pln" style="color:rgb(72,72,76)"> materializedConfiguration</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="com" style="color:rgb(147,161,161); margin-top:0px">/* </span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="com" style="color:rgb(147,161,161); margin-top:0px"> materializedConfiguration对象中存储如下内容:</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="com" style="color:rgb(147,161,161); margin-top:0px">{ sourceRunners:{r1=PollableSourceRunner: { source:Taildir source: { positionFile: /home/bjtianye1/flume-kafkachannel/position.json, skipToEnd: false, byteOffsetHeader: false, idleTimeout: 120000, writePosInterval: 3000 } counterGroup:{ name:null counters:{} } }}sinkRunners:{k3=SinkRunner: { policy:org.apache.flume.sink.DefaultSinkProcessor@11498436 counterGroup:{ name:null counters:{} } }, </span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="com" style="color:rgb(147,161,161); margin-top:0px">k1=SinkRunner: { policy:org.apache.flume.sink.DefaultSinkProcessor@7186fe17 counterGroup:{ name:null counters:{} } }, k2=SinkRunner: { policy:org.apache.flume.sink.DefaultSinkProcessor@5593d23b counterGroup:{ name:null counters:{} } }} channels:{c2=org.apache.flume.channel.kafka.KafkaChannel{name: c2}} }</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="com" style="color:rgb(147,161,161); margin-top:0px">*/</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    logger</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">info</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="str" style="color:rgb(221,17,68)">"Starting new configuration:{}"</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> materializedConfiguration</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="kwd" style="color:rgb(30,52,123)">this</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">materializedConfiguration </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> materializedConfiguration</span><span class="pun" style="color:rgb(147,161,161)">;</span></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="com" style="color:rgb(147,161,161)">//启动channel</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="kwd" style="color:rgb(30,52,123)">for</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">Entry</span><span class="pun" style="color:rgb(147,161,161)">&lt;</span><span class="typ" style="color:teal">String</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">Channel</span><span class="pun" style="color:rgb(147,161,161)">&gt;</span><span class="pln" style="color:rgb(72,72,76)"> entry </span><span class="pun" style="color:rgb(147,161,161)">:</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        materializedConfiguration</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getChannels</span><span class="pun" style="color:rgb(147,161,161)">().</span><span class="pln" style="color:rgb(72,72,76)">entrySet</span><span class="pun" style="color:rgb(147,161,161)">())</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="kwd" style="color:rgb(30,52,123)">try</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        logger</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">info</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="str" style="color:rgb(221,17,68)">"Starting Channel "</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">+</span><span class="pln" style="color:rgb(72,72,76)"> entry</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getKey</span><span class="pun" style="color:rgb(147,161,161)">());</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        supervisor</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">supervise</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">entry</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getValue</span><span class="pun" style="color:rgb(147,161,161)">(),</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">            </span><span class="kwd" style="color:rgb(30,52,123)">new</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">SupervisorPolicy</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="typ" style="color:teal">AlwaysRestartPolicy</span><span class="pun" style="color:rgb(147,161,161)">(),</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">LifecycleState</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">START</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">catch</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">Exception</span><span class="pln" style="color:rgb(72,72,76)"> e</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        logger</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">error</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="str" style="color:rgb(221,17,68)">"Error while starting {}"</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> entry</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getValue</span><span class="pun" style="color:rgb(147,161,161)">(),</span><span class="pln" style="color:rgb(72,72,76)"> e</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="com" style="color:rgb(147,161,161)">/*</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="com" style="color:rgb(147,161,161); margin-top:0px">     * Wait for all channels to start.</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="com" style="color:rgb(147,161,161); margin-top:0px">     */</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="kwd" style="color:rgb(30,52,123)">for</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">Channel</span><span class="pln" style="color:rgb(72,72,76)"> ch </span><span class="pun" style="color:rgb(147,161,161)">:</span><span class="pln" style="color:rgb(72,72,76)"> materializedConfiguration</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getChannels</span><span class="pun" style="color:rgb(147,161,161)">().</span><span class="pln" style="color:rgb(72,72,76)">values</span><span class="pun" style="color:rgb(147,161,161)">())</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="kwd" style="color:rgb(30,52,123)">while</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">ch</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getLifecycleState</span><span class="pun" style="color:rgb(147,161,161)">()</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">!=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">LifecycleState</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">START</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          </span><span class="pun" style="color:rgb(147,161,161)">&amp;&amp;</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">!</span><span class="pln" style="color:rgb(72,72,76)">supervisor</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">isComponentInErrorState</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">ch</span><span class="pun" style="color:rgb(147,161,161)">))</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="kwd" style="color:rgb(30,52,123)">try</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          logger</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">info</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="str" style="color:rgb(221,17,68)">"Waiting for channel: "</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">+</span><span class="pln" style="color:rgb(72,72,76)"> ch</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getName</span><span class="pun" style="color:rgb(147,161,161)">()</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">+</span></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">              </span><span class="str" style="color:rgb(221,17,68)">" to start. Sleeping for 500 ms"</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          </span><span class="typ" style="color:teal">Thread</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">sleep</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="lit" style="color:rgb(25,95,145)">500</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="pun" style="color:rgb(147,161,161)">}</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">catch</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">InterruptedException</span><span class="pln" style="color:rgb(72,72,76)"> e</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          logger</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">error</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="str" style="color:rgb(221,17,68)">"Interrupted while waiting for channel to start."</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> e</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          </span><span class="typ" style="color:teal">Throwables</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">propagate</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">e</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="com" style="color:rgb(147,161,161)">//启动sink</span></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="kwd" style="color:rgb(30,52,123)">for</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">Entry</span><span class="pun" style="color:rgb(147,161,161)">&lt;</span><span class="typ" style="color:teal">String</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">SinkRunner</span><span class="pun" style="color:rgb(147,161,161)">&gt;</span><span class="pln" style="color:rgb(72,72,76)"> entry </span><span class="pun" style="color:rgb(147,161,161)">:</span><span class="pln" style="color:rgb(72,72,76)"> materializedConfiguration</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getSinkRunners</span><span class="pun" style="color:rgb(147,161,161)">().</span><span class="pln" style="color:rgb(72,72,76)">entrySet</span><span class="pun" style="color:rgb(147,161,161)">())</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="kwd" style="color:rgb(30,52,123)">try</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        logger</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">info</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="str" style="color:rgb(221,17,68)">"Starting Sink "</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">+</span><span class="pln" style="color:rgb(72,72,76)"> entry</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getKey</span><span class="pun" style="color:rgb(147,161,161)">());</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        supervisor</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">supervise</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">entry</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getValue</span><span class="pun" style="color:rgb(147,161,161)">(),</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">            </span><span class="kwd" style="color:rgb(30,52,123)">new</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">SupervisorPolicy</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="typ" style="color:teal">AlwaysRestartPolicy</span><span class="pun" style="color:rgb(147,161,161)">(),</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">LifecycleState</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">START</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">catch</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">Exception</span><span class="pln" style="color:rgb(72,72,76)"> e</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        logger</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">error</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="str" style="color:rgb(221,17,68)">"Error while starting {}"</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> entry</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getValue</span><span class="pun" style="color:rgb(147,161,161)">(),</span><span class="pln" style="color:rgb(72,72,76)"> e</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="com" style="color:rgb(147,161,161)">//启动source</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="kwd" style="color:rgb(30,52,123)">for</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">Entry</span><span class="pun" style="color:rgb(147,161,161)">&lt;</span><span class="typ" style="color:teal">String</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">SourceRunner</span><span class="pun" style="color:rgb(147,161,161)">&gt;</span><span class="pln" style="color:rgb(72,72,76)"> entry </span><span class="pun" style="color:rgb(147,161,161)">:</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">         materializedConfiguration</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getSourceRunners</span><span class="pun" style="color:rgb(147,161,161)">().</span><span class="pln" style="color:rgb(72,72,76)">entrySet</span><span class="pun" style="color:rgb(147,161,161)">())</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="kwd" style="color:rgb(30,52,123)">try</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        logger</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">info</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="str" style="color:rgb(221,17,68)">"Starting Source "</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">+</span><span class="pln" style="color:rgb(72,72,76)"> entry</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getKey</span><span class="pun" style="color:rgb(147,161,161)">());</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        supervisor</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">supervise</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">entry</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getValue</span><span class="pun" style="color:rgb(147,161,161)">(),</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">            </span><span class="kwd" style="color:rgb(30,52,123)">new</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">SupervisorPolicy</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="typ" style="color:teal">AlwaysRestartPolicy</span><span class="pun" style="color:rgb(147,161,161)">(),</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">LifecycleState</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">START</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">catch</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">Exception</span><span class="pln" style="color:rgb(72,72,76)"> e</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        logger</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">error</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="str" style="color:rgb(221,17,68)">"Error while starting {}"</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> entry</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getValue</span><span class="pun" style="color:rgb(147,161,161)">(),</span><span class="pln" style="color:rgb(72,72,76)"> e</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="com" style="color:rgb(147,161,161)">//加载监控</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="kwd" style="color:rgb(30,52,123)">this</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">loadMonitoring</span><span class="pun" style="color:rgb(147,161,161)">();</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">  </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li></ol></pre>
<p style='margin-top:10px; margin-bottom:10px; font-size:15px; font-family:Helvetica,"Hiragino Sans GB",微软雅黑,"Microsoft YaHei UI",SimSun,SimHei,arial,sans-serif; line-height:24px'>
先看下source基本过程，在 startAllComponents 方法中会调用对应source组件的 supervise 方法，在supervise 方法中会创建monitorRunnable线程，然后通过scheduleWithFixedDelay方法根据给定延迟定期运行monitorRunnable线程：</p>
<pre class="prettyprint linenums prettyprinted" style='margin-top:10px; margin-bottom:10px; border:1px solid rgb(225,225,232); font-size:13px; line-height:19px; overflow:auto; padding:0px; word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; background-color:rgb(247,247,249)'><ol class="linenums" style="margin:0px; padding:10px 10px 10px 40px!important; color:rgb(30,52,123)"><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="com" style="color:rgb(147,161,161); margin-top:0px">//supervise方法用于对传入组件生命周期的管理</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">  </span><span class="kwd" style="color:rgb(30,52,123)">public</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">synchronized</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">void</span><span class="pln" style="color:rgb(72,72,76)"> supervise</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">LifecycleAware</span><span class="pln" style="color:rgb(72,72,76)"> lifecycleAware</span><span class="pun" style="color:rgb(147,161,161)">,</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="typ" style="color:teal">SupervisorPolicy</span><span class="pln" style="color:rgb(72,72,76)"> policy</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">LifecycleState</span><span class="pln" style="color:rgb(72,72,76)"> desiredState</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">......</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="com" style="color:rgb(147,161,161)">//MonitorRunnable是一个线程，会定期检查组件的状态</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="typ" style="color:teal">MonitorRunnable</span><span class="pln" style="color:rgb(72,72,76)"> monitorRunnable </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">new</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">MonitorRunnable</span><span class="pun" style="color:rgb(147,161,161)">();</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    monitorRunnable</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">lifecycleAware </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> lifecycleAware</span><span class="pun" style="color:rgb(147,161,161)">;</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    monitorRunnable</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">supervisoree </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> process</span><span class="pun" style="color:rgb(147,161,161)">;</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    monitorRunnable</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">monitorService </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> monitorService</span><span class="pun" style="color:rgb(147,161,161)">;</span></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    supervisedProcesses</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">put</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">lifecycleAware</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> process</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="com" style="color:rgb(147,161,161)">/*</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="com" style="color:rgb(147,161,161); margin-top:0px">     * scheduleWithFixedDelay创建并执行一个在给定初始延迟后首次启用的定期操作，随后，</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="com" style="color:rgb(147,161,161); margin-top:0px">     * 在每一次执行终止和下一次执行开始之间都存在给定的延迟。</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="com" style="color:rgb(147,161,161); margin-top:0px">     */</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="typ" style="color:teal">ScheduledFuture</span><span class="pun" style="color:rgb(147,161,161)">&lt;?&gt;</span><span class="pln" style="color:rgb(72,72,76)"> future </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> monitorService</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">scheduleWithFixedDelay</span><span class="pun" style="color:rgb(147,161,161)">(</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        monitorRunnable</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="lit" style="color:rgb(25,95,145)">0</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="lit" style="color:rgb(25,95,145)">3</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">TimeUnit</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">SECONDS</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    monitorFutures</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">put</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">lifecycleAware</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> future</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">  </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li></ol></pre>
<p style='margin-top:10px; margin-bottom:10px; font-size:15px; font-family:Helvetica,"Hiragino Sans GB",微软雅黑,"Microsoft YaHei UI",SimSun,SimHei,arial,sans-serif; line-height:24px'>
在monitorRunnable线程中的run方法中会根据指定的生命周期中的一种状态关键字选择相应的操作。 <br>
定义生命周期中的四种状态的枚举类型如下所示：</p>
<pre class="prettyprint linenums prettyprinted" style='margin-top:10px; margin-bottom:10px; border:1px solid rgb(225,225,232); font-size:13px; line-height:19px; overflow:auto; padding:0px; word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; background-color:rgb(247,247,249)'><ol class="linenums" style="margin:0px; padding:10px 10px 10px 40px!important; color:rgb(30,52,123)"><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="com" style="color:rgb(147,161,161); margin-top:0px">//flume-ng-core\src\main\java\org\apache\flume\lifecycle\LifecycleState.java</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="kwd" style="color:rgb(30,52,123); margin-top:0px">public</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">enum</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">LifecycleState</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">  IDLE</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> START</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> STOP</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> ERROR</span><span class="pun" style="color:rgb(147,161,161)">;</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">  </span><span class="kwd" style="color:rgb(30,52,123)">public</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">static</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">final</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">LifecycleState</span><span class="pun" style="color:rgb(147,161,161)">[]</span><span class="pln" style="color:rgb(72,72,76)"> START_OR_ERROR </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">new</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">LifecycleState</span><span class="pun" style="color:rgb(147,161,161)">[]</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      START</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> ERROR </span><span class="pun" style="color:rgb(147,161,161)">};</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">  </span><span class="kwd" style="color:rgb(30,52,123)">public</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">static</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">final</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">LifecycleState</span><span class="pun" style="color:rgb(147,161,161)">[]</span><span class="pln" style="color:rgb(72,72,76)"> STOP_OR_ERROR </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">new</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">LifecycleState</span><span class="pun" style="color:rgb(147,161,161)">[]</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      STOP</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> ERROR </span><span class="pun" style="color:rgb(147,161,161)">};</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pun" style="color:rgb(147,161,161); margin-top:0px">}</span></code></li></ol></pre>
<p style='margin-top:10px; margin-bottom:10px; font-size:15px; font-family:Helvetica,"Hiragino Sans GB",微软雅黑,"Microsoft YaHei UI",SimSun,SimHei,arial,sans-serif; line-height:24px'>
现在是启动source，肯定就是传入的START，看看run方法：</p>
<pre class="prettyprint linenums prettyprinted" style='margin-top:10px; margin-bottom:10px; border:1px solid rgb(225,225,232); font-size:13px; line-height:19px; overflow:auto; padding:0px; word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; background-color:rgb(247,247,249)'><ol class="linenums" style="margin:0px; padding:10px 10px 10px 40px!important; color:rgb(30,52,123)"><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="kwd" style="color:rgb(30,52,123); margin-top:0px">public</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">void</span><span class="pln" style="color:rgb(72,72,76)"> run</span><span class="pun" style="color:rgb(147,161,161)">()</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      logger</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">debug</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="str" style="color:rgb(221,17,68)">"checking process:{} supervisoree:{}"</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> lifecycleAware</span><span class="pun" style="color:rgb(147,161,161)">,</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          supervisoree</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="kwd" style="color:rgb(30,52,123)">long</span><span class="pln" style="color:rgb(72,72,76)"> now </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">System</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">currentTimeMillis</span><span class="pun" style="color:rgb(147,161,161)">();</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">         </span><span class="pun" style="color:rgb(147,161,161)">......</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">            </span><span class="kwd" style="color:rgb(30,52,123)">switch</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">supervisoree</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">status</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">desiredState</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">              </span><span class="kwd" style="color:rgb(30,52,123)">case</span><span class="pln" style="color:rgb(72,72,76)"> START</span><span class="pun" style="color:rgb(147,161,161)">:</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">                </span><span class="kwd" style="color:rgb(30,52,123)">try</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">                  lifecycleAware</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">start</span><span class="pun" style="color:rgb(147,161,161)">();</span><span class="pln" style="color:rgb(72,72,76)">   </span><span class="com" style="color:rgb(147,161,161)">//传入状态为START，就会调用该方法</span></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">                </span><span class="pun" style="color:rgb(147,161,161)">}</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">catch</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">Throwable</span><span class="pln" style="color:rgb(72,72,76)"> e</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">                  </span><span class="pun" style="color:rgb(147,161,161)">......</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">                </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">                </span><span class="kwd" style="color:rgb(30,52,123)">break</span><span class="pun" style="color:rgb(147,161,161)">;</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">              </span><span class="kwd" style="color:rgb(30,52,123)">case</span><span class="pln" style="color:rgb(72,72,76)"> STOP</span><span class="pun" style="color:rgb(147,161,161)">:</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">                </span><span class="kwd" style="color:rgb(30,52,123)">try</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">                  lifecycleAware</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">stop</span><span class="pun" style="color:rgb(147,161,161)">();</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">                </span><span class="pun" style="color:rgb(147,161,161)">}</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">catch</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">Throwable</span><span class="pln" style="color:rgb(72,72,76)"> e</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">                  </span><span class="pun" style="color:rgb(147,161,161)">......</span></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">                </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">                </span><span class="kwd" style="color:rgb(30,52,123)">break</span><span class="pun" style="color:rgb(147,161,161)">;</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">              </span><span class="kwd" style="color:rgb(30,52,123)">default</span><span class="pun" style="color:rgb(147,161,161)">:</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">                logger</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">warn</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="str" style="color:rgb(221,17,68)">"I refuse to acknowledge {} as a desired state"</span><span class="pun" style="color:rgb(147,161,161)">,</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">                    supervisoree</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">status</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">desiredState</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">            </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">            </span><span class="kwd" style="color:rgb(30,52,123)">if</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(!</span><span class="pln" style="color:rgb(72,72,76)">supervisoree</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">policy</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">isValid</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">lifecycleAware</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> supervisoree</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">status</span><span class="pun" style="color:rgb(147,161,161)">))</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">              logger</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">error</span><span class="pun" style="color:rgb(147,161,161)">(</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">                  </span><span class="str" style="color:rgb(221,17,68)">"Policy {} of {} has been violated - supervisor should exit!"</span><span class="pun" style="color:rgb(147,161,161)">,</span></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">                  supervisoree</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">policy</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> lifecycleAware</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">            </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">catch</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">Throwable</span><span class="pln" style="color:rgb(72,72,76)"> t</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        logger</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">error</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="str" style="color:rgb(221,17,68)">"Unexpected error"</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> t</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      logger</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">debug</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="str" style="color:rgb(221,17,68)">"Status check complete"</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li></ol></pre>
<p style='margin-top:10px; margin-bottom:10px; font-size:15px; font-family:Helvetica,"Hiragino Sans GB",微软雅黑,"Microsoft YaHei UI",SimSun,SimHei,arial,sans-serif; line-height:24px'>
会调用lifecycleAware.start()方法。到这块后，想要继续往下深究，我们就需要了解一个Source中称为Source运行器的组件。</p>
<h2 id="wiz_toc_2" style='margin:20px 0px 10px; padding:0px; font-size:20px; position:relative; font-family:Helvetica,"Hiragino Sans GB",微软雅黑,"Microsoft YaHei UI",SimSun,SimHei,arial,sans-serif'>
SourceRunner运行器</h2>
<p style='margin-top:10px; margin-bottom:10px; font-size:15px; font-family:Helvetica,"Hiragino Sans GB",微软雅黑,"Microsoft YaHei UI",SimSun,SimHei,arial,sans-serif; line-height:24px'>
SourceRunner运行器主要用于控制一个Source如何被驱动，目前Source提供了两种机制： PollableSource（轮询拉取）和EventDrivenSource（事件驱动）。PollableSource相关类需要外部驱动来确定source中是否有消息可以使用，而EventDrivenSource相关类不需要外部驱动，自己实现了事件驱动机制。在SourceRunner.java文件中，会根据instanceof 运算符(该运算符是用来在运行时指出对象是否是特定类的一个实例)来确定具体的source实现了哪种机制，然后创建相应的对象。</p>
<pre class="prettyprint linenums prettyprinted" style='margin-top:10px; margin-bottom:10px; border:1px solid rgb(225,225,232); font-size:13px; line-height:19px; overflow:auto; padding:0px; word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; background-color:rgb(247,247,249)'><ol class="linenums" style="margin:0px; padding:10px 10px 10px 40px!important; color:rgb(30,52,123)"><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="com" style="color:rgb(147,161,161); margin-top:0px">//SourceRunner.java</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="kwd" style="color:rgb(30,52,123); margin-top:0px">if</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">source </span><span class="kwd" style="color:rgb(30,52,123)">instanceof</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">PollableSource</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    runner </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">new</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">PollableSourceRunner</span><span class="pun" style="color:rgb(147,161,161)">();</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="pun" style="color:rgb(147,161,161)">((</span><span class="typ" style="color:teal">PollableSourceRunner</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> runner</span><span class="pun" style="color:rgb(147,161,161)">).</span><span class="pln" style="color:rgb(72,72,76)">setSource</span><span class="pun" style="color:rgb(147,161,161)">((</span><span class="typ" style="color:teal">PollableSource</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> source</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pun" style="color:rgb(147,161,161); margin-top:0px">}</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">else</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">if</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">source </span><span class="kwd" style="color:rgb(30,52,123)">instanceof</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">EventDrivenSource</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    runner </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">new</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">EventDrivenSourceRunner</span><span class="pun" style="color:rgb(147,161,161)">();</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="pun" style="color:rgb(147,161,161)">((</span><span class="typ" style="color:teal">EventDrivenSourceRunner</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> runner</span><span class="pun" style="color:rgb(147,161,161)">).</span><span class="pln" style="color:rgb(72,72,76)">setSource</span><span class="pun" style="color:rgb(147,161,161)">((</span><span class="typ" style="color:teal">EventDrivenSource</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> source</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pun" style="color:rgb(147,161,161); margin-top:0px">}</span></code></li></ol></pre>
<p style='margin-top:10px; margin-bottom:10px; font-size:15px; font-family:Helvetica,"Hiragino Sans GB",微软雅黑,"Microsoft YaHei UI",SimSun,SimHei,arial,sans-serif; line-height:24px'>
如代码所示会创建具体运行器的实例对象，至此也许有人会问，那这是在那块调用的呢？仔细查看代码从main方法开始，就可以发现在加载配置文件（在main方法中加载配置文件时已经根据配置文件创建了对应SourceRunner的实例对象，configurationProvider.getConfiguration()这步时）时就已经实例化了该对象。那么刚提到的两种驱动方式，都分别对应哪些具体的Source实现呢？看下图可知： <br>
</p>
<div style="text-align:center"><img src="file:///C:/Users/bjtianye1/Documents/My%20Knowledge/temp/30b802ec-0106-4edc-ba31-0400118055f2/128/index_files/6543b8ec-ca42-42b4-80d8-bfcdcde965ed.png" alt="" style="border:0px; max-width:100%; margin:2px 0px; height:auto!important"> <img src="https://img-blog.csdn.net/20170117164917840?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdHlfbGF1cmVs/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></div>
flume-1.7版本中只有TaildirSource是PollableSource方式的。了解了Source运行器，接下来就可以看看TaildirSource的启动部分了。
<p></p>
<h2 id="wiz_toc_3" style='margin:20px 0px 10px; padding:0px; font-size:20px; position:relative; font-family:Helvetica,"Hiragino Sans GB",微软雅黑,"Microsoft YaHei UI",SimSun,SimHei,arial,sans-serif'>
TaildirSource启动</h2>
<p style='margin-top:10px; margin-bottom:10px; font-size:15px; font-family:Helvetica,"Hiragino Sans GB",微软雅黑,"Microsoft YaHei UI",SimSun,SimHei,arial,sans-serif; line-height:24px'>
接上上步lifecycleAware.start()调用start方法，代码中那么多的start方法，那究竟接下来调用的是哪个start呢？看了SourceRunner运行器部分相信大家应该想到了，调用的肯定就是SourceRunner的start方法啦。eclipse查看目前Flume就存在EventDrivenSourceRunner和PollableSourceRunner两种方式，如下图： <br>
</p>
<div style="text-align:center"><img src="file:///C:/Users/bjtianye1/Documents/My%20Knowledge/temp/30b802ec-0106-4edc-ba31-0400118055f2/128/index_files/756e13cf-7d51-46b5-a14b-a1939231c795.png" alt="" style="border:0px; max-width:100%; margin:2px 0px; height:auto!important"> <img src="https://img-blog.csdn.net/20170117164936910?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdHlfbGF1cmVs/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></div>
进入PollableSourceRunner的start方法:
<p></p>
<pre class="prettyprint linenums prettyprinted" style='margin-top:10px; margin-bottom:10px; border:1px solid rgb(225,225,232); font-size:13px; line-height:19px; overflow:auto; padding:0px; word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; background-color:rgb(247,247,249)'><ol class="linenums" style="margin:0px; padding:10px 10px 10px 40px!important; color:rgb(30,52,123)"><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="lit" style="color:rgb(25,95,145); margin-top:0px">@Override</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">  </span><span class="kwd" style="color:rgb(30,52,123)">public</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">void</span><span class="pln" style="color:rgb(72,72,76)"> start</span><span class="pun" style="color:rgb(147,161,161)">()</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="typ" style="color:teal">PollableSource</span><span class="pln" style="color:rgb(72,72,76)"> source </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">PollableSource</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> getSource</span><span class="pun" style="color:rgb(147,161,161)">();</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="typ" style="color:teal">ChannelProcessor</span><span class="pln" style="color:rgb(72,72,76)"> cp </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> source</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getChannelProcessor</span><span class="pun" style="color:rgb(147,161,161)">();</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    cp</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">initialize</span><span class="pun" style="color:rgb(147,161,161)">();</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    source</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">start</span><span class="pun" style="color:rgb(147,161,161)">();</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    runner </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">new</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">PollingRunner</span><span class="pun" style="color:rgb(147,161,161)">();</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    runner</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">source </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> source</span><span class="pun" style="color:rgb(147,161,161)">;</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    runner</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">counterGroup </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> counterGroup</span><span class="pun" style="color:rgb(147,161,161)">;</span></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    runner</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">shouldStop </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> shouldStop</span><span class="pun" style="color:rgb(147,161,161)">;</span></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    runnerThread </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">new</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">Thread</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">runner</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    runnerThread</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">setName</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">getClass</span><span class="pun" style="color:rgb(147,161,161)">().</span><span class="pln" style="color:rgb(72,72,76)">getSimpleName</span><span class="pun" style="color:rgb(147,161,161)">()</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">+</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="str" style="color:rgb(221,17,68)">"-"</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">+</span><span class="pln" style="color:rgb(72,72,76)"> </span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        source</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getClass</span><span class="pun" style="color:rgb(147,161,161)">().</span><span class="pln" style="color:rgb(72,72,76)">getSimpleName</span><span class="pun" style="color:rgb(147,161,161)">()</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">+</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="str" style="color:rgb(221,17,68)">"-"</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">+</span><span class="pln" style="color:rgb(72,72,76)"> source</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getName</span><span class="pun" style="color:rgb(147,161,161)">());</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    runnerThread</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">start</span><span class="pun" style="color:rgb(147,161,161)">();</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    lifecycleState </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">LifecycleState</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">START</span><span class="pun" style="color:rgb(147,161,161)">;</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">  </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li></ol></pre>
<p style='margin-top:10px; margin-bottom:10px; font-size:15px; font-family:Helvetica,"Hiragino Sans GB",微软雅黑,"Microsoft YaHei UI",SimSun,SimHei,arial,sans-serif; line-height:24px'>
start方法中调会创建一个PollingRunner的线程并启动该线程，线程的run方法中才会最终调用具体Source的process方法（如 TaildirSource）:</p>
<pre class="prettyprint linenums prettyprinted" style='margin-top:10px; margin-bottom:10px; border:1px solid rgb(225,225,232); font-size:13px; line-height:19px; overflow:auto; padding:0px; word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; background-color:rgb(247,247,249)'><ol class="linenums" style="margin:0px; padding:10px 10px 10px 40px!important; color:rgb(30,52,123)"><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="lit" style="color:rgb(25,95,145); margin-top:0px">@Override</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">  </span><span class="kwd" style="color:rgb(30,52,123)">public</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">Status</span><span class="pln" style="color:rgb(72,72,76)"> process</span><span class="pun" style="color:rgb(147,161,161)">()</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="typ" style="color:teal">Status</span><span class="pln" style="color:rgb(72,72,76)"> status </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">Status</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">READY</span><span class="pun" style="color:rgb(147,161,161)">;</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="kwd" style="color:rgb(30,52,123)">try</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      existingInodes</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">clear</span><span class="pun" style="color:rgb(147,161,161)">();</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      existingInodes</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">addAll</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">reader</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">updateTailFiles</span><span class="pun" style="color:rgb(147,161,161)">());</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="kwd" style="color:rgb(30,52,123)">for</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="kwd" style="color:rgb(30,52,123)">long</span><span class="pln" style="color:rgb(72,72,76)"> inode </span><span class="pun" style="color:rgb(147,161,161)">:</span><span class="pln" style="color:rgb(72,72,76)"> existingInodes</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="typ" style="color:teal">TailFile</span><span class="pln" style="color:rgb(72,72,76)"> tf </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> reader</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getTailFiles</span><span class="pun" style="color:rgb(147,161,161)">().</span><span class="kwd" style="color:rgb(30,52,123)">get</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">inode</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="kwd" style="color:rgb(30,52,123)">if</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">tf</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">needTail</span><span class="pun" style="color:rgb(147,161,161)">())</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          tailFileProcess</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">tf</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">true</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      closeTailFiles</span><span class="pun" style="color:rgb(147,161,161)">();</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="kwd" style="color:rgb(30,52,123)">try</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="typ" style="color:teal">TimeUnit</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">MILLISECONDS</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">sleep</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">retryInterval</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">catch</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">InterruptedException</span><span class="pln" style="color:rgb(72,72,76)"> e</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        logger</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">info</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="str" style="color:rgb(221,17,68)">"Interrupted while sleeping"</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="pun" style="color:rgb(147,161,161)">}</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">catch</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">Throwable</span><span class="pln" style="color:rgb(72,72,76)"> t</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      logger</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">error</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="str" style="color:rgb(221,17,68)">"Unable to tail files"</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> t</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      status </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">Status</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">BACKOFF</span><span class="pun" style="color:rgb(147,161,161)">;</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="kwd" style="color:rgb(30,52,123)">return</span><span class="pln" style="color:rgb(72,72,76)"> status</span><span class="pun" style="color:rgb(147,161,161)">;</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">  </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li></ol></pre>
<p style='margin-top:10px; margin-bottom:10px; font-size:15px; font-family:Helvetica,"Hiragino Sans GB",微软雅黑,"Microsoft YaHei UI",SimSun,SimHei,arial,sans-serif; line-height:24px'>
process方法是Source中最重要的一个方式，其中实现了事件写入Channel中的事务过程，具体的读写日志、位置记录文件读写等都实现在tailFileProcess方法中：</p>
<pre class="prettyprint linenums prettyprinted" style='margin-top:10px; margin-bottom:10px; border:1px solid rgb(225,225,232); font-size:13px; line-height:19px; overflow:auto; padding:0px; word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; background-color:rgb(247,247,249)'><ol class="linenums" style="margin:0px; padding:10px 10px 10px 40px!important; color:rgb(30,52,123)"><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="com" style="color:rgb(147,161,161); margin-top:0px">//TaildirSource.java文件中的tailFileProcess方法中会将event写入channel</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="kwd" style="color:rgb(30,52,123); margin-top:0px">private</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">void</span><span class="pln" style="color:rgb(72,72,76)"> tailFileProcess</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">TailFile</span><span class="pln" style="color:rgb(72,72,76)"> tf</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">boolean</span><span class="pln" style="color:rgb(72,72,76)"> backoffWithoutNL</span><span class="pun" style="color:rgb(147,161,161)">)</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="kwd" style="color:rgb(30,52,123)">throws</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">IOException</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">InterruptedException</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="kwd" style="color:rgb(30,52,123)">while</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="kwd" style="color:rgb(30,52,123)">true</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      reader</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">setCurrentFile</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">tf</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="typ" style="color:teal">List</span><span class="pun" style="color:rgb(147,161,161)">&lt;</span><span class="typ" style="color:teal">Event</span><span class="pun" style="color:rgb(147,161,161)">&gt;</span><span class="pln" style="color:rgb(72,72,76)"> events </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> reader</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">readEvents</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">batchSize</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> backoffWithoutNL</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="kwd" style="color:rgb(30,52,123)">if</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">events</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">isEmpty</span><span class="pun" style="color:rgb(147,161,161)">())</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="kwd" style="color:rgb(30,52,123)">break</span><span class="pun" style="color:rgb(147,161,161)">;</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      sourceCounter</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">addToEventReceivedCount</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">events</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">size</span><span class="pun" style="color:rgb(147,161,161)">());</span></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      sourceCounter</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">incrementAppendBatchReceivedCount</span><span class="pun" style="color:rgb(147,161,161)">();</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="kwd" style="color:rgb(30,52,123)">try</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">                        </span><span class="com" style="color:rgb(147,161,161)">//processEventBatch方法尝试将event批量放入配置的channel中</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        getChannelProcessor</span><span class="pun" style="color:rgb(147,161,161)">().</span><span class="pln" style="color:rgb(72,72,76)">processEventBatch</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">events</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        reader</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">commit</span><span class="pun" style="color:rgb(147,161,161)">();</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">catch</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">ChannelException</span><span class="pln" style="color:rgb(72,72,76)"> ex</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        logger</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">warn</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="str" style="color:rgb(221,17,68)">"The channel is full or unexpected failure. "</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">+</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">            </span><span class="str" style="color:rgb(221,17,68)">"The source will try again after "</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">+</span><span class="pln" style="color:rgb(72,72,76)"> retryInterval </span><span class="pun" style="color:rgb(147,161,161)">+</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="str" style="color:rgb(221,17,68)">" ms"</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="typ" style="color:teal">TimeUnit</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">MILLISECONDS</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">sleep</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">retryInterval</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        retryInterval </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> retryInterval </span><span class="pun" style="color:rgb(147,161,161)">&lt;&lt;</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="lit" style="color:rgb(25,95,145)">1</span><span class="pun" style="color:rgb(147,161,161)">;</span></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        retryInterval </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">Math</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">min</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">retryInterval</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> maxRetryInterval</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="kwd" style="color:rgb(30,52,123)">continue</span><span class="pun" style="color:rgb(147,161,161)">;</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      retryInterval </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="lit" style="color:rgb(25,95,145)">1000</span><span class="pun" style="color:rgb(147,161,161)">;</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      sourceCounter</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">addToEventAcceptedCount</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">events</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">size</span><span class="pun" style="color:rgb(147,161,161)">());</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      sourceCounter</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">incrementAppendBatchAcceptedCount</span><span class="pun" style="color:rgb(147,161,161)">();</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="kwd" style="color:rgb(30,52,123)">if</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">events</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">size</span><span class="pun" style="color:rgb(147,161,161)">()</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">&lt;</span><span class="pln" style="color:rgb(72,72,76)"> batchSize</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="kwd" style="color:rgb(30,52,123)">break</span><span class="pun" style="color:rgb(147,161,161)">;</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">  </span><span class="pun" style="color:rgb(147,161,161)">}</span><span class="pln" style="color:rgb(72,72,76)">  </span></code></li></ol></pre>
<p style='margin-top:10px; margin-bottom:10px; font-size:15px; font-family:Helvetica,"Hiragino Sans GB",微软雅黑,"Microsoft YaHei UI",SimSun,SimHei,arial,sans-serif; line-height:24px'>
在发送到channel的过程中我们也发现都会有事务的创建(getTransaction())、开始(tx.begin())、提交(tx.commit())、回滚(tx.rollback())、关闭(tx.close())等操作，这是必须的。在sink中这些操作基本都是在process方法中直接显式调用，而在source端则封装在processEvent和processEventBatch（批量写入channel）方法中。 <br>
processEventBatch方法的代码在ChannelProcessor.java文件中定义，其实现最终将event写入channel中，会创建事务保证数据完整性，也就是flume中特有的事务机制，具体代码如下：</p>
<pre class="prettyprint linenums prettyprinted" style='margin-top:10px; margin-bottom:10px; border:1px solid rgb(225,225,232); font-size:13px; line-height:19px; overflow:auto; padding:0px; word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; background-color:rgb(247,247,249)'><ol class="linenums" style="margin:0px; padding:10px 10px 10px 40px!important; color:rgb(30,52,123)"><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">  </span><span class="kwd" style="color:rgb(30,52,123)">public</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">void</span><span class="pln" style="color:rgb(72,72,76)"> processEventBatch</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">List</span><span class="pun" style="color:rgb(147,161,161)">&lt;</span><span class="typ" style="color:teal">Event</span><span class="pun" style="color:rgb(147,161,161)">&gt;</span><span class="pln" style="color:rgb(72,72,76)"> events</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="typ" style="color:teal">Preconditions</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">checkNotNull</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">events</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="str" style="color:rgb(221,17,68)">"Event list must not be null"</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    events </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> interceptorChain</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">intercept</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">events</span><span class="pun" style="color:rgb(147,161,161)">);</span><span class="pln" style="color:rgb(72,72,76)">  </span><span class="com" style="color:rgb(147,161,161)">//拦截器处理，根据具体拦截器配置对event添加headers</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="typ" style="color:teal">Map</span><span class="pun" style="color:rgb(147,161,161)">&lt;</span><span class="typ" style="color:teal">Channel</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">List</span><span class="pun" style="color:rgb(147,161,161)">&lt;</span><span class="typ" style="color:teal">Event</span><span class="pun" style="color:rgb(147,161,161)">&gt;&gt;</span><span class="pln" style="color:rgb(72,72,76)"> reqChannelQueue </span><span class="pun" style="color:rgb(147,161,161)">=</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="kwd" style="color:rgb(30,52,123)">new</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">LinkedHashMap</span><span class="pun" style="color:rgb(147,161,161)">&lt;</span><span class="typ" style="color:teal">Channel</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">List</span><span class="pun" style="color:rgb(147,161,161)">&lt;</span><span class="typ" style="color:teal">Event</span><span class="pun" style="color:rgb(147,161,161)">&gt;&gt;();</span><span class="pln" style="color:rgb(72,72,76)">   </span><span class="com" style="color:rgb(147,161,161)">//需要的Channel及要发送至该Channel的event列表的LinkedHashMap对象</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="typ" style="color:teal">Map</span><span class="pun" style="color:rgb(147,161,161)">&lt;</span><span class="typ" style="color:teal">Channel</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">List</span><span class="pun" style="color:rgb(147,161,161)">&lt;</span><span class="typ" style="color:teal">Event</span><span class="pun" style="color:rgb(147,161,161)">&gt;&gt;</span><span class="pln" style="color:rgb(72,72,76)"> optChannelQueue </span><span class="pun" style="color:rgb(147,161,161)">=</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="kwd" style="color:rgb(30,52,123)">new</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">LinkedHashMap</span><span class="pun" style="color:rgb(147,161,161)">&lt;</span><span class="typ" style="color:teal">Channel</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">List</span><span class="pun" style="color:rgb(147,161,161)">&lt;</span><span class="typ" style="color:teal">Event</span><span class="pun" style="color:rgb(147,161,161)">&gt;&gt;();</span><span class="pln" style="color:rgb(72,72,76)">   </span><span class="com" style="color:rgb(147,161,161)">//可选的Channel及要发送至该Channel的event列表</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="kwd" style="color:rgb(30,52,123)">for</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">Event</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">event</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">:</span><span class="pln" style="color:rgb(72,72,76)"> events</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="typ" style="color:teal">List</span><span class="pun" style="color:rgb(147,161,161)">&lt;</span><span class="typ" style="color:teal">Channel</span><span class="pun" style="color:rgb(147,161,161)">&gt;</span><span class="pln" style="color:rgb(72,72,76)"> reqChannels </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> selector</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getRequiredChannels</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="kwd" style="color:rgb(30,52,123)">event</span><span class="pun" style="color:rgb(147,161,161)">);</span><span class="pln" style="color:rgb(72,72,76)">  </span><span class="com" style="color:rgb(147,161,161)">//获取需要的Channel列表</span></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="kwd" style="color:rgb(30,52,123)">for</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">Channel</span><span class="pln" style="color:rgb(72,72,76)"> ch </span><span class="pun" style="color:rgb(147,161,161)">:</span><span class="pln" style="color:rgb(72,72,76)"> reqChannels</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="typ" style="color:teal">List</span><span class="pun" style="color:rgb(147,161,161)">&lt;</span><span class="typ" style="color:teal">Event</span><span class="pun" style="color:rgb(147,161,161)">&gt;</span><span class="pln" style="color:rgb(72,72,76)"> eventQueue </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> reqChannelQueue</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="kwd" style="color:rgb(30,52,123)">get</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">ch</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="kwd" style="color:rgb(30,52,123)">if</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">eventQueue </span><span class="pun" style="color:rgb(147,161,161)">==</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">null</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          eventQueue </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">new</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">ArrayList</span><span class="pun" style="color:rgb(147,161,161)">&lt;</span><span class="typ" style="color:teal">Event</span><span class="pun" style="color:rgb(147,161,161)">&gt;();</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          reqChannelQueue</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">put</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">ch</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> eventQueue</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        eventQueue</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">add</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="kwd" style="color:rgb(30,52,123)">event</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="typ" style="color:teal">List</span><span class="pun" style="color:rgb(147,161,161)">&lt;</span><span class="typ" style="color:teal">Channel</span><span class="pun" style="color:rgb(147,161,161)">&gt;</span><span class="pln" style="color:rgb(72,72,76)"> optChannels </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> selector</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getOptionalChannels</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="kwd" style="color:rgb(30,52,123)">event</span><span class="pun" style="color:rgb(147,161,161)">);</span><span class="pln" style="color:rgb(72,72,76)">  </span><span class="com" style="color:rgb(147,161,161)">//获取可选的Channel列表</span></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="kwd" style="color:rgb(30,52,123)">for</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">Channel</span><span class="pln" style="color:rgb(72,72,76)"> ch </span><span class="pun" style="color:rgb(147,161,161)">:</span><span class="pln" style="color:rgb(72,72,76)"> optChannels</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="typ" style="color:teal">List</span><span class="pun" style="color:rgb(147,161,161)">&lt;</span><span class="typ" style="color:teal">Event</span><span class="pun" style="color:rgb(147,161,161)">&gt;</span><span class="pln" style="color:rgb(72,72,76)"> eventQueue </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> optChannelQueue</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="kwd" style="color:rgb(30,52,123)">get</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">ch</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="kwd" style="color:rgb(30,52,123)">if</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">eventQueue </span><span class="pun" style="color:rgb(147,161,161)">==</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">null</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          eventQueue </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">new</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">ArrayList</span><span class="pun" style="color:rgb(147,161,161)">&lt;</span><span class="typ" style="color:teal">Event</span><span class="pun" style="color:rgb(147,161,161)">&gt;();</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          optChannelQueue</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">put</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">ch</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> eventQueue</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        eventQueue</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">add</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="kwd" style="color:rgb(30,52,123)">event</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="com" style="color:rgb(147,161,161)">// Process required channels</span></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="kwd" style="color:rgb(30,52,123)">for</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">Channel</span><span class="pln" style="color:rgb(72,72,76)"> reqChannel </span><span class="pun" style="color:rgb(147,161,161)">:</span><span class="pln" style="color:rgb(72,72,76)"> reqChannelQueue</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">keySet</span><span class="pun" style="color:rgb(147,161,161)">())</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="typ" style="color:teal">Transaction</span><span class="pln" style="color:rgb(72,72,76)"> tx </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> reqChannel</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">getTransaction</span><span class="pun" style="color:rgb(147,161,161)">();</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="typ" style="color:teal">Preconditions</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">checkNotNull</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">tx</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="str" style="color:rgb(221,17,68)">"Transaction object must not be null"</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="kwd" style="color:rgb(30,52,123)">try</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        tx</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="kwd" style="color:rgb(30,52,123)">begin</span><span class="pun" style="color:rgb(147,161,161)">();</span><span class="pln" style="color:rgb(72,72,76)">    </span><span class="com" style="color:rgb(147,161,161)">//开始事务</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="typ" style="color:teal">List</span><span class="pun" style="color:rgb(147,161,161)">&lt;</span><span class="typ" style="color:teal">Event</span><span class="pun" style="color:rgb(147,161,161)">&gt;</span><span class="pln" style="color:rgb(72,72,76)"> batch </span><span class="pun" style="color:rgb(147,161,161)">=</span><span class="pln" style="color:rgb(72,72,76)"> reqChannelQueue</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="kwd" style="color:rgb(30,52,123)">get</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">reqChannel</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="kwd" style="color:rgb(30,52,123)">for</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">Event</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">event</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">:</span><span class="pln" style="color:rgb(72,72,76)"> batch</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span><span class="pln" style="color:rgb(72,72,76)">   </span><span class="com" style="color:rgb(147,161,161)">//遍历event依次放入Channel中</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          reqChannel</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">put</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="kwd" style="color:rgb(30,52,123)">event</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        tx</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">commit</span><span class="pun" style="color:rgb(147,161,161)">();</span><span class="pln" style="color:rgb(72,72,76)">    </span><span class="com" style="color:rgb(147,161,161)">//提交事务</span></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">catch</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">Throwable</span><span class="pln" style="color:rgb(72,72,76)"> t</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        tx</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">rollback</span><span class="pun" style="color:rgb(147,161,161)">();</span><span class="pln" style="color:rgb(72,72,76)">    </span><span class="com" style="color:rgb(147,161,161)">//发生异常，回滚事务</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="kwd" style="color:rgb(30,52,123)">if</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">t </span><span class="kwd" style="color:rgb(30,52,123)">instanceof</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">Error</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          LOG</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">error</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="str" style="color:rgb(221,17,68)">"Error while writing to required channel: "</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">+</span><span class="pln" style="color:rgb(72,72,76)"> reqChannel</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> t</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          </span><span class="kwd" style="color:rgb(30,52,123)">throw</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">Error</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> t</span><span class="pun" style="color:rgb(147,161,161)">;</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="pun" style="color:rgb(147,161,161)">}</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">else</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">if</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">t </span><span class="kwd" style="color:rgb(30,52,123)">instanceof</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">ChannelException</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          </span><span class="kwd" style="color:rgb(30,52,123)">throw</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="typ" style="color:teal">ChannelException</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> t</span><span class="pun" style="color:rgb(147,161,161)">;</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="pun" style="color:rgb(147,161,161)">}</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">else</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          </span><span class="kwd" style="color:rgb(30,52,123)">throw</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">new</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="typ" style="color:teal">ChannelException</span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="str" style="color:rgb(221,17,68)">"Unable to put batch on required "</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">+</span></code></li><li class="L9" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">              </span><span class="str" style="color:rgb(221,17,68)">"channel: "</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">+</span><span class="pln" style="color:rgb(72,72,76)"> reqChannel</span><span class="pun" style="color:rgb(147,161,161)">,</span><span class="pln" style="color:rgb(72,72,76)"> t</span><span class="pun" style="color:rgb(147,161,161)">);</span></code></li><li class="L0" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L1" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">finally</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L2" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="kwd" style="color:rgb(30,52,123)">if</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">(</span><span class="pln" style="color:rgb(72,72,76)">tx </span><span class="pun" style="color:rgb(147,161,161)">!=</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="kwd" style="color:rgb(30,52,123)">null</span><span class="pun" style="color:rgb(147,161,161)">)</span><span class="pln" style="color:rgb(72,72,76)"> </span><span class="pun" style="color:rgb(147,161,161)">{</span></code></li><li class="L3" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">          tx</span><span class="pun" style="color:rgb(147,161,161)">.</span><span class="pln" style="color:rgb(72,72,76)">close</span><span class="pun" style="color:rgb(147,161,161)">();</span></code></li><li class="L4" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">        </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L5" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">      </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L6" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">    </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li><li class="L7" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px"> </span><span class="pun" style="color:rgb(147,161,161)">......</span></code></li><li class="L8" style="margin:0px; color:rgb(190,190,197); line-height:18px; padding-left:12px!important; list-style-type:decimal!important"><code style='margin:0px; padding:0px; color:rgb(102,102,102); word-wrap:break-word; font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace; max-width:100%; border:none; background:transparent'><span class="pln" style="color:rgb(72,72,76); margin-top:0px">  </span><span class="pun" style="color:rgb(147,161,161)">}</span></code></li></ol></pre>
<p style='margin-top:10px; margin-bottom:10px; font-size:15px; font-family:Helvetica,"Hiragino Sans GB",微软雅黑,"Microsoft YaHei UI",SimSun,SimHei,arial,sans-serif; line-height:24px'>
至此，TaildirSource启动的一个具体过程就结束了，至于taildirsource具体的读写文件过程这里就不说了，想了解的可以阅读相关代码实现。</p>
<br>
            </div>
                </div>