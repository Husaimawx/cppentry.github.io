---
layout:     post
title:      Hbase集群环境搭建
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <h2 style="font-size:20px;font-weight:normal;line-height:1.5;color:rgb(0,0,0);border-bottom-color:rgb(46,61,84);font-family:Arial, sans-serif;background-color:rgb(255,255,255);"><strong>Hbase简介</strong></h2><p style="margin-left:30px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial, sans-serif;font-size:14px;">hbase和hadoop一样也分为单机版、伪分布式版和完全分布式集群版本，这篇文章介绍如何搭建完全分布式集群环境。</p><p style="margin-left:30px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial, sans-serif;font-size:14px;">hbase依赖于hadoop环境，搭建hbase之前首先需要搭建好hadoop的完全集群环境和zookeeper集群环境。搭建步骤见另一篇文章。</p><h2 style="font-size:20px;font-weight:normal;line-height:1.5;color:rgb(0,0,0);border-bottom-color:rgb(46,61,84);font-family:Arial, sans-serif;background-color:rgb(255,255,255);"><strong>第一步：Hbase下载</strong></h2><p style="margin-left:30px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial, sans-serif;font-size:14px;"><span style="color:rgb(0,0,0);">下载地址：<a href="http://mirrors.shuosc.org/apache/hbase/stable/hbase-1.2.6-bin.tar.gz" rel="nofollow" class="external-link" style="color:rgb(50,108,166);">http://mirrors.shuosc.org/apache/hbase/stable/hbase-1.2.6-bin.tar.gz</a></span></p><p style="margin-left:30px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial, sans-serif;font-size:14px;">下载下来压缩包为hbase-1.2.6-bin.tar.gz。请使用tar -xzvf hbase-1.2.6-bin.tar.gz解压至/opt目录</p><h2 style="font-size:20px;font-weight:normal;line-height:1.5;color:rgb(0,0,0);border-bottom-color:rgb(46,61,84);font-family:Arial, sans-serif;background-color:rgb(255,255,255);"><strong>第二步：安装前准备</strong></h2><ol class="linenums" style="margin-left:35px;color:rgb(51,51,51);font-family:Arial, sans-serif;"><li class="L0" style="font-size:14px;"><span style="color:rgb(0,0,0);"><code class="language-bash" style="font-family:monospace;"><span class="com" style="background-color:rgb(255,255,255);">修改每台服务器主机名</span></code></span><br><code class="language-bash" style="background-color:rgb(255,255,255);font-family:monospace;"><span class="pln" style="color:rgb(0,0,0);">vim </span><span class="pun" style="color:rgb(102,102,0);">/</span><span class="pln" style="color:rgb(0,0,0);">etc</span><span class="pun" style="color:rgb(102,102,0);">/</span><span class="pln" style="color:rgb(0,0,0);">hostname</span></code><br><code class="language-bash" style="background-color:rgb(255,255,255);font-family:monospace;"><span class="pln" style="color:rgb(0,0,0);"><img class="confluence-embedded-image confluence-external-resource" src="https://confluence.evergrande.com/download/attachments/4326586/image2017-11-29%2016%3A49%3A5.png?version=1&amp;modificationDate=1511945351000&amp;api=v2" style="border:0px;" alt=""><img src="https://img-blog.csdn.net/20180503093247774?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1NDWV9TaGFkb3c=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></span></code></li><li class="L0" style="font-size:14px;background-color:rgb(255,255,255);"><code class="language-bash" style="font-family:monospace;"><span class="pln" style="color:rgb(0,0,0);">修改防火墙</span></code><br>systemctl stop firewalld.service          #停止firewall<br>#systemctl disable firewalld.service     #禁止firewall开机启动<code class="language-bash" style="font-family:monospace;"><span class="pln" style="color:rgb(0,0,0);"><br></span></code></li><li class="L0" style="font-size:14px;background-color:rgb(255,255,255);"><code class="language-bash" style="font-family:monospace;"><span class="pln" style="color:rgb(0,0,0);">设置免密码登录（每台服务器必须重复以下步骤）</span></code><br><span style="color:rgb(0,0,0);"><strong>A.生成秘钥：</strong><br></span><code class="language-bash" style="font-family:monospace;"><span class="pln" style="color:rgb(0,0,0);">ssh-keygen -t dsa -P '' -f ~/.ssh/id_dsa</span></code><br><code class="language-bash" style="font-family:monospace;"><span class="pln" style="color:rgb(0,0,0);">cat ~/.ssh/id_dsa.pub &gt;&gt; ~/.ssh/authorized_keys</span></code><br><strong><span style="color:rgb(0,0,0);">B.将authorized_keys文件拷贝到另外两台服务器</span></strong><br><span style="color:rgb(0,0,0);">scp ~/.ssh/authorized_keys node2:~/.ssh/</span><span style="color:rgb(0,0,0);"> </span><br><span style="color:rgb(0,0,0);">scp ~/.ssh/authorized_keys node3:~/.ssh/</span><code class="language-bash" style="font-family:monospace;"><span class="pln" style="color:rgb(0,0,0);"><br></span></code></li><li class="L0" style="font-size:14px;background-color:rgb(255,255,255);"><span style="color:rgb(0,0,0);">切记保持三台服务器的~/.ssh/known_hosts中的内容一致</span></li><li class="L0" style="background-color:rgb(255,255,255);"><span style="font-size:14px;color:rgb(0,0,0);">配置环境变量</span><br><span style="font-size:14px;color:rgb(0,0,0);">vim /etc/profile</span><p style="color:rgb(51,51,51);background-color:transparent;"><span style="font-size:12px;">export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.102-4.b14.el7.x86_64<br>export HBASE_HOME=/opt/hbase-1.2.6<br>export PATH=$PATH:$JAVA_HOME/bin:$HBASE_HOME/bin</span></p><p style="font-size:14px;color:rgb(51,51,51);background-color:transparent;"><span style="color:rgb(0,0,0);">source /etc/profile</span></p></li></ol><div style="color:rgb(51,51,51);font-family:Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><h2 class="L0" style="font-size:20px;font-weight:normal;line-height:1.5;color:rgb(0,0,0);border-bottom-color:rgb(46,61,84);"><strong>第三步：安装配置</strong></h2><p style="margin-left:30px;color:rgb(51,51,51);background-color:transparent;"><span style="color:rgb(0,0,0);">需要修改 /opt/hbase-1.2.6/conf 中的3个配置文件（更多设置项可点击查看官方说明）：</span></p><div>       1、<span style="color:#326ca6;">regionservers</span>（删除localhost）</div><div>          <img src="https://img-blog.csdn.net/20180427151818833?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1NDWV9TaGFkb3c=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></div><div>       2、<a href="https://confluence.evergrande.com/download/attachments/4326660/hbase-env.sh?version=1&amp;modificationDate=1512123130000&amp;api=v2" rel="nofollow" style="color:rgb(50,108,166);">h</a><span style="color:#326ca6;">base-env.sh</span>（图一加注释、图二加环境变量）</div><div>         <img class="confluence-embedded-image" src="https://confluence.evergrande.com/download/attachments/4326660/image2018-3-26%2014%3A38%3A44.png?version=1&amp;modificationDate=1522046347000&amp;api=v2" style="border:0px;" alt=""><img src="https://img-blog.csdn.net/20180427151925265?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1NDWV9TaGFkb3c=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></div><div>         <img class="confluence-embedded-image" src="https://confluence.evergrande.com/download/attachments/4326660/image2018-3-26%2014%3A39%3A23.png?version=1&amp;modificationDate=1522046386000&amp;api=v2" style="border:0px;" alt=""><img src="https://img-blog.csdn.net/20180427151946368?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1NDWV9TaGFkb3c=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></div><div>       3、<span style="color:#326ca6;">hbase-site.xml</span>（注意箭头出处为hadoop节点）</div><div>         <img class="confluence-embedded-image" src="https://confluence.evergrande.com/download/attachments/4326660/image2018-3-26%2014%3A41%3A21.png?version=1&amp;modificationDate=1522046504000&amp;api=v2" style="border:0px;" alt=""><pre><code class="language-html">&lt;configuration&gt;
    &lt;property&gt;
        &lt;name&gt;hbase.rootdir&lt;/name&gt;
        &lt;value&gt;hdfs://hadoop1:9000/hbase&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;hbase.cluster.distributed&lt;/name&gt;
        &lt;value&gt;true&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt;p.
        &lt;value&gt;10.100.160.132,10.100.160.133,10.100.160.134&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;hbase.master&lt;/name&gt;
        &lt;value&gt;hdfs://hadoop1:60000&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;hbase.zookeeper.property.dataDir&lt;/name&gt;
        &lt;value&gt;/opt/zookeeper/data&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;hbase.zookeeper.property.clientPort&lt;/name&gt;
        &lt;value&gt;2181&lt;/value&gt;
    &lt;/property&gt;
&lt;/configuration&gt;</code></pre></div><p class="L0" style="margin-left:30px;color:rgb(51,51,51);background-color:transparent;"><span style="color:rgb(0,0,0);">将node1的/opt/hbase-2.9.0打包并拷贝至node2和node3中</span></p><p class="L0" style="margin-left:30px;color:rgb(51,51,51);background-color:transparent;"><span style="color:rgb(0,0,0);">注意：Hbase的hbase-site.xml文件中hbase.rootdir对应URL必须指定到Hadoop，与core-site.xml的fs.defaultFS一致</span></p><h2 class="L0" style="font-size:20px;font-weight:normal;line-height:1.5;color:rgb(0,0,0);border-bottom-color:rgb(46,61,84);"><strong>第四步：启动集群</strong></h2><ol><li class="L0">启动：./bin/start-hbase.sh</li><li class="L0"><span style="color:rgb(0,0,0);">jps检查守护进程是否启动（由于搭建的测试环境中，hadoop和hbase共用一台服务器，此处jps同样能查看出hadoop的进程）</span><br><span style="color:rgb(0,0,0);"><img class="confluence-embedded-image" src="https://confluence.evergrande.com/download/attachments/4326660/image2017-12-1%2018%3A18%3A30.png?version=1&amp;modificationDate=1512123516000&amp;api=v2" style="border:0px;" alt=""><img src="https://img-blog.csdn.net/20180427152107665?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1NDWV9TaGFkb3c=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></span></li><li class="L0"><span style="color:rgb(0,0,0);">停止：./bin/stop-hbase.sh</span></li></ol><h2 class="L0" style="font-size:20px;font-weight:normal;line-height:1.5;color:rgb(0,0,0);border-bottom-color:rgb(46,61,84);"><strong>第六步：浏览器查看</strong></h2><p class="L0" style="margin-left:30px;color:rgb(51,51,51);background-color:transparent;">URL：<a href="http://10.100.96.138:16010/" rel="nofollow" class="external-link" style="color:rgb(50,108,166);">http://10.100.96.138:16010</a></p><p class="L0" style="margin-left:30px;color:rgb(51,51,51);background-color:transparent;"><img class="confluence-embedded-image" src="https://confluence.evergrande.com/download/attachments/4326660/image2017-12-1%2018%3A19%3A19.png?version=1&amp;modificationDate=1512123566000&amp;api=v2" style="border:0px;" alt=""><img src="https://img-blog.csdn.net/20180427152140842?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1NDWV9TaGFkb3c=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><h2 class="L0" style="font-size:20px;font-weight:normal;line-height:1.5;color:rgb(0,0,0);border-bottom-color:rgb(46,61,84);"><strong>问题及解决方案</strong></h2><ol><li>HBase启动时，警告： <p style="color:rgb(51,51,51);background-color:transparent;">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize=128m; support was removed in 8.0 <br>Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=128m; support was removed in 8.0</p>解决：由于使用了JDK8 ，需要在HBase的配置文件中conf/hbase-env.sh，注释掉两行，修改完后重启hbase<img class="confluence-embedded-image" src="https://confluence.evergrande.com/download/attachments/4326660/image2017-12-1%2018%3A23%3A43.png?version=1&amp;modificationDate=1512123830000&amp;api=v2" alt="" style="border:0px;"><img src="https://img-blog.csdn.net/20180503093532756?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1NDWV9TaGFkb3c=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></li></ol></div>            </div>
                </div>