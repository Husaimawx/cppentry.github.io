---
layout:     post
title:      Flume架构
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								<div class="article-copyright">
					版权声明：本文为博主原创文章，未经博主允许不得转载。					https://blog.csdn.net/Zonzereal/article/details/78677801				</div>
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<p align="justify">1.1. <span style="font-family:'宋体';">什么是</span><span style="font-family:Calibri;">Flume </span></p>
<p align="justify">flume <span style="font-family:'宋体';">作为</span><span style="font-family:Calibri;"> cloudera </span><span style="font-family:'宋体';">开发的实时日志收集系统，受到了业界的认可与广泛应用。</span><span style="font-family:Calibri;">Flume </span><span style="font-family:'宋体';">初始的发行版本目前被统称为</span><span style="font-family:Calibri;"> Flume OG</span><span style="font-family:'宋体';">（</span><span style="font-family:Calibri;">original generation</span><span style="font-family:'宋体';">），属于</span><span style="font-family:Calibri;"> cloudera</span><span style="font-family:'宋体';">。但随着</span><span style="font-family:Calibri;"> FLume </span><span style="font-family:'宋体';">功能的扩展，</span><span style="font-family:Calibri;">Flume OG </span><span style="font-family:'宋体';">代码工程臃肿、核心组件设计不合理、核心配置不标准等缺点暴露出来，尤其是在</span><span style="font-family:Calibri;"> Flume OG </span><span style="font-family:'宋体';">的最后一个发行版本</span><span style="font-family:Calibri;"> 0.94.0 </span><span style="font-family:'宋体';">中，日志传输不稳定的现象尤为严重，为了解决这些问题，</span><span style="font-family:Calibri;">2011 </span><span style="font-family:'宋体';">年</span><span style="font-family:Calibri;"> 10 </span><span style="font-family:'宋体';">月</span><span style="font-family:Calibri;"> 22 </span><span style="font-family:'宋体';">号，</span><span style="font-family:Calibri;">cloudera </span><span style="font-family:'宋体';">完成了</span><span style="font-family:Calibri;"> Flume-728</span><span style="font-family:'宋体';">，对</span><span style="font-family:Calibri;"> Flume </span><span style="font-family:'宋体';">进行了里程碑式的改动：重构核心组件、核心配置以及代码架构，重构后的版本统称为</span><span style="font-family:Calibri;"> Flume NG</span><span style="font-family:'宋体';">（</span><span style="font-family:Calibri;">next generation</span><span style="font-family:'宋体';">）；改动的另一原因是将</span><span style="font-family:Calibri;"> Flume </span><span style="font-family:'宋体';">纳入</span><span style="font-family:Calibri;"> apache </span><span style="font-family:'宋体';">旗下，</span><span style="font-family:Calibri;">cloudera Flume </span><span style="font-family:'宋体';">改名为</span><span style="font-family:Calibri;"> Apache Flume</span><span style="font-family:'宋体';">。</span><span style="font-family:Calibri;"> </span></p>
<p align="justify">1.1.1. Flume<span style="font-family:'宋体';">的特点</span></p>
<p align="justify">flume<span style="font-family:'宋体';">是一个分布式、可靠、和高可用的海量日志采集、聚合和传输的系统。支持在日志系统中定制各类数据发送方，用于收集数据</span><span style="font-family:Calibri;">;</span><span style="font-family:'宋体';">同时，</span><span style="font-family:Calibri;">Flume</span><span style="font-family:'宋体';">提供对数据进行简单处理，并写到各种数据接受方</span><span style="font-family:Calibri;">(</span><span style="font-family:'宋体';">比如文本、</span><span style="font-family:Calibri;">HDFS</span><span style="font-family:'宋体';">、</span><span style="font-family:Calibri;">Hbase</span><span style="font-family:'宋体';">等</span><span style="font-family:Calibri;">)</span><span style="font-family:'宋体';">的能力。</span></p>
<p> <img src="https://img-blog.csdn.net/20171130162852924?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWm9uemVyZWFs/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p align="justify">flume<span style="font-family:'宋体';">的数据流由事件</span><span style="font-family:Calibri;">(Event)</span><span style="font-family:'宋体';">贯穿始终。事件是</span><span style="font-family:Calibri;">Flume</span><span style="font-family:'宋体';">的基本数据单位，它携带日志数据</span><span style="font-family:Calibri;">(</span><span style="font-family:'宋体';">字节数组形式</span><span style="font-family:Calibri;">)</span><span style="font-family:'宋体';">并且携带有头信息，这些</span><span style="font-family:Calibri;">Event</span><span style="font-family:'宋体';">由</span><span style="font-family:Calibri;">Agent</span><span style="font-family:'宋体';">外部的</span><span style="font-family:Calibri;">Source</span><span style="font-family:'宋体';">生成，当</span><span style="font-family:Calibri;">Source</span><span style="font-family:'宋体';">捕获事件后会进行特定的格式化，然后</span><span style="font-family:Calibri;">Source</span><span style="font-family:'宋体';">会把事件推入</span><span style="font-family:Calibri;">(</span><span style="font-family:'宋体';">单个或多个</span><span style="font-family:Calibri;">)Channel</span><span style="font-family:'宋体';">中。你可以把</span><span style="font-family:Calibri;">Channel</span><span style="font-family:'宋体';">看作是一个缓冲区，它将保存事件直到</span><span style="font-family:Calibri;">Sink</span><span style="font-family:'宋体';">处理完该事件。</span><span style="font-family:Calibri;">Sink</span><span style="font-family:'宋体';">负责持久化日志或者把事件推向另一个</span><span style="font-family:Calibri;">Source</span><span style="font-family:'宋体';">。</span></p>
<p align="justify">1.1.2. Flume<span style="font-family:'宋体';">的可靠性</span></p>
<p align="justify">当节点出现故障时，日志能够被传送到其他节点上而不会丢失。<span style="font-family:Calibri;">Flume</span><span style="font-family:'宋体';">提供了三种级别的可靠性保障，从强到弱依次分别为：</span><span style="font-family:Calibri;">end-to-end</span><span style="font-family:'宋体';">（收到数据</span><span style="font-family:Calibri;">agent</span><span style="font-family:'宋体';">首先将</span><span style="font-family:Calibri;">event</span><span style="font-family:'宋体';">写到磁盘上，当数据传送成功后，再删除；如果数据发送失败，可以重新发送。），</span><span style="font-family:Calibri;">Store on failure</span><span style="font-family:'宋体';">（这也是</span><span style="font-family:Calibri;">scribe</span><span style="font-family:'宋体';">采用的策略，当数据接收方</span><span style="font-family:Calibri;">crash</span><span style="font-family:'宋体';">时，将数据写到本地，待恢复后，继续发送），</span><span style="font-family:Calibri;">Besteffort</span><span style="font-family:'宋体';">（数据发送到接收方后，不会进行确认）。</span></p>
<p align="justify">1.1.3. Flume<span style="font-family:'宋体';">的可恢复性</span></p>
<p align="justify">还是靠<span style="font-family:Calibri;">Channel</span><span style="font-family:'宋体';">。推荐使用</span><span style="font-family:Calibri;">FileChannel</span><span style="font-family:'宋体';">，事件持久化在本地文件系统里</span><span style="font-family:Calibri;">(</span><span style="font-family:'宋体';">性能较差</span><span style="font-family:Calibri;">)</span><span style="font-family:'宋体';">。</span></p>
<p align="justify">1.2. Flume<span style="font-family:'宋体';">基本概念</span></p>
<p align="justify"> <img src="https://img-blog.csdn.net/20171130162930358?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWm9uemVyZWFs/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p align="justify">1.3. Flume<span style="font-family:'宋体';">三大组件</span></p>
<p align="justify">Flume<span style="font-family:'宋体';">主要由</span><span style="font-family:Calibri;">3</span><span style="font-family:'宋体';">个重要的组件购成：</span></p>
<p align="justify">Source:<span style="font-family:'宋体';">完成对日志数据的收集，分成</span><span style="font-family:Calibri;">transtion </span><span style="font-family:'宋体';">和 </span><span style="font-family:Calibri;">event </span><span style="font-family:'宋体';">打入到</span><span style="font-family:Calibri;">channel</span><span style="font-family:'宋体';">之中。</span></p>
<p align="justify">Channel:<span style="font-family:'宋体';">主要提供一个队列的功能，对</span><span style="font-family:Calibri;">source</span><span style="font-family:'宋体';">提供中的数据进行简单的缓存。</span></p>
<p align="justify">Sink:<span style="font-family:'宋体';">取出</span><span style="font-family:Calibri;">Channel</span><span style="font-family:'宋体';">中的数据，进行相应的存储文件系统，数据库，或者提交到远程服务器。</span></p>
<p align="justify"> </p>
<p align="justify">1.3.1. Source</p>
<p> <img src="https://img-blog.csdn.net/20171130162954938?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWm9uemVyZWFs/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p align="justify">1.3.2. Sink</p>
<p> <img src="https://img-blog.csdn.net/20171130163017166?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWm9uemVyZWFs/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p align="justify">1.3.3. Channel</p>
<p align="justify"> <img src="https://img-blog.csdn.net/20171130163103401?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWm9uemVyZWFs/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""><br></p>
<p align="justify">1.4Flume<span style="font-family:'宋体';">拓扑</span></p>
<p align="justify"><img src="https://img-blog.csdn.net/20171130163120772?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWm9uemVyZWFs/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""><img src="https://img-blog.csdn.net/20171130163128753?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWm9uemVyZWFs/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""><img src="https://img-blog.csdn.net/20171130163138647?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWm9uemVyZWFs/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> </p>
<p> </p>
<p> flume具体的source、channel、sink的配置参照官网，准没错<img alt="偷笑" src="http://static.blog.csdn.net/xheditor/xheditor_emot/default/titter.gif"></p>
<p> </p>
            </div>
                </div>