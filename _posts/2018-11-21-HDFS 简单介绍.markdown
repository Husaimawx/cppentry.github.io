---
layout:     post
title:      HDFS 简单介绍
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<p><span style="font-size:14px;">前面介绍<span style="font-family:'Times New Roman';">MapReduce</span><span style="font-family:'宋体';">，现在来了解一下</span><span style="font-family:'Times New Roman';">HDFS -- Hadoop </span>Distributed File System</span></p>
<p><span style="font-size:14px;">HDFS <span style="font-family:'宋体';">作为</span><span style="font-family:'Times New Roman';">Hadoop</span><span style="font-family:'宋体';">集群的一部分，同时也可以独立的分布式文件系统使用。</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">的</span><span style="font-family:'Times New Roman';">¨just work¨</span><span style="font-family:'宋体';">设计理念在很多环境中都适用，了解</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">知识对集群配置</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">和诊断</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">有很大的帮助。</span></span></p>
<p><span style="font-size:14px;"> </span></p>
<p><strong><span style="font-size:14px;">概述</span></strong></p>
<p><span style="font-size:14px;">HDFS<span style="font-family:'宋体';">是</span><span style="font-family:'Times New Roman';">Hadoop</span><span style="font-family:'宋体';">应用中的首选分布式文件存储系统。一个</span><span style="font-family:'Times New Roman';">HDFS </span><span style="font-family:'宋体';">集群包括一个管理文件系统元数据的</span><span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">，和存储数据的</span><span style="font-family:'Times New Roman';">DataNode</span><span style="font-family:'宋体';">。</span></span></p>
<p><span style="font-size:14px;">下面是用户比较感兴趣的几个特性：</span></p>
<p><span style="font-size:14px;">1 Hadoop<span style="font-family:'宋体';">包含</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">，非常适合在通用的硬件上进行分布式存储和分布式运算。</span><span style="font-family:'Times New Roman';">Hadoop</span><span style="font-family:'宋体';">具有容错性，规模性和易扩展性。</span><span style="font-family:'Times New Roman';">MapReduce</span><span style="font-family:'宋体';">在大型的分布式应用中非常的简单易用，同时也是</span><span style="font-family:'Times New Roman';">Hadoop</span><span style="font-family:'宋体';">的一部分。</span></span></p>
<p><span style="font-size:14px;">2 HDFS<span style="font-family:'宋体';">的默认配置能满足大多数用户的安装。在大多数时候，只有在非常大的集群中才需要编写配置文件。</span></span></p>
<p><span style="font-size:14px;">3 Hadoop<span style="font-family:'宋体';">是用</span><span style="font-family:'Times New Roman';">JAVA</span><span style="font-family:'宋体';">编写的，大多数主要平台都支持。</span></span></p>
<p><span style="font-size:14px;">4 Hadoop<span style="font-family:'宋体';">支持 </span><span style="font-family:'Times New Roman';">SHELL-LIKE </span><span style="font-family:'宋体';">命令与</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">直接交互。</span></span></p>
<p><span style="font-size:14px;">5 NameNode<span style="font-family:'宋体';">和</span><span style="font-family:'Times New Roman';">DataNodes</span><span style="font-family:'宋体';">可以使用</span><span style="font-family:'Times New Roman';">web</span><span style="font-family:'宋体';">网页的方式展示集群的当前状态</span></span></p>
<p><span style="font-size:14px;">6 新的特性和改进在<span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">中得以实现。以下是</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">的一些有用的特性。</span></span></p>
<p><span style="font-size:14px;">1） 文件的权限和认证</span></p>
<p><span style="font-size:14px;">2） Rack awareness<span style="font-family:'宋体';">：统计节点的物理位置能够更好的分配</span><span style="font-family:'Times New Roman';">task</span><span style="font-family:'宋体';">和确存储容量。</span></span></p>
<p><span style="font-size:14px;">3） SafeMode<span style="font-family:'宋体';">：管理员配置模式。</span></span></p>
<p><span style="font-size:14px;">4） fsck<span style="font-family:'宋体';">：一种诊断文件系统健康和找到丢失的文件或者</span><span style="font-family:'Times New Roman';">blocks</span><span style="font-family:'宋体';">块的工具。</span></span></p>
<p><span style="font-size:14px;">5） fetchdt<span style="font-family:'宋体';">：获取 </span><span style="font-family:'Times New Roman';">Delegation Token </span><span style="font-family:'宋体';">并把它以文件的方式把它存储在本地系统中。</span></span></p>
<p><span style="font-size:14px;">6） Rebalancer<span style="font-family:'宋体';">：当数据不平衡的分布到</span><span style="font-family:'Times New Roman';">DataNodes</span><span style="font-family:'宋体';">时进行集群的平衡。</span></span></p>
<p><span style="font-size:14px;">7） Upgrade and rollback<span style="font-family:'宋体';">： 在软件升级后出现错误，</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">可以回滚到升级之前的状态。</span></span></p>
<p><span style="font-size:14px;">8） Secondary NameNode<span style="font-family:'宋体';">：周期性的执行</span><span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">命名空间的的</span><span style="font-family:'Times New Roman';">checkpoints</span><span style="font-family:'宋体';">，有助于保持</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">修改日志文件的大小。</span></span></p>
<p><span style="font-size:14px;"> </span></p>
<p><strong><span style="font-size:14px;">Web <span style="font-family:'宋体';">接口</span></span></strong></p>
<p><span style="font-size:14px;">NameNode<span style="font-family:'宋体';">和</span><span style="font-family:'Times New Roman';">DataNode </span><span style="font-family:'宋体';">分别运行在一个内部的</span><span style="font-family:'Times New Roman';">web server</span><span style="font-family:'宋体';">中，这样以便展示当前集群运行状态的基本信息。默认配置里，</span><span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">的主页是</span><span style="font-family:'Times New Roman';">http://namenode-name</span><span style="font-family:'宋体';">：</span><span style="font-family:'Times New Roman';">50070</span><span style="font-family:'宋体';">。该主页列出了集群中的</span><span style="font-family:'Times New Roman';">DataNode</span><span style="font-family:'宋体';">和集群的基本统计信息。同时该网页通常也用于文件系统的浏览。</span></span></p>
<p><span style="font-size:14px;"> </span></p>
<p><strong><span style="font-size:14px;">Shell <span style="font-family:'宋体';">命令</span></span></strong></p>
<p><span style="font-size:14px;">Hadoop<span style="font-family:'宋体';">包含很多</span><span style="font-family:'Times New Roman';">shell-like</span><span style="font-family:'宋体';">的命令用于直接和</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">和其他的</span><span style="font-family:'Times New Roman';">Hadoop</span><span style="font-family:'宋体';">支持的文件系统进行交互。可以使用 </span><span style="font-family:'Times New Roman';">bin/hdfs dfs -help </span><span style="font-family:'宋体';">列出全出</span><span style="font-family:'Times New Roman';">hadoop shell</span><span style="font-family:'宋体';">支持的全部命令。另外，</span><span style="font-family:'Times New Roman';">bin/hdfs dfs -help</span><span style="font-family:'宋体';">命令中的 </span><span style="font-family:'Times New Roman';">-name </span><span style="font-family:'宋体';">可以展示一个命令的详细信息。这些命令支持大多数普通的文件系统的操作例如文件的复制和修改文件的权限等。同时也支持一些</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">特殊的操作例如修改文件的副本数量。</span></span></p>
<p><span style="font-size:14px;"> </span></p>
<p><strong><span style="font-size:14px;">DFSAdmin <span style="font-family:'宋体';">命令</span></span></strong></p>
<p><span style="font-size:14px;">bin/hadoop dfsadmin <span style="font-family:'宋体';">命令支持一些</span><span style="font-family:'Times New Roman';">HDFS </span><span style="font-family:'宋体';">管理员相关操作。</span><span style="font-family:'Times New Roman';">Bin/hadoop dfsadmin -help</span><span style="font-family:'宋体';">命令可以列出全部支持的命令：</span></span></p>
<p><span style="font-size:14px;">1）-report<span style="font-family:'宋体';">：报告</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">基本统计信息。有些信息可以直接在</span><span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">的</span><span style="font-family:'Times New Roman';">web</span><span style="font-family:'宋体';">界面中直接看到。</span></span></p>
<p><span style="font-size:14px;">2）-safemode<span style="font-family:'宋体';">：通常不需要，管理员可以打开和关闭</span><span style="font-family:'Times New Roman';">safemode</span><span style="font-family:'宋体';">模式。</span></span></p>
<p><span style="font-size:14px;">3）-finalizeUpgrefe<span style="font-family:'宋体';">：删除最近一次升级前的集群备份。</span></span></p>
<p><span style="font-size:14px;">4）-refreshNode<span style="font-family:'宋体';">：让集群中的主机主动将自己的状态与</span><span style="font-family:'Times New Roman';">namenode</span><span style="font-family:'宋体';">进行交互。重新读取配置的修改文件，可以通过</span><span style="font-family:'Times New Roman';">dfs.hosts </span><span style="font-family:'宋体';">和 </span><span style="font-family:'Times New Roman';">dfs.host.exclude </span><span style="font-family:'宋体';">和读取全部的（</span><span style="font-family:'Times New Roman';">hostnames</span><span style="font-family:'宋体';">）。</span></span></p>
<p><span style="font-size:14px;"> </span></p>
<p><strong><span style="font-size:14px;">Secondary NameNode</span></strong></p>
<p><span style="font-size:14px;">NameNode <span style="font-family:'宋体';">存储整个文件系统的修改日志，该修改日是以本地文件</span><span style="font-family:'Times New Roman';">appended</span><span style="font-family:'宋体';">的方式进行记录。当</span><span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">启动时，会通过镜像文件读取</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">状态，</span><span style="font-family:'Times New Roman';">fsimage</span><span style="font-family:'宋体';">，然后使用</span><span style="font-family:'Times New Roman';">edits</span><span style="font-family:'宋体';">读取日志文件。然后写入新的</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">状态到</span><span style="font-family:'Times New Roman';">fsimage</span><span style="font-family:'宋体';">，然后使用一个空白</span><span style="font-family:'Times New Roman';">edits</span><span style="font-family:'宋体';">文件开始常规的操作。由于</span><span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">合并</span><span style="font-family:'Times New Roman';">fsimage</span><span style="font-family:'宋体';">和编写记录日志文件只在启动的时候进行，</span><span style="font-family:'Times New Roman';">edits log </span><span style="font-family:'宋体';">文件非常大会出现超时。另外一个超大的</span><span style="font-family:'Times New Roman';">edits</span><span style="font-family:'宋体';">文件在</span><span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">下次重启的时候需要更多的时间。</span></span></p>
<p><span style="font-size:14px;">Secondary NameNode <span style="font-family:'宋体';">合并</span><span style="font-family:'Times New Roman';">fsimage </span><span style="font-family:'宋体';">以及定期的处理</span><span style="font-family:'Times New Roman';">edits log</span><span style="font-family:'宋体';">日志文件并保持</span><span style="font-family:'Times New Roman';">edits log</span><span style="font-family:'宋体';">日志文件在限定的大小方位内。</span><span style="font-family:'Times New Roman';">Secondary NameNode</span><span style="font-family:'宋体';">通常使用独立的机器运行。</span><span style="font-family:'Times New Roman';">Secondary NameNode</span><span style="font-family:'宋体';">通过 </span><span style="font-family:'Times New Roman';">bin/start-dfs.sh</span><span style="font-family:'宋体';">启动，在</span><span style="font-family:'Times New Roman';">conf/masters </span><span style="font-family:'宋体';">文件中指定节点作为</span><span style="font-family:'Times New Roman';">Secondary NameNode</span><span style="font-family:'宋体';">。</span></span></p>
<p><span style="font-size:14px;">在<span style="font-family:'Times New Roman';">Secondary NameNode</span><span style="font-family:'宋体';">开始处理</span><span style="font-family:'Times New Roman';">checkpoint</span><span style="font-family:'宋体';">时，有以下</span><span style="font-family:'Times New Roman';">2</span><span style="font-family:'宋体';">个配置参数进行控制：</span></span></p>
<p><span style="font-size:14px;">1）fs.checkpoint.period<span style="font-family:'宋体';">，默认是</span><span style="font-family:'Times New Roman';">1</span><span style="font-family:'宋体';">小时周期执行，可以指定相邻两次的安全</span><span style="font-family:'Times New Roman';">checkpint</span><span style="font-family:'宋体';">的执行时间周期。</span></span></p>
<p><span style="font-size:14px;">2）fs.checkpoint.size<span style="font-family:'宋体';">，默认是</span><span style="font-family:'Times New Roman';">64MB</span><span style="font-family:'宋体';">。定义</span><span style="font-family:'Times New Roman';">edits log</span><span style="font-family:'宋体';">的文件大小来紧急的</span><span style="font-family:'Times New Roman';">checkpoint</span><span style="font-family:'宋体';">即使在相邻的两次</span><span style="font-family:'Times New Roman';">checkpoint</span><span style="font-family:'宋体';">时间还未到达。</span></span></p>
<p><span style="font-size:14px;"> </span></p>
<p><span style="font-size:14px;">Secondary NameNode<span style="font-family:'宋体';">存储着与 </span><span style="font-family:'Times New Roman';">primary NameNode </span><span style="font-family:'宋体';">最近一次文件路径一样的</span><span style="font-family:'Times New Roman';">checkpoint</span><span style="font-family:'宋体';">。所以这个 </span><span style="font-family:'Times New Roman';">checkpoint</span><span style="font-family:'宋体';">镜像文件总是可以被</span><span style="font-family:'Times New Roman';">primary NameNode</span><span style="font-family:'宋体';">读取。</span></span></p>
<p><span style="font-size:14px;"> </span></p>
<p><strong><span style="font-size:14px;">Import Checkpoint </span></strong></p>
<p><span style="font-size:14px;">最近一次<span style="font-family:'Times New Roman';">checkpoint</span><span style="font-family:'宋体';">可以导入到</span><span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">，如果在其他全部镜像和</span><span style="font-family:'Times New Roman';">edits </span><span style="font-family:'宋体';">文件全部丢失的时候。为了导入，我们应该：</span></span></p>
<p><span style="font-size:14px;">1）在<span style="font-family:'Times New Roman';">dfs.name.dir</span><span style="font-family:'宋体';">中创建一个可用的空目录文件。</span></span></p>
<p><span style="font-size:14px;">2）在<span style="font-family:'Times New Roman';">fs.checkppoint.dir</span><span style="font-family:'宋体';">中指定</span><span style="font-family:'Times New Roman';">checkpoint</span><span style="font-family:'宋体';">的文件路径。</span></span></p>
<p><span style="font-size:14px;">3）启动<span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">命令，并带上 </span><span style="font-family:'Times New Roman';">-importCheckpoint</span><span style="font-family:'宋体';">选项。</span></span></p>
<p><span style="font-size:14px;">NameNode<span style="font-family:'宋体';">将会从</span><span style="font-family:'Times New Roman';">fs.checkpoint.dir</span><span style="font-family:'宋体';">路径里加载</span><span style="font-family:'Times New Roman';">checkpoint</span><span style="font-family:'宋体';">，然后保存到</span><span style="font-family:'Times New Roman';">Namede</span><span style="font-family:'宋体';">的</span><span style="font-family:'Times New Roman';">dfs.name.dir</span><span style="font-family:'宋体';">文件路径中。如果一个合法的</span><span style="font-family:'Times New Roman';">iamge</span><span style="font-family:'宋体';">镜像在</span><span style="font-family:'Times New Roman';">dfs.name.dir</span><span style="font-family:'宋体';">目录中存在，将会失败操作。</span><span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">会验证</span><span style="font-family:'Times New Roman';">fs.checkpoint.dir</span><span style="font-family:'宋体';">目录中的镜像文件是否一致，但是不能以任何方式进行修改。</span></span></p>
<p><span style="font-size:14px;"> </span></p>
<p><strong><span style="font-size:14px;">Rebalancer</span></strong></p>
<p><span style="font-size:14px;">HDFS<span style="font-family:'宋体';">的数据不可能在</span><span style="font-family:'Times New Roman';">DataNode</span><span style="font-family:'宋体';">中均匀的分布。如我们在现有的集群中添加一个新的</span><span style="font-family:'Times New Roman';">DataNode</span><span style="font-family:'宋体';">节点。当填充新的</span><span style="font-family:'Times New Roman';">blocks</span><span style="font-family:'宋体';">时（文件的数据以</span><span style="font-family:'Times New Roman';">blocks</span><span style="font-family:'宋体';">序列被存储），</span><span style="font-family:'Times New Roman';">DataNodes</span><span style="font-family:'宋体';">在选择接收这些</span><span style="font-family:'Times New Roman';">blocks</span><span style="font-family:'宋体';">之前，</span><span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">需要如下参数信息：</span></span></p>
<p><span style="font-size:14px;">1）策略来保证相同副本的一个节点作为写<span style="font-family:'Times New Roman';">block</span><span style="font-family:'宋体';">。</span></span></p>
<p><span style="font-size:14px;">2）需要将副本存储在不同的机架上，来保证集群能找回整机机架丢失的数据。</span></p>
<p><span style="font-size:14px;">3）通常在同一机架中的文件副本由其中的一个副本来替换其他的副本，这样可以减少跨机架的网络<span style="font-family:'Times New Roman';">I/O</span><span style="font-family:'宋体';">量。</span></span></p>
<p><span style="font-size:14px;">4）在机群中均匀的分布<span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">数据到</span><span style="font-family:'Times New Roman';">DataNodes</span><span style="font-family:'宋体';">。</span></span></p>
<p><span style="font-size:14px;"> </span></p>
<p><span style="font-size:14px;">由于要考虑多重竞争，数据可能不会均匀的分布到<span style="font-family:'Times New Roman';">DataNodes</span><span style="font-family:'宋体';">中。</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">提供一个管理员工具来分析</span><span style="font-family:'Times New Roman';">block</span><span style="font-family:'宋体';">使用率和</span><span style="font-family:'Times New Roman';">DataNode</span><span style="font-family:'宋体';">间数据的负载均衡。</span></span></p>
<p><span style="font-size:14px;"> </span></p>
<p><strong><span style="font-size:14px;">Rack Awareness</span></strong></p>
<p><span style="font-size:14px;">     大型的<span style="font-family:'Times New Roman';">hadoop</span><span style="font-family:'宋体';">集群一般部署在多机架环境中，网络传输会在同一机架的不同节点间以及不同机架的不同节点间。另外</span><span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">会将</span><span style="font-family:'Times New Roman';">block</span><span style="font-family:'宋体';">副本分布多机架中来提高容错率。</span><span style="font-family:'Times New Roman';">Hadoop </span><span style="font-family:'宋体';">集群管理员可以通过配置 </span><span style="font-family:'Times New Roman';">dfs.network.script </span><span style="font-family:'宋体';">来决定那个节点属于那个机架。当</span><span style="font-family:'Times New Roman';">script</span><span style="font-family:'宋体';">脚本配置了，每个节点运行该</span><span style="font-family:'Times New Roman';">script</span><span style="font-family:'宋体';">脚本来确定它的</span><span style="font-family:'Times New Roman';">rack id</span><span style="font-family:'宋体';">。默认安装后，全部节点属于同一机架。</span></span></p>
<p><span style="font-size:14px;"> </span></p>
<p><strong><span style="font-size:14px;">Safemode</span></strong></p>
<p><span style="font-size:14px;">当<span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">启动时，会从</span><span style="font-family:'Times New Roman';">fsimage</span><span style="font-family:'宋体';">镜像加载文件系统状态和记录日志文件。然后等待</span><span style="font-family:'Times New Roman';">DataNodes</span><span style="font-family:'宋体';">来报告他们的</span><span style="font-family:'Times New Roman';">blocks</span><span style="font-family:'宋体';">从而避免过早的创建</span><span style="font-family:'Times New Roman';">blocks</span><span style="font-family:'宋体';">副本即使集群里存在足够的副本数。该阶段里</span><span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">处于 </span><span style="font-family:'Times New Roman';">safemode</span><span style="font-family:'宋体';">模式。</span><span style="font-family:'Times New Roman';">Namenode</span><span style="font-family:'宋体';">的</span><span style="font-family:'Times New Roman';">Safemode</span><span style="font-family:'宋体';">模式在</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">集群中是 </span><span style="font-family:'Times New Roman';">read-only</span><span style="font-family:'宋体';">只读模式，不容许任何文件系统或</span><span style="font-family:'Times New Roman';">bloks</span><span style="font-family:'宋体';">的修改。通常</span><span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">在</span><span style="font-family:'Times New Roman';">DataNodes</span><span style="font-family:'宋体';">报告大多数文件系统的</span><span style="font-family:'Times New Roman';">blocks</span><span style="font-family:'宋体';">可用后就会自动离开</span><span style="font-family:'Times New Roman';">Safemode</span><span style="font-family:'宋体';">模式。如果需要，</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">可以通过明确使用 </span><span style="font-family:'Times New Roman';">bin/hadoop dfsadmin -safemode</span><span style="font-family:'宋体';">命令来切换到</span><span style="font-family:'Times New Roman';">safemode</span><span style="font-family:'宋体';">模式。</span><span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">的</span><span style="font-family:'Times New Roman';">web</span><span style="font-family:'宋体';">网页会显示</span><span style="font-family:'Times New Roman';">safemode</span><span style="font-family:'宋体';">的开启或关闭状态。更多详细的描述和配置信息可以通过</span><span style="font-family:'Times New Roman';">JAVADoc</span><span style="font-family:'宋体';">的</span><span style="font-family:'Times New Roman';">NameNode.setSafeMode()</span><span style="font-family:'宋体';">得到。</span></span></p>
<p><span style="font-size:14px;"> </span></p>
<p><strong><span style="font-size:14px;">fsck</span></strong></p>
<p><span style="font-size:14px;">HDFS<span style="font-family:'宋体';">支持使用</span><span style="font-family:'Times New Roman';">fsck</span><span style="font-family:'宋体';">命令来检查不一致问题。其设计是用来报告各种文件问题，例如：一个文件丢失的</span><span style="font-family:'Times New Roman';">blocks</span><span style="font-family:'宋体';">或者</span><span style="font-family:'Times New Roman';">blocks</span><span style="font-family:'宋体';">的复制。不想传统的本地系统的</span><span style="font-family:'Times New Roman';">fsck</span><span style="font-family:'宋体';">工具，该命令不会纠正它探测到的错误。通常</span><span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">自动修正大多数可以纠正的错误。报告期间默认情况下</span><span style="font-family:'Times New Roman';">fsck</span><span style="font-family:'宋体';">会忽略打开的文件但是会提供一个选项去选择全部文件。</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">的</span><span style="font-family:'Times New Roman';">fsck</span><span style="font-family:'宋体';">命令不是</span><span style="font-family:'Times New Roman';">hadoop shell</span><span style="font-family:'宋体';">命令。它可通过</span><span style="font-family:'Times New Roman';">bin/hadoop fsck</span><span style="font-family:'宋体';">来运行。</span></span></p>
<p><span style="font-size:14px;"> </span></p>
<p><strong><span style="font-size:14px;">fetchdt</span></strong></p>
<p><span style="font-size:14px;">HDFS<span style="font-family:'宋体';">支持 </span><span style="font-family:'Times New Roman';">fetchdt</span><span style="font-family:'宋体';">命令来获取令牌环，并将它以文件的方式保存到本地系统中。该令牌可以用于以后没有安全策略的客户端访问有安全策略的服务器。可通过使用</span><span style="font-family:'Times New Roman';">RPC</span><span style="font-family:'宋体';">或</span><span style="font-family:'Times New Roman';">HTTPS</span><span style="font-family:'宋体';">（通过</span><span style="font-family:'Times New Roman';">Kerberos</span><span style="font-family:'宋体';">）得到令牌，然后在运行之前得到需提供</span><span style="font-family:'Times New Roman';">Kerberos</span><span style="font-family:'宋体';">凭证。</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">的</span><span style="font-family:'Times New Roman';">fetchdt</span><span style="font-family:'宋体';">命令不是</span><span style="font-family:'Times New Roman';">hadoop shell</span><span style="font-family:'宋体';">命令。它通过</span><span style="font-family:'Times New Roman';">bin/hadoop fetchdt DTfile</span><span style="font-family:'宋体';">运行。当你获取到令牌后可以不需要</span><span style="font-family:'Times New Roman';">kerberos </span><span style="font-family:'宋体';">凭证来运行</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">命令，但需要指定</span><span style="font-family:'Times New Roman';">HADOOP_TOKEN_FILE_LOCATION</span><span style="font-family:'宋体';">环境变量给令牌环文件。</span></span></p>
<p><span style="font-size:14px;"> </span></p>
<p><strong><span style="font-size:14px;">Recovery Mode</span></strong></p>
<p><span style="font-size:14px;">一般情况下你需要配置<span style="font-family:'Times New Roman';">metadata</span><span style="font-family:'宋体';">元数据到多个存储路径下。当某一个存储路径失效或不可用，你可以通过其他路径来读取</span><span style="font-family:'Times New Roman';">metadata</span><span style="font-family:'宋体';">元数据。</span></span></p>
<p><span style="font-size:14px;">然而，如果<span style="font-family:'Times New Roman';">metadata</span><span style="font-family:'宋体';">元数据只存储到一个路径下，并且失效了，你该怎么办？在这种情况下，有一个特殊的</span><span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">启动模式叫做</span><span style="font-family:'Times New Roman';">Recovery mode</span><span style="font-family:'宋体';">恢复模式，恢复模式允许你恢复大多数数据。</span></span></p>
<p><span style="font-size:14px;">你可以使用恢复模式启动<span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">：</span><span style="font-family:'Times New Roman';">namenode -recover</span></span></p>
<p><span style="font-size:14px;">当在<span style="font-family:'Times New Roman';">recovery mode</span><span style="font-family:'宋体';">中，</span><span style="font-family:'Times New Roman';">Namenode</span><span style="font-family:'宋体';">会通过命令行的方式与你交互，并有你决定用什么方式来恢复你的数据。</span></span></p>
<p><span style="font-size:14px;">如果你不想使用<span style="font-family:'Times New Roman';">prompted</span><span style="font-family:'宋体';">的方式，可以使用 </span><span style="font-family:'Times New Roman';">-force</span><span style="font-family:'宋体';">选项来屏蔽。这个选项始终默认选择第一选项来完成数据恢复任务。</span></span></p>
<p><span style="font-size:14px;">因为<span style="font-family:'Times New Roman';">Recovery mode</span><span style="font-family:'宋体';">会丢失你的数据，你应该总是在恢复之前保存好你</span><span style="font-family:'Times New Roman';">edits log</span><span style="font-family:'宋体';">日志文件和</span><span style="font-family:'Times New Roman';">fsimage</span><span style="font-family:'宋体';">镜像文件。</span></span></p>
<p><span style="font-size:14px;"> </span></p>
<p><strong><span style="font-size:14px;">Upgrade and Rollback</span></strong></p>
<p><span style="font-size:14px;">在现有的集群上更新<span style="font-family:'Times New Roman';">hadoop</span><span style="font-family:'宋体';">，就像任何软件更新一样，会可能出现一些新的</span><span style="font-family:'Times New Roman';">bugs</span><span style="font-family:'宋体';">或者对现有应用和潜在的不相容的改变。</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">允许管理员可以回到早期的</span><span style="font-family:'Times New Roman';">hadoop</span><span style="font-family:'宋体';">版本，以及让所有节点回滚到更新前的状态。</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">可以在某一个时间点上进行备份。在更新前，管理员需要使用</span><span style="font-family:'Times New Roman';">bin/hadoop -finalizeUpgrade </span><span style="font-family:'宋体';">命令来删除现有的备份。以下简单描述更新的过程：</span></span></p>
<p><span style="font-size:14px;">1）在更新升级<span style="font-family:'Times New Roman';">hadoop</span><span style="font-family:'宋体';">软件之前，使用</span><span style="font-family:'Times New Roman';">dfsadmin -upgradeProgress status</span><span style="font-family:'宋体';">来判断是否集群需要被</span><span style="font-family:'Times New Roman';">finalized</span><span style="font-family:'宋体';">。</span></span></p>
<p><span style="font-size:14px;">2）停止集群和分发<span style="font-family:'Times New Roman';">hadoop</span><span style="font-family:'宋体';">新版本。</span></span></p>
<p><span style="font-size:14px;">3）运行新的版本 <span style="font-family:'Times New Roman';">-upgrede </span><span style="font-family:'宋体';">选项（</span><span style="font-family:'Times New Roman';">bin/start-dfs.sh -upgrade</span><span style="font-family:'宋体';">）</span></span></p>
<p><span style="font-size:14px;">4）大多数时间，集群工作的很好。一旦新的<span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">运行的非常好（或许几天的操作之后），完成升级。请注意，直到集群升级完成，删除升级前的文件是没有真正在</span><span style="font-family:'Times New Roman';">DataNodes</span><span style="font-family:'宋体';">中释放磁盘空间的。</span></span></p>
<p><span style="font-size:14px;">5）如果需要回滚到以前的版本：停止集群并分发<span style="font-family:'Times New Roman';">hadoop</span><span style="font-family:'宋体';">的早期版本；使用</span><span style="font-family:'Times New Roman';">rollback</span><span style="font-family:'宋体';">选项开始集群（</span><span style="font-family:'Times New Roman';">bin/start-dfs.h -rollback</span><span style="font-family:'宋体';">）。</span></span></p>
<p><span style="font-size:14px;"> </span></p>
<p><strong><span style="font-size:14px;">File Permissions and Security </span></strong></p>
<p><span style="font-size:14px;">文件权限类似与<span style="font-family:'Times New Roman';">linux</span><span style="font-family:'宋体';">权限设定。目前，简单文件权限的安全是被限制的。用户启动</span><span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">后，该用户将被视为</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">的超级用户。未来的</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">版本将会支持类似与</span><span style="font-family:'Times New Roman';">Kerberos</span><span style="font-family:'宋体';">的网络认证协议来验证用户和数据传输加密。</span></span></p>
<p><span style="font-size:14px;"> </span></p>
<p><strong><span style="font-size:14px;">Scalability</span></strong></p>
<p><span style="font-size:14px;">Hadoop<span style="font-family:'宋体';">目前能在几千台节点上运行。</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">每个集群众只有一个</span><span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">。目前</span><span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">的内存是扩展性的瓶颈。在大型的集群里，存储在</span><span style="font-family:'Times New Roman';">HDFS</span><span style="font-family:'宋体';">中的文件大小不断平均增加，集群的规模也在增加，但是</span><span style="font-family:'Times New Roman';">NameNode</span><span style="font-family:'宋体';">的内存却没有增加。默认的配置可能不适合非常大的集群。</span></span></p>
            </div>
                </div>