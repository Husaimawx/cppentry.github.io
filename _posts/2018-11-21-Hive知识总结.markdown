---
layout:     post
title:      Hive知识总结
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
    <div class="rich_media_content">
                    

                    

                    
                    
                    <h1 style="font-size:2.6em;font-family:inherit;line-height:1.1;color:inherit;"><span style="font-size:16px;">本文是根据之前hive系列的文章进行整理。</span></h1><p><span style="font-size:16px;"><br></span></p><h1 style="font-size:2.6em;font-family:inherit;line-height:1.1;color:inherit;">知识大纲</h1><h2 style="font-family:inherit;line-height:1.1;color:inherit;font-size:2.15em;">Hive基础操作和数据类型</h2><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">基础操作</h3><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">数据类型</h3><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">数据库操作</h3><h2 style="font-family:inherit;line-height:1.1;color:inherit;font-size:2.15em;">HiveQL</h2><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">数据定义</h3><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">数据操作</h3><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">数据查询</h3><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">where查询</h3><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">JOIN</h3><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">排序</h3><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">视图</h3><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">桶</h3><h2 style="font-family:inherit;line-height:1.1;color:inherit;font-size:2.15em;">HiveQL：索引</h2><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">创建索引</h3><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">使用索引</h3><h2 style="font-family:inherit;line-height:1.1;color:inherit;font-size:2.15em;">Hive优化</h2><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">常见优化</h3><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">hive数据倾斜</h3><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">Hive压缩</h3><hr style="border-right:0px;border-bottom:0px;border-left:0px;border-top-style:solid;border-top-color:rgba(128,128,128,.1);"><h1 style="font-size:2.6em;font-family:inherit;line-height:1.1;color:inherit;">一. Hive基础操作和数据类型</h1><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">基础操作</h3><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">数据类型</h3><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">数据库操作</h3><hr style="border-right:0px;border-bottom:0px;border-left:0px;border-top-style:solid;border-top-color:rgba(128,128,128,.1);"><h2 style="font-family:inherit;line-height:1.1;color:inherit;font-size:2.15em;">基础操作</h2><p>指定数据仓库 目录 <br><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbvHdhUGbniaTUodEBQFkS8hFGTIWBNlFPNxicoictED0O8CCvS2MWwZ91w/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>一般都是在hdfs上有这个目录，hive安装的时候元数据保存在关系数据库中，一般是mysql。hive启动命令： <br><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulb8yZXcCX3icJEqNAhhb5kY3xFBWvwK63OrRx3veVjibJppHsAlfnmFaxw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>hive默认，bin/hive启动的是client模式，bin/hive类似于bin/hive –service cli 后面的选项还有如下图，你也可以启动一个hwi，用web访问，执行sql可视化。</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbkPE20L7DdKCpqnsYydpdx5CufHeZKk3icqicmVfWDUdoNZkpFiaYXlXmA/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>剩下的两个参数说明：添加额外jar包和指定配置文件 <br><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbd7a1Pgn7xwNCKWwRxb61bPzSqTciaib4twiaZxef6UHdThTjqgcBc4Pxg/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>命令行界面，也就是CLI，是和Hive交互的常用方式，使用cli，用户可以创建表，检查模式，以及查询表等，cli选项如下：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbFyB9q3V0R6aL1VX1ib3CKg1MpNseWWC1QQuS4IosaaV8I4ENqazo3Wg/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>各个选项使用说明：</p><p>-d可以设置变量，类似于：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbiaZZJsYCDZkzEm1icCRfIuR5wsj5JaHZkeXTcLr4jkH7St8Ceia30QGEQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>可以简化成-d，-d是用来自定义变量的，需要注意的是定义的是hive，可以不加hivevar。 <br>例如上面第一个写的，但是，如果是env、system必须要加前缀，如下：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbQZWVOoY2yZzysmchariae5nr6lj4Do8MXqbm6XqlCGduFkibrOmhUw8Q/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>-e 是直接执行sql语句。如下：bin/hive -e “sql语句”</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulb1cvkwFQpeQYwKNibYpWaWFnHfRa3hM1J2iaWxnYC31NuAWywtV9xqxkA/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>-f 是执行文件里的sql语句，例如：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbDE3OLBVg0EO5wBN8ib3gdickkN5b38seRKRS4UAiaM8z5dFz0w6HpFe5A/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>我们可以把hive sql执行的结果直接导入到本地文件中</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbU2D3xIAMvcpVQox7BgL1TfzTMiaayb62A7mPBDLoDz31Ocu3xvqEBiaw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>注意-S可以去掉额外提示信息</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbVTwdkCsWzYDYjPicgCluHibDoVRWqvcyb1icJXRY1bFubLuDDcqnlNibjg/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>启动hive shell的时候，如果想加载一下额外配置可以在命令里面写-d 配置=值，但这样比较麻烦，每次都得写。hive有一个hive shell每次启动的时候都会去加载的目录：</p><p>$HOME/hivec,比如/home/root/hiver</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulb2zxmwU9AHtfHcNmQgfa23OqyEcibE15NpnxIib7oJePLhDVaLQAyS5uw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p><strong>注意</strong> hive.cli.print.current.db=true是显示数据库的名字，还有一个配置是hive.exec.mode.local.auto=true，即使在hadoop分布式环境中，配置之后，hive根据数据量判断是用自己的mr本地执行（本地执行快），还是用hadoop分布式环境执行。在hive shell 中可以直接执行hadoop命令，执行方式是去掉hadoop。例如：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbNfe3G43MibTbyK3pgxG5dUGKsb9TwkkbEHDXibQVxBgxXs2zictJ9C69g/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>hive不光可以配置提示数据库，还可以设置显示列，配置如下设置命令和显示的列名</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbKibGicMUFm7XfPyMv8t64DnulgvZKzxtLCzMXKuicoibRFCrsGdKp8Eevw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><h2 style="font-family:inherit;line-height:1.1;color:inherit;font-size:2.15em;">数据类型</h2><p>hive的数据类型和java的基本类型保持一致</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbbqZGA2e0CiaEkO6uib1C3aJUWuW00QNpdrHY07Jth181HWwAtrvqfxmQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>它只有时间戳类型没有date类型，hive里面的类型强制转换用的是：cast(列 as 类型)。hive为了提高读取数据，把平时我们要分表做的事情，写到一张表里面，为了实现这个目的，它额外多出了集合类型，冗余存储</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulb7FkXPv1FxQmpASd2VcA6DGsGpLZGqIhT1ibYl5JZic162EM30KRO3IuQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>分别是结构体、key-value键值对、数组。注意里面都是引号引起来的，例如：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbxmS88m6Iib8ibmPXib6zq8UHtulvSRib2sY9faswKBeUprrd4I1UDzxfwA/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>当我们设置了集合类型，我们的数据格式就一定限制了。</p><p>数据格式分割符，例如我们平时csv就是逗号分割。hive默认的分割符：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulboNoemU3RfOqgGesbccicFTo3OibGuGv2jRznpaxW16PiaCw1acOvoxJXw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>换行符是不能自定义的，其他都可以自定义：集合元素之间用^B,map的key value之间用^C、列与列之间用^A。这是hive默认的。例如数据：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbhLZttPxTKVlzClXVn7h1cM5oGOhW4TpROiaAyMtPMfrl7QqM7mnia8mw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>用户可以不使用默认分割符，根据数据情况自定义分割符，比如：你的事csv，自定义fields</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbtGZoSPKu3oWpEx97GAAaz2FfP5gAy2VIiaNQpSAv1iaVTYKibaEe0pEww/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>注意两点：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbfaXpN4icibIOIzLd26pJJgEQQeBjIicfGbgXmvMB9nIcictVFPpQO5awBQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>看一下上面例子各个自定义介绍（例子默认的是默认分隔符）：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbXAt6NQ47h31nOaicsciaVVEBF3d3c9fxviatsibzBcrlsIMw41ibNW23UDw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>csv是逗号分隔符：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulb6PkZT0gR28KdqwQTLb0wz6vdagUptrAyFicX98kEX7KXZiaVgjGHyurw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>列与列之间用逗号</p><h2 style="font-family:inherit;line-height:1.1;color:inherit;font-size:2.15em;">数据库操作</h2><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">hive的数据库创建</h3><p>我们都知道hive是数据仓库，因为它不能对单条数据进行更改和删除</p><p>hive的数据库的创建语句： hive&gt; CREATE DATABASE financials <br>最好加上IF NOT EXISTS判断一下，例如： <br>hive &gt; CREATE DATABASE IF NOT EXISTS FINANCIALS <br>否则如果库存在则会报错。</p><p>注意，数据库创建完，在数据库所在的目录位于属性</p><p>hive.metastore.warehouse.dir所指定的顶层目录之后</p><p>hive不管是数据库还是表创建，记录是在关系数据库里面，并且还要在hdfs文件系统中生成一个文件夹，表示数据库或者表。 <br>如下所述：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbHncr6PhWGicnXTp179IJMGSTgMfOuvGngGYOWGicSz6UbRpjYAVH4Zgw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>你也可以去手动修改存储在hdfs位置（建议不要修改），例如：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbGtnufwj7wGkQnOMh6UTwQDrwGbJdvDTWpMSibyIsAjwCpmfSzqhR8uw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>查数据库的详细信息：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbM3jsuC1vCiabeeK9mS5QXE5XoRn8jjyc7ba1Fd2rJOzWuqNIQT2jehw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>切换数据库：use {dbname}</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbmPZ0ib0BzDCU8LibsBO4GHvShOECS6WhU5Kfuibb4sxvVXwGgED3xW2HA/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>删除数据库：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulb7aRytTt1KNy1yib8FIRib4r0WnoibsZkv1fNHKeUPd5X6OHXrAOzqOK5w/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>注意后面的cascade，加上之后及时数据库有表也可以删除（强制删除）。如果不加，当数据库有表时，删除是不成功的。</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbZZ3Ciag8I9iboeVvVpp9uIMvzHWqNjobuVjReJf51xXOGCVrwib1sd0rw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><h1 style="font-size:2.6em;font-family:inherit;line-height:1.1;color:inherit;">二.HiveQL</h1><h2 style="font-family:inherit;line-height:1.1;color:inherit;font-size:2.15em;">数据定义</h2><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">表创建</h3><p>表创建，hive表分为内部表和外部表：内部表删除后数据也随着删除，外部表删除了数据还在。</p><h4 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.25em;">创建内部表：</h4><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulb8xZkwpjug9tMu6eZvWKzhLtklCibtld1INOvkfFQib4uPtVDHyZ1Ao5g/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>其中，location指定表的创建位置。注意： <br>我们可以复制已存在的表结构（仅仅是表结构，不包含数据）创建出一张新表</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbITf77eUsTLlwNydicafIId9SBA4dnpCnAbDyRZp4fOTcry5z8zMI97Q/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>创建一个同样有数据的表： <br>create table name as select * from name</p><h4 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.25em;">创建外部表：</h4><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbHE7WBa3VFHyQ9XUkibfnKPsqtd6rxZ2nRxTHwAZibeapFTM4XlhK3ueg/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>注意：外部表要指定location，因为外部表都是指向有数据目录，当外部表删除的时候，并不影响，复制一张外部表：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbzGzfOs71TxpU97FyialVLBTpfxQVCDeDOY64ESqmy3slMyiceRxsicicBA/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>备注：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="http://mmsns.qpic.cn/mmsns/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbfsEicIdlvq4IFQFykGTGAIw/0" alt="0"></p><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">表分区partition</h3><p>表分区partition，表分区可以加快查询，创建表分区：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbuibN34DZAd78rDSrVwibicVu7qcKsnvwxQPJpDG3yDvSmmiccPgkaVZiaXw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>我们可以把parition当成一个过滤条件。 <br>SELECT * FROM employees默认情况下是非严格模式的，如果有partition，你不加where过滤，也可以执行。但如果是严格模式，你不加where会报错</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbmmAicbqRmRictxVcWLoxDQUY1VQDaTZ7Cu2W5mCW0P7K9Mv8E5Um2wGQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p><strong>查看表分区</strong>：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbE8fgzEV64iaGibibeib9VnOdIrWvjMsicfBS3zZyibROPdTEhLPqHPq425qA/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p><strong>查看特定一个分区：</strong></p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbcygSADsFWfh7WcNa0ypCUPUEeSbde9UImy5HS63qib2r7CwDxtw2nsg/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>从本地文件目录加载数据到内部表中，例如：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbwr7Xy7JVGf8YiaFibBf1FZzIjIqoYibQaBsvV8hj08UWbU3yOvUy5dOUA/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>去掉local：从hdfs上move数据；local：copy本地数据到hive表</p><p>外部表同样可以创建分区表。例如：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbezFRPxONxC6xVEbqWqaBiald3aZibIsj8icL4hWzxgxxMWH1GbkIpH3ew/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>分区表，外部表需要先创建好分区，然后在hdfs拷贝数据到目录下：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbx9ClHh4paJApcGSylfibJLziccf1OPiaDUZpPpfwdxZtYQLIicSGr2ECwA/0?wx_fmt=png" alt="0?wx_fmt=png"></p><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">表删除</h3><p>表删除语句：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbL8VR5TyOwq5Emicibd5HnvibaK47fQBHeUf154AQavod95TeK7J7AtOzQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>注：对于管理表，表的元数据信息和表内的数据都会被删除，对于内部表，表的元数据信息会被删除，但是表中的数据不会被删除。</p><p>表的修改：修改就是针对原数据，大多数修改可以通过ALTER TABLE语句 <br>表重名： ALTER TABLE name RENAME TO new_name <br>增加分区：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbiaBuKz3RFSdGicNbm0qib3hiaGkJDuH0UyAzRqBA8ibAk39JzibXg35Teiaaw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>修改分区：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbKCbQo1WRTacjva5tibabgia6Z0jOOgo99YGfibWyLfelHicibZfsEfo1B8A/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>删除分区：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbDWRjxvWrjibPQ97sEKNcHibQiaibRI3QDjaJONMdZmS4iaSd9AkqickuOlOQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>修改表列：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbMrKq2FXVgC1PotPsMg4SRG19DDSZZDeK22n5UF4JPxaSQ7OpnMPiclg/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>修改列位置：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbrYyTnVSrLYUSBNUTnwSNgdibWsVbU8LEgdPmwFC5gnRiaWCeDpaoC1qQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>增加列：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulb8icQZG6AdMeSrIBUlCByrZH6RHGrKEv0gpibH6ZBX2pO7eChFYWfnAkQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>删除列：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbpwzmPCQ9fUKhzOUgnia0t4n7FpxOic5Kjm1RExbhIUZ6AkOxdPqpt7dA/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>修改存储属性：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulb84HZ99uaN2VSAUflo6lnCrcaD3ghiayWKXUSZGbptGuibc3qaMmrFExg/0?wx_fmt=png" alt="0?wx_fmt=png"></p><h2 style="font-family:inherit;line-height:1.1;color:inherit;font-size:2.15em;">数据操作</h2><p>表的数据加载，动态分区，数据导出</p><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">表的数据加载</h3><p>向内部表加载数据，因为hive没有行级插入更新和事务。 <br><strong>第一种</strong>方法只能整个文件copy到表目录下：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbcKRto7LQjiads8cWkmjnPFh6TEicbSjD6ogjr0hFmNO0FvShr3XzfYdw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>overwrite：覆盖；去掉overwrite：新增。</p><p><strong>第二种</strong>方法是通过查询语句插入到新表： <br><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulb9QuwxEOgX1ibLgA5zKwKklTglXkEkvwnSRhcibSfJOYYw6GQuYxRyanQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p><strong>第三种</strong>加载数据方法：load ，select，hdfs命令。 <br>hive插入到分区表的时候可以用动态分区：默认情况下动态分区没有开启，需要我们手动配置开启，例如：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbV9M3X5ngmibQjgYyicwcm9iaRhxB5fM71kSnxfjC9LzVuuqXbj3bNsAFQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">动态分区</h3><p>开启动态分区，然后按照非严格模式执行，非严格模式时可以没有静态分区。 <br>注意：如果有静态分区，一定在动态分区前面。</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbiay1BQqmnxGjfTQossSuegzUdEia1pUlINWBEhiaMom8n06ceMZSk0PTA/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>动态分区例子：它是按照后两位来动态分区的。</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbNcKvGcQiazUebKHLhRSl60rmTXS9HgEJLLBRF8LVaLZibTLv1xRNmMEQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>单个查询语句中创建表并加载数据：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbVDQAtj1CLVDh3OmaI9KmAxaWvhv4nFRoGZa7Px3WNP9aIYZKOEslHw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">导出数据</h3><p>导出数据：有两种方法。 <br>第一种用hdfs命令，直接拷贝到本地目录</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbAaOqzfCAb6nibiag6ctbzW7sZ5yROwlHfYvMGXnuKKFfrAo92PkibibLyA/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>第二种就是用sql来导出数据：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbhib5YPwD1sL9IU30dzmZV9kgNVFaRcSkroia0icuBX5pMaQGI8UbfSiasw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><h2 style="font-family:inherit;line-height:1.1;color:inherit;font-size:2.15em;">数据查询</h2><p>select * from name 都用过在hive中from name a select a.* 这样子写也是对的。</p><p>查询的时候集合显示与使用：</p><p>查询数组</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbrmtCdj7gtsMicNEuvx4vnI6Ww6v2gJHQ6GZhrEevp4XiamVvZ7ejnplw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>查询map：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbaKAmtJrMNEzLjIUo80iaTdVx7Z1duwxuzzricBb55kK0ljV5Aia1SJYjw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>查询struct：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulb70H6rodtsobZP5ib3Gy7jpXnoicWficHwzzYnk3QetU2QYd6qDm2TwFHQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>数组类型使用：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbLdCzL4pEce895ickCsoS4WN5hWE5RaW5IqCqMREWUSCAFeUNlfttia8g/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>map类型使用：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbSyujD3kFpz7mVHcu5ZQicj6lXnRbMKsI2iaIYyIdOd5JpYVLUogRbUEg/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>struct类型使用：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulb8IwMqI2YfzK2UZ6DYjxKxVJaoiaxbS5JlGzZQEtS0ueBibT8vRrQUVsQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>这里我们可以使用.*来匹配列：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbhEXCSEDtWVlJXH1geNibK9icy1ZfxSCeVjPHCxDWWnSF99dPo7T0iaZ7g/0?wx_fmt=png" alt="0?wx_fmt=png"></p><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">hive的函数</h3><p>hive的函数：</p><ul class="list-paddingleft-2"><li><p>内置函数</p></li><li><p>数学函数（窗口函数）</p></li><li><p>聚合函数</p></li><li><p>表函数</p></li></ul><p>对于不同的函数，我们可以自定义。</p><p>总结上面的函数可以分为三大类：</p><ul class="list-paddingleft-2"><li><p>内置函数，数学函数都是一列一个值</p></li><li><p>聚合函数都是多列一个值</p></li><li><p>表函数是一列多个值比如处理集合列</p></li></ul><p>所以我们可以自定义三种函数类型。hive的函数操作符：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbWaQXWc7RM4BXUJFYDcYbvfPsPhZDAxRFgWVn8QfDrWFBs2BfhJNSAw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><h4 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.25em;">数学函数</h4><p>一个列返回一个值，例如：round（）</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbmcQNfy2bHiclYwat3ABm9YPv9Bpqqf7iaUeI0qfMXvXZeNfWPEtz0n9Q/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>数学函数表：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbIOkFGlRDiaxrK7nldVfxvlvgIKp9RaQRcHIgNvoH5mDY36DNlooKoFg/0?wx_fmt=png" alt="0?wx_fmt=png"><br><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbkktdPkc2N1dPKuxZ2bgF7FOduPlVWcCDI6JB0fBNiaCArUAGZEpJXgg/0?wx_fmt=png" alt="0?wx_fmt=png"><br><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbDiariaia6iaiatybRII0gL5VSyTXuGz0b3uuMd0vajfa0NmK6PHibYYwk6LQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><h4 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.25em;">聚合函数</h4><p>针对的是多列多行求一个值，如：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbrHA198FbhSO2uVg1204TRvoFBIcAqniavXT9QmHCowd5RJhUayrHHwA/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>聚合函数的表： <br><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbXjaTiaD7VdNicyvdEIzIOzpoicQibHAtcCvQhb6TwiasuXxxLMEicOmn9sVQ/0?wx_fmt=png" alt="0?wx_fmt=png"><br><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulblbenMRvDucozgMYl92hXz5h7TYibZjgNRAkOSos7KIJw3rUPZic53tFg/0?wx_fmt=png" alt="0?wx_fmt=png"></p><h4 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.25em;">表生成函数</h4><p>一个集合类型生成多行多列，例如：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbGMW5QqXTia3cGEQMMlddyZdMib1JSbk5N1MW9uQmyLKKoy4pTLibpKv9w/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>表生成函数的表：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbEl8auG8tABbkPRuDkMxWISMTiavZUZG0whFoUia9bqgxS13MdkDD0s3g/0?wx_fmt=png" alt="0?wx_fmt=png"></p><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">避免不必要的mr程序：最好开启本地模式，例如：</h3><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbDgeXZPRyEicXVZ7of3aCSY0iaicGN3wvgCJGfSmEu3YOx42A8CcyiaQlvg/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>select * from name 是不会走mr程序的，如果是分区表，条件是分区条件也不走mr程序。例如：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbgcHwxfibEAZ3Uvlq55AkNtKIrYSDPQlUPOq9o6GQaMYS854kiaASvCPQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><h2 style="font-family:inherit;line-height:1.1;color:inherit;font-size:2.15em;">where查询</h2><p>例如：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbgnobE6Njo8ibhD8ONiaLN07pD4cpKl63rJkYdXJniaooPUB6WeP8M2OicQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>where后面的操作符：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulblCUppurU3e67YsdLXyup64o547NSHz0nxXS7Vgp56SM7OIHdufceNA/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>like和rlike（hive独有rlike），其中like：模糊查询；rlike：通过java正则表达式指定条件。例如：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbFR6JticaCibhzz5wmXQWG09a6uoIhIW5wSPuic928aZFWfxfOjWicDx7WQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>关键字rlike后面的字符串表达式如下定义： <br>字符串中的点号（.）表示和热议的字符匹配，星号(*)表示重复‘左边的字符串零次到无数次，表达式（x|y）’表示和x或者y匹配。</p><p>group by：和聚合函数配合使用，并且可以用having做分组结果过滤。</p><h2 style="font-family:inherit;line-height:1.1;color:inherit;font-size:2.15em;">JOIN</h2><p>join：分为内连接、外连接、全连接，hive中一定要用on做连接过滤，如果用where做匹配连接容易出现笛卡尔积，导致执行很慢。</p><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">内连接</h3><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbQNqPicFyibRSaSdTkKVwqB6u0KbDUt2WtqibgMgWRROXiaQuu487BpiaStQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">join优化</h3><p>hive查询的执行顺序是从左到右，一般是把左表缓存到共享缓存中，在map中做join加快执行速度，需要设置：hive.auto.convert.join=true <br>默认大小： <br>hive.mapjoin.smalltable.filesize=25000000</p><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">外连接和全连接</h3><p>外连接分为left join和right join，与其他数据库基本一致。</p><p>全连接是两张表的记录都输出。</p><p>hive有两个特殊连接：左半开连接，map端连接。</p><h4 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.25em;">左半开连接：输出左表记录，在右表已经存在的</h4><p>例如：平常的sql <br><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulb0SDRYQa5LWkgAXEgJOs6Bv44ITaksdQoyDaPysxgEVneEm0iccwL3SA/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>hive只能用左半开实现</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbBDFczMRicKiaY59dK4ia97vc88KM85HoDQcIrfvDMsicO1WAFQG9ff30Jg/0?wx_fmt=png" alt="0?wx_fmt=png"></p><h2 style="font-family:inherit;line-height:1.1;color:inherit;font-size:2.15em;">排序</h2><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">order by和sort by</h3><p>order by：排序，order by是对<strong>全表排序</strong>效率比较慢，也就是最后结果是一个reducer执行。</p><p>sort by：只会在每个reducer中对数据进行排序，执行一个<strong>局部</strong>排序过程，这样可以保证每个reducer的输出都是有序的，但是并非全局有序。如果需求没有必要全部排序，可以用sort by局部排序。sort by 多个reducer输出需要设置reducer个数：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbsbbnQlnKdvHpRKkpccanJEbyxdjjtJ5gwEZFM8iadZR7HNemZjn3GFA/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>一般用sort by加上distribute by，可以保证全局有序。例如：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbdekOFajOULWHvMOQky2bibViaHNsY8SiaQGUGEsAmuLEAhq9jztHhdtng/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>如果只对一个列这样排序，可以简写cluster by:cluster by代替了distribute by和sort by 对一个列排序组合。</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbvfpdhLNuXQD2C7RQbd3oqYpk3xHTicFaiaLLoIzZPc32eibM4Bjp23cFQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>注意：distribute by和sort by 或者cluster by会剥夺sort by 的并行性，这样实现输出文件全局有序。</p><h2 style="font-family:inherit;line-height:1.1;color:inherit;font-size:2.15em;">视图</h2><p>hive可以创建视图，视图只是保存sql语句并不在hdfs上创建目录，例如：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbrDiaXczgrSqyLxSyGZJ6OBicreLKvib6w46vTia9diasRhbIfpTLvZJ3hzg/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>可以用if not exists 做视图是否存在判断，例如：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulb1GvSk8LHtevtlUHItZuxyspjdib6wT6brWAH6U3FF4Rm8KibzH11TaQA/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>注意： <br>查询视图的时候先执行视图，视图后面跟的sql语句真实select，当语句为select * from view时，此时使用视图和使用表是一样的，删除视图：drop view if exists shipments。 <br>查看视图：show tables（没有show views 语句）</p><h2 style="font-family:inherit;line-height:1.1;color:inherit;font-size:2.15em;">桶</h2><p>创建分区的时候创建的太多分区目录，这对hdfs压力很大，这个时候需要做桶，实际桶比分区查询速度快;</p><p><strong>概念</strong>：桶表是对数据进行哈希取值，然后放到不同文件中存储。数据加载到桶表时，会对字段取hash值，然后与桶的数量取模。把数据放到对应的文件中。 <br>物理上，每个桶就是表（或分区）目录里的一个文件，一个作业产生的桶（输出文件）和reduce任务个数相同</p><p><strong>作用：</strong>桶表专门用于抽样查询，是很专业性的，需要抽样查询时，才创建和使用桶表。</p><p><strong>优势：</strong>桶比分区查询效率要高，分桶就是把大表拆成小表过程，然后可以进行map端执行，并且分桶是默认排序的。</p><p>例子： <br>比如你的分区是2017,2017里面有一年的数据一个大文件大小为100g，做查询join的时候可以做map端join，map端join需要默认是25M，可以结合着分区，在分区里面做分桶，也就是把那大文件分成一块一块小文件。 <br>创建带桶的表：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbXiblBXQduTZicIO185OQU4BXmXDy5GabjQmSyWA8BD8JEiaJbHJQcrAYw/0?wx_fmt=png" alt="0?wx_fmt=png"><br>上图表示创建四个桶，桶是要指定的，首先开启使用桶：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbf0kGT07CkEKsRLpWkXNyPeDD03IVrq6DAkDn7icARWDZbmOc4BWY9jQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>向桶里面插入数据：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbxAy7T8eJtIiaWbtxjpo1ibrJJgg5hFW70lw8ciapibkKlRJLnicrQicCvdKA/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>一般情况下分区和桶都是配合使用的，分桶是相对分区进行更细粒度的划分。分桶将整个数据内容安装某列属性值得到hash值进行分区，如果安装name属性分为3个桶，就是对name属性值的hash值对3取模，按照取模结果对数据分桶。例如：取模结果为0的数据记录存放到一个文件，取模为1的数据存放到一个文件……</p><p>注意:</p><ul class="list-paddingleft-2"><li><p>第一，分桶之前要执行hive.enforce.bucketiong=true</p></li><li><p>第二，要使用关键字clustered by指定分区依据的列名，还要指定分为多少桶，这里指定分为3个桶。</p></li><li><p>第三，与分区不同的是，分区依据不是真实数据表文件中的列，而是我们指定的伪列，但是分桶是依据数据表中真实的列而不是伪列。所以在指定分区依据的列的时候要指定列的类型，因为在数据表文件中不存在这个列，相当于新建一个列。而分桶依据的是表中已经存在的列，这个列的数据类型显然是已知的，所以不需要指定列的类型。 <br>如何使用分桶查询：</p></li></ul><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbkNyGOS8acm4CBicakTLfhPPiauJYTw4f46yPlNic3yxBJ2bwRIXZDjKXw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>要指定关键字tablesample。用桶查询数据tablesample（bucket下标从1开始out of到第3个桶on 你之前指定分桶字段）</p><hr style="border-right:0px;border-bottom:0px;border-left:0px;border-top-style:solid;border-top-color:rgba(128,128,128,.1);"><h1 style="font-size:2.6em;font-family:inherit;line-height:1.1;color:inherit;">三.HiveQL：索引</h1><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">创建索引</h3><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">使用索引</h3><hr style="border-right:0px;border-bottom:0px;border-left:0px;border-top-style:solid;border-top-color:rgba(128,128,128,.1);"><p>Hive支持索引，但是Hive的索引与关系型数据库中的索引并不相同。比如，Hive不支持逐渐或者外检。Hive索引比较麻烦，而且有些文件格式不支持，所以不常用，但是他缺失提高查询速度。</p><p>Hive索引目的是提高Hive表指定列的查询速度。没有索引时，类似“WHERE tab1.col1=10”的查询，Hive会加重整张表或分区，然后处理所有的rows，但是如果在字段col1上面存在索引时，那么只会加载和处理文件的一部分。与其他传统数据库一样，增加索引在提升查询速度时，会消耗额外资源去创建索引和需要更多的磁盘空间存储索引。Hive 0.7.0版本中，加入了索引。Hive 0.8.0版本中增加了bitmap索引。</p><h2 style="font-family:inherit;line-height:1.1;color:inherit;font-size:2.15em;">创建索引</h2><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbSKgqwFO0dR1n1wdXZZA0usN5gBKLyap31dnBJgdnraEEDjibBpAfib8g/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>with defered rebuild 延迟重建，创建的时候并不赋值，后面通过： <br><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbhEGDWibOltyuDW15jDTbxicq5RfiauxTg3b6xdrhyx8zIr2QNPpyOHRjg/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>hive的索引就是根据给定字段，放到一个新的索引表里面，保存表名，字段名和文件路径。</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbbibGtTU5SgXbUkxibA2fgeiagMlWicGYOKjx2IXYm6Swj6Yyp0hj1lQGEw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>左边是你自己表，右边是生成的索引表，索引表中key：原表中key字段的值。</p><p>_bucketname：代表数据文件对于的HDFS文件路径， <br>_offsets：代表该key值在文件中的偏移量。可能有多个偏移量。所以字段类型为数组。所以利用索引可以直接定位到你想要的数据文件，不会扫描全表。</p><h2 style="font-family:inherit;line-height:1.1;color:inherit;font-size:2.15em;">使用索引</h2><p>使用索引，首先设置</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbAHyngTPkkib8sl94tCPEvBxFE8SqQhPiabtUQPCk6MzEHw8NL7VsNaNQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>然后查询：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbldiafyib2FWwRjGCCH0oRRrN6ddJXvuCtibficLQ9msyicO5EicI5PIhRYpw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>注意</p><ul class="list-paddingleft-2"><li><p>每次查询时候都要先用一个job扫描索引表，如果索引列的值非常稀疏，那么索引表本身也会非常大；</p></li><li><p>索引表不会自动rebuild，如果报有数据新增或删除，那么必须手动rebuild索引表数据。</p></li></ul><p>查询索引列</p><ol class="list-paddingleft-2"><li><p>首先扫描索引表知道列名对应值，然后知道对应文件路径，直接去加载文件，省去扫描全部表。加快查询速度</p></li><li><p>根据值直接插到路径，然后去加载对应文件就可以了</p></li></ol><hr style="border-right:0px;border-bottom:0px;border-left:0px;border-top-style:solid;border-top-color:rgba(128,128,128,.1);"><h1 style="font-size:2.6em;font-family:inherit;line-height:1.1;color:inherit;">四.Hive优化</h1><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">常见优化</h3><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">hive数据倾斜</h3><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">Hive压缩</h3><hr style="border-right:0px;border-bottom:0px;border-left:0px;border-top-style:solid;border-top-color:rgba(128,128,128,.1);"><h2 style="font-family:inherit;line-height:1.1;color:inherit;font-size:2.15em;">常见优化</h2><ul class="list-paddingleft-2"><li><p>explain关键字： <br>hive优化实际上是hadoop的map reduce优化，首先我们需要知道一条sql语句执行了哪几个步骤，hive和传统关系数据库一样也有个执行计划，用explain关键字可以卡到完整的执行步骤。</p></li><li><p>本地模式 <br>当输入数据小于250M时候没人不调用mapreduce，直接在本地机器执行计算。 <br>hive.exec.mode.local.auto=true</p></li><li><p>并行模式 <br>执行一条sql的时候分成步骤，有时候不是关联的，这种情况下可以并行执行。 <br>开启：hive.exec.parallel=true，这个默认是关闭的。</p></li><li><p>严格模式 <br>hive默认情况下是不严格模式。严格模式是对sql执行有要求。</p><ul style="list-style-type:square;" class="list-paddingleft-2"><li><p>对于表分区查询的时候必须where不分区字段，必须指定表分区限制</p></li><li><p>order by必须加limit限制</p></li><li><p>join的时候必须用on 关联，不能用where关联，用where会进行笛卡尔积</p></li></ul></li><li><p>调整map和reduce个数</p></li><li><p>jvm重用 <br>在hadoop2中是uber模式</p></li><li><p>推测执行 <br>最好关掉。默认是开启</p></li><li><p>join优化：如果有小表，我们开启join优化，可以进行map端join。hive.auto.convert.join=ture，小表放在左边。</p></li></ul><h2 style="font-family:inherit;line-height:1.1;color:inherit;font-size:2.15em;">hive数据倾斜</h2><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbMf6nWLw9t7afqlgibyqK7hM8tkRGdr4wQIRUibqibYc2aXwowkibA32SlQ/0?wx_fmt=png" alt="0?wx_fmt=png"></p><h2 style="font-family:inherit;line-height:1.1;color:inherit;font-size:2.15em;">Hive压缩</h2><p>查看现有压缩包有哪几种</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbWVDRCNicd59Hfk0z3a37FiaRYx0DOV63HQIpNwaBKy6WRNSx0lmic4Giaw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>这里显示了四种：gzip,bzip,默认，snappy。最好的压缩格式是snappy，空间时间比较均衡，hive的压缩和hadoop是一样，有中间压缩和输出压缩。</p><p>压缩优点：减少空间 <br>压缩缺点：不能分割和消耗cpu。如果想分割根据大小文件来压缩。</p><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">中间压缩</h3><p>hive的中间压缩的设置：可以在hive中设置，也可以在hadoop中设置，如果hadoop设置了hive就不需要设置了。</p><p>我们来看在hive开启中间压缩hive-site.xml</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulb4wpHnQ6EccKF7wpAib3UzDmNO3icUrMhdwTjLp5Lb1QKtQEtrQPP7A9Q/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>开启以后如果不选择压缩格式就是没人压缩，一般情况下我们都要选择压缩格式。 <br>如果hadoop里面配置了，就不需要再配置了。配置如下：hive-site.xml</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbJLBnyfiaV7Oar5WYVhqyK57OBH04bmvwiapqxsziaRbMYwiaKtAUPC6xkw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>这些配置也可以在执行sql的时候配置：配置hive环境变量用set <br>例如：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbC5lk1mX20g32Xquj2PJ9iaG9q7zibQ30CQuemu2Fsmcz1uEKmzWwKuDA/0?wx_fmt=png" alt="0?wx_fmt=png"></p><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">输出结果压缩</h3><p>hive和hadoop一样都可以对输出结果进行压缩，如果hadoop设置了hive就不用设置了，如果没有，可以用hive进行设置，在hive-site.xml中添加：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbhV7DVGjib7HN5dA0kibjVYf5Z0KicibWiau03pDWuVDnz2Y7ibgtmuC7uQSw/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>这是在配置文件中添加，我们也可以在执行语句的时候添加：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbFicWWtUxHq2ZZe5dAbJHXzOnLz0LCJr1uOkDCQTTxeiadia3VolBiaAIxg/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>直接在执行的set对这两个变量进行赋值，这种方法只对这个对话有效，配置文件对整个hive有效，如果设置hadoop中所有使用hadoop引擎的都有效。</p><p>hadoop内置的一种为了压缩可分割的文件格式是：sequence文件</p><p>用sequence文件我们可以指定压缩方法，比如按照行来压缩，按照block来压缩。</p><p>hadoop中可以设置的，hive的配置文件设置是：</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulbYW7ZvfBrhiaibq0uxHfqNQkjCJpIYjCUJBH3L8ib36bic4o972wvPo6CvA/0?wx_fmt=png" alt="0?wx_fmt=png"></p><p>按照block压缩也就是128压缩一次，这个同样可以用set执行语句的时候设置</p><p><img title="" style="border-width:0px;vertical-align:middle;" src="https://ss.csdn.net/p?http://mmbiz.qpic.cn/mmbiz_png/jRyFtu7a2jOdLF8LtarATRZPG0yTOulb3ec9AA3QLmyzfSKFa43EGSq7XKXEyibVyiaWTuR603RarOHZWWmqicByA/0?wx_fmt=png" alt="0?wx_fmt=png"></p><h3 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.7em;">parquet</h3><p>现在有一种比较好的文件格式parquet，hadoop本身不支持，需要额外jar包。</p><p>Parquet是面向分析型业务的列式存储格式。</p><h4 style="font-family:inherit;line-height:1.1;color:inherit;font-size:1.25em;">列式存储</h4><p>列式存储和行式存储相比有哪些优势：</p><ul class="list-paddingleft-2"><li><p>可以通过不符合条件的数据，只读取需要的数据，降低IO数据量</p></li><li><p>压缩编码可以降低磁盘存储空间，由于同一列的数据类型是一样的，可以使用更高效的压缩编码。进一步节约存储空间。</p></li><li><p>只读取需要的列，支持向量运算，能够获取更好的扫描性能。</p></li></ul><p><br></p><p><br></p><hr><p><br></p><p>大数据总结系列文章：</p><p><a href="http://mp.weixin.qq.com/s?__biz=MzI4NjcyNDk0NQ==&amp;mid=2247483765&amp;idx=1&amp;sn=5689004c4e208293930297e336914117&amp;chksm=ebd9c74bdcae4e5ddda29731e96e0232e431ed8076eb5a252cf451d8979751a9cf24ecf574a7&amp;scene=21#wechat_redirect" rel="nofollow">Hadoop知识点整理</a><br></p><p><a href="http://mp.weixin.qq.com/s?__biz=MzI4NjcyNDk0NQ==&amp;mid=2247483952&amp;idx=1&amp;sn=18adf0f3bc042b1ab5a6db5b9129d2c6&amp;chksm=ebd9c40edcae4d18794227b4ece97d3633dd6848c8ad5987a3ef680dfca79a920e6a821b18fb&amp;scene=21#wechat_redirect" rel="nofollow">Zookeeper知识点总结</a><br></p><p><br></p><hr><p><br></p><p style="min-height:1em;color:rgb(62,62,62);font-size:16px;background-color:rgb(255,255,255);">大数据学习交流QQ群：374038693</p><p style="min-height:1em;color:rgb(62,62,62);font-size:16px;background-color:rgb(255,255,255);">更多关于hadoop，spark和机器学习，数据结构与算法文章请关注本文公众号：</p><p style="min-height:1em;color:rgb(62,62,62);font-size:16px;background-color:rgb(255,255,255);"><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/jRyFtu7a2jMbViaN9dXstpbhpQHG1xLdxD5VurYbuIDjHYgyyoqUsyRE9YVqLrbKyVKAib4x4w947CmlHcOez25w/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></p><p><br></p><p><br></p>
                </div>
              </div>
                </div>