---
layout:     post
title:      宿主机程序访问虚拟机HDFS
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								<div class="article-copyright">
					版权声明：本文为博主原创文章，未经博主允许不得转载。					https://blog.csdn.net/qq_19648191/article/details/54862282				</div>
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<h3>需求</h3>
<p>读取HDFS上的/user/hadoop/input/protocols，并写到windows的E盘下。</p>
<p><br></p>
<h3>软硬件</h3>
<p>CentOS6.7</p>
<p>hadoop2.6.0</p>
<p>IDEA 2016</p>
<p><br></p>
<h3>资源</h3>
<p></p>
<pre><code class="language-plain">[hadoop@name01 hadoop]$ hadoop fs -ls /user/hadoop/input
-rw-r--r--   1 hadoop supergroup       6455 2017-02-03 03:26 /user/hadoop/input/protocols</code></pre><br><p></p>
<h3>测试代码</h3>
<p>这里就不给出详细代码了</p>
<p></p>
<pre><code class="language-java">String outputDir = "e:/protocols";

FileSystem fs = null;
InputStream in = null;
OutputStream out = null;
try {
    //Config and open
    Configuration conf = new Configuration();
    fs = FileSystem.get(URI.create("hdfs://192.168.147.128:9000"), conf);
    in = fs.open(new Path("/user/hadoop/input/protocols"));

    //Read and output
    out = new FileOutputStream(outputDir);
    //读取并写资源到本地
} catch (IOException e) {
    //异常检测
} finally {
    //释放资源
}

System.out.println("Finished.");</code></pre>
<p></p>
<p><br></p>
<h3>可能问题</h3>
<div>（1）无法访问</div>
<p>（2）9000端口Connection refused</p>
<p>（3）50010端口没有更多内容</p>
<p><br></p>
<h3>情况</h3>
<p>（1）在虚拟机上可telnet 9000和50010端口</p>
<p>（2）在宿主机无法telnet成功</p>
<p><br></p>
<h3>分析</h3>
<p>（1）core-site.xml的fs.default.name不用设置localhost，用虚拟机的ip</p>
<p>（2）有可能是虚拟机的防火墙</p>
<p><br></p>
<h3>解决方案（以root用户为例）</h3>
<p>（1）编辑/etc/sysconfig/iptables</p>
<p></p>
<pre><code class="language-plain"># Generated by iptables-save v1.4.7 on Fri Feb  3 10:40:29 2017
*filter
:INPUT ACCEPT [53:4699] #具体参考链接（2）
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [34:4139]

-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT #开放lo接口的所有端口
-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT #开放22端口

-P INPUT DROP #关闭所有的端口

-A INPUT -p tcp -m tcp --dport 50070 -j ACCEPT #开放50070端口，用于访问浏览器namenode
-A INPUT -p tcp -m tcp --dport 50090 -j ACCEPT #secondary namenode，也可以用浏览器进行访问
-A INPUT -p tcp -m tcp --dport 50010 -j ACCEPT #用于访问datanode
-A INPUT -p tcp -m tcp --dport 50075 -j ACCEPT

-A INPUT -p tcp -m tcp --dport 50020 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 8088 -j ACCEPT #用于浏览器访问yarn
-A INPUT -p tcp -m tcp --dport 9000 -j ACCEPT #用于程序访问hdfs

COMMIT
# Completed on Fri Feb  3 10:40:29 2017
~                                                                 </code></pre>
<p></p>
<p><br></p>
<p>（2）重启iptables</p>
<p></p>
<pre><code class="language-plain">service iptables restart</code></pre>
<p></p>
<p><br></p>
<h3>相关链接</h3>
<p>（1）<a href="http://www.sxt.cn/info-5826-u-5660.html" rel="nofollow">http://www.sxt.cn/info-5826-u-5660.html</a><br></p>
<p>（2）<a href="http://www.tuicool.com/articles/B7vMzmI" rel="nofollow">http://www.tuicool.com/articles/B7vMzmI</a></p>
            </div>
                </div>