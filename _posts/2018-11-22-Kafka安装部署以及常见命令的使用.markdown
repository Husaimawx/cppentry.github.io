---
layout:     post
title:      Kafka安装部署以及常见命令的使用
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <p>前面介绍了kafka的基本原理，下面开始搭建kafka集群</p><p></p><h2><strong>1.1 <span style="font-family:'黑体';">环境准备</span></strong></h2><h3><strong>1.1.1 <span style="font-family:'宋体';">集群规划</span></strong></h3><p>hadoop102          					hadoop103             				hadoop104</p><p>      zk                        							zk                              zk</p><p>  kafka                   						kafka                           					kafka</p><h3><strong>1.1.2 jar<span style="font-family:'宋体';">包</span><span style="font-family:'宋体';">下载</span></strong></h3><p><a href="http://kafka.apache.org/downloads.html" rel="nofollow">http://kafka.apache.org/downloads.html</a></p><p>我们这里下载的是kafka_2.11-0.11.0.0.tgz版本</p><p></p><h3><strong>1.1.3 <span style="font-family:'宋体';">虚拟机准备</span></strong></h3><p>1<span style="font-family:'宋体';">）</span><span style="font-family:'宋体';">准备</span>3<span style="font-family:'宋体';">台</span><span style="font-family:'宋体';">虚拟机</span></p><p>2<span style="font-family:'宋体';">）</span><span style="font-family:'宋体';">配置</span>ip<span style="font-family:'宋体';">地址</span></p><p>3<span style="font-family:'宋体';">）</span><span style="font-family:'宋体';">配置主机名称</span></p><p>4<span style="font-family:'宋体';">）</span>3<span style="font-family:'宋体';">台</span><span style="font-family:'宋体';">主机分别关闭防火墙</span></p><p><span style="color:#7030a0;">[root@hadoop102 zhang]# chkconfig iptables off</span></p><p><span style="color:#7030a0;">[root@hadoop103 zhang]# chkconfig iptables off</span></p><p><span style="color:#7030a0;">[root@hadoop104 zhang]# chkconfig iptables off</span></p><h3><strong>1.1.4 <span style="font-family:'宋体';">安装</span><span style="font-family:'Times New Roman';">jdk (</span></strong><span style="font-family:'Times New Roman';font-size:14px;">由于比较简单，这里自行百度安装</span><strong><span style="font-family:'Times New Roman';">)</span></strong></h3><div><h3><strong>1.1.5 <span style="font-family:'宋体';">安装</span>Zookeeper</strong></h3><p>0<span style="font-family:'宋体';">）集群</span><span style="font-family:'宋体';">规划</span></p><p><span style="font-family:'宋体';">在</span>hadoop102<span style="font-family:'宋体';">、</span>hadoop103<span style="font-family:'宋体';">和</span>hadoop104<span style="font-family:'宋体';">三个</span><span style="font-family:'宋体';">节点上部署</span>Zookeeper<span style="font-family:'宋体';">。</span></p><p>1<span style="font-family:'宋体';">）</span><span style="font-family:'宋体';">解压安装</span></p><p><span style="font-family:'宋体';">（</span>1<span style="font-family:'宋体';">）解压</span>zookeeper<span style="font-family:'宋体';">安装</span><span style="font-family:'宋体';">包到</span>/opt/module/<span style="font-family:'宋体';">目录下</span></p><p>	<span style="color:#7030a0;">[zhang@hadoop102 software]$ tar -zxvf zookeeper-3.4.10.tar.gz -C /opt/module/</span></p><p><span style="font-family:'宋体';">（</span>2<span style="font-family:'宋体';">）在</span>/opt/module/zookeeper-3.4.10/<span style="font-family:'宋体';">这个</span><span style="font-family:'宋体';">目录下创建</span>zkData</p><p>	<span style="color:#7030a0;">mkdir -p zkData</span></p><p><span style="font-family:'宋体';">（</span>3<span style="font-family:'宋体';">）重命名</span>/opt/module/zookeeper-3.4.10/conf<span style="font-family:'宋体';">这个</span><span style="font-family:'宋体';">目录下的</span>zoo_sample.cfg<span style="font-family:'宋体';">为</span>zoo.cfg</p><p>	<span style="color:#7030a0;">mv zoo_sample.cfg zoo.cfg</span></p><p>2<span style="font-family:'宋体';">）配置</span>zoo.cfg<span style="font-family:'宋体';">文件</span></p><p>	<span style="font-family:'宋体';">（</span>1<span style="font-family:'宋体';">）具体</span><span style="font-family:'宋体';">配置</span></p><p>	<span style="color:#7030a0;">dataDir=/opt/module/zookeeper-3.4.10/zkData</span></p><p>	<span style="font-family:'宋体';">增加</span><span style="font-family:'宋体';">如下配置</span></p><p>	#######################cluster##########################</p><p>server.2=hadoop102:2888:3888</p><p>server.3=hadoop103:2888:3888</p><p>server.4=hadoop104:2888:3888</p><p><span style="font-family:'宋体';">（</span>2<span style="font-family:'宋体';">）配置参数</span><span style="font-family:'宋体';">解读</span></p><p>Server.A=B:C:D<span style="font-family:'宋体';">。</span></p><p>A<span style="font-family:'宋体';">是一个数字，表示这个是第几号服务器；</span></p><p>B<span style="font-family:'宋体';">是这个服务器的</span><span style="font-family:'Times New Roman';">ip</span><span style="font-family:'宋体';">地址；</span></p><p>C<span style="font-family:'宋体';">是这个服务器与集群中的</span><span style="font-family:'Times New Roman';">Leader</span><span style="font-family:'宋体';">服务器交换信息的端口；</span></p><p>D<span style="font-family:'宋体';">是</span><span style="font-family:'宋体';">万一集群中的</span>Leader<span style="font-family:'宋体';">服务器挂了，需要一个端口来重新进行选举，选出一个新的</span><span style="font-family:'Times New Roman';">Leader</span><span style="font-family:'宋体';">，而这个端口就是用来执行选举时服务器相互通信的端口。</span></p><p><span style="font-family:'宋体';">集群</span><span style="font-family:'宋体';">模式下配置一个文件</span>myid<span style="font-family:'宋体';">，</span><span style="font-family:'宋体';">这个文件在</span>dataDir<span style="font-family:'宋体';">目录</span><span style="font-family:'宋体';">下，这个文件里面有一个数据就是</span>A<span style="font-family:'宋体';">的值，</span><span style="font-family:'Times New Roman';">Zookeeper</span><span style="font-family:'宋体';">启动时读取此文件，拿到里面</span><span style="font-family:'宋体';">的</span><span style="font-family:'宋体';">数据与</span>zoo.cfg<span style="font-family:'宋体';">里面</span><span style="font-family:'宋体';">的配置信息比较从而判断到底是哪个</span>server<span style="font-family:'宋体';">。</span></p><p>3<span style="font-family:'宋体';">）</span><span style="font-family:'宋体';">集群操作</span></p><p><span style="font-family:'宋体';">（</span>1<span style="font-family:'宋体';">）</span><span style="font-family:'宋体';">在</span>/opt/module/zookeeper-3.4.10/zkData<span style="font-family:'宋体';">目录</span><span style="font-family:'宋体';">下创建一个</span>myid<span style="font-family:'宋体';">的文件</span></p><p>	<span style="color:#7030a0;">touch myid</span></p><p><span><span style="font-family:'宋体';">添加</span>myid<span style="font-family:'宋体';">文件，注意一定要在</span><span style="font-family:'Times New Roman';">linux</span><span style="font-family:'宋体';">里面创建</span></span><span><span style="font-family:'宋体';">，</span></span><span><span style="font-family:'宋体';">在</span>notepad++</span><span><span style="font-family:'宋体';">里面</span></span><span><span style="font-family:'宋体';">很可能乱码</span></span></p><p><span style="font-family:'宋体';">（</span>2<span style="font-family:'宋体';">）</span><span style="font-family:'宋体';">编辑</span>myid<span style="font-family:'宋体';">文件</span></p><p>	<span style="color:#7030a0;">vi myid</span></p><p>	<span style="font-family:'宋体';">在</span><span style="font-family:'宋体';">文件中添加</span><span style="font-family:'宋体';">与</span>server<span style="font-family:'宋体';">对</span><span style="font-family:'宋体';">应</span><span style="font-family:'宋体';">的编号：如</span>2</p><p><span style="font-family:'宋体';">（</span>3<span style="font-family:'宋体';">）拷贝</span><span style="font-family:'宋体';">配置好的</span>zookeeper<span style="font-family:'宋体';">到其他机器上</span></p><p><span style="color:#7030a0;">scp -r zookeeper-3.4.10/ </span><a href="mailto:root@hadoop103.atguigu.com:/opt/app/" rel="nofollow"><u><span>root@hadoop103:/opt/app/</span></u></a></p><p><span style="color:#7030a0;">scp -r zookeeper-3.4.10/ </span><a href="mailto:root@hadoop104.atguigu.com:/opt/app/" rel="nofollow"><u><span>root@hadoop104:/opt/app/</span></u></a></p><p>	<span style="font-family:'宋体';">并</span><span style="font-family:'宋体';">分别修改</span>myid<span style="font-family:'宋体';">文件中内容为</span>3<span style="font-family:'宋体';">、</span><span style="font-family:'Times New Roman';">4</span></p><p><span style="font-family:'Times New Roman';"></span></p><p><span style="font-family:'宋体';">（</span>4<span style="font-family:'宋体';">）</span><span style="font-family:'宋体';">分别启动</span>zookeeper</p><p><span style="color:#7030a0;">[root@hadoop102 zookeeper-3.4.10]# bin/zkServer.sh start</span></p><p><span style="color:#7030a0;">[root@hadoop103 zookeeper-3.4.10]# bin/zkServer.sh start</span></p><p><span style="color:#7030a0;">[root@hadoop104 zookeeper-3.4.10]# bin/zkServer.sh start</span></p><p><span style="font-family:'宋体';">（</span>5<span style="font-family:'宋体';">）</span><span style="font-family:'宋体';">查看状态</span></p><p><span style="color:#7030a0;">[root@hadoop102 zookeeper-3.4.10]# bin/zkServer.sh status</span></p><p>JMX enabled by default</p><p>Using config: /opt/module/zookeeper-3.4.10/bin/../conf/zoo.cfg</p><p>Mode: <span>follower</span></p><p><span style="color:#7030a0;">[root@hadoop103 zookeeper-3.4.10]# bin/zkServer.sh status</span></p><p>JMX enabled by default</p><p>Using config: /opt/module/zookeeper-3.4.10/bin/../conf/zoo.cfg</p><p>Mode:<span> leader</span></p><p><span style="color:#7030a0;">[root@hadoop104 zookeeper-3.4.5]# bin/zkServer.sh status</span></p><p>JMX enabled by default</p><p>Using config: /opt/module/zookeeper-3.4.10/bin/../conf/zoo.cfg</p><p>Mode: <span>follower</span></p><h2><strong>2.2 Kafka<span style="font-family:'黑体';">集群部署 </span></strong></h2><p>1<span style="font-family:'宋体';">）</span><span style="font-family:'宋体';">解压安装包</span></p><p><span style="color:#7030a0;">[zhang@hadoop102 software]$ tar -zxvf kafka_2.11-0.11.0.0.tgz -C /opt/module/</span></p><p>2<span style="font-family:'宋体';">）</span><span style="font-family:'宋体';">修改解压后的</span><span style="font-family:'宋体';">文件</span><span style="font-family:'宋体';">名称</span></p><p><span style="color:#7030a0;">[<span style="color:#7030a0;">zhang</span>@hadoop102 module]$ mv kafka_2.11-0.11.0.0/ kafka</span></p><p>3<span style="font-family:'宋体';">）在</span>/opt/module/kafka<span style="font-family:'宋体';">目录下</span><span style="font-family:'宋体';">创建</span>logs<span style="font-family:'宋体';">文件夹</span></p><p><span style="color:#7030a0;">[<span style="color:#7030a0;">zhang</span>@hadoop102 kafka]$ mkdir logs</span></p><p>4<span style="font-family:'宋体';">）</span><span style="font-family:'宋体';">修改配置文件</span></p><p><span style="color:#7030a0;">[<span style="color:#7030a0;">zhang</span>@hadoop102 kafka]$ cd config/</span></p><p><span style="color:#7030a0;">[<span style="color:#7030a0;">zhang</span>@hadoop102 config]$ vi server.properties</span></p><p><span style="font-family:'宋体';">输入以下内容：</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p><span>#</span><span>broker</span><span>的</span><span>全局唯一编号，不能重复</span></p><p><span>broker.id=0</span></p><p><span>#</span><span>是否允许删除<span style="font-family:'Times New Roman';">topic</span></span></p><p><span>delete.topic.enable=true</span></p><p>#<span style="font-family:'宋体';">处理网络请求</span>的线程数量</p><p>num.network.threads=3</p><p>#用来处理磁盘<span style="font-family:'Times New Roman';">IO</span><span style="font-family:'宋体';">的</span>线程数量</p><p>num.io.threads=8</p><p>#发送套接字的缓冲区大小</p><p>socket.send.buffer.bytes=102400</p><p>#<span style="font-family:'宋体';">接收套接字的缓冲区大小</span></p><p>socket.receive.buffer.bytes=102400</p><p>#<span style="font-family:'宋体';">请求套接字的</span>最大缓冲区大小</p><p>socket.request.max.bytes=104857600</p><p><span>#</span><span>kafka<span style="font-family:'宋体';">运行日志存放的路径</span></span></p><p><span>log.dirs=/opt/module/kafka/logs</span></p><p>#topic<span style="font-family:'宋体';">在当前</span><span style="font-family:'Times New Roman';">broker</span><span style="font-family:'宋体';">上的分区个数</span></p><p>num.partitions=1</p><p>#<span style="font-family:'宋体';">用来恢复和清理</span><span style="font-family:'Times New Roman';">data</span><span style="font-family:'宋体';">下数据的线程数量</span></p><p>num.recovery.threads.per.data.dir=1</p><p>#segment<span style="font-family:'宋体';">文件保留的最长时间，超时将被删除</span></p><p>log.retention.hours=168</p><p><span>#<span style="font-family:'宋体';">配置连接</span></span><span>Zookeeper</span><span>集群</span><span>地址</span></p><p><span>zookeeper.connect=hadoop102:2181,hadoop103:2181,hadoop104:2181</span></p></td></tr></tbody></table><p>5<span style="font-family:'宋体';">）配置环境</span><span style="font-family:'宋体';">变量</span></p><p><span style="color:#7030a0;">[</span><span>root</span><span style="color:#7030a0;">@hadoop102 module]# vi /etc/profile</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p>#KAFKA_HOME</p><p>export KAFKA_HOME=/opt/module/kafka</p><p>export PATH=$PATH:$KAFKA_HOME/bin</p></td></tr></tbody></table><p><span style="color:#7030a0;">[</span><span>root</span><span style="color:#7030a0;">@hadoop102 module]# source /etc/profile</span></p><p>6<span style="font-family:'宋体';">）分发安装包</span></p><p><span style="color:#7030a0;">[</span><span>root</span><span style="color:#7030a0;">@hadoop102 etc]# xsync profile</span></p><p><span style="color:#7030a0;">[atguigu@hadoop102 module]$ xsync kafka/</span></p>7<span style="font-family:'宋体';">）分别在</span>hadoop103<span style="font-family:'宋体';">和</span>hadoop104<span style="font-family:'宋体';">上修改</span><span style="font-family:'宋体';">配置文件</span>/opt/module/kafka/config/server.properties<span style="font-family:'宋体';">中</span><span style="font-family:'宋体';">的</span><span>broker.id=1</span><span><span style="font-family:'宋体';">、</span></span><span>broker.id=2</span></div><p></p><p>	<span style="font-family:'宋体';">注</span><span style="font-family:'宋体';">：</span>broker.id<span style="font-family:'宋体';">不得</span><span style="font-family:'宋体';">重复</span></p><p>8<span style="font-family:'宋体';">）</span><span style="font-family:'宋体';">启动集群</span></p><p><span style="font-family:'宋体';">依次在</span>hadoop102<span style="font-family:'宋体';">、</span>hadoop103<span style="font-family:'宋体';">、</span>hadoop104<span style="font-family:'宋体';">节点上启动</span>kafka</p><p><span style="color:#7030a0;">[zhang@hadoop102 kafka]$ bin/kafka-server-start.sh config/server.properties &amp;</span></p><p><span style="color:#7030a0;">[zhang@hadoop103 kafka]$ bin/kafka-server-start.sh config/server.properties &amp;</span></p><p><span style="color:#7030a0;">[zhang@hadoop104 kafka]$ bin/kafka-server-start.sh config/server.properties &amp;</span></p><p>9<span style="font-family:'宋体';">）关闭</span><span style="font-family:'宋体';">集群</span></p><p><span style="color:#7030a0;">[zhang@hadoop102 kafka]$ bin/kafka-server-stop.sh stop</span></p><p><span style="color:#7030a0;">[zhang@hadoop103 kafka]$ bin/kafka-server-stop.sh stop</span></p><p><span style="color:#7030a0;">[zhang@hadoop104 kafka]$ bin/kafka-server-stop.sh stop</span></p><p><span style="color:#7030a0;"></span></p><h2><strong>1.3 Kafka<span style="font-family:'黑体';">命令行操作</span></strong></h2><p>1<span style="font-family:'宋体';">）查看当前服务器中的所有</span><span style="font-family:Calibri;">topic</span></p><p><span style="color:#7030a0;">[zhang@hadoop102 kafka]$ bin/kafka-topics.sh --zookeeper hadoop102:2181 --</span><span>list</span></p><p>2<span style="font-family:'宋体';">）创建</span><span style="font-family:Calibri;">topic</span></p><p><span style="color:#7030a0;">[<span style="color:#7030a0;"><span style="color:#7030a0;">zhang</span></span>@hadoop102 kafka]$ bin/kafka-topics.sh --zookeeper hadoop102:2181 --</span><span>create</span><span style="color:#7030a0;"> --replication-factor 3 --partitions 1 --topic first</span></p><p><span style="font-family:'宋体';">选项</span><span style="font-family:'宋体';">说明：</span></p><p>--topic <span style="font-family:'宋体';">定义</span>topic<span style="font-family:'宋体';">名</span></p><p>--replication-factor  <span style="font-family:'宋体';">定义副本数</span></p><p>--partitions  <span style="font-family:'宋体';">定义分区数</span></p><p>3<span style="font-family:'宋体';">）删除</span><span style="font-family:Calibri;">topic</span></p><p><span style="color:#7030a0;">[<span style="color:#7030a0;"><span style="color:#7030a0;">zhang</span></span>@hadoop102 kafka]$ bin/kafka-topics.sh --zookeeper hadoop102:2181 --</span><span>delete</span><span style="color:#7030a0;"> --topic first</span></p><p><span style="font-family:'宋体';">需要</span>server.properties<span style="font-family:'宋体';">中设置</span><span style="font-family:Calibri;">delete.topic.enable=true</span><span style="font-family:'宋体';">否则只是标记删除或者直接重启。</span></p><p><span style="color:#000000;">4<span style="font-family:'宋体';">）发送消息</span></span></p><p><span style="color:#7030a0;">[<span style="color:#7030a0;"><span style="color:#7030a0;">zhang</span></span>@hadoop102 kafka]$ </span><span>bin/kafka-console-producer.sh</span><span style="color:#7030a0;"> --broker-list hadoop102:9092 --topic first</span></p><p><span style="color:#7030a0;">&gt;hello world</span></p><p><span style="color:#7030a0;">&gt;atguigu  atguigu</span></p><p><span style="color:#000000;">5</span><span style="color:#000000;"><span style="font-family:'宋体';">）消费消息</span></span></p><p><span style="color:#7030a0;">[<span style="color:#7030a0;"><span style="color:#7030a0;">zhang</span></span>@</span><span>hadoop103</span><span style="color:#7030a0;"> kafka]$ </span><span>bin/kafka-console-consumer.sh</span><span style="color:#7030a0;"> --zookeeper hadoop102:2181 --from-beginning --topic first</span></p><p><span style="color:#000000;">--from-beginning</span><span style="color:#000000;"><span style="font-family:'宋体';">：</span></span><span style="color:#000000;"><span style="font-family:'宋体';">会把</span>first<span style="font-family:'宋体';">主题中</span></span><span style="color:#000000;"><span style="font-family:'宋体';">以往</span></span><span style="color:#000000;"><span style="font-family:'宋体';">所有的数据都读取出来。</span></span><span style="color:#000000;"><span style="font-family:'宋体';">根据</span></span><span style="color:#000000;"><span style="font-family:'宋体';">业务场景</span></span><span style="color:#000000;"><span style="font-family:'宋体';">选择</span></span><span style="color:#000000;"><span style="font-family:'宋体';">是否</span></span><span style="color:#000000;"><span style="font-family:'宋体';">增加</span></span><span style="color:#000000;"><span style="font-family:'宋体';">该配置。</span></span></p><p><span style="color:#000000;">6<span style="font-family:'宋体';">）查看某个</span><span style="font-family:Calibri;">Topic</span><span style="font-family:'宋体';">的详情</span></span></p><p><span style="color:#7030a0;">[<span style="color:#7030a0;"><span style="color:#7030a0;">zhang</span></span>@hadoop102 kafka]$</span><span style="color:#7030a0;"> </span><span style="color:#7030a0;">bin/kafka-topics.sh --zookeeper hadoop102:2181 --</span><span>describe</span><span style="color:#7030a0;"> --topic first</span><br></p><span style="color:#000000;"><strong>以上就是kafka集群的部署过程，这里强调一点kafka的broker.id需要与你部署的zookeeper的myid保持一致，能够一一对应，不然，你的kafka集群无法启动</strong></span><br><p><br></p>            </div>
                </div>