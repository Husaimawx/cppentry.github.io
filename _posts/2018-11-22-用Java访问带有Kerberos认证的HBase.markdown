---
layout:     post
title:      用Java访问带有Kerberos认证的HBase
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <div class="article_title" style="color:rgb(0,0,0);font-family:'microsoft yahei';font-size:12px;line-height:normal;"><h1 style="vertical-align:middle;font-size:18px;"><span class="link_title"><a href="http://blog.csdn.net/mm_bit/article/details/51958344" rel="nofollow" style="color:rgb(0,0,0);">用Java访问带有Kerberos认证的HBase</a></span></h1></div><div class="article_manage clearfix" style="border-bottom-style:solid;border-bottom-width:1px;border-bottom-color:rgb(237,237,237);color:rgb(153,153,153);font-size:12px;line-height:22px;font-family:Arial;text-align:right;"><div class="article_l"><span class="link_categories">标签： <a href="http://so.csdn.net/so/search/s.do?q=HBase&amp;t=blog" rel="nofollow" style="color:rgb(200,131,38);">HBase</a> <a href="http://so.csdn.net/so/search/s.do?q=java&amp;t=blog" rel="nofollow" style="color:rgb(200,131,38);">java</a></span></div><div class="article_r"><span class="link_postdate">2016年07月19日 18:26:41</span> <span class="link_view" title="阅读次数" style='background-image:url("../images/skin-type-icon.png");background-position:0px -25px;background-repeat:no-repeat;'>6475人阅读</span> <span class="link_comments" title="评论次数" style='background-image:url("../images/skin-type-icon-yellow.png");background-position:0px -43px;background-repeat:no-repeat;'><a class="btn-pinglun" style="color:rgb(200,131,38);">评论</a>(0)</span> <span class="link_collect csdn-tracking-statistics" style='background-image:url("../images/skin-type-icon-yellow.png");background-position:0px -62px;background-repeat:no-repeat;'><a title="收藏" style="color:rgb(200,131,38);">收藏</a></span> <span class="link_report" style='background-image:url("../images/skin-type-icon-yellow.png");background-position:0px -81px;background-repeat:no-repeat;'><a title="举报" style="color:rgb(200,131,38);">举报</a></span></div></div><div class="category clearfix" style="border-bottom-style:solid;border-bottom-width:1px;border-bottom-color:rgb(237,237,237);color:rgb(0,0,0);font-family:'microsoft yahei';font-size:12px;line-height:normal;"><div class="category_l" style="font-size:14px;color:rgb(51,51,51);width:70px;line-height:28px;"><img src="http://csdnimg.cn/release/phoenix/images/category_icon.jpg" style="border:none;vertical-align:middle;" alt=""> <span style="vertical-align:middle;">分类：</span></div><div class="category_r" style="font-size:14px;color:rgb(223,52,52);">java 基础（48） <img class="arrow-down" src="http://csdnimg.cn/release/phoenix/images/arrow_triangle%20_down.jpg" style="border:none;" alt=""> HBase（26） <img class="arrow-down" src="http://csdnimg.cn/release/phoenix/images/arrow_triangle%20_down.jpg" style="border:none;" alt=""></div></div><div class="bog_copyright" style="color:rgb(0,0,0);font-family:'microsoft yahei';font-size:12px;line-height:normal;"></div><div class="article_content csdn-tracking-statistics" style="font-size:15px;color:rgb(85,85,85);line-height:35px;font-family:'microsoft yahei';"><div class="htmledit_views"><div style="color:rgb(51,51,51);font-size:14px;font-family:sans-serif;"><h2 style="font-size:1.2em;">开始之前</h2></div><div style="color:rgb(51,51,51);font-size:14px;font-family:sans-serif;"><br></div><div style="color:rgb(51,51,51);font-size:14px;font-family:sans-serif;">   因为HBase的存储系统是基于Hadoop的存储，现在Hadoop已经增加了Kerberos认证机制，这样HBase的客户端访问HBase数据库的时候也需要进行身份的认证。</div><div style="color:rgb(51,51,51);font-size:14px;font-family:sans-serif;">   Kerberos是一个认证中心，客户端在访问HBase前必须通过认证才能访问，下图是Kerberos的认证图：</div><div style="color:rgb(51,51,51);font-size:14px;font-family:sans-serif;">  </div><div style="color:rgb(51,51,51);font-size:14px;font-family:sans-serif;"><br></div><div style="color:rgb(51,51,51);font-family:sans-serif;"> 我们不需要详细介绍Kerberos的原理，但是大概流程可以说一下：</div><div style="color:rgb(51,51,51);font-family:sans-serif;"><br></div><div style="color:rgb(51,51,51);font-family:sans-serif;">当HBase客户端访问HBase的时候，首先必须访问KDC获取一个经过授权的票据，以后Client在访问HBase server的时候可以通过这个票据进行访问。</div><div style="color:rgb(51,51,51);font-family:sans-serif;">正常情况下当我们通过HBase客户端访问的时候，都需要进行一次认证的过程，认证过后，KDC返回的票据具有有效期，一般默认是10小时，换句话说在这10个小时内你不需要再次登录KDC进行认证。</div><div style="color:rgb(51,51,51);font-family:sans-serif;"><br></div><div style="color:rgb(51,51,51);font-family:sans-serif;">1，Linux客户端认证方式</div><div style="color:rgb(51,51,51);font-family:sans-serif;"> </div><div style="color:rgb(51,51,51);font-family:sans-serif;"> 如果我们现在处在Linux客户端上想进行HBase Client的Kerberos认证怎么办，我们怎么登录KDC进行认证？  在Linux有一个Kinit可以完成这种认证过程，可以通过kinit之后，传入必要的参数（例如用户名和密码）等就可以认证。 同时Kerberos还提供了另外一种方式就是我们可以通过一个.keytab  文件直接认证，这样我们就不需要记住这些密码了，keytab这个文件从哪来的呢，这也是在配置Hadoop的时候通过一个ktutil工具生成的。我们可以理解成.keytab文件是带有密码的一个文件就可以了，只要拿到这个文件我们就可以在linux机器上运行kinit 完成这个登录认证的过程 (其中hbase.keytab是服务端生成的文件)</div><div style="color:rgb(51,51,51);font-family:sans-serif;"><br></div><div style="color:rgb(51,51,51);font-family:sans-serif;"><span style="font-family:'微软雅黑', 'Microsoft YaHei';line-height:25px;">kinit -k -t /etc/hadoop/conf/hbase.keytab <a href="mailto:hbase/1722.myip.domain@HADOOP.COM" rel="nofollow" style="color:rgb(51,102,153);">hbase/1722.myip.domain@HADOOP.COM</a></span></div><div style="color:rgb(51,51,51);font-family:sans-serif;"><br></div><div style="color:rgb(51,51,51);font-family:sans-serif;">认证完成后我们就可以直接用 hbase shell操作Hbase了</div><div style="color:rgb(51,51,51);font-family:sans-serif;"><br></div><div style="color:rgb(51,51,51);font-family:sans-serif;">2， Java程序认证方式</div><div style="color:rgb(51,51,51);font-family:sans-serif;"><br></div><div style="color:rgb(51,51,51);font-family:sans-serif;">通过Linux kinit 命令我们很容易的完成认证，但是如果要是用Java程序编码怎么完成这种登录认证呢？</div><div style="color:rgb(51,51,51);font-family:sans-serif;"><br></div><div style="color:rgb(51,51,51);font-family:sans-serif;">  2.1 我们把服务器端的 hbase.keytab 文件 copy到 本地一个磁盘，例如 <a style="color:rgb(51,102,153);">c:\</a></div><div style="color:rgb(51,51,51);font-family:sans-serif;">  2.2 我们copy远程集群一个hbase-site.xml文件放到你运行环境的classpath下，这个和正常没有kerberos的HBase访问是一样的</div><div style="color:rgb(51,51,51);font-family:sans-serif;">  2.3 接下来我们需要用到 UserGroupInformation API来进行访问，这个API需要一个参数 principal 和一个你的 keytab 文件，这里文件里面存储的是相关的密码</div><div style="color:rgb(51,51,51);font-family:sans-serif;"><br></div><div style="color:rgb(51,51,51);font-family:sans-serif;">  程序代码实例如下：</div><div style="color:rgb(51,51,51);font-size:14px;font-family:sans-serif;"><br></div><div style="color:rgb(51,51,51);font-size:14px;font-family:sans-serif;">  </div><div style="color:rgb(51,51,51);font-family:'微软雅黑';font-size:14px;"><div align="left"><div align="left"><span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">package</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">com.hbasedemo;</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;color:rgb(1,1,1);"><span style="font-size:10pt;"><br></span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">import</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">java.io.IOException;</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;color:rgb(1,1,1);"><span style="font-size:10pt;"><br></span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">import</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">org.apache.hadoop.conf.Configuration;</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">import</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">org.apache.hadoop.hbase.HBaseConfiguration;</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">import</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">org.apache.hadoop.hbase.KeyValue;</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">import</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">org.apache.hadoop.hbase.client.HTable;</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">import</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">org.apache.hadoop.hbase.client.Result;</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">import</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">org.apache.hadoop.hbase.client.ResultScanner;</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">import</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">org.apache.hadoop.hbase.client.Scan;</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">import</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">org.apache.hadoop.security.UserGroupInformation;</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;color:rgb(1,1,1);"><span style="font-size:10pt;"><br></span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">public</span></span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">class</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">Test {</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">      </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">private</span></span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">static</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">Configuration</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(0,0,192);"><span style="font-size:10pt;"><span>conf</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">=</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">null</span></span></span><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">;</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;color:rgb(1,1,1);"><span style="font-size:10pt;"><br></span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">      </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">static</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">{</span></span></div><div align="left"><span style="font-family:'Courier New';color:rgb(63,127,95);"><br></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(63,127,95);"><span style="font-size:10pt;">// 这个配置文件主要是记录</span> <span style="font-size:10pt;"><span>kerberos</span></span><span style="font-size:10pt;">的相关配置信息，例如KDC是哪个IP？默认的realm是哪个？</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(63,127,95);"><span style="font-size:10pt;">// 如果没有这个配置文件这边认证的时候肯定不知道KDC的路径喽</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(63,127,95);"><span style="font-size:10pt;">// 这个文件也是从远程服务器上copy下来的</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            System.</span> <span style="font-size:10pt;"><span>setProperty</span></span><span style="font-size:10pt;">(</span></span><span style="font-family:'Courier New';font-size:12px;color:rgb(42,0,255);"><span style="font-size:10pt;">"java.security.krb5.conf"</span></span><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">,</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(42,0,255);"><span style="font-size:10pt;">"C:/Users/dongzeguang/Downloads/krb5.conf"</span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">);</span></span></div><div align="left"><span style="font-size:10pt;font-family:'Courier New';">            </span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(0,0,192);"><span style="font-size:10pt;"><span>conf</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">= HBaseConfiguration.</span><span style="font-size:10pt;"><span>create</span></span><span style="font-size:10pt;">();</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(0,0,192);"><span style="font-size:10pt;"><span>conf</span></span></span><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">.set(</span></span><span style="font-family:'Courier New';font-size:12px;color:rgb(42,0,255);"><span style="font-size:10pt;">"hadoop.security.authentication"</span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">,</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(42,0,255);"><span style="font-size:10pt;">"Kerberos"</span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">);</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(63,127,95);"><span style="font-size:10pt;">// 这个hbase.keytab也是从远程服务器上copy下来的, 里面存储的是密码相关信息</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(63,127,95);"><span style="font-size:10pt;">// 这样我们就不需要交互式输入密码了</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(0,0,192);"><span style="font-size:10pt;"><span>conf</span></span></span><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">.set(</span></span><span style="font-family:'Courier New';font-size:12px;color:rgb(42,0,255);"><span style="font-size:10pt;">"keytab.file"</span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">,</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(42,0,255);"><span style="font-size:10pt;">"C:/Users/Downloads/hbase.keytab"</span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">);</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(63,127,95);"><span style="font-size:10pt;">// 这个可以理解成用户名信息，也就是Principal</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(0,0,192);"><span style="font-size:10pt;"><span>conf</span></span></span><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">.set(</span></span><span style="font-family:'Courier New';font-size:12px;color:rgb(42,0,255);"><span style="font-size:10pt;">"kerberos.principal"</span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">,</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(42,0,255);"><span style="font-size:10pt;">"hbase/1722.myip.domain@HADOOP.COM"</span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">);    </span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            conf.set("hbase.master.kerberos.principal",HBASE_MASTER_PRINCIPAL);</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            conf.set("hbase.regionserver.kerberos.principal",HBASE_RS_PRINCIPAL);</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            conf.set("hbase.zookeeper.quorum","xxx.xxx.xxx.xxx");</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            conf.set("hbase.zookeeper.property.clientPort","2181");</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            conf.set("hbase.security.authentication","kerberos");</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;"><br></span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            UserGroupInformation.</span> <span style="font-size:10pt;"><span>setConfiguration</span></span><span style="font-size:10pt;">(</span></span><span style="font-family:'Courier New';font-size:12px;color:rgb(0,0,192);"><span style="font-size:10pt;"><span>conf</span></span></span><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">);</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">try</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">{</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">                  UserGroupInformation.</span> <span style="font-size:10pt;"><span>loginUserFromKeytab</span></span><span style="font-size:10pt;">(</span></span><span style="font-family:'Courier New';font-size:12px;color:rgb(42,0,255);"><span style="font-size:10pt;">"hbase/1722.myip.domain@HADOOP.COM"</span></span><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">,</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(42,0,255);"><span style="font-size:10pt;">"C:/Users/Downloads/hbase.keytab"</span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">);</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            }</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">catch</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">(IOException e) {</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">                  </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(63,127,95);"><span style="font-size:10pt;">//</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,159,191);"><span style="font-size:10pt;"><span style="font-weight:700;">TODO</span></span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(63,127,95);"><span style="font-size:10pt;">Auto-generated catch block</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">                  e.printStackTrace();</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            }</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">      }</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;color:rgb(1,1,1);"><span style="font-size:10pt;"><br></span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">      </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">public</span></span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">static</span></span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">void</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">scanSpan(</span></span><span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">final</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">String tableName)</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">throws</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">Exception {</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            HTable table = </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">new</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">HTable(</span></span><span style="font-family:'Courier New';font-size:12px;color:rgb(0,0,192);"><span style="font-size:10pt;"><span>conf</span></span></span><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">, tableName);</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            System.</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(0,0,192);"><span style="font-size:10pt;"><span>out</span></span></span><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">.println(</span></span><span style="font-family:'Courier New';font-size:12px;color:rgb(42,0,255);"><span style="font-size:10pt;">"tablename:"</span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">+</span></span><span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">new</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">String(table.getTableName()));</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            Scan s =</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">new</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">Scan();</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            ResultScanner rs = table.getScanner(s);</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            </span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">for</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">(Result r : rs) {</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">                  System.</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(0,0,192);"><span style="font-size:10pt;"><span>out</span></span></span><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">.println(r.toString());</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">                  KeyValue[] kv = r.</span> <span style="font-size:10pt;"><span><del>raw</del></span></span><span style="font-size:10pt;"><span>()</span></span><span style="font-size:10pt;">;</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">                  </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">for</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">(</span></span><span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">int</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">i = 0; i &lt; kv.</span></span><span style="font-family:'Courier New';font-size:12px;color:rgb(0,0,192);"><span style="font-size:10pt;">length</span></span><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">; i++) {</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">                        System.</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(0,0,192);"><span style="font-size:10pt;"><span>out</span></span></span><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">.print(</span></span><span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">new</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">String(kv[i].</span><span style="font-size:10pt;"><span><del>getRow</del></span></span><span style="font-size:10pt;"><span>()</span></span><span style="font-size:10pt;">) +</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(42,0,255);"><span style="font-size:10pt;">""</span></span><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">);</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">                        System.</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(0,0,192);"><span style="font-size:10pt;"><span>out</span></span></span><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">.print(</span></span><span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">new</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">String(kv[i].</span><span style="font-size:10pt;"><span><del>getFamily</del></span></span><span style="font-size:10pt;"><span>()</span></span><span style="font-size:10pt;">) +</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(42,0,255);"><span style="font-size:10pt;">":"</span></span><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">);</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">                        System.</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(0,0,192);"><span style="font-size:10pt;"><span>out</span></span></span><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">.print(</span></span><span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">new</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">String(kv[i].</span><span style="font-size:10pt;"><span><del>getQualifier</del></span></span><span style="font-size:10pt;"><span>()</span></span> <span style="font-size:10pt;">) +</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(42,0,255);"><span style="font-size:10pt;">""</span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">);</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">                        System.</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(0,0,192);"><span style="font-size:10pt;"><span>out</span></span></span><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">.print(kv[i].getTimestamp() +</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(42,0,255);"><span style="font-size:10pt;">""</span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">);</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">                        System.</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(0,0,192);"><span style="font-size:10pt;"><span>out</span></span></span><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">.println(</span></span><span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">new</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">String(kv[i].</span><span style="font-size:10pt;"><span><del>getValue</del></span></span><span style="font-size:10pt;"><span>()</span></span> <span style="font-size:10pt;">));</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">                  }</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            }</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;color:rgb(1,1,1);"><span style="font-size:10pt;"><br></span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">      }</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;color:rgb(1,1,1);"><span style="font-size:10pt;"><br></span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">      </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(63,95,191);"><span style="font-size:10pt;">/**</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;color:rgb(63,95,191);"><span style="font-size:10pt;">       *</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,159,191);"><span style="font-size:10pt;"><span style="font-weight:700;">@param</span></span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(63,95,191);"><span style="font-size:10pt;">args</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;color:rgb(63,95,191);"><span style="font-size:10pt;">       */</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">      </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">public</span></span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">static</span></span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">void</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">main(String[] args) {</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(63,127,95);"><span style="font-size:10pt;">//</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,159,191);"><span style="font-size:10pt;"><span style="font-weight:700;">TODO</span></span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(63,127,95);"><span style="font-size:10pt;">Auto-generated method stub</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">try</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">{</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">                  Test.</span> <span style="font-size:10pt;"><span>scanSpan</span></span><span style="font-size:10pt;">(</span></span><span style="font-family:'Courier New';font-size:12px;color:rgb(42,0,255);"><span style="font-size:10pt;">"h_span"</span></span><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">);</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            }</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,0,85);"><span style="font-size:10pt;"><span style="font-weight:700;">catch</span></span></span> <span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">(Exception e) {</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">                  </span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(63,127,95);"><span style="font-size:10pt;">//</span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(127,159,191);"><span style="font-size:10pt;"><span style="font-weight:700;">TODO</span></span></span> <span style="font-family:'Courier New';font-size:12px;color:rgb(63,127,95);"><span style="font-size:10pt;">Auto-generated catch block</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">                  e.printStackTrace();</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">            }</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">      }</span></span></div><div align="left"><span style="font-family:'Courier New';font-size:12px;color:rgb(1,1,1);"><span style="font-size:10pt;"><br></span></span></div><p><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">}</span></span></p><p><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;"><br></span></span></p><p><span style="font-family:'Courier New';font-size:12px;"><span style="font-size:10pt;">转载出处：<a href="http://blog.csdn.net/blackice1015/article/details/49422855" rel="nofollow" style="color:rgb(12,137,207);">http://blog.csdn.net/blackice1015/article/details/49422855</a></span></span></p><div><span style="font-family:'Courier New';font-size:12px;"><br></span></div></div></div></div></div>            </div>
                </div>