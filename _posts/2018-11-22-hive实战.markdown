---
layout:     post
title:      hive实战
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <div id="cnblogs_post_body">
<blockquote>
<p>1. 安装hive</p>
<p>2. hive实战</p>
<p>3. hive存储模型</p>
<p>4. 深入hql查询语言</p>
<p>5. 参考资料及代码下载 </p>
</blockquote>
<h3 style="font-family:verdana, geneva, arial, helvetica, sans-serif;color:#FFFFFF;font-size:15pt;font-weight:bolder;background-color:#808080;">
<strong><span style="font-family:Cambria;">&lt;1&gt;. 安装hive</span>
</strong>
<strong><span style="font-family:Cambria;"> </span>
</strong>
<span class="Apple-style-span" style="font-family:verdana, 'courier new';font-size:14px;color:#000000;font-weight:normal;"><a id="section1" name="section1"></a>
</span>
</h3>
<p>下载hive，下载地址<a href="http://mirror.bjtu.edu.cn/apache/hive/" rel="nofollow">http://mirror.bjtu.edu.cn/apache//hive/</a>
，解压该文件： </p>
<p>xuqiang@ubuntu:~/hadoop/src/hive$ tar zxvf hive-0.7.0-bin.tar.gz </p>
<p>设置环境变量： </p>
<p>xuqiang@ubuntu:~/hadoop/src/hive$ cd hive-0.7.0-bin/ </p>
<p>xuqiang@ubuntu:~/hadoop/src/hive/hive-0.7.0-bin$ export HIVE_HOME=`pwd`</p>
<p>添加HIVE_HOME到环境变量PATH中： </p>
<p>xuqiang@ubuntu:~/hadoop/src/hive$ export PATH=$HIVE_HOME/bin:$PATH; </p>
<p>在运行hive之前，请确保变量HADOOP_HOME已经设置，如果没有设置，可以使用export命令设置该变量。 </p>
<p>然后需要在hdfs上创建如下的目录来保存hive相关的数据。 </p>
<p> </p>
<div class="cnblogs_code">
<div>
<span style="color:#000000;">xuqiang@ubuntu:~</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hadoop</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">src</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hive</span>
<span style="color:#000000;">$</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">$</span>
<span style="color:#000000;">HADOOP_HOME</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">bin</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hadoop fs -</span>
<span style="color:#0000ff;">mkdir</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">tmp<br>
xuqiang@ubuntu:~</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hadoop</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">src</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hive</span>
<span style="color:#000000;">$</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">$</span>
<span style="color:#000000;">HADOOP_HOME</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">bin</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hadoop fs -</span>
<span style="color:#0000ff;">mkdir</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">user</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hive</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">warehouse<br>
xuqiang@ubuntu:~</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hadoop</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">src</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hive</span>
<span style="color:#000000;">$</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">$</span>
<span style="color:#000000;">HADOOP_HOME</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">bin</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hadoop fs -chmod g</span>
<span style="color:#000000;">+</span>
<span style="color:#000000;">w </span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">tmp<br>
xuqiang@ubuntu:~</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hadoop</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">src</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hive</span>
<span style="color:#000000;">$</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">$</span>
<span style="color:#000000;">HADOOP_HOME</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">bin</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hadoop fs -chmod g</span>
<span style="color:#000000;">+</span>
<span style="color:#000000;">w </span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">user</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hive</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">warehouse</span>
</div>
</div>
<p> </p>
<p>此时运行hive的环境已经准备好了，在命令行中键入如下命令开始运行hive： </p>
<p> </p>
<div class="cnblogs_code">
<div>
<span style="color:#000000;">xuqiang@ubuntu:~</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hadoop</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">src</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hive</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hive-</span>
<span style="color:#000000;">0.7</span>
<span style="color:#000000;">.</span>
<span style="color:#000000;">0</span>
<span style="color:#000000;">-bin</span>
<span style="color:#000000;">$</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">$</span>
<span style="color:#000000;">HIVE_HOME</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">bin</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hive</span>
</div>
</div>
<p> </p>
<h3 style="font-family:verdana, geneva, arial, helvetica, sans-serif;color:#FFFFFF;font-size:15pt;font-weight:bolder;background-color:#808080;">
<strong><span style="font-family:Cambria;">&lt;2&gt;. hive实战</span>
</strong>
<strong><span style="font-family:Cambria;"> </span>
</strong>
<span class="Apple-style-span" style="font-family:verdana, 'courier new';font-size:14px;color:#000000;font-weight:normal;"><a></a>
</span>
</h3>
<p>这里我们将完成这样的一个过程，首先创建一个表，从本机上加载数据到该表中，查询该表，得到我们感兴趣的数据。 </p>
<p>首先创建表（具体语法将在下面给出）： </p>
<p> </p>
<div class="cnblogs_code">
<div>
<span style="color:#000000;">hive</span>
<span style="color:#000000;">&gt;</span>
<span style="color:#000000;"> create table cite</span>
<span style="color:#000000;">(</span>
<span style="color:#000000;">citing INT</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;"> cited INT</span>
<span style="color:#000000;">)</span>
<span style="color:#000000;"><br></span>
<span style="color:#000000;">&gt;</span>
<span style="color:#000000;"> row </span>
<span style="color:#0000ff;">format</span>
<span style="color:#000000;"> delimited<br></span>
<span style="color:#000000;">&gt;</span>
<span style="color:#000000;"> fields terminated by '</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;">'<br></span>
<span style="color:#000000;">&gt;</span>
<span style="color:#000000;"> stored as textfile</span>
<span style="color:#000000;">;</span>
</div>
</div>
<p> </p>
<p>创建完表之后，我们可以使用show tables命令查看新建的表： </p>
<p> </p>
<div class="cnblogs_code">
<div>
<span style="color:#000000;">hive</span>
<span style="color:#000000;">&gt;</span>
<span style="color:#000000;"> show tables</span>
<span style="color:#000000;">;</span>
<span style="color:#000000;"><br>
OK<br>
cite<br></span>
<span style="color:#0000ff;">Time</span>
<span style="color:#000000;"> taken: </span>
<span style="color:#000000;">1.257</span>
<span style="color:#000000;"> seconds</span>
</div>
</div>
<p> </p>
<p>查看新建表的结构： </p>
<p> </p>
<div class="cnblogs_code">
<div>
<span style="color:#000000;">hive</span>
<span style="color:#000000;">&gt;</span>
<span style="color:#000000;"> describe cite</span>
<span style="color:#000000;">;</span>
<span style="color:#000000;"><br>
OK<br>
citing int<br>
cited int<br></span>
<span style="color:#0000ff;">Time</span>
<span style="color:#000000;"> taken: </span>
<span style="color:#000000;">0.625</span>
<span style="color:#000000;"> seconds</span>
</div>
</div>
<p> </p>
<p>我们加载本地数据到该表中去： </p>
<p> </p>
<div class="cnblogs_code">
<div>
<span style="color:#000000;">hive</span>
<span style="color:#000000;">&gt;</span>
<span style="color:#000000;"> load data local inpath '</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">home</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">xuqiang</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hadoop</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">data</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">cite75_99</span>
<span style="color:#000000;">.</span>
<span style="color:#000000;">txt'<br></span>
<span style="color:#000000;">&gt;</span>
<span style="color:#000000;"> overwrite into table cite</span>
<span style="color:#000000;">;</span>
<span style="color:#000000;"><br>
Copying data from file:</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">home</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">xuqiang</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hadoop</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">data</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">cite75_99</span>
<span style="color:#000000;">.</span>
<span style="color:#000000;">txt<br>
Copying file: file:</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">home</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">xuqiang</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hadoop</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">data</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">cite75_99</span>
<span style="color:#000000;">.</span>
<span style="color:#000000;">txt<br>
Loading data to table default</span>
<span style="color:#000000;">.</span>
<span style="color:#000000;">cite<br>
Deleted hdfs:</span>
<span style="color:#000000;">//</span>
<span style="color:#000000;">localhost:</span>
<span style="color:#000000;">9000</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">user</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hive</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">warehouse</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">cite<br>
OK<br></span>
<span style="color:#0000ff;">Time</span>
<span style="color:#000000;"> taken: </span>
<span style="color:#000000;">89.766</span>
<span style="color:#000000;"> seconds</span>
</div>
</div>
<p> </p>
<p>查询前10行数据： </p>
<p> </p>
<div class="cnblogs_code">
<div>
<span style="color:#000000;">hive</span>
<span style="color:#000000;">&gt;</span>
<span style="color:#000000;"> </span>
<span style="color:#0000ff;">select</span>
<span style="color:#000000;"> * from cite limit </span>
<span style="color:#000000;">10</span>
<span style="color:#000000;">;</span>
<span style="color:#000000;"><br>
OK<br>
NULL NULL<br></span>
<span style="color:#000000;">3858241</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">956203</span>
<span style="color:#000000;"><br></span>
<span style="color:#000000;">3858241</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">1324234</span>
<span style="color:#000000;"><br></span>
<span style="color:#000000;">3858241</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">3398406</span>
<span style="color:#000000;"><br></span>
<span style="color:#000000;">3858241</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">3557384</span>
<span style="color:#000000;"><br></span>
<span style="color:#000000;">3858241</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">3634889</span>
<span style="color:#000000;"><br></span>
<span style="color:#000000;">3858242</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">1515701</span>
<span style="color:#000000;"><br></span>
<span style="color:#000000;">3858242</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">3319261</span>
<span style="color:#000000;"><br></span>
<span style="color:#000000;">3858242</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">3668705</span>
<span style="color:#000000;"><br></span>
<span style="color:#000000;">3858242</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">3707004</span>
<span style="color:#000000;"><br></span>
<span style="color:#0000ff;">Time</span>
<span style="color:#000000;"> taken: </span>
<span style="color:#000000;">0.778</span>
<span style="color:#000000;"> seconds</span>
</div>
</div>
<p> </p>
<p>查询该文件中存在多少条数据，这时hive将执行一个map-reduce的过程来计算该值： </p>
<p> </p>
<div class="cnblogs_code">
<div>
<span style="color:#000000;">hive</span>
<span style="color:#000000;">&gt;</span>
<span style="color:#000000;"> </span>
<span style="color:#0000ff;">select</span>
<span style="color:#000000;"> count</span>
<span style="color:#000000;">(</span>
<span style="color:#000000;">1</span>
<span style="color:#000000;">)</span>
<span style="color:#000000;"> from cite</span>
<span style="color:#000000;">;</span>
<span style="color:#000000;"><br>
Total MapReduce jobs </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">1</span>
<span style="color:#000000;"><br>
Launching Job </span>
<span style="color:#000000;">1</span>
<span style="color:#000000;"> out of </span>
<span style="color:#000000;">1</span>
<span style="color:#000000;"><br>
Number of reduce tasks determined at compile </span>
<span style="color:#0000ff;">time</span>
<span style="color:#000000;">: </span>
<span style="color:#000000;">1</span>
<span style="color:#000000;"><br>
In order to change the average load </span>
<span style="color:#0000ff;">for</span>
<span style="color:#000000;"> a reducer </span>
<span style="color:#000000;">(</span>
<span style="color:#000000;">in bytes</span>
<span style="color:#000000;">)</span>
<span style="color:#000000;">:<br></span>
<span style="color:#0000ff;">set</span>
<span style="color:#000000;"> hive</span>
<span style="color:#000000;">.</span>
<span style="color:#000000;">exec</span>
<span style="color:#000000;">.</span>
<span style="color:#000000;">reducers</span>
<span style="color:#000000;">.</span>
<span style="color:#000000;">bytes</span>
<span style="color:#000000;">.</span>
<span style="color:#000000;">per</span>
<span style="color:#000000;">.</span>
<span style="color:#000000;">reducer</span>
<span style="color:#000000;">=&lt;</span>
<span style="color:#000000;">number</span>
<span style="color:#000000;">&gt;</span>
<span style="color:#000000;"><br>
In order to limit the maximum number of reducers:<br></span>
<span style="color:#0000ff;">set</span>
<span style="color:#000000;"> hive</span>
<span style="color:#000000;">.</span>
<span style="color:#000000;">exec</span>
<span style="color:#000000;">.</span>
<span style="color:#000000;">reducers</span>
<span style="color:#000000;">.</span>
<span style="color:#000000;">max</span>
<span style="color:#000000;">=&lt;</span>
<span style="color:#000000;">number</span>
<span style="color:#000000;">&gt;</span>
<span style="color:#000000;"><br>
In order to </span>
<span style="color:#0000ff;">set</span>
<span style="color:#000000;"> a constant number of reducers:<br></span>
<span style="color:#0000ff;">set</span>
<span style="color:#000000;"> mapred</span>
<span style="color:#000000;">.</span>
<span style="color:#000000;">reduce</span>
<span style="color:#000000;">.</span>
<span style="color:#000000;">tasks</span>
<span style="color:#000000;">=&lt;</span>
<span style="color:#000000;">number</span>
<span style="color:#000000;">&gt;</span>
<span style="color:#000000;"><br>
Starting Job </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> job_201106150005_0004</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;"> Tracking URL </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> http:</span>
<span style="color:#000000;">//</span>
<span style="color:#000000;">localhost:</span>
<span style="color:#000000;">50030</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">jobdetails</span>
<span style="color:#000000;">.</span>
<span style="color:#000000;">jsp?jobid</span>
<span style="color:#000000;">=</span>
<span style="color:#000000;">job_201106150005_0004<br>
Kill </span>
<span style="color:#0000ff;">Command</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">home</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">xuqiang</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hadoop</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">src</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hadoop-</span>
<span style="color:#000000;">0.20</span>
<span style="color:#000000;">.</span>
<span style="color:#000000;">2</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">bin</span>
<span style="color:#000000;">/../</span>
<span style="color:#000000;">bin</span>
<span style="color:#000000;">/</span>
<span style="color:#000000;">hadoop job -Dmapred</span>
<span style="color:#000000;">.</span>
<span style="color:#000000;">job</span>
<span style="color:#000000;">.</span>
<span style="color:#000000;">tracker</span>
<span style="color:#000000;">=</span>
<span style="color:#000000;">localhost:</span>
<span style="color:#000000;">9001</span>
<span style="color:#000000;"> -kill job_201106150005_0004<br></span>
<span style="color:#000000;">2011</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">06</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">15</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">05</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">33</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">20</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;">724</span>
<span style="color:#000000;"> Stage-</span>
<span style="color:#000000;">1</span>
<span style="color:#000000;"> map </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">0</span>
<span style="color:#000000;">%</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;"> reduce </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">0</span>
<span style="color:#000000;">%<br></span>
<span style="color:#000000;">2011</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">06</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">15</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">05</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">33</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">46</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;">325</span>
<span style="color:#000000;"> Stage-</span>
<span style="color:#000000;">1</span>
<span style="color:#000000;"> map </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">2</span>
<span style="color:#000000;">%</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;"> reduce </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">0</span>
<span style="color:#000000;">%<br></span>
<span style="color:#000000;">2011</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">06</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">15</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">05</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">33</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">49</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;">827</span>
<span style="color:#000000;"> Stage-</span>
<span style="color:#000000;">1</span>
<span style="color:#000000;"> map </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">3</span>
<span style="color:#000000;">%</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;"> reduce </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">0</span>
<span style="color:#000000;">%<br></span>
<span style="color:#000000;">2011</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">06</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">15</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">05</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">33</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">53</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;">208</span>
<span style="color:#000000;"> Stage-</span>
<span style="color:#000000;">1</span>
<span style="color:#000000;"> map </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">4</span>
<span style="color:#000000;">%</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;"> reduce </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">0</span>
<span style="color:#000000;">%<br></span>
<span style="color:#000000;">2011</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">06</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">15</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">05</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">33</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">55</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;">259</span>
<span style="color:#000000;"> Stage-</span>
<span style="color:#000000;">1</span>
<span style="color:#000000;"> map </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">7</span>
<span style="color:#000000;">%</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;"> reduce </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">0</span>
<span style="color:#000000;">%<br></span>
<span style="color:#000000;">2011</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">06</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">15</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">05</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">34</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">40</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;">450</span>
<span style="color:#000000;"> Stage-</span>
<span style="color:#000000;">1</span>
<span style="color:#000000;"> map </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">9</span>
<span style="color:#000000;">%</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;"> reduce </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">0</span>
<span style="color:#000000;">%<br></span>
<span style="color:#000000;">2011</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">06</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">15</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">05</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">34</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">52</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;">706</span>
<span style="color:#000000;"> Stage-</span>
<span style="color:#000000;">1</span>
<span style="color:#000000;"> map </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">48</span>
<span style="color:#000000;">%</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;"> reduce </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">0</span>
<span style="color:#000000;">%<br></span>
<span style="color:#000000;">2011</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">06</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">15</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">05</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">34</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">57</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;">961</span>
<span style="color:#000000;"> Stage-</span>
<span style="color:#000000;">1</span>
<span style="color:#000000;"> map </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">50</span>
<span style="color:#000000;">%</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;"> reduce </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">0</span>
<span style="color:#000000;">%<br></span>
<span style="color:#000000;">2011</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">06</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">15</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">05</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">35</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">28</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;">420</span>
<span style="color:#000000;"> Stage-</span>
<span style="color:#000000;">1</span>
<span style="color:#000000;"> map </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">50</span>
<span style="color:#000000;">%</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;"> reduce </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">17</span>
<span style="color:#000000;">%<br></span>
<span style="color:#000000;">2011</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">06</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">15</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">05</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">35</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">36</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;">653</span>
<span style="color:#000000;"> Stage-</span>
<span style="color:#000000;">1</span>
<span style="color:#000000;"> map </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">58</span>
<span style="color:#000000;">%</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;"> reduce </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">17</span>
<span style="color:#000000;">%<br></span>
<span style="color:#000000;">2011</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">06</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">15</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">05</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">35</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">40</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;">844</span>
<span style="color:#000000;"> Stage-</span>
<span style="color:#000000;">1</span>
<span style="color:#000000;"> map </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">61</span>
<span style="color:#000000;">%</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;"> reduce </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">17</span>
<span style="color:#000000;">%<br></span>
<span style="color:#000000;">2011</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">06</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">15</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">05</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">35</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">49</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;">131</span>
<span style="color:#000000;"> Stage-</span>
<span style="color:#000000;">1</span>
<span style="color:#000000;"> map </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">62</span>
<span style="color:#000000;">%</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;"> reduce </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">17</span>
<span style="color:#000000;">%<br></span>
<span style="color:#000000;">2011</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">06</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">15</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">05</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">35</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">56</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;">428</span>
<span style="color:#000000;"> Stage-</span>
<span style="color:#000000;">1</span>
<span style="color:#000000;"> map </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">67</span>
<span style="color:#000000;">%</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;"> reduce </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">17</span>
<span style="color:#000000;">%<br></span>
<span style="color:#000000;">2011</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">06</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">15</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">05</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">36</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">34</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;">380</span>
<span style="color:#000000;"> Stage-</span>
<span style="color:#000000;">1</span>
<span style="color:#000000;"> map </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">90</span>
<span style="color:#000000;">%</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;"> reduce </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">17</span>
<span style="color:#000000;">%<br></span>
<span style="color:#000000;">2011</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">06</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">15</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">05</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">36</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">52</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;">601</span>
<span style="color:#000000;"> Stage-</span>
<span style="color:#000000;">1</span>
<span style="color:#000000;"> map </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">100</span>
<span style="color:#000000;">%</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;"> reduce </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">17</span>
<span style="color:#000000;">%<br></span>
<span style="color:#000000;">2011</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">06</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">15</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">05</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">37</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">10</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;">299</span>
<span style="color:#000000;"> Stage-</span>
<span style="color:#000000;">1</span>
<span style="color:#000000;"> map </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">100</span>
<span style="color:#000000;">%</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;"> reduce </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">67</span>
<span style="color:#000000;">%<br></span>
<span style="color:#000000;">2011</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">06</span>
<span style="color:#000000;">-</span>
<span style="color:#000000;">15</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">05</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">37</span>
<span style="color:#000000;">:</span>
<span style="color:#000000;">16</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;">471</span>
<span style="color:#000000;"> Stage-</span>
<span style="color:#000000;">1</span>
<span style="color:#000000;"> map </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">100</span>
<span style="color:#000000;">%</span>
<span style="color:#000000;">,</span>
<span style="color:#000000;"> reduce </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> </span>
<span style="color:#000000;">100</span>
<span style="color:#000000;">%<br>
Ended Job </span>
<span style="color:#000000;">=</span>
<span style="color:#000000;"> job_201106150005_0004<br>
OK<br></span>
<span style="color:#000000;">16522439</span>
<span style="color:#000000;"><br></span>
<span style="color:#0000ff;">Time</span>
<span style="color:#000000;"> taken: </span>
<span style="color:#000000;">274.531</span>
<span style="color:#000000;"> seconds</span>
</div>
</div>
<p> </p>
<p>好的，最后我们删除刚刚新建的表： </p>
<p> </p>
<div class="cnblogs_code">
<div>
<span style="color:#000000;">hive</span>
<span style="color:#000000;">&gt;</span>
<span style="color:#000000;"> drop table cite</span>
<span style="color:#000000;">;</span>
<span style="color:#000000;"><br>
OK<br></span>
<span style="color:#0000ff;">Time</span>
<span style="color:#000000;"> taken: </span>
<span style="color:#000000;">5.724</span>
<span style="color:#000000;"> seconds</span>
</div>
</div>
<p> </p>
<h3 style="font-family:verdana, geneva, arial, helvetica, sans-serif;color:#FFFFFF;font-size:15pt;font-weight:bolder;background-color:#808080;">
<strong><span style="font-family:Cambria;">&lt;3&gt;. 存储模型</span>
</strong>
<strong><span style="font-family:Cambria;"> </span>
</strong>
<span class="Apple-style-span" style="font-family:verdana, 'courier new';font-size:14px;color:#000000;font-weight:normal;"><a></a>
</span>
</h3>
<p>通常情况下hive将数据存储到hadoop上/user/hive/warehouse目录下，关系型数据库使用索引index去加快查询速度，
而hive使用的是以恶搞所谓的partition 
columns的概念，例如比如说存在某一行叫做state，可以根据state中存储的数据值，将state分为50个partitions。如果存在
date列的话，那么通常按照时间进行partition，hive在对分区的列上进行查询的速度会比较快，原因是hadoop在数据存储上将不同的分区
存储在了不同的目录文件下。例如对于上面的列state和date，可能的存储模型如下： </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/2011061520545865.jpg" rel="nofollow"><img style="background-image:none;border:0px none;" title="clip_image002" src="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055017264.jpg" border="0" alt="clip_image002" width="512" height="194"></a>
 </p>
<p>当然每个分区内的数据文件可能还是比较大，幸好在hive中存在一个所谓的buckets的概念，buckets根据hash值将数据分割成更小的数据文件，还是上面的例子，如果使用buckets的话，可能的存储模型如下： </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055024365.jpg" rel="nofollow"><img style="background-image:none;border:0px none;" title="clip_image004" src="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/20110615205503593.jpg" border="0" alt="clip_image004" width="553" height="127"></a>
 </p>
<h3 style="font-family:verdana, geneva, arial, helvetica, sans-serif;color:#FFFFFF;font-size:15pt;font-weight:bolder;background-color:#808080;">
<strong><span style="font-family:Cambria;">&lt;4&gt;. 深入hql</span>
</strong>
<strong><span style="font-family:Cambria;"> </span>
</strong>
<span class="Apple-style-span" style="font-family:verdana, 'courier new';font-size:14px;color:#000000;font-weight:normal;"><a></a>
</span>
</h3>
<p>我们将通过实际hql语句来分析hql的语法。 </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055126468.jpg" rel="nofollow"><img style="background-image:none;border:0px none;" title="clip_image006" src="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055146143.jpg" border="0" alt="clip_image006" width="554" height="199"></a>
 </p>
<p>该条语句创建表page_view，表中有5列，同时在见表语句中指出了各个列的数据类型，在hive中内建支持的数据类型如下： </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055183017.jpg" rel="nofollow"><img style="background-image:none;border:0px none;" title="clip_image008" src="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055227034.jpg" border="0" alt="clip_image008" width="553" height="198"></a>
 </p>
<p>这些类型的层次结构如下： </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055233022.jpg" rel="nofollow"><img style="background-image:none;border:0px none;" title="clip_image010" src="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055244234.jpg" border="0" alt="clip_image010" width="364" height="228"></a>
 </p>
<p>层次结构中允许从子类型隐式的转换成父类型。 </p>
<p>接着回到上面的见表语句，在列ip中添加了注释： </p>
<p>Ip STRING COMMENT (“Ip address of user”) </p>
<p>然后建表语句中添加了表的分区： </p>
<p>Partitioned by (dt string, country string) </p>
<p>注意的是这里的两列并不是表中的列，实际上这里的分区的两列dt和country仅仅是为了分区，实际上可能并不存储这些数据。 </p>
<p>Additionally the partitioned by clause defines the partitioning 
columns which are different from the data columns and are actually not 
stored with the data. When specified in this way </p>
<p>然后建表语句指定buckets大小，这里是32。 </p>
<p>最后指定数据源的文件格式。 </p>
<p>好的现在我们给出更多的表操作的例子，由于sql极其相似，这里仅仅给出了语法，并没有给出解释。 </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055253220.jpg" rel="nofollow"><img style="background-image:none;border:0px none;" title="clip_image012" src="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055275021.jpg" border="0" alt="clip_image012" width="371" height="39"></a>
 </p>
<p>描述表page_view结构。 </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055283169.jpg" rel="nofollow"><img style="background-image:none;border:0px none;" title="clip_image014" src="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055297728.jpg" border="0" alt="clip_image014" width="336" height="45"></a>
 </p>
<p>改变表的名字 </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055306191.jpg" rel="nofollow"><img style="background-image:none;border:0px none;" title="clip_image016" src="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055317926.jpg" border="0" alt="clip_image016" width="435" height="34"></a>
 </p>
<p>新增加一行 </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055326073.jpg" rel="nofollow"><img style="background-image:none;border:0px none;" title="clip_image018" src="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055324536.jpg" border="0" alt="clip_image018" width="473" height="36"></a>
 </p>
<p>删除分区 </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055342749.jpg" rel="nofollow"><img style="background-image:none;border:0px none;" title="clip_image020" src="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055351735.jpg" border="0" alt="clip_image020" width="410" height="31"></a>
 </p>
<p>删除表 </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055367440.jpg" rel="nofollow"><img style="background-image:none;border:0px none;" title="clip_image022" src="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055376427.jpg" border="0" alt="clip_image022" width="273" height="35"></a>
 </p>
<p>显示所有的表 </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055386526.jpg" rel="nofollow"><img style="background-image:none;border:0px none;" title="clip_image024" src="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055402787.jpg" border="0" alt="clip_image024" width="411" height="49"></a>
 </p>
<p>从文件page_view.txt文件将数据加载到表page_view中，注意的是这里的路径可以使用绝对路径或者相对路径。这里使用了local，表明数据文件的来源是本地，而不是在hdfs上。 </p>
<p>Hql上的查询语句和sql很类似，这里没有一一给出，下面仅仅将给出hql中运算符和内建聚类函数。 </p>
<p>运算符： </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055419364.jpg" rel="nofollow"><img style="background-image:none;border:0px none;" title="clip_image026" src="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055436738.jpg" border="0" alt="clip_image026" width="553" height="176"></a>
 </p>
<p>内建聚类函数： </p>
<p><a href="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055467908.jpg" rel="nofollow"><img style="background-image:none;border:0px none;" title="clip_image028" src="http://images.cnblogs.com/cnblogs_com/xuqiang/201106/201106152055486677.jpg" border="0" alt="clip_image028" width="554" height="219"></a>
 </p>
<h3 style="font-family:verdana, geneva, arial, helvetica, sans-serif;color:#FFFFFF;font-size:15pt;font-weight:bolder;background-color:#808080;">
<strong><span style="font-family:Cambria;">&lt;5&gt;. 参考资料及代码下载</span>
</strong>
<strong><span style="font-family:Cambria;"> </span>
</strong>
<span class="Apple-style-span" style="font-family:verdana, 'courier new';font-size:14px;color:#000000;font-weight:normal;"><a></a>
</span>
</h3>
<p><a href="http://wiki.apache.org/hadoop/Hive/GettingStarted" rel="nofollow">http://wiki.apache.org/hadoop/Hive/GettingStarted</a>
 </p>
</div>            </div>
                </div>