---
layout:     post
title:      Apache Flume简介及安装部署
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <h1 style="line-height:1.5;color:rgb(0,0,0);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;text-align:left;background-color:rgb(255,255,255);">概述</h1><blockquote style="background:rgb(255,255,255) url(&quot;images/comment.gif&quot;) no-repeat 25px 0px;border:2px solid rgb(239,239,239);min-height:35px;line-height:1.6em;color:rgb(51,51,51);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:13px;text-align:left;"><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;">Flume 是 Cloudera 提供的一个<span style="line-height:1.5;color:rgb(255,0,0);">高可用的，高可靠的，分布式的海量日志采集、聚合和传输的软件</span>。</p><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;">Flume 的核心是把<span style="line-height:1.5;color:rgb(255,0,0);">数据从数据源(source)收集</span>过来，再将收集到的数据<span style="line-height:1.5;color:rgb(255,0,0);">送到指定的目的地(sink)</span>。为了保证输送的过程一定成功，在送到目的地(sink)之前，会先<span style="line-height:1.5;color:rgb(255,0,0);">缓存数据(channel),</span>待数据真正到达目的地(sink)后，flume 在删除自己缓存的数据。</p><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;">Flume 支持定制各类数据发送方，用于收集各类型数据；同时，Flume 支持定制各种数据接受方，用于最终存储数据。一般的采集需求，通过对 flume 的简单配置即可实现。针对特殊场景也具备良好的自定义扩展能力。因此，<span style="line-height:1.5;color:rgb(255,0,0);">flume 可以适用于大部分的日常数据采集场景</span>。</p></blockquote><h1 style="line-height:1.5;color:rgb(0,0,0);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;text-align:left;background-color:rgb(255,255,255);">运行机制</h1><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;text-align:left;background-color:rgb(255,255,255);">　　<span>Flume 系统中核心的角色是 agent，agent 本身是一个 Java 进程，一般运行在日志收集节点。</span></p><ul style="margin-left:30px;color:rgb(0,0,0);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:13px;text-align:left;background-color:rgb(255,255,255);"><li style="margin-left:0px;">　　每一个 agent 相当于一个数据传递员，内部有三个组件：</li></ul><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;text-align:left;background-color:rgb(255,255,255);">　　　　<span style="line-height:1.5;color:rgb(255,0,0);">Source：采集源，用于跟数据源对接，以获取数据；</span></p><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;text-align:left;background-color:rgb(255,255,255);"><span style="line-height:1.5;color:rgb(255,0,0);">　　　　Sink：下沉地，采集数据的传送目的，用于往下一级 agent 传递数据或者往最终存储系统传递数据；</span></p><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;text-align:left;background-color:rgb(255,255,255);"><span style="line-height:1.5;color:rgb(255,0,0);">　　　　Channel：agent 内部的数据传输通道，用于从 source 将数据传递到 sink；</span></p><ul style="margin-left:30px;color:rgb(0,0,0);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:13px;text-align:left;background-color:rgb(255,255,255);"><li style="margin-left:0px;">　　在整个数据的传输的过程中，流动的是 event，它是 Flume 内部数据传输的最基本单元。event 将传输的数据进行封装。如果是文本文件，通常是一行记录，event 也是事务的基本单位。event 从 source，流向 channel，再到 sink，本身为一个字节数组，并可携带 headers(头信息)信息。event 代表着一个数据的最小完整单元，从外部数据源来，向外部的目的地去。</li><li style="margin-left:0px;">　　一个完整的 event 包括：event headers、event body、event 信息，其event 信息就是 flume 收集到的日记记录。</li></ul><h1 style="line-height:1.5;color:rgb(0,0,0);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;text-align:left;background-color:rgb(255,255,255);">Flume采集系统结构图</h1><h2 style="font-size:21px;line-height:1.5;color:rgb(0,0,0);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;text-align:left;background-color:rgb(255,255,255);">　　简单结构：</h2><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;text-align:left;background-color:rgb(255,255,255);">　　　　　　单个 agent 采集数据</p><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;text-align:left;background-color:rgb(255,255,255);"><img src="https://images2018.cnblogs.com/blog/1385779/201807/1385779-20180707161605555-1910881968.png" alt="" width="728" height="276" style="margin-left:auto;border:0px;"></p><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;text-align:left;background-color:rgb(255,255,255);"> </p><h2 style="font-size:21px;line-height:1.5;color:rgb(0,0,0);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;text-align:left;background-color:rgb(255,255,255);">　　复杂结构</h2><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;text-align:left;background-color:rgb(255,255,255);">　　　　　　多级 agent 之间串联</p><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;text-align:left;background-color:rgb(255,255,255);"> </p><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;text-align:left;background-color:rgb(255,255,255);"><img src="https://images2018.cnblogs.com/blog/1385779/201807/1385779-20180707161704462-2032281931.png" alt="" width="723" height="486" style="margin-left:auto;border:0px;"></p><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;text-align:left;background-color:rgb(255,255,255);"> </p><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;text-align:left;background-color:rgb(255,255,255);"> </p><h1 style="line-height:1.5;color:rgb(0,0,0);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;text-align:left;background-color:rgb(255,255,255);">Flume安装部署</h1><ul style="margin-left:30px;color:rgb(0,0,0);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:13px;text-align:left;background-color:rgb(255,255,255);"><li style="margin-left:0px;">上传安装包到数据源所在节点上</li><li style="margin-left:0px;">解压</li></ul><div class="cnblogs_code" style="background-color:rgb(245,245,245);border:1px solid rgb(204,204,204);color:rgb(0,0,0);text-align:left;font-family:'Courier New';font-size:12px;"><pre style="font-family:'Courier New';">tar -zxvf apache-flume-1.6.0-bin.tar.gz</pre></div><ul style="margin-left:30px;color:rgb(0,0,0);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:13px;text-align:left;background-color:rgb(255,255,255);"><li style="margin-left:0px;">根据数据采集需求 配置采集方案，描述在配置文件中(文件名可任意自定义)</li></ul><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;text-align:left;background-color:rgb(255,255,255);">　　　　在 flume 的 的 conf  目录下新建一个文件</p><div class="cnblogs_code" style="background-color:rgb(245,245,245);border:1px solid rgb(204,204,204);color:rgb(0,0,0);text-align:left;font-family:'Courier New';font-size:12px;"><pre style="font-family:'Courier New';">vi netcat-logger.conf</pre></div><div class="cnblogs_code" style="background-color:rgb(245,245,245);border:1px solid rgb(204,204,204);color:rgb(0,0,0);text-align:left;font-family:'Courier New';font-size:12px;"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);border:none;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span></div><pre style="font-family:'Courier New';"><span style="line-height:1.5;">#从网络端口接收数据，下沉到logger
#采集配置文件，netcat</span>-<span style="line-height:1.5;">logger.conf

# Name the components on </span><span style="line-height:1.5;">this</span><span style="line-height:1.5;"> agent
a1.sources </span>=<span style="line-height:1.5;"> r1
a1.sinks </span>=<span style="line-height:1.5;"> k1
a1.channels </span>=<span style="line-height:1.5;"> c1

# Describe</span>/<span style="line-height:1.5;">configure the source
a1.sources.r1.type </span>=<span style="line-height:1.5;"> netcat
a1.sources.r1.bind </span>=<span style="line-height:1.5;"> localhost
a1.sources.r1.port </span>= 44444<span style="line-height:1.5;">

# Describe the sink
a1.sinks.k1.type </span>=<span style="line-height:1.5;"> logger

# Use a channel which buffers events in memory
a1.channels.c1.type </span>=<span style="line-height:1.5;"> memory
a1.channels.c1.capacity </span>= 1000<span style="line-height:1.5;">
a1.channels.c1.transactionCapacity </span>= 100<span style="line-height:1.5;">

# Bind the source and sink to the channel
a1.sources.r1.channels </span>=<span style="line-height:1.5;"> c1
a1.sinks.k1.channel </span>= c1</pre><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);border:none;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span></div></div><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;text-align:left;background-color:rgb(255,255,255);"> </p><ul style="margin-left:30px;color:rgb(0,0,0);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:13px;text-align:left;background-color:rgb(255,255,255);"><li style="margin-left:0px;">指定采集方案配置文件，在相应的节点上启动 flume agent</li></ul><div class="cnblogs_code" style="background-color:rgb(245,245,245);border:1px solid rgb(204,204,204);color:rgb(0,0,0);text-align:left;font-family:'Courier New';font-size:12px;"><pre style="font-family:'Courier New';"><span style="line-height:1.5;color:rgb(255,0,0);">bin/flume-ng agent --conf conf --conf-file conf/netcat-logger.conf --name a1 -Dflume.root.logger=INFO,console</span></pre><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;"><span class="md-line md-end-block md-focus" style="line-height:1.5;font-size:12px;">#--conf 指定flume自带配置文件位置（简写-c）</span></p><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;"><span class="md-line md-end-block" style="line-height:1.5;font-size:12px;">#--conf-file指定采集方案是哪一个(-f)</span></p><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;"><span class="md-line md-end-block md-focus" style="line-height:1.5;font-size:12px;">#--name 给本次flume agent起个名字</span></p></div><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;text-align:left;background-color:rgb(255,255,255);"> </p><ul style="margin-left:30px;color:rgb(0,0,0);font-family:verdana, 'ms song', '宋体', Arial, '微软雅黑', Helvetica, sans-serif;font-size:13px;text-align:left;background-color:rgb(255,255,255);"><li style="margin-left:0px;">测试</li></ul><div class="cnblogs_code" style="background-color:rgb(245,245,245);border:1px solid rgb(204,204,204);color:rgb(0,0,0);text-align:left;font-family:'Courier New';font-size:12px;"><pre style="font-family:'Courier New';"><span style="line-height:1.5;">#安装telnet
yum install </span>-y telnet</pre></div><div class="cnblogs_code" style="background-color:rgb(245,245,245);border:1px solid rgb(204,204,204);color:rgb(0,0,0);text-align:left;font-family:'Courier New';font-size:12px;"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);border:none;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span></div><p style="line-height:1.5;color:rgb(0,0,0);font-size:13px;">传入数据：<br>$ <span style="line-height:1.5;color:rgb(255,0,0);font-size:12px;">telnet localhost 44444</span><br>Trying 127.0.0.1...<br>Connected to localhost.localdomain (127.0.0.1).<br>Escape character is '^]'.<br>Hello world! &lt;ENTER&gt;<br>OK</p><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy" style="line-height:1.5;"><a title="复制代码" style="color:rgb(51,51,51);border:none;"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none;"></a></span></div></div>            </div>
                </div>