---
layout:     post
title:      Hive（四）hive函数与hive shell
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <div>﻿﻿</div><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">一、hive函数</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">    <img style="border:0px;" alt="" src="https://images2015.cnblogs.com/blog/1122015/201704/1122015-20170412184550095-1001443022.png"></p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">     1、hive内置函数</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">        （1）内容较多，见《 Hive 官方文档》<br>            https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF<br>        （2）详细解释：<br>            http://blog.sina.com.cn/s/blog_83bb57b70101lhmk.html</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">         （3） 测试内置函数的快捷方式：</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">                 1、创建一个 dual 表 create table dual(id string);<br>                  2、 load 一个文件（一行，一个空格）到 dual 表<br>                  3、 select substr('huangbo',2,3) from dual;</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">          （4）查看内置函数  show  functions;</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">                 显示函数的详细信息 desc function abs;</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">                  显示函数的扩展信息  desc function extended concat;</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">           (5)详细使用见文档</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">    2、hive自定义函数</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">当 Hive 提供的内置函数无法满足你的业务处理需要时，此时就可以考虑使用用户自定义函 数<br>UDF （ user-defined function）作用于单个数据行，产生一个数据行作为输出。（数学函数， 字符串函数）<br>UDAF（用户定义聚集函数 User- Defined Aggregation Funcation）：接收多个输入数据行，并产 生一个输出数据行。（ count， max）<br><br></p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">    3、一个简单的UDF函数示例：</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">         （1）先开发一个简单的 java 类，继承 org.apache.hadoop.hive.ql.exec.UDF，重载 evaluate 方法</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);"><img style="border:0px;" alt="" src="https://images2015.cnblogs.com/blog/1122015/201704/1122015-20170412191843048-210514114.png"></p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">        （2）打成jar包上传到服务器</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">         （3） 将 jar 包添加到 hive 的 classpath</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">                hive&gt;add JAR /root/hivejar /udf.jar;</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">         （4）创建临时函数与开发好的 class 关联起来</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);"> Hive&gt;create temporary function tolowercase as ' com.mazh.udf. ToLowerCase ';</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">          (5)至此，便可以在 hql 在使用自定义的函数</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">select tolowercase(name),age from studentss;</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">      4、Transform实现   （把json数据中timeStamp字段变成日期编号）</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">Hive 的 TRANSFORM 关键字提供了在 SQL 中调用自写脚本的功能。适合实现 Hive 中没有的 功能又不想写 UDF 的情况<br>具体以一个实例讲解。     </p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">（1）先加载 rating.json 文件到 hive 的一个原始表 rat_json<br>create table rat_json(line string) row format delimited;<br>load data local inpath '/root/rating.json' into table rat_json;<br>（2） 创建 rate 这张表用来存储解析 json 出来的字段：<br>create table rate(movie int, rate int, unixtime int, userid int) row format delimited fields<br>terminated by '\t';<br>解析 json，得到结果之后存入 rate 表：<br>insert into table rate select get_json_object(line,'$.movie') as moive,get_json_object(line,'$.rate')<br>as rate,get_json_object(line,'$.timeStamp') as unixtime,get_json_object(line,'$.uid') as userid<br>from rat_json;<br>（3）使用 transform+python 的方式去转换 unixtime 为 weekday<br>先编辑一个 python 脚本文件</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">vi weekday_mapper.py</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">#!/bin/python<br>import sys<br>import datetime<br>for line in sys.stdin:<br>line = line.strip()<br>movie,rate,unixtime,userid = line.split('\t')<br>weekday = datetime.datetime.fromtimestamp(float(unixtime)).isoweekday()<br>print '\t'.join([movie, rate, str(weekday),userid])</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">保存文件<br>然后，将文件加入 hive 的 classpath：</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);"><img style="border:0px;" alt="" src="https://images2015.cnblogs.com/blog/1122015/201704/1122015-20170412194925642-335800889.png"></p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">最后查询看数据是否正确：<br>select distinct(weekday) from lastjsontable;</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">二、Hive  Shell  操作</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">  1、hive 命令行</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);"> <img style="border:0px;" alt="" src="https://images2015.cnblogs.com/blog/1122015/201704/1122015-20170413185406345-1815258299.png"></p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">语法结构：</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">hive [-hiveconf x=y]* [&lt;-i filename&gt;]* [&lt;-f filename&gt;|&lt;-e query-string&gt;] [-S]</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">说明：</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">   （1） -i 从文件初始化 HQL。<br>   （2） -e 从命令行执行指定的 HQL<br>   （3） -f 执行 HQL 脚本<br>   （4） -v 输出执行的 HQL 语句到控制台<br>   （5） -p &lt;port&gt; connect to Hive Server on port number<br>   （6） -hiveconf x=y（ Use this to set hive/hadoop configuration variables）<br>   （7）-S 表示以不打印日志的形式执行 （hive -S -e ......）</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">实例：</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">（1）</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);"><img style="border:0px;" alt="" src="https://images2015.cnblogs.com/blog/1122015/201704/1122015-20170413190313783-1735097239.png"></p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">(2)运行一个文件</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);"><img style="border:0px;" alt="" src="https://images2015.cnblogs.com/blog/1122015/201704/1122015-20170413190416392-434231554.png"></p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);"> (3)运行参数文件</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">从配置文件启动 hive，并加载配置文件当中的配置参数</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);"><img style="border:0px;" alt="" src="https://images2015.cnblogs.com/blog/1122015/201704/1122015-20170413190854923-275278045.png"></p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">     2、hive参数配置方式</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;">hive参数大全：<span class="fontstyle0"><span style="background-color:rgb(250,247,239);">https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties<span> </span><br></span></span></p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;">开发 Hive 应用时，不可避免地需要设定 Hive 的参数。设定 Hive 的参数可以调优 HQL 代码 的执行效率，或帮助定位问题。然而实践中经常遇到的一个问题是，为什么设定的参数没有起作用？这通常是错误的设定方式导致的。</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);"> </p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">对于一般参数，有以下三种设定方式：<br>配置文件 （全局有效）<br>命令行参数（对 hive 启动实例有效）    （hive -i ...）<br>参数声明 （对 hive 的连接 session 有效）（进入hive客户端之后设置）</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);"> </p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">优先级：参数声明 高于命令行参数 高于配置文件</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">（1）配置文件： Hive 的配置文件包括</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">用户自定义配置文件： $HIVE_CONF_DIR/hive-site.xml<br>默认配置文件： $HIVE_CONF_DIR/hive-default.xml<br>用户自定义配置会覆盖默认配置。<br>另外， Hive 也会读入 Hadoop 的配置，因为 Hive 是作为 Hadoop 的客户端启动的， Hive 的配<br>置会覆盖 Hadoop 的配置。<br>配置文件的设定对本机启动的所有 Hive 进程都有效。</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;">（2）<span class="fontstyle0"><span style="background-color:rgb(250,247,239);">命令行参数</span><span class="fontstyle0"><span style="background-color:rgb(250,247,239);">：启动<span> </span></span><span class="fontstyle2"><span style="background-color:rgb(250,247,239);">Hive</span><span class="fontstyle0"><span style="background-color:rgb(250,247,239);">（客户端或<span> </span></span><span class="fontstyle2"><span style="background-color:rgb(250,247,239);">Server<span> </span></span><span class="fontstyle0"><span style="background-color:rgb(250,247,239);">方式）时，可以在命令行添加</span><span class="fontstyle2"><span style="background-color:rgb(250,247,239);">-hiveconf param=value<br></span><span class="fontstyle0"><span style="background-color:rgb(250,247,239);">来设定参数，例如：<br></span><span class="fontstyle2"><span style="background-color:rgb(250,247,239);">bin/hive -hiveconf hive.root.logger=INFO,console<br></span><span class="fontstyle0"><span style="background-color:rgb(250,247,239);">这一设定对本次启动的<span> </span></span><span class="fontstyle2"><span style="background-color:rgb(250,247,239);">Session</span><span class="fontstyle0"><span style="background-color:rgb(250,247,239);">（对于<span> </span></span><span class="fontstyle2"><span style="background-color:rgb(250,247,239);">Server<span> </span></span><span class="fontstyle0"><span style="background-color:rgb(250,247,239);">方式启动，则是所有请求的<span> </span></span><span class="fontstyle2"><span style="background-color:rgb(250,247,239);">Sessions</span><span class="fontstyle0"><span style="background-color:rgb(250,247,239);">）有效。<span> </span><br></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;">（3）</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">参数声明：可以在 HQL 中使用 SET 关键字设定参数，例如：<br>set mapred.reduce.tasks=100;<br>这一设定的作用域也是 session 级的。</p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">set hive.exec.reducers.bytes.per.reducer=&lt;number&gt; 每个 reduce task 的平均负载数据量 hive 会估算我们的总数据量，然后用总数据量除以上述参数值，就能得出需要运行的 reduce task 数<br>set hive.exec.reducers.max=&lt;number&gt; 设置 reduce task 数量的上限<br>set mapreduce.job.reduces=&lt;number&gt; 指定固定的 reduce task 数量 但是，这个参数在必要时&lt;业务逻辑决定只能用一个 reduce task&gt; hive 会忽略<br><br></p><p style="text-align:left;color:rgb(57,57,57);text-transform:none;text-indent:0px;letter-spacing:normal;font-family:verdana, 'ms song', Arial, Helvetica, sans-serif;font-size:14px;font-style:normal;font-weight:normal;word-spacing:0px;background-color:rgb(250,247,239);">上述三种设定方式的优先级依次递增。即参数声明覆盖命令行参数，命令行参数覆盖配置文 件设定。注意某些系统级的参数，例如 log4j 相关的设定，必须用前两种方式设定，因为那 些参数的读取在 Session 建立以前已经完成了。</p>            </div>
                </div>