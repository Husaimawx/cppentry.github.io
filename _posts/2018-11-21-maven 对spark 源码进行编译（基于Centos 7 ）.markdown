---
layout:     post
title:      maven 对spark 源码进行编译（基于Centos 7 ）
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><span style="font-size:18pt;"><span style="font-weight:700;">maven 对spark 源码进行编译（</span></span><span style="font-size:18pt;"><span style="font-weight:700;">基于Centos 7</span></span> <span style="font-size:18pt;"><span style="font-weight:700;">）</span></span></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><br></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><br></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><span style="font-size:14pt;"><span style="font-size:14pt;"><span style="font-weight:700;">1 、写在前面的话</span></span></span></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><br></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">    有些小伙伴可能会问：Spark官网不是已经提供了Spark针对不同版本的安装包了吗，我们为什么还需要对Spark源码进行编译呢？针对这个问题我们到Spark官网: <a href="http://spark.apache.org/" rel="nofollow">spark.apache.org</a>来看下，如下图所示:</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><br></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><img src="https://img-blog.csdn.net/20180528180102491?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI0NTA1MTI3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">    Spark官网的确是提供了一些Hadoop版本的Spark安装包，但是提供的这些是否能够满足我们的要求呢？答案肯定是否定的，根据本人近几年做Spark的开发经验，列出如下几点：</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">        （1）在生产环境中Hadoop的选型，很大部分都是CDH或者HDP系列的，那么官方提供的这几个Hadoop系列是否能够生产的需求？</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">        （2）在开发过程中，我们经常会遇到需要对Spark的源码进行修改，那么修改后的代码如何集成到Spark安装包中去呢？</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">    针对如上列出的两点的个人觉得比较好的最佳实践：根据生产上运行的Hadoop版本编译出Spark的安装包，修改Spark源码之后，重新编译Spark</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">    所以：个人觉得如果想更好的学习和使用Spark，那么第一步就是要会根据Spark源码编译出安装包。</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><br></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><span style="font-size:14pt;"><span style="font-size:14pt;"><span style="font-weight:700;">2 、前置准备</span></span></span></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><br></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">    根据Spark官方文档编译模块的介绍（<a href="http://spark.apache.org/docs/2.1.0/building-spark.html" rel="nofollow">http://spark.apache.org/docs/2.1.0/building-spark.html</a>）的介绍：</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">The Maven-based build is the build of reference for Apache Spark. Building Spark using Maven requires Maven 3.3.9 or newer and Java 7+. Note that support for Java 7 is deprecated as of Spark 2.0.0 and may be removed in Spark 2.2.0.”</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">我们得知：</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">   （1）Java需要7+版本，而且在Spark2.0.0之后Java 7已经被标识成deprecated了，但是不影响使用，但是在Spark2.2.0版本之后Java 7的支持将会被移除；</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">   （2）Maven需要3.3.9+版本。</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><span style="font-size:13px;"><span style="color:rgb(0,0,0);font-family:Roboto, 'Segoe UI', Arial, 'Microsoft Yahei', sans-serif;"> </span></span></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><span style="font-size:14pt;"><span style="font-weight:700;">3、</span></span><span style="font-size:14pt;"><span style="background-color:rgb(248,250,252);font-size:14pt;color:rgb(28,31,33);font-family:'PingFang SC', '微软雅黑', 'Microsoft YaHei', Helvetica, 'Helvetica Neue', Tahoma, Arial, sans-serif;"><span style="font-weight:700;">Spark-2.1.0源码下载</span></span></span></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><br></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><span style="font-size:10pt;"><span style="font-size:10pt;color:rgb(28,31,33);font-family:'PingFang SC';">        （1）下载地址：</span><a href="http://spark.apache.org/downloads.html" rel="nofollow" style="color:rgb(28,31,33);font-size:10pt;font-family:'PingFang SC';">http://spark.apache.org/downloads.html</a></span></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><img src="https://img-blog.csdn.net/20180528180114739?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI0NTA1MTI3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><br></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><br></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">    （2）下载完成后解压即可，解压后的目录结构如下图所示</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><br></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><img src="https://img-blog.csdn.net/20180528180125428?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI0NTA1MTI3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><br></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">   注意1：<span style="font-size:13px;color:rgb(0,0,0);font-family:Roboto;">mvn编译命令：</span></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><span style="font-size:13px;font-family:Roboto;">                 注意：如果使用cdh 编译，那么需要在pom.xml 中配置红色文字引用：</span></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><div style="padding:0px;margin:0px;"><br></div><table style="border-spacing:0px;width:852px;"><colgroup><col></colgroup><tbody><tr><td style="margin:0px;border-color:rgb(164,190,173);background-color:rgb(205,237,216);"><div style="padding:0px;margin:0px;"><span style="font-size:13px;font-family:Roboto;">&lt;</span><span style="font-size:13px;font-family:Roboto;">repositories</span><span style="font-size:13px;font-family:Roboto;">&gt;</span></div><div style="padding:0px;margin:0px;"><span style="font-family:Roboto;">  &lt;repository&gt;</span></div><div style="padding:0px;margin:0px;"><span style="font-size:13px;font-family:Roboto;">     &lt;id&gt;central&lt;/id&gt;</span></div><div style="padding:0px;margin:0px;"><span style="font-family:Roboto;">      &lt;!-- This should be at top, it makes maven try the central repo first and then others and hence faster dep resolution --&gt;</span></div><div style="padding:0px;margin:0px;"><span style="font-family:Roboto;">      &lt;name&gt;Maven Repository&lt;/name&gt;</span></div><div style="padding:0px;margin:0px;"><span style="font-family:Roboto;">      &lt;url&gt;</span><a href="https://repo1.maven.org/maven2" rel="nofollow" style="font-family:Roboto;">https://repo1.maven.org/maven2</a><span style="font-family:Roboto;">&lt;/url&gt;</span></div><div style="padding:0px;margin:0px;"><span style="font-family:Roboto;">      &lt;releases&gt;</span></div><div style="padding:0px;margin:0px;"><span style="font-family:Roboto;">        &lt;enabled&gt;true&lt;/enabled&gt;</span></div><div style="padding:0px;margin:0px;"><span style="font-family:Roboto;">      &lt;/releases&gt;</span></div><div style="padding:0px;margin:0px;"><span style="font-family:Roboto;">      &lt;snapshots&gt;</span></div><div style="padding:0px;margin:0px;"><span style="font-family:Roboto;">        &lt;enabled&gt;false&lt;/enabled&gt;</span></div><div style="padding:0px;margin:0px;"><span style="font-family:Roboto;">      &lt;/snapshots&gt;</span></div><div style="padding:0px;margin:0px;"><span style="font-family:Roboto;">    &lt;/repository&gt;</span></div><div style="padding:0px;margin:0px;"><span style="font-size:13px;font-family:Roboto;">    <span style="color:rgb(255,70,53);"><span style="font-weight:700;"> &lt;repository&gt;</span></span></span></div><div style="padding:0px;margin:0px;font-size:13px;"><span style="color:rgb(255,70,53);font-family:Roboto;"><span style="font-weight:700;">          &lt;id&gt;cloudera&lt;/id&gt;</span></span></div><div style="padding:0px;margin:0px;font-size:13px;"><span style="color:rgb(255,70,53);font-family:Roboto;"><span style="font-weight:700;">          &lt;url&gt;https://</span></span><span style="color:rgb(255,70,53);font-family:Roboto;"><span style="font-weight:700;">repository.</span></span><a href="http://cloudera.com/artifactory/cloudera-repos/" rel="nofollow" style="color:rgb(255,70,53);font-family:Roboto;font-weight:bold;">cloudera.com/artifactory/cloudera-repos/</a><span style="color:rgb(255,70,53);font-family:Roboto;"><span style="font-weight:700;">&lt;/url&gt;</span></span></div><div style="padding:0px;margin:0px;"><span style="font-size:13px;"><span style="color:rgb(255,70,53);font-family:Roboto;"><span style="font-weight:700;">     &lt;/repository&gt;</span></span></span></div><div style="padding:0px;margin:0px;"><span style="font-size:13px;font-family:Roboto;">&lt;/</span><span style="font-size:13px;font-family:Roboto;">repositories</span><span style="font-size:13px;font-family:Roboto;">&gt;</span></div></td></tr></tbody></table><div style="padding:0px;margin:0px;"><span style="font-size:13px;color:rgb(0,0,0);font-family:Roboto, 'Segoe UI', Arial, 'Microsoft Yahei', sans-serif;">  注意2：</span><span style="font-size:13px;color:rgb(0,0,0);font-family:Roboto;">maven环境内存要符合条件。如果用maven进行编译需要先设置</span><span style="font-size:13px;color:rgb(0,0,0);font-family:Roboto;">maven内存（如果用</span><span style="background-color:rgb(255,250,165);font-size:13px;color:rgb(0,0,0);font-family:Roboto;">make-distribution.sh ，则在这个脚本中进行修改</span><span style="font-size:13px;color:rgb(0,0,0);font-family:Roboto;">）：</span></div><div style="padding:0px;margin:0px;"><span style="font-size:13px;color:rgb(0,0,0);font-family:Roboto;">            export MAVEN_OPTS="-Xmx2g -XX:ReservedCodeCacheSize=512m"  </span></div><div style="padding:0px;margin:0px;"><br></div><div style="padding:0px;margin:0px;"><span style="font-size:13px;color:rgb(0,0,0);font-family:Roboto;"> </span><span style="font-size:13px;color:rgb(0,0,0);font-family:Roboto, 'Segoe UI', Arial, 'Microsoft Yahei', sans-serif;"> 注意3：如果scala 版本为2.10 ,需要进行 ./dev/</span><span style="font-size:13px;color:rgb(0,0,0);font-family:Roboto;">change-scala-version.sh 2.10</span></div><div style="padding:0px;margin:0px;"><span style="font-size:13px;color:rgb(0,0,0);font-family:Roboto;">  我的版本为2.11.8，我执行了这个命令   ./dev/change-scala-version.sh 2.11   </span></div><div style="padding:0px;margin:0px;"><br></div><div style="padding:0px;margin:0px;"><span style="font-size:13px;color:rgb(0,0,0);font-family:Roboto;">  注意4：</span></div><div style="padding:0px;margin:0px;">                <img src="https://img-blog.csdn.net/20180528180136340?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI0NTA1MTI3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></div></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><br></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><span style="font-size:14pt;"><span style="font-size:14pt;"><span style="font-weight:700;">4、Spark源码编译</span></span></span></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><br></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">    查看官方文档编译源码部分：<a href="http://spark.apache.org/docs/2.1.0/building-spark.html#building-a-runnable-distribution" rel="nofollow">http://spark.apache.org/docs/2.1.0/building-spark.html#building-a-runnable-distribution</a></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">    我们可以使用Spark源码目录中的dev下的make-distribution.sh脚本，官方提供的编译命令如下：</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">    <span style="background-color:rgb(255,250,165);">   <span style="color:rgb(121,121,121);"> ./dev/make-distribution.sh --name custom-spark --tgz -Psparkr -Phadoop-2.4 -Phive -Phive-thriftserver -Pmesos -Pyarn</span></span></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">    参数说明：</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">        --name：指定编译完成后Spark安装包的名字</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">        --tgz：以tgz的方式进行压缩</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">        -Psparkr：编译出来的Spark支持R语言</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">        -Phadoop-2.4：以hadoop-2.4的profile进行编译，具体的profile可以看出源码根目录中的pom.xml中查看</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">        -Phive和-Phive-thriftserver：编译出来的Spark支持对Hive的操作</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">        -Pmesos：编译出来的Spark支持运行在Mesos上</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">        -Pyarn：编译出来的Spark支持运行在YARN上</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><br></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">        那么我们可以根据具体的条件来编译Spark，比如我们使用的Hadoop版本是2.6.0-cdh5.7.0，并且我们需要将Spark运行在YARN上、支持对Hive的操作，那么我们的Spark源码编译脚本就是：</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">         <span style="background-color:rgb(255,250,165);">  <span style="font-weight:bold;"> </span></span><span style="background-color:rgb(255,250,165);"><span style="font-weight:700;">./dev/make-distribution.sh --name 2.6.0-cdh5.7.0 --tgz -Pyarn -Phadoop-2.6 -Phive -Phive-thriftserver -Dhadoop.version=2.6.0-cdh5.7.0 </span></span><span style="background-color:rgb(255,250,165);"><span style="font-weight:700;"> </span></span> <span style="background-color:rgb(255,250,165);"><span style="font-weight:700;">-U</span></span></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><br></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">    编译成功后，在Spark源码的根目录中就spark-2.1.0-bin-2.6.0-cdh5.7.0.tgz包，那么我们就可以使用编译出来的这个安装包来进行Spark的安装了。</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">有小伙伴可能会问，为什么编译出来的安装包的名称是spark-2.1.0-bin-2.6.0-cdh5.7.0.tgz呢？我们可以带着这个疑惑，查看make-distribution.sh的源码，在该脚本的最后部分，有如下代码：</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><div style="padding:0px;margin:0px;"><br></div><table style="border-spacing:0px;width:852px;"><colgroup><col></colgroup><tbody><tr><td style="margin:0px;border-color:rgb(164,190,173);background-color:rgb(205,237,216);"><div style="padding:0px;margin:0px;">   if [ "$MAKE_TGZ" == "true" ]; then</div><div style="padding:0px;margin:0px;">        TARDIR_NAME=spark-$VERSION-bin-$NAME</div><div style="padding:0px;margin:0px;">        TARDIR="$SPARK_HOME/$TARDIR_NAME"</div><div style="padding:0px;margin:0px;">        rm -rf "$TARDIR"</div><div style="padding:0px;margin:0px;">        cp -r "$DISTDIR" "$TARDIR"</div><div style="padding:0px;margin:0px;">        tar czf "spark-$VERSION-bin-$NAME.tgz" -C "$SPARK_HOME" "$TARDIR_NAME"</div><div style="padding:0px;margin:0px;">        rm -rf "$TARDIR"fi</div></td></tr></tbody></table><div style="padding:0px;margin:0px;"><br></div></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">    该VERSION就是我们Spark的版本即2.1.0，NAME就是我们在编译时指定的2.6.0-cdh5.7.0，所以根据该脚本最终输出的Spark安装包的全称为: spark-2.1.0-bin-2.6.0-cdh5.7.0.tgz。通过该代码的查看希望大家能明白一个问题：源码面前，了无秘密。</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">    注意：在编译过程中会出现下载某个依赖包的时间太久，这是由于网络问题，可以执行ctrl+c停止编译命令，然后重新运行编译命令，在编译过程中多试几次即可。有条件的小伙伴，建议开着VPN然后再进行编译，整个编译过程会顺畅很多。</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><br></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><br></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">错误纠正：</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">（1）错误1：</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><div style="padding:0px;margin:0px;"><br></div><table style="border-spacing:0px;width:852px;"><colgroup><col></colgroup><tbody><tr><td style="margin:0px;border-color:rgb(50,50,50);background-color:rgb(63,63,63);"><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Reactor Summary:</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO]</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project Parent POM 2.1.0 ..................... SUCCESS [ 48.209 s]</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project Tags ................................. SUCCESS [01:06 min]</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project Sketch ............................... SUCCESS [01:00 min]</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project Networking ........................... SUCCESS [02:14 min]</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project Shuffle Streaming Service ............ SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project Unsafe ............................... SUCCESS [01:47 min]</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project Launcher ............................. SUCCESS [02:16 min]</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project Core ................................. SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project ML Local Library ....................</span><span style="color:rgb(255,255,255);">.</span> <span style="color:rgb(255,0,0);">FAILURE</span> <span style="color:rgb(255,255,255);">[01:31 min]</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project GraphX ............................... SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project Streaming ............................ SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project Catalyst ............................. SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project SQL .................................. SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project ML Library ........................... SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project Tools ................................ SUCCESS [ 36.592 s]</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project Hive ................................. SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project REPL ................................. SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project YARN Shuffle Service ................. SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project YARN ................................. SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project Hive Thrift Server ................... SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project Assembly ............................. SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project External Flume Sink .................. SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project External Flume ....................... SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project External Flume Assembly .............. SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Integration for Kafka 0.8 .................... SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project Examples ............................. SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project External Kafka Assembly .............. SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Integration for Kafka 0.10 ................... SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Integration for Kafka 0.10 Assembly .......... SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Kafka 0.10 Source for Structured Streaming ......... SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Spark Project Java 8 Tests 2.1.0 ................... SKIPPED</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] ------------------------------------------------------------------------</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO]</span> <span style="color:rgb(255,0,0);">BUILD FAILURE</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] ------------------------------------------------------------------------</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Total time: 11:29 min</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] Finished at: 2018-05-04T00:42:48+08:00</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">[INFO] ------------------------------------------------------------------------</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,0,0);">[ERROR]</span> <span style="color:rgb(255,255,255);">Failed to execute goal</span> <span style="color:rgb(65,173,28);">net.alchim31.maven:scala-maven-plugin:3.2.2:testCompile</span> <span style="color:rgb(255,255,255);">(scala-test-compile-first) on project spark-mllib-local_2.11:</span> <span style="color:rgb(255,0,0);">Execution scala-test-compile-first of goal net.alchim31.maven:scala-maven-plugin:3.2.2:testCompile failed.: CompileFailed</span> <span style="color:rgb(255,255,255);">-&gt; [Help 1]</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,0,0);">[ERROR]</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,0,0);">[ERROR]</span> <span style="color:rgb(255,255,255);">To see the full stack trace of the errors, re-run Maven with the -e switch.</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,0,0);">[ERROR]</span> <span style="color:rgb(255,255,255);">Re-run Maven using the -X switch to enable full debug logging.</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,0,0);">[ERROR]</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,0,0);">[ERROR]</span> <span style="color:rgb(255,255,255);">For more information about the errors and possible solutions, please read the following articles:</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,0,0);">[ERROR]</span> <span style="color:rgb(255,255,255);">[Help 1]</span> <a href="http://cwiki.apache.org/confluence/display/MAVEN/PluginExecutionException" rel="nofollow" style="color:rgb(255,255,255);">http://cwiki.apache.org/confluence/display/MAVEN/PluginExecutionException</a></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,0,0);">[ERROR]</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,0,0);">[ERROR]</span> <span style="color:rgb(255,255,255);">After correcting the problems, you can resume the build with the command</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,0,0);">[ERROR] </span><span style="color:rgb(255,255,255);"> </span><span style="color:rgb(255,255,255);"> mvn &lt;goals&gt; -rf :spark-mllib-local_2.11</span></div></td></tr></tbody></table><div style="padding:0px;margin:0px;"><br></div></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">原因：可能网络不好</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">解决方案：</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">方案1：<span style="font-weight:bold;">删除本地 Maven 仓库，然后多次重新编译</span></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><span>方案2：</span><span> </span><span style="background-color:rgb(249,242,244);color:rgb(199,37,78);font-family:Consolas, Inconsolata, Courier, monospace;line-height:22px;">mvn &lt;goals&gt; -rf :spark-sql_2.10</span><span>   </span><span> 从失败的地方(比如 spark-sql_2.10 )开始编译。推荐</span></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">如按照提示在maven 命令后加 -rf :spark-tags_2.11</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">./dev/make-distribution.sh --name 2.6.0-cdh5.7.0 --tgz -Pyarn -Phadoop-2.6 -Phive -Phive-thriftserver -Dhadoop.version=2.6.0-cdh5.7.0 <span style="color:rgb(235,0,115);">-rf :spark-mllib-local_2.11</span>  -U</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">（2）错误2</div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);"><div style="padding:0px;margin:0px;"><br></div><table style="border-spacing:0px;width:852px;"><colgroup><col></colgroup><tbody><tr><td style="margin:0px;border-color:rgb(50,50,50);background-color:rgb(63,63,63);"><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">Java HotSpot(TM) 64-Bit Server VM warning: INFO: os::commit_memory(0x00000000b6c7d000, 98807808, 0) failed; error='Cannot allocate memory' (errno=12)</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);">#</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);"># There is insufficient memory for the Java Runtime Environment to continue.</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);"># Native memory allocation (mmap) failed to map 98807808 bytes for committing reserved memory.</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);"># An error report file with more information is saved as:</span></div><div style="padding:0px;margin:0px;"><span style="color:rgb(255,255,255);"># /www/instl/spark/spark-2.1.0/hs_err_pid15199.log</span></div></td></tr></tbody></table><div style="padding:0px;margin:0px;">原因：内存不够</div></div><div style="padding:0px;margin:0px;color:rgb(51,51,51);font-size:14px;background-color:rgb(255,255,255);">解决方案：加大内存。4G+</div><div><br></div>            </div>
                </div>