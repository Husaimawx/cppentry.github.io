---
layout:     post
title:      【Flume】数据采集引擎Flume
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								<div class="article-copyright">
					版权声明：本文为博主原创文章，未经博主允许不得转载。					https://blog.csdn.net/xin93/article/details/80671642				</div>
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:28px;"><strong>一、概述</strong></span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">flume是一个高效的、可靠的、可用的分布式海量日志数据收集、聚合、传输的工具。</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">Flume is a distributed, reliable, and available service for efficiently collecting, aggregating, and moving large amounts of log data. </span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:28px;"><strong>二、flum的架构</strong></span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><img src="https://img-blog.csdn.net/20180612214343920?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbjkz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:28px;"><strong>三、flume的组件以及作用</strong></span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">client：客户端（运行agent的地方）</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">source： 数据源，负责接收数据</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">channel：管道，负责接收source端的数据，将数据推送到sink端。</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">sink：下沉器，负责去拉取channel的数据，将其持久化到存储系统。</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;"><br></span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">interceptor: 拦截器，flume允许使用拦截器拦截数据，可以作用于source、sink端，flume还可以允许拦截器链。</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;"><br></span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">selector：选择器，作用于source端，决定数据往哪个channel发送。</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;"><br></span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">event：flume的事件，相当于一条数据。</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">agent：flume的客户端，一个agent运行在一个jvm里，它是flume的最小运行单元。</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;"><br></span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">source的种类</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">avro\exec\spooling dir\syslogtcp\httpsource\kafka</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;"><br></span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">channel的种类</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">file、memory、jdbc、kafka</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">sink的种类</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">avro、hdfs、kafka、hbase、logger</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;"><br></span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">数据模型：</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">单一的数据模型：</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">多数据流模型：</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:28px;"><strong>四、flume的安装</strong></span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">flume0.9和1.x的版本</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">1.  0.9之前的 版本叫flume-og， 而1.x的版本叫flume-ng</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">2.  0.9区分逻辑和物理上的节点，而1.x不区分物理和逻辑上的节点，每一个agent都是一个服务。</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">3.  0.9需要master和zookeeper的支持，而1.x 不再需要这些组件的支持。</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;"><span style="font-size:16px;">4.  0.9开发并不是很灵活，而1.x很灵活，</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:28px;"><strong>四、flume案例</strong></span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:20px;"><strong>avro+memory+logger</strong></span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">vi agentconf/avro-logger.conf</div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">#Name the components on the agent</div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">a1.sources=r1</div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">a1.channel=c1</div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">a1.sinks=s1</div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">#describe source </div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">s1.sources.r1.type = avro</div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">s1.sources.r1.bind = 192.168.243.11</div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">s1.sources.r1.port = 44444</div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">#describe channel</div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">a1.channels.c1.type = memory</div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">#describe sinks</div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">a1.sinks.s1.type = logger</div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">#bind source and sink to the channel</div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">a1.source.r1.channels = c1</div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">a1.sinks.s1.channels = c1</div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>启动agent</strong></span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">bin/flume-ng agent -c ./conf -f ./agentconf/avro-logger.conf -n a1 -Dflume.root.logger=INFO,console</div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>测试</strong></span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">bin/flume-ng avro-client -c ./conf -H 192.168.243.11 -p 44444 -F /root/flumedata/test.dat</div>            </div>
                </div>