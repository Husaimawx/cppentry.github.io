---
layout:     post
title:      ELK + Kafka + Filebeat学习
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <div class="article_content csdn-tracking-statistics" style="padding:0px;margin:0px;"><div class="htmledit_views" style="padding:0px;margin-bottom:0px;"><h1 style="padding:0px;text-align:center;"><span style="font-family:'Times New Roman';">ELK + Kafka + Filebeat学习</span></h1><div style="padding:0px;margin:0px;text-align:left;"><h2 style="padding:0px;"><a></a><span style="font-family:'Times New Roman';">目录：<br>1、ELK + Kafka + Filebeat架构<br>2、为什么要使用ELK<br>3、验证流程：Filebeat-&gt;Logstash-&gt;Kafka-&gt;Logstash-&gt;Elasticsearch-&gt;Kibana</span></h2><div style="padding:0px;margin:0px;"><span style="font-family:'Times New Roman';"><br></span></div></div><h1 style="padding:0px;"><a></a><span style="font-family:'Times New Roman';">1 <span>ELK + Kafka + Filebeat架构</span></span></h1><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';"><img src="https://img-blog.csdn.net/20170909010902708?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmVtb2FfRGVuZ3Fpbnlp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""><br></span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">图1.1 ELK + Kafka + Filebeat架构图</span></span></p><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">l Filebeat：</span></span></p><blockquote style="padding:0px;margin-bottom:0px;margin-left:40px;border:none;"><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">日志采集。</span></span></p></blockquote><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">l Logstash：</span></span></p><blockquote style="padding:0px;margin-bottom:0px;margin-left:40px;border:none;"><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">官网描述：Logstash：Collect，Enrich and Transport。收集，丰富和传输，Logstash是用于管理事件和日志的工具。可以使用它来收集日志，解析它们，然后存储它们以备以后使用（例如用来搜索）。</span></span></p></blockquote><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">l Shipper：</span></span></p><blockquote style="padding:0px;margin-bottom:0px;margin-left:40px;border:none;"><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">在每个目标系统上运行的客户端，负责收集日志消息。</span></span></p></blockquote><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">l Kafka：</span></span></p><blockquote style="padding:0px;margin-bottom:0px;margin-left:40px;border:none;"><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">作为消息队列解耦了处理过程，同时提高了可扩展性。具有峰值处理能力，使用消息队列能够使关键组件顶住突发的访问压力，而不会因为突发的超负荷的请求而完全崩溃。</span></span></p></blockquote><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">l Kerberos：</span></span></p><blockquote style="padding:0px;margin-bottom:0px;margin-left:40px;border:none;"><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">基于共享秘钥对称加密的安全网络认证系统，它避免了将密码在网络上传输，而是将密码作为对称加密的秘钥，通过是否能够解密来验证用户的身份。</span></span></p></blockquote><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">l Indexer：</span></span></p><blockquote style="padding:0px;margin-bottom:0px;margin-left:40px;border:none;"><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">负责按管理员指定的方式，汇集日志并转发日志给elasticsearch。</span></span></p></blockquote><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">l Elasticsearch：</span></span></p><blockquote style="padding:0px;margin-bottom:0px;margin-left:40px;border:none;"><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">官网描述：Elasticsearch：Store，Search and Analyze。存储，搜索和分析，用于存储所有的日志。</span></span></p></blockquote><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">l Search Guard：</span></span></p><blockquote style="padding:0px;margin-bottom:0px;margin-left:40px;border:none;"><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">Search Guard是Elasticsearch的安全插件。它为后端系统（如Kerberos）提供身份验证和授权，并向Elasticsearch添加审核日志记录和文档/字段级安全性。</span></span></p></blockquote><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">l Kibana：</span></span></p><blockquote style="padding:0px;margin-bottom:0px;margin-left:40px;border:none;"><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">官网描述：Kibana：Explore，Visualize and Share。浏览，可视化和分享，为Logstash和ElasticSearch提供日志分析友好的Web界面，帮助汇总、分析和搜索重要数据。</span></span></p></blockquote><p align="justify"><span style="font-family:'Times New Roman';"><br></span></p><h1 style="padding:0px;"><a></a><span style="font-family:'Times New Roman';">2 <span>为什么要使用ELK</span></span></h1><blockquote style="padding:0px;margin-bottom:0px;margin-left:40px;border:none;"><p><span style="font-size:14px;"><span style="font-family:'Times New Roman';">l 开发可以通过登录到Kibana拿到日志，而不再需要通过运维，减轻运维的工作，同时运维也方便进行管理；</span></span></p><p><span style="font-size:14px;"><span style="font-family:'Times New Roman';">l 可以解决单个日志文件巨大，常用的文本工具难以分析，检索困难；</span></span></p><p><span style="font-size:14px;"><span style="font-family:'Times New Roman';">l 日志种类多，分散在不同的位置难以查找，通过ELK可以进行统一管理；</span></span></p></blockquote><p><span style="font-family:'Times New Roman';"><br></span></p><h1 style="padding:0px;"><a></a><span style="font-family:'Times New Roman';">3 验证流程：Filebeat-&gt;Logstash-&gt;Kafka-&gt;Logstash-&gt;Elasticsearch-&gt;Kibana</span></h1><p><span style="font-size:14px;"><span style="font-family:'Times New Roman';">软件版本说明：</span></span></p><p><span style="font-size:14px;"><span style="font-family:'Times New Roman';">Filebeat版本：5.2.1</span></span></p><p><span style="font-size:14px;"><span style="font-family:'Times New Roman';">Logstash版本：5.2.2</span></span></p><p><span style="font-size:14px;"><span style="font-family:'Times New Roman';">Kafka版本：0.10.1</span></span></p><p><span style="font-size:14px;"><span style="font-family:'Times New Roman';">Elasticsearch版本：5.2.2</span></span></p><p><span style="font-size:14px;"><span style="font-family:'Times New Roman';">Kibana版本：5.2.2</span></span></p><p><span style="font-size:14px;"><span style="font-family:'Times New Roman';">jdk版本：1.8.0_112</span></span></p><p><span style="font-size:14px;"><span style="font-family:'Times New Roman';">（1）filebeat是通过yum进行安装的，因此修改filebeat配置文件/etc/filebeat目录下filebeat.yml文件对应的output.logstash中logstash的host位置，以及配置监控的日志文件的路径，这里监控的是在/root/remoa目录下的dengqy.log日志文件。</span></span></p><p style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';"> <img src="https://img-blog.csdn.net/20170909010956096?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmVtb2FfRGVuZ3Fpbnlp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></span></span></p><p style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">图3.1 截图1</span></span></p><p style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';"> <img src="https://img-blog.csdn.net/20170909011012409?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmVtb2FfRGVuZ3Fpbnlp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></span></span></p><p style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">图3.2 截图2</span></span></p><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">（2）查看kafka中broker服务器的hosts位置：</span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';"> <img src="https://img-blog.csdn.net/20170909011022490?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmVtb2FfRGVuZ3Fpbnlp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">图3.3 截图3</span></span></p><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">（3）查看Elasticsearch中服务器的host位置：在/opt/package/elasticsearch-5.2.2/config目录下查看elasticsearch.yml文件中的host的ip地址及运行HTTP服务的端口，端口注释即使用默认端口9200。</span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';"> <img src="https://img-blog.csdn.net/20170909011030734?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmVtb2FfRGVuZ3Fpbnlp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">图3.4 截图4</span></span></p><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">（4）查看用于Elasticsearch身份验证的keys文件位置：</span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';"> <img src="https://img-blog.csdn.net/20170909011041543?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmVtb2FfRGVuZ3Fpbnlp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">图3.5 截图5</span></span></p><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">（5）配置remoatest2.conf文件作为filebeat input logstash以及logstash output kafka。</span></span></p><p align="justify"></p><div class="dp-highlighter bg_plain" style="padding:1px 0px 0px;margin:0px 0px 24px;font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;background-color:rgb(231,229,220);width:843.469px;text-align:left;"><div class="bar" style="padding:0px 0px 0px 45px;margin:0px;"><div class="tools" style="padding:3px 8px 10px 10px;margin:0px;font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;background-color:rgb(248,248,248);border-left:3px solid rgb(108,226,108);border-right:1px solid rgb(231,229,220);"><span>[plain]</span> <a href="https://blog.csdn.net/Remoa_Dengqinyi/article/details/77902391#" rel="nofollow" class="ViewSource" title="view plain" style='background-image:url("https://csdnimg.cn/release/phoenix/images/ico_plain.gif");background-position:left top;background-repeat:no-repeat;background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;width:16px;height:16px;text-indent:-2000px;'>view plain</a><span> <a href="https://blog.csdn.net/Remoa_Dengqinyi/article/details/77902391#" rel="nofollow" class="CopyToClipboard" title="copy" style='background-image:url("https://csdnimg.cn/release/phoenix/images/ico_copy.gif");background-position:left top;background-repeat:no-repeat;background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;width:16px;height:16px;text-indent:-2000px;'>copy</a></span><div style="padding:0px;margin:0px;width:16px;height:16px;"></div><div style="padding:0px;margin:0px;width:16px;height:16px;"></div><span></span></div></div><ol start="1" style="border-top:none;border-right:1px solid rgb(231,229,220);border-bottom:none;border-left:none;background-color:rgb(255,255,255);color:rgb(92,92,92);"><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;"><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&lt;span style="font-size:14px;"&gt;&lt;span style="font-family:'Times New Roman';"&gt;input {  </span></span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">        beats{  </span></li><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                port =&gt; 5044  </span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">        }  </span></li><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">}  </span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">output {  </span></li><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">    stdout{codec =&gt; rubydebug}  </span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">    kafka{  </span></li><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                topic_id =&gt; "dengqytopic"  </span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                bootstrap_servers =&gt; "hdp1.example.com:9092"  </span></li><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                security_protocol =&gt; "SASL_PLAINTEXT"  </span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                sasl_kerberos_service_name =&gt; "kafka"  </span></li><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                jaas_path =&gt; "/tmp/kafka_jaas.conf.demouser"  </span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                kerberos_config =&gt; "/etc/krb5.conf"  </span></li><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                compression_type =&gt; "none"  </span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                acks =&gt; "1"  </span></li><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">        }  </span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">}&lt;/span&gt;&lt;/span&gt;  </span></li></ol></div><p></p><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">（6）配置remoatest3.conf文件作为kafka input logstash以及logstash output elasticsearch。</span></span></p><p align="justify"></p><div class="dp-highlighter bg_plain" style="padding:1px 0px 0px;margin:0px 0px 24px;font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;background-color:rgb(231,229,220);width:843.469px;text-align:left;"><div class="bar" style="padding:0px 0px 0px 45px;margin:0px;"><div class="tools" style="padding:3px 8px 10px 10px;margin:0px;font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;background-color:rgb(248,248,248);border-left:3px solid rgb(108,226,108);border-right:1px solid rgb(231,229,220);"><span>[plain]</span> <a href="https://blog.csdn.net/Remoa_Dengqinyi/article/details/77902391#" rel="nofollow" class="ViewSource" title="view plain" style='background-image:url("https://csdnimg.cn/release/phoenix/images/ico_plain.gif");background-position:left top;background-repeat:no-repeat;background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;width:16px;height:16px;text-indent:-2000px;'>view plain</a><span> <a href="https://blog.csdn.net/Remoa_Dengqinyi/article/details/77902391#" rel="nofollow" class="CopyToClipboard" title="copy" style='background-image:url("https://csdnimg.cn/release/phoenix/images/ico_copy.gif");background-position:left top;background-repeat:no-repeat;background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;width:16px;height:16px;text-indent:-2000px;'>copy</a></span><div style="padding:0px;margin:0px;width:16px;height:16px;"></div><div style="padding:0px;margin:0px;width:16px;height:16px;"></div><span></span></div></div><ol start="1" style="border-top:none;border-right:1px solid rgb(231,229,220);border-bottom:none;border-left:none;background-color:rgb(255,255,255);color:rgb(92,92,92);"><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;"><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&lt;span style="font-size:14px;"&gt;&lt;span style="font-family:'Times New Roman';"&gt;input{  </span></span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">        kafka{  </span></li><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                bootstrap_servers =&gt; "hdp1.example.com:9092"  </span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                security_protocol =&gt; "SASL_PLAINTEXT"  </span></li><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                sasl_kerberos_service_name =&gt; "kafka"  </span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                jaas_path =&gt; "/tmp/kafka_jaas.conf.demouser"  </span></li><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                kerberos_config =&gt; "/etc/krb5.conf"  </span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                topics =&gt; ["dengqytopic"]  </span></li><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">        }  </span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">}  </span></li><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">output{  </span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">        stdout{  </span></li><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                codec =&gt; rubydebug  </span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">        }  </span></li><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">        elasticsearch{  </span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                hosts =&gt; ["kdc1.example.com:9200","kdc2.example.com:9200"]  </span></li><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                user =&gt; logstash  </span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                password =&gt; logstash  </span></li><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                action =&gt; "index"  </span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                index =&gt; "logstash-dengqy-%{+YYYY.MM.dd}"  </span></li><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                truststore =&gt; "/opt/package/logstash-5.2.2/config/keys/truststore.jks"  </span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                truststore_password =&gt; whoami  </span></li><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                ssl =&gt; true  </span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                ssl_certificate_verification =&gt; true  </span></li><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">                codec =&gt; "json"  </span></li><li style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);background-color:rgb(248,248,248);line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">        }  </span></li><li class="alt" style="border-top:none;border-right:none;border-bottom:none;border-left:3px solid rgb(108,226,108);color:inherit;line-height:18px;padding:0px 3px 0px 10px;margin-right:0px;margin-bottom:0px;list-style-position:outside;"><span style="margin:0px;padding:0px;border:none;color:#000000;background-color:inherit;">}&lt;/span&gt;&lt;/span&gt;  </span></li></ol></div><p></p><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">（7）启动消费者监控：</span></span></p><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">KAFKA_HEAP_OPTS="-Djava.security.auth.login.config=/usr/hdp/current/kafka-broker/config/kafka_client_jaas.conf -Xmx512M"  /opt/package/kafka_2.10-0.10.1.0/bin/kafka-console-consumer.sh --topic dengqytopic --bootstrap-server hdp1.example.com:9092  --from-beginning --consumer.config /opt/package/kafka_2.10-0.10.1.0/config/consumer.properties</span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';"> <img src="https://img-blog.csdn.net/20170909011131453?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmVtb2FfRGVuZ3Fpbnlp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">图3.6 截图6</span></span></p><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">（8）启动remoatest2.conf脚本：</span></span></p><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">bash ../bin/logstash -f remoatest2.conf</span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';"> <img src="https://img-blog.csdn.net/20170909011141223?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmVtb2FfRGVuZ3Fpbnlp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">图3.7 截图7</span></span></p><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">（9）启动remoatest3.conf脚本：</span></span></p><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">bash bin/logstash -f config/remoatest3.conf</span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';"> <img src="https://img-blog.csdn.net/20170909011150529?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmVtb2FfRGVuZ3Fpbnlp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">图3.8 截图8</span></span></p><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">（10）启动filebeat收集：</span></span></p><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">service filebeat start</span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';"> <img src="https://img-blog.csdn.net/20170909011204253?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmVtb2FfRGVuZ3Fpbnlp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">图3.9 截图9</span></span></p><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">（11）查看到remoatest3.conf中配置的stdout{codec =&gt; rubydebug}标准输出：</span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';"> <img src="https://img-blog.csdn.net/20170909011211698?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmVtb2FfRGVuZ3Fpbnlp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">图3.10 截图10</span></span></p><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">（12）查看到remoatest2.conf中配置的stdout{codec =&gt; rubydebug}标准输出：</span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';"><img src="https://img-blog.csdn.net/20170909011229612?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmVtb2FfRGVuZ3Fpbnlp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">图3.11 截图11</span></span></p><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">（13）查看到消费者中处理日志：</span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';"> <img src="https://img-blog.csdn.net/20170909011248004?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmVtb2FfRGVuZ3Fpbnlp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">图3.12 截图12</span></span></p><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">（14）在Kibana中查看到对应的index：</span></span></p><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">GET _cat/indices</span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';"> <img src="https://img-blog.csdn.net/20170909011259536?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmVtb2FfRGVuZ3Fpbnlp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">图3.13 截图13</span></span></p><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">（15）查看该index详细内容，数据总量及数据内容一致，即存入elasticsearch中成功：</span></span></p><p align="justify"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">GET logstash-dengqy-2017.09.08/_search</span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';"> <img src="https://img-blog.csdn.net/20170909011310902?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmVtb2FfRGVuZ3Fpbnlp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></span></span></p><p align="justify" style="text-align:center;"><span style="font-size:14px;"><span style="font-family:'Times New Roman';">图3.14 截图14</span></span></p><p align="justify"><br></p></div></div><div class="article-bar-bottom" style="padding:0px 0px 16px;margin:36px 0px 0px;border-bottom:1px solid rgb(227,227,227);color:rgb(51,51,51);font-family:'SF Pro Display', Roboto, Noto, Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;font-size:14px;"><div class="article-copyright" style="padding:0px;margin:0px;font-size:12px;color:rgb(153,153,153);">版权声明：感谢来访！欢迎指导、勘误、讨论及转载，转载请注明出处：blog.csdn.net/remoa_dengqinyi https://blog.csdn.net/Remoa_Dengqinyi/article/details/77902391</div></div>            </div>
                </div>