---
layout:     post
title:      Flume 1.7.0安装与实例
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								<div class="article-copyright">
					版权声明：本文为博主原创文章，未经博主允许不得转载。					https://blog.csdn.net/strongyoung88/article/details/52937835				</div>
								            <div id="content_views" class="markdown_views prism-atom-one-dark">
							<!-- flowchart 箭头图标 勿删 -->
							<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path></svg>
							<h1 id="flume安装">Flume安装</h1>

<p>系统要求： <br>
需安装JDK 1.7及以上版本</p>

<p>1、 下载二进制包 <br>
    下载页面：<a href="http://flume.apache.org/download.html" rel="nofollow">http://flume.apache.org/download.html</a> <br>
    1.7.0下载地址：<a href="http://www.apache.org/dyn/closer.lua/flume/1.7.0/apache-flume-1.7.0-bin.tar.gz" rel="nofollow">http://www.apache.org/dyn/closer.lua/flume/1.7.0/apache-flume-1.7.0-bin.tar.gz</a></p>

<p>2、解压</p>



<pre class="prettyprint"><code class=" hljs lasso">$ cp ~/Downloads/apache<span class="hljs-attribute">-flume</span><span class="hljs-subst">-</span><span class="hljs-number">1.7</span><span class="hljs-number">.0</span><span class="hljs-attribute">-bin</span><span class="hljs-built_in">.</span>tar<span class="hljs-built_in">.</span>gz ~
$ cd 
$ tar <span class="hljs-attribute">-zxvf</span> apache<span class="hljs-attribute">-flume</span><span class="hljs-subst">-</span><span class="hljs-number">1.7</span><span class="hljs-number">.0</span><span class="hljs-attribute">-bin</span><span class="hljs-built_in">.</span>tar<span class="hljs-built_in">.</span>gz
$ cd apache<span class="hljs-attribute">-flume</span><span class="hljs-subst">-</span><span class="hljs-number">1.7</span><span class="hljs-number">.0</span><span class="hljs-attribute">-bin</span></code></pre>

<p>3、创建flume-env.sh文件</p>



<pre class="prettyprint"><code class=" hljs avrasm">
$ <span class="hljs-keyword">cp</span> conf/flume-env<span class="hljs-preprocessor">.sh</span><span class="hljs-preprocessor">.template</span> conf/flume-env<span class="hljs-preprocessor">.sh</span></code></pre>



<h1 id="简单实例传输指定文件">简单实例－传输指定文件</h1>

<p>场景：两台机器，一台为client，一台为agent，在client上将指定文件传输到agent机器上。</p>

<p>1、创建配置文件 </p>

<p>根据flume自身提供的模板，创建flume.conf配置文件。</p>



<pre class="prettyprint"><code class=" hljs avrasm">
$ <span class="hljs-keyword">cp</span> conf/flume-conf<span class="hljs-preprocessor">.properties</span><span class="hljs-preprocessor">.template</span> conf/flume<span class="hljs-preprocessor">.conf</span></code></pre>

<p>编辑文件flume.conf：</p>



<pre class="prettyprint"><code class=" hljs ruby"><span class="hljs-variable">$ </span>vi conf/flume.conf</code></pre>

<p>在文件末尾加入以下配置：</p>



<pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-preprocessor"># Define a memory channel called ch1 on agent1</span>
agent1<span class="hljs-preprocessor">.channels</span><span class="hljs-preprocessor">.ch</span>1<span class="hljs-preprocessor">.type</span> = memory

<span class="hljs-preprocessor"># Define an Avro source called avro-source1 on agent1 and tell it</span>
<span class="hljs-preprocessor"># to bind to 0.0.0.0:41414. Connect it to channel ch1.</span>
agent1<span class="hljs-preprocessor">.sources</span><span class="hljs-preprocessor">.avro</span>-source1<span class="hljs-preprocessor">.channels</span> = ch1
agent1<span class="hljs-preprocessor">.sources</span><span class="hljs-preprocessor">.avro</span>-source1<span class="hljs-preprocessor">.type</span> = avro
agent1<span class="hljs-preprocessor">.sources</span><span class="hljs-preprocessor">.avro</span>-source1<span class="hljs-preprocessor">.bind</span> = <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>
agent1<span class="hljs-preprocessor">.sources</span><span class="hljs-preprocessor">.avro</span>-source1<span class="hljs-preprocessor">.port</span> = <span class="hljs-number">41414</span>

<span class="hljs-preprocessor"># Define a logger sink that simply logs all events it receives</span>
<span class="hljs-preprocessor"># and connect it to the other end of the same channel.</span>
agent1<span class="hljs-preprocessor">.sinks</span><span class="hljs-preprocessor">.log</span>-sink1<span class="hljs-preprocessor">.channel</span> = ch1
agent1<span class="hljs-preprocessor">.sinks</span><span class="hljs-preprocessor">.log</span>-sink1<span class="hljs-preprocessor">.type</span> = logger

<span class="hljs-preprocessor"># Finally, now that we've defined all of our components, tell</span>
<span class="hljs-preprocessor"># agent1 which ones we want to activate.</span>
agent1<span class="hljs-preprocessor">.channels</span> = ch1
agent1<span class="hljs-preprocessor">.sources</span> = avro-source1
agent1<span class="hljs-preprocessor">.sinks</span> = log-sink1</code></pre>

<p>保存，并且退出：</p>

<p>2、启动flume server <br>
在作为agent的机器上执行以下：</p>



<pre class="prettyprint"><code class=" hljs lasso">
bin/flume<span class="hljs-attribute">-ng</span> agent <span class="hljs-subst">--</span>conf <span class="hljs-built_in">.</span>/conf<span class="hljs-subst">/</span> <span class="hljs-attribute">-f</span> conf/flume<span class="hljs-built_in">.</span>conf <span class="hljs-attribute">-Dflume</span><span class="hljs-built_in">.</span>root<span class="hljs-built_in">.</span>logger<span class="hljs-subst">=</span>DEBUG,console <span class="hljs-attribute">-n</span> agent1</code></pre>

<p>3、在新的窗口开启client <br>
在作为client的机器上执行以下： <br>
（由于当前环境是在单机上模拟两台机器，所以，直接在新的终端中输入以下命令）</p>



<pre class="prettyprint"><code class=" hljs lasso">
$ bin/flume<span class="hljs-attribute">-ng</span> avro<span class="hljs-attribute">-client</span> <span class="hljs-subst">--</span>conf conf <span class="hljs-attribute">-H</span> localhost <span class="hljs-attribute">-p</span> <span class="hljs-number">41414</span> <span class="hljs-attribute">-F</span> /etc/passwd <span class="hljs-attribute">-Dflume</span><span class="hljs-built_in">.</span>root<span class="hljs-built_in">.</span>logger<span class="hljs-subst">=</span>DEBUG,console</code></pre>

<p>4、结果 <br>
这个时候，你可以看到以下消息：</p>



<pre class="prettyprint"><code class=" hljs avrasm">
<span class="hljs-number">2012</span>-<span class="hljs-number">03</span>-<span class="hljs-number">16</span> <span class="hljs-number">16</span>:<span class="hljs-number">39</span>:<span class="hljs-number">17</span>,<span class="hljs-number">124</span> (main) [DEBUG - org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.client</span><span class="hljs-preprocessor">.avro</span><span class="hljs-preprocessor">.AvroCLIClient</span><span class="hljs-preprocessor">.run</span>(AvroCLIClient<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">175</span>)] Finished
<span class="hljs-number">2012</span>-<span class="hljs-number">03</span>-<span class="hljs-number">16</span> <span class="hljs-number">16</span>:<span class="hljs-number">39</span>:<span class="hljs-number">17</span>,<span class="hljs-number">127</span> (main) [DEBUG - org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.client</span><span class="hljs-preprocessor">.avro</span><span class="hljs-preprocessor">.AvroCLIClient</span><span class="hljs-preprocessor">.run</span>(AvroCLIClient<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">178</span>)] Closing reader
<span class="hljs-number">2012</span>-<span class="hljs-number">03</span>-<span class="hljs-number">16</span> <span class="hljs-number">16</span>:<span class="hljs-number">39</span>:<span class="hljs-number">17</span>,<span class="hljs-number">127</span> (main) [DEBUG - org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.client</span><span class="hljs-preprocessor">.avro</span><span class="hljs-preprocessor">.AvroCLIClient</span><span class="hljs-preprocessor">.run</span>(AvroCLIClient<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">183</span>)] Closing transceiver
<span class="hljs-number">2012</span>-<span class="hljs-number">03</span>-<span class="hljs-number">16</span> <span class="hljs-number">16</span>:<span class="hljs-number">39</span>:<span class="hljs-number">17</span>,<span class="hljs-number">129</span> (main) [DEBUG - org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.client</span><span class="hljs-preprocessor">.avro</span><span class="hljs-preprocessor">.AvroCLIClient</span><span class="hljs-preprocessor">.main</span>(AvroCLIClient<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">73</span>)] Exiting</code></pre>

<p>在前面那个开启flume server的窗口，可以看到如下消息：</p>



<pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-number">2012</span>-<span class="hljs-number">03</span>-<span class="hljs-number">16</span> <span class="hljs-number">16</span>:<span class="hljs-number">39</span>:<span class="hljs-number">16</span>,<span class="hljs-number">738</span> (New I/O server boss <span class="hljs-preprocessor">#1 ([id: 0x49e808ca, /0:0:0:0:0:0:0:0:41414])) [INFO - org.apache.avro.ipc.NettyServer$NettyServerAvroHandler.handleUpstream(NettyServer.java:123)] [id: 0x0b92a848, /1</span>
<span class="hljs-number">27.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">39577</span> =&gt; /<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">41414</span>] OPEN
<span class="hljs-number">2012</span>-<span class="hljs-number">03</span>-<span class="hljs-number">16</span> <span class="hljs-number">16</span>:<span class="hljs-number">39</span>:<span class="hljs-number">16</span>,<span class="hljs-number">742</span> (New I/O server worker <span class="hljs-preprocessor">#1-1) [INFO - org.apache.avro.ipc.NettyServer$NettyServerAvroHandler.handleUpstream(NettyServer.java:123)] [id: 0x0b92a848, /127.0.0.1:39577 =&gt; /127.0.0.1:41414] BOU</span>
<span class="hljs-label">ND:</span> /<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">41414</span>
<span class="hljs-number">2012</span>-<span class="hljs-number">03</span>-<span class="hljs-number">16</span> <span class="hljs-number">16</span>:<span class="hljs-number">39</span>:<span class="hljs-number">16</span>,<span class="hljs-number">742</span> (New I/O server worker <span class="hljs-preprocessor">#1-1) [INFO - org.apache.avro.ipc.NettyServer$NettyServerAvroHandler.handleUpstream(NettyServer.java:123)] [id: 0x0b92a848, /127.0.0.1:39577 =&gt; /127.0.0.1:41414] CON</span>
<span class="hljs-label">NECTED:</span> /<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">39577</span>
<span class="hljs-number">2012</span>-<span class="hljs-number">03</span>-<span class="hljs-number">16</span> <span class="hljs-number">16</span>:<span class="hljs-number">39</span>:<span class="hljs-number">17</span>,<span class="hljs-number">129</span> (New I/O server worker <span class="hljs-preprocessor">#1-1) [INFO - org.apache.avro.ipc.NettyServer$NettyServerAvroHandler.handleUpstream(NettyServer.java:123)] [id: 0x0b92a848, /127.0.0.1:39577 :&gt; /127.0.0.1:41414] DISCONNECTED</span>
<span class="hljs-number">2012</span>-<span class="hljs-number">03</span>-<span class="hljs-number">16</span> <span class="hljs-number">16</span>:<span class="hljs-number">39</span>:<span class="hljs-number">17</span>,<span class="hljs-number">129</span> (New I/O server worker <span class="hljs-preprocessor">#1-1) [INFO - org.apache.avro.ipc.NettyServer$NettyServerAvroHandler.handleUpstream(NettyServer.java:123)] [id: 0x0b92a848, /127.0.0.1:39577 :&gt; /127.0.0.1:41414] UNBOUND</span>
<span class="hljs-number">2012</span>-<span class="hljs-number">03</span>-<span class="hljs-number">16</span> <span class="hljs-number">16</span>:<span class="hljs-number">39</span>:<span class="hljs-number">17</span>,<span class="hljs-number">129</span> (New I/O server worker <span class="hljs-preprocessor">#1-1) [INFO - org.apache.avro.ipc.NettyServer$NettyServerAvroHandler.handleUpstream(NettyServer.java:123)] [id: 0x0b92a848, /127.0.0.1:39577 :&gt; /127.0.0.1:41414] CLOSED</span>
<span class="hljs-number">2012</span>-<span class="hljs-number">03</span>-<span class="hljs-number">16</span> <span class="hljs-number">16</span>:<span class="hljs-number">39</span>:<span class="hljs-number">17</span>,<span class="hljs-number">302</span> (Thread-<span class="hljs-number">1</span>) [INFO - org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.LoggerSink</span><span class="hljs-preprocessor">.process</span>(LoggerSink<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">68</span>)] Event: { headers:{} body:[B<span class="hljs-localvars">@5</span>c1ae90c }
<span class="hljs-number">2012</span>-<span class="hljs-number">03</span>-<span class="hljs-number">16</span> <span class="hljs-number">16</span>:<span class="hljs-number">39</span>:<span class="hljs-number">17</span>,<span class="hljs-number">302</span> (Thread-<span class="hljs-number">1</span>) [INFO - org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.LoggerSink</span><span class="hljs-preprocessor">.process</span>(LoggerSink<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">68</span>)] Event: { headers:{} body:[B<span class="hljs-localvars">@6</span>aba4211 }
<span class="hljs-number">2012</span>-<span class="hljs-number">03</span>-<span class="hljs-number">16</span> <span class="hljs-number">16</span>:<span class="hljs-number">39</span>:<span class="hljs-number">17</span>,<span class="hljs-number">302</span> (Thread-<span class="hljs-number">1</span>) [INFO - org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.LoggerSink</span><span class="hljs-preprocessor">.process</span>(LoggerSink<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">68</span>)] Event: { headers:{} body:[B<span class="hljs-localvars">@6</span>a47a0d4 }
<span class="hljs-number">2012</span>-<span class="hljs-number">03</span>-<span class="hljs-number">16</span> <span class="hljs-number">16</span>:<span class="hljs-number">39</span>:<span class="hljs-number">17</span>,<span class="hljs-number">302</span> (Thread-<span class="hljs-number">1</span>) [INFO - org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.LoggerSink</span><span class="hljs-preprocessor">.process</span>(LoggerSink<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">68</span>)] Event: { headers:{} body:[B<span class="hljs-localvars">@48</span>ff4cf }
...</code></pre>



<h1 id="简单实例将目录文件上传到hdfs">简单实例－将目录文件上传到HDFS</h1>

<p>场景：将机器上的某个文件夹下的文件上传到HDFS上。</p>

<p>1、配置conf/flume.conf</p>



<pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-preprocessor"># Define a memory channel called ch1 on agent1</span>
agent1<span class="hljs-preprocessor">.channels</span><span class="hljs-preprocessor">.ch</span>1<span class="hljs-preprocessor">.type</span> = memory

<span class="hljs-preprocessor"># Define an Avro source called avro-source1 on agent1 and tell it</span>
<span class="hljs-preprocessor"># to bind to 0.0.0.0:41414. Connect it to channel ch1.</span>
agent1<span class="hljs-preprocessor">.sources</span><span class="hljs-preprocessor">.spooldir</span>-source1<span class="hljs-preprocessor">.channels</span> = ch1
agent1<span class="hljs-preprocessor">.sources</span><span class="hljs-preprocessor">.spooldir</span>-source1<span class="hljs-preprocessor">.type</span> = spooldir
agent1<span class="hljs-preprocessor">.sources</span><span class="hljs-preprocessor">.spooldir</span>-source1<span class="hljs-preprocessor">.spoolDir</span>=/home/hadoop/flume-<span class="hljs-number">1.7</span><span class="hljs-number">.0</span>/tmpData
agent1<span class="hljs-preprocessor">.sources</span><span class="hljs-preprocessor">.spooldir</span>-source1<span class="hljs-preprocessor">.bind</span> = <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>
agent1<span class="hljs-preprocessor">.sources</span><span class="hljs-preprocessor">.spooldir</span>-source1<span class="hljs-preprocessor">.port</span> = <span class="hljs-number">41414</span>

<span class="hljs-preprocessor"># Define a logger sink that simply logs all events it receives</span>
<span class="hljs-preprocessor"># and connect it to the other end of the same channel.</span>
agent1<span class="hljs-preprocessor">.sinks</span><span class="hljs-preprocessor">.hdfs</span>-sink1<span class="hljs-preprocessor">.channel</span> = ch1
agent1<span class="hljs-preprocessor">.sinks</span><span class="hljs-preprocessor">.hdfs</span>-sink1<span class="hljs-preprocessor">.type</span> = hdfs
agent1<span class="hljs-preprocessor">.sinks</span><span class="hljs-preprocessor">.hdfs</span>-sink1<span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.path</span> = hdfs://master:<span class="hljs-number">9000</span>/test
agent1<span class="hljs-preprocessor">.sinks</span><span class="hljs-preprocessor">.hdfs</span>-sink1<span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.filePrefix</span> = events-
agent1<span class="hljs-preprocessor">.sinks</span><span class="hljs-preprocessor">.hdfs</span>-sink1<span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.useLocalTimeStamp</span> = true
agent1<span class="hljs-preprocessor">.sinks</span><span class="hljs-preprocessor">.hdfs</span>-sink1<span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.round</span> = true
agent1<span class="hljs-preprocessor">.sinks</span><span class="hljs-preprocessor">.hdfs</span>-sink1<span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.roundValue</span> = <span class="hljs-number">10</span>

<span class="hljs-preprocessor"># Finally, now that we've defined all of our components, tell</span>
<span class="hljs-preprocessor"># agent1 which ones we want to activate.</span>
agent1<span class="hljs-preprocessor">.channels</span> = ch1
agent1<span class="hljs-preprocessor">.sources</span> = spooldir-source1
agent1<span class="hljs-preprocessor">.sinks</span> = hdfs-sink1
</code></pre>

<p>其中，/home/hadoop/flume-1.7.0/tmpData是我要上传的文件所在目录，也就是，我要将此文件夹下的文件都上传到HDFS上的hdfs://master:9000/test目录。</p>

<p><strong><em>注意</em></strong>：</p>

<ul>
<li>这样的配置会产生许多小文件，因为默认情况下，一个文件存储10个event，这个配置由rollCount控制，默认为10，此外还有一个参数为rollSize，这个是控制一个文件的大小，如果文件大于这个数值，就是另起一文件。</li>
<li>此时的文件名都是以event开头，如果想保留原来文件的名字，可以使用以下配置（其中，basenameHeader是相对source而言，filePrefix是相对sink而言，分别这样设置之后，上传到hdfs上的文件名就会变成“原始文件名.时间戳”）：</li>
</ul>



<pre class="prettyprint"><code class=" hljs avrasm">agent1<span class="hljs-preprocessor">.sources</span><span class="hljs-preprocessor">.spooldir</span>-source1<span class="hljs-preprocessor">.basenameHeader</span> = true
agent1<span class="hljs-preprocessor">.sinks</span><span class="hljs-preprocessor">.hdfs</span>-sink1<span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.filePrefix</span> = %{basename}
agent1<span class="hljs-preprocessor">.sinks</span><span class="hljs-preprocessor">.hdfs</span>-sink1<span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.rollSize</span> = <span class="hljs-number">0</span>  
agent1<span class="hljs-preprocessor">.sinks</span><span class="hljs-preprocessor">.hdfs</span>-sink1<span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.rollCount</span> = <span class="hljs-number">0</span>
</code></pre>

<p>2、启动agent <br>
使用以下命令启动agent：</p>

<pre class="prettyprint"><code class=" hljs avrasm">bin/flume-ng agent --conf ./conf/ -f ./conf/flume<span class="hljs-preprocessor">.conf</span> --name agent1 -Dflume<span class="hljs-preprocessor">.root</span><span class="hljs-preprocessor">.logger</span>=DEBUG,console</code></pre>

<p>3、查看结果 <br>
到Hadoop提供的WEB GUI界面可以看到刚刚上传的文件是否成功。 <br>
GUI界面地址为：<a href="http://master:50070/explorer.html#/test" rel="nofollow">http://master:50070/explorer.html#/test</a> <br>
其中，master为Hadoop的Namenode所在的机器名。</p>

<p>4、总结 <br>
在这个场景，需要将文件上传到HDFS上，会使用到几个Hadoop的jar包，分别是：</p>



<pre class="prettyprint"><code class=" hljs bash"><span class="hljs-variable">${HADOOP_HOME}</span>share/hadoop/common/hadoop-common-<span class="hljs-number">2.4</span>.<span class="hljs-number">0</span>.jar
<span class="hljs-variable">${HADOOP_HOME}</span>share/hadoop/common/lib/commons-configuration-<span class="hljs-number">1.6</span>.jar
<span class="hljs-variable">${HADOOP_HOME}</span>share/hadoop/common/lib/hadoop-auth-<span class="hljs-number">2.4</span>.<span class="hljs-number">0</span>.jar
<span class="hljs-variable">${HADOOP_HOME}</span>share/hadoop/hdfs/hadoop-hdfs-<span class="hljs-number">2.4</span>.<span class="hljs-number">0</span>.jar</code></pre>

<p>当我使用HDP的Hadoop2.7时，还会用到以下jar包：</p>



<pre class="prettyprint"><code class=" hljs lasso">common<span class="hljs-attribute">-io</span><span class="hljs-subst">-</span><span class="hljs-number">2.4</span><span class="hljs-built_in">.</span>jar
htrace<span class="hljs-attribute">-core</span><span class="hljs-subst">-</span><span class="hljs-number">3.1</span><span class="hljs-number">.0</span><span class="hljs-attribute">-incubating</span><span class="hljs-built_in">.</span>jar</code></pre>

<p>以上包都可以在hadoop相关的lib目录下找到</p>



<h1 id="异常">异常</h1>



<h2 id="failed-to-start-agent-because-dependencies-were-not-found-in-classpath-error-follows-javalangnoclassdeffounderror-orgapachehadoopiosequencefilecompressiontype">Failed to start agent because dependencies were not found in classpath. Error follows. java.lang.NoClassDefFoundError org/apache/hadoop/io/SequenceFile$CompressionType</h2>



<pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">03</span> <span class="hljs-number">14</span>:<span class="hljs-number">49</span>:<span class="hljs-number">35</span>,<span class="hljs-number">278</span> (conf-file-poller-<span class="hljs-number">0</span>) [ERROR - org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.node</span><span class="hljs-preprocessor">.PollingPropertiesFileConfigurationProvider</span>$FileWatcherRunnable<span class="hljs-preprocessor">.run</span>(PollingPropertiesFileConfigurationProvider<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">146</span>)] Failed to start agent because dependencies were not found <span class="hljs-keyword">in</span> classpath. Error follows.
<span class="hljs-label">java.lang.NoClassDefFoundError:</span> org/apache/hadoop/io/SequenceFile$CompressionType
</code></pre>

<p>问题原因：缺少依赖包，这个依赖包是以下jar文件：</p>



<pre class="prettyprint"><code class=" hljs axapta">${HADOOP_HOME}share/hadoop/<span class="hljs-keyword">common</span>/hadoop-<span class="hljs-keyword">common</span>-<span class="hljs-number">2.4</span><span class="hljs-number">.0</span>.jar
</code></pre>

<p>解决方法：找到这个jar文件，copy到flume安装目录下的lib目录下就ok了。</p>



<h2 id="javalangnullpointerexception-expected-timestamp-in-the-flume-event-headers-but-it-was-null">java.lang.NullPointerException: Expected timestamp in the Flume event headers, but it was null</h2>



<pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">03</span> <span class="hljs-number">16</span>:<span class="hljs-number">32</span>:<span class="hljs-number">06</span>,<span class="hljs-number">741</span> (SinkRunner-PollingRunner-DefaultSinkProcessor) [ERROR - org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.HDFSEventSink</span><span class="hljs-preprocessor">.process</span>(HDFSEventSink<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">447</span>)] process failed
<span class="hljs-label">java.lang.NullPointerException:</span> Expected timestamp <span class="hljs-keyword">in</span> the Flume event headers, but it was null
    at <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.google</span><span class="hljs-preprocessor">.common</span><span class="hljs-preprocessor">.base</span><span class="hljs-preprocessor">.Preconditions</span><span class="hljs-preprocessor">.checkNotNull</span>(Preconditions<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">204</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.formatter</span><span class="hljs-preprocessor">.output</span><span class="hljs-preprocessor">.BucketPath</span><span class="hljs-preprocessor">.replaceShorthand</span>(BucketPath<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">256</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.formatter</span><span class="hljs-preprocessor">.output</span><span class="hljs-preprocessor">.BucketPath</span><span class="hljs-preprocessor">.escapeString</span>(BucketPath<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">465</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.HDFSEventSink</span><span class="hljs-preprocessor">.process</span>(HDFSEventSink<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">368</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.DefaultSinkProcessor</span><span class="hljs-preprocessor">.process</span>(DefaultSinkProcessor<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">67</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.SinkRunner</span>$PollingRunner<span class="hljs-preprocessor">.run</span>(SinkRunner<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">145</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.Thread</span><span class="hljs-preprocessor">.run</span>(Thread<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">745</span>)

</code></pre>

<p>解决方法： <br>
编辑conf/flume.conf文件，其中agent1，sink1替换成你自己的agent和sink</p>



<pre class="prettyprint"><code class=" hljs avrasm">agent1<span class="hljs-preprocessor">.sinks</span><span class="hljs-preprocessor">.sink</span>1<span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.useLocalTimeStamp</span> = true</code></pre>



<h2 id="javalangnoclassdeffounderror-orgapachecommonsconfigurationconfiguration">java.lang.NoClassDefFoundError: org/apache/commons/configuration/Configuration</h2>



<pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">03</span> <span class="hljs-number">16</span>:<span class="hljs-number">32</span>:<span class="hljs-number">55</span>,<span class="hljs-number">594</span> (SinkRunner-PollingRunner-DefaultSinkProcessor) [ERROR - org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.HDFSEventSink</span><span class="hljs-preprocessor">.process</span>(HDFSEventSink<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">447</span>)] process failed
<span class="hljs-label">java.lang.NoClassDefFoundError:</span> org/apache/commons/configuration/Configuration
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.metrics</span>2<span class="hljs-preprocessor">.lib</span><span class="hljs-preprocessor">.DefaultMetricsSystem</span>.&lt;init&gt;(DefaultMetricsSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">38</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.metrics</span>2<span class="hljs-preprocessor">.lib</span><span class="hljs-preprocessor">.DefaultMetricsSystem</span>.&lt;clinit&gt;(DefaultMetricsSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">36</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.security</span><span class="hljs-preprocessor">.UserGroupInformation</span>$UgiMetrics<span class="hljs-preprocessor">.create</span>(UserGroupInformation<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">106</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.security</span><span class="hljs-preprocessor">.UserGroupInformation</span>.&lt;clinit&gt;(UserGroupInformation<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">208</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span>$Cache$Key.&lt;init&gt;(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">2554</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span>$Cache$Key.&lt;init&gt;(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">2546</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span>$Cache<span class="hljs-preprocessor">.get</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">2412</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span><span class="hljs-preprocessor">.get</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">368</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.Path</span><span class="hljs-preprocessor">.getFileSystem</span>(Path<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">296</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$1<span class="hljs-preprocessor">.call</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">240</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$1<span class="hljs-preprocessor">.call</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">232</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$9$1<span class="hljs-preprocessor">.run</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">668</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.auth</span><span class="hljs-preprocessor">.SimpleAuthenticator</span><span class="hljs-preprocessor">.execute</span>(SimpleAuthenticator<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">50</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$9<span class="hljs-preprocessor">.call</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">665</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.FutureTask</span><span class="hljs-preprocessor">.run</span>(FutureTask<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">266</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.ThreadPoolExecutor</span><span class="hljs-preprocessor">.runWorker</span>(ThreadPoolExecutor<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1142</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.ThreadPoolExecutor</span>$Worker<span class="hljs-preprocessor">.run</span>(ThreadPoolExecutor<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">617</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.Thread</span><span class="hljs-preprocessor">.run</span>(Thread<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">745</span>)
Caused by: java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.ClassNotFoundException</span>: org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.commons</span><span class="hljs-preprocessor">.configuration</span><span class="hljs-preprocessor">.Configuration</span>
    at java<span class="hljs-preprocessor">.net</span><span class="hljs-preprocessor">.URLClassLoader</span><span class="hljs-preprocessor">.findClass</span>(URLClassLoader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">381</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.ClassLoader</span><span class="hljs-preprocessor">.loadClass</span>(ClassLoader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">424</span>)
    at sun<span class="hljs-preprocessor">.misc</span><span class="hljs-preprocessor">.Launcher</span>$AppClassLoader<span class="hljs-preprocessor">.loadClass</span>(Launcher<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">331</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.ClassLoader</span><span class="hljs-preprocessor">.loadClass</span>(ClassLoader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">357</span>)
    ... <span class="hljs-number">18</span> more
</code></pre>

<p>解决方法： <br>
缺少的依赖在commons-configuration-1.6.jar包里，这个包在${HADOOP_HOME}share/hadoop/common/lib/下，将其拷贝到flume的lib目录下。</p>



<pre class="prettyprint"><code class=" hljs bash">cp <span class="hljs-variable">${HADOOP_HOME}</span>share/hadoop/common/lib/commons-configuration-<span class="hljs-number">1.6</span>.jar <span class="hljs-variable">${FLUME_HOME}</span>/lib/</code></pre>



<h2 id="javalangnoclassdeffounderror-orgapachehadooputilplatformname">java.lang.NoClassDefFoundError: org/apache/hadoop/util/PlatformName</h2>



<pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">03</span> <span class="hljs-number">16</span>:<span class="hljs-number">41</span>:<span class="hljs-number">54</span>,<span class="hljs-number">629</span> (SinkRunner-PollingRunner-DefaultSinkProcessor) [ERROR - org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.HDFSEventSink</span><span class="hljs-preprocessor">.process</span>(HDFSEventSink<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">447</span>)] process failed
<span class="hljs-label">java.lang.NoClassDefFoundError:</span> org/apache/hadoop/util/PlatformName</code></pre>

<p>解决方法： <br>
缺少hadoop-auth-2.4.0.jar依赖，同样将其拷贝到flume的lib目录下：</p>



<pre class="prettyprint"><code class=" hljs bash">cp <span class="hljs-variable">${HADOOP_HOME}</span>share/hadoop/common/lib/hadoop-auth-<span class="hljs-number">2.4</span>.<span class="hljs-number">0</span>.jar <span class="hljs-variable">${FLUME_HOME}</span>/lib/</code></pre>



<h2 id="hdfs-io-error-javaioioexception-no-filesystem-for-scheme-hdfs">HDFS IO error java.io.IOException: No FileSystem for scheme: hdfs</h2>



<pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-number">2016</span>-<span class="hljs-number">11</span>-<span class="hljs-number">03</span> <span class="hljs-number">16</span>:<span class="hljs-number">49</span>:<span class="hljs-number">26</span>,<span class="hljs-number">638</span> (SinkRunner-PollingRunner-DefaultSinkProcessor) [WARN - org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.HDFSEventSink</span><span class="hljs-preprocessor">.process</span>(HDFSEventSink<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">443</span>)] HDFS IO error
<span class="hljs-label">java.io.IOException:</span> No FileSystem for scheme: hdfs
</code></pre>

<p>缺少依赖：hadoop-hdfs-2.4.0.jar</p>



<pre class="prettyprint"><code class=" hljs bash">cp <span class="hljs-variable">${HADOOP_HOME}</span>share/hadoop/hdfs/hadoop-hdfs-<span class="hljs-number">2.4</span>.<span class="hljs-number">0</span>.jar <span class="hljs-variable">${FLUME_HOME}</span>/lib/</code></pre>



<h2 id="javalangnoclassdeffounderror-orgapachehtracesamplerbuilder">java.lang.NoClassDefFoundError: org/apache/htrace/SamplerBuilder</h2>



<pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-number">2016</span>-<span class="hljs-number">12</span>-<span class="hljs-number">26</span> <span class="hljs-number">09</span>:<span class="hljs-number">49</span>:<span class="hljs-number">07</span>,<span class="hljs-number">854</span> (SinkRunner-PollingRunner-DefaultSinkProcessor) [ERROR - org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.HDFSEventSink</span><span class="hljs-preprocessor">.process</span>(HDFSEventSink<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">447</span>)] process failed
<span class="hljs-label">java.lang.NoClassDefFoundError:</span> org/apache/htrace/SamplerBuilder
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.DFSClient</span>.&lt;init&gt;(DFSClient<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">645</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.DFSClient</span>.&lt;init&gt;(DFSClient<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">629</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.DistributedFileSystem</span><span class="hljs-preprocessor">.initialize</span>(DistributedFileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">159</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span><span class="hljs-preprocessor">.createFileSystem</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">2761</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span><span class="hljs-preprocessor">.access</span>$200(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">99</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span>$Cache<span class="hljs-preprocessor">.getInternal</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">2795</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span>$Cache<span class="hljs-preprocessor">.get</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">2777</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span><span class="hljs-preprocessor">.get</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">386</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.Path</span><span class="hljs-preprocessor">.getFileSystem</span>(Path<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">295</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$1<span class="hljs-preprocessor">.call</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">240</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$1<span class="hljs-preprocessor">.call</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">232</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$9$1<span class="hljs-preprocessor">.run</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">668</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.auth</span><span class="hljs-preprocessor">.SimpleAuthenticator</span><span class="hljs-preprocessor">.execute</span>(SimpleAuthenticator<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">50</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$9<span class="hljs-preprocessor">.call</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">665</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.FutureTask</span><span class="hljs-preprocessor">.run</span>(FutureTask<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">266</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.ThreadPoolExecutor</span><span class="hljs-preprocessor">.runWorker</span>(ThreadPoolExecutor<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1142</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.ThreadPoolExecutor</span>$Worker<span class="hljs-preprocessor">.run</span>(ThreadPoolExecutor<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">617</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.Thread</span><span class="hljs-preprocessor">.run</span>(Thread<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">745</span>)
Caused by: java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.ClassNotFoundException</span>: org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.htrace</span><span class="hljs-preprocessor">.SamplerBuilder</span>
    at java<span class="hljs-preprocessor">.net</span><span class="hljs-preprocessor">.URLClassLoader</span><span class="hljs-preprocessor">.findClass</span>(URLClassLoader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">381</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.ClassLoader</span><span class="hljs-preprocessor">.loadClass</span>(ClassLoader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">424</span>)
    at sun<span class="hljs-preprocessor">.misc</span><span class="hljs-preprocessor">.Launcher</span>$AppClassLoader<span class="hljs-preprocessor">.loadClass</span>(Launcher<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">331</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.ClassLoader</span><span class="hljs-preprocessor">.loadClass</span>(ClassLoader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">357</span>)
    ... <span class="hljs-number">18</span> more
Exception <span class="hljs-keyword">in</span> thread <span class="hljs-string">"SinkRunner-PollingRunner-DefaultSinkProcessor"</span> java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.NoClassDefFoundError</span>: org/apache/htrace/SamplerBuilder
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.DFSClient</span>.&lt;init&gt;(DFSClient<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">645</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.DFSClient</span>.&lt;init&gt;(DFSClient<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">629</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.DistributedFileSystem</span><span class="hljs-preprocessor">.initialize</span>(DistributedFileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">159</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span><span class="hljs-preprocessor">.createFileSystem</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">2761</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span><span class="hljs-preprocessor">.access</span>$200(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">99</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span>$Cache<span class="hljs-preprocessor">.getInternal</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">2795</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span>$Cache<span class="hljs-preprocessor">.get</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">2777</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span><span class="hljs-preprocessor">.get</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">386</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.Path</span><span class="hljs-preprocessor">.getFileSystem</span>(Path<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">295</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$1<span class="hljs-preprocessor">.call</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">240</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$1<span class="hljs-preprocessor">.call</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">232</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$9$1<span class="hljs-preprocessor">.run</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">668</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.auth</span><span class="hljs-preprocessor">.SimpleAuthenticator</span><span class="hljs-preprocessor">.execute</span>(SimpleAuthenticator<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">50</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$9<span class="hljs-preprocessor">.call</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">665</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.FutureTask</span><span class="hljs-preprocessor">.run</span>(FutureTask<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">266</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.ThreadPoolExecutor</span><span class="hljs-preprocessor">.runWorker</span>(ThreadPoolExecutor<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1142</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.ThreadPoolExecutor</span>$Worker<span class="hljs-preprocessor">.run</span>(ThreadPoolExecutor<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">617</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.Thread</span><span class="hljs-preprocessor">.run</span>(Thread<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">745</span>)
Caused by: java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.ClassNotFoundException</span>: org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.htrace</span><span class="hljs-preprocessor">.SamplerBuilder</span>
    at java<span class="hljs-preprocessor">.net</span><span class="hljs-preprocessor">.URLClassLoader</span><span class="hljs-preprocessor">.findClass</span>(URLClassLoader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">381</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.ClassLoader</span><span class="hljs-preprocessor">.loadClass</span>(ClassLoader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">424</span>)
    at sun<span class="hljs-preprocessor">.misc</span><span class="hljs-preprocessor">.Launcher</span>$AppClassLoader<span class="hljs-preprocessor">.loadClass</span>(Launcher<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">331</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.ClassLoader</span><span class="hljs-preprocessor">.loadClass</span>(ClassLoader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">357</span>)
    ... <span class="hljs-number">18</span> more

</code></pre>

<p>解决方法：将<code>htrace-core-3.1.0-incubating.jar</code>jar包（这个jar包也可以在Hadoop的安装目录下找到，我的是有lib目录下）拷贝到<code>${FLUME_HOME}/lib/</code>目录下。</p>



<h2 id="javalangnoclassdeffounderror-orgapachecommonsiocharsets">java.lang.NoClassDefFoundError: org/apache/commons/io/Charsets</h2>



<pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-number">2016</span>-<span class="hljs-number">12</span>-<span class="hljs-number">26</span> <span class="hljs-number">10</span>:<span class="hljs-number">15</span>:<span class="hljs-number">36</span>,<span class="hljs-number">190</span> (SinkRunner-PollingRunner-DefaultSinkProcessor) [ERROR - org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.HDFSEventSink</span><span class="hljs-preprocessor">.process</span>(HDFSEventSink<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">447</span>)] process failed
<span class="hljs-label">java.lang.NoClassDefFoundError:</span> org/apache/commons/io/Charsets
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.ipc</span><span class="hljs-preprocessor">.Server</span>.&lt;clinit&gt;(Server<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">221</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.ipc</span><span class="hljs-preprocessor">.ProtobufRpcEngine</span>.&lt;clinit&gt;(ProtobufRpcEngine<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">71</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.Class</span><span class="hljs-preprocessor">.forName</span>0(Native Method)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.Class</span><span class="hljs-preprocessor">.forName</span>(Class<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">348</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.conf</span><span class="hljs-preprocessor">.Configuration</span><span class="hljs-preprocessor">.getClassByNameOrNull</span>(Configuration<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">2147</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.conf</span><span class="hljs-preprocessor">.Configuration</span><span class="hljs-preprocessor">.getClassByName</span>(Configuration<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">2112</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.conf</span><span class="hljs-preprocessor">.Configuration</span><span class="hljs-preprocessor">.getClass</span>(Configuration<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">2206</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.ipc</span><span class="hljs-preprocessor">.RPC</span><span class="hljs-preprocessor">.getProtocolEngine</span>(RPC<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">205</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.ipc</span><span class="hljs-preprocessor">.RPC</span><span class="hljs-preprocessor">.getProtocolProxy</span>(RPC<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">579</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.NameNodeProxies</span><span class="hljs-preprocessor">.createNNProxyWithClientProtocol</span>(NameNodeProxies<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">419</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.NameNodeProxies</span><span class="hljs-preprocessor">.createNonHAProxy</span>(NameNodeProxies<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">315</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.NameNodeProxies</span><span class="hljs-preprocessor">.createProxy</span>(NameNodeProxies<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">176</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.DFSClient</span>.&lt;init&gt;(DFSClient<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">688</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.DFSClient</span>.&lt;init&gt;(DFSClient<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">629</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.DistributedFileSystem</span><span class="hljs-preprocessor">.initialize</span>(DistributedFileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">159</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span><span class="hljs-preprocessor">.createFileSystem</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">2761</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span><span class="hljs-preprocessor">.access</span>$200(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">99</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span>$Cache<span class="hljs-preprocessor">.getInternal</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">2795</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span>$Cache<span class="hljs-preprocessor">.get</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">2777</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span><span class="hljs-preprocessor">.get</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">386</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.Path</span><span class="hljs-preprocessor">.getFileSystem</span>(Path<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">295</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$1<span class="hljs-preprocessor">.call</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">240</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$1<span class="hljs-preprocessor">.call</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">232</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$9$1<span class="hljs-preprocessor">.run</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">668</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.auth</span><span class="hljs-preprocessor">.SimpleAuthenticator</span><span class="hljs-preprocessor">.execute</span>(SimpleAuthenticator<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">50</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$9<span class="hljs-preprocessor">.call</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">665</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.FutureTask</span><span class="hljs-preprocessor">.run</span>(FutureTask<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">266</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.ThreadPoolExecutor</span><span class="hljs-preprocessor">.runWorker</span>(ThreadPoolExecutor<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1142</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.ThreadPoolExecutor</span>$Worker<span class="hljs-preprocessor">.run</span>(ThreadPoolExecutor<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">617</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.Thread</span><span class="hljs-preprocessor">.run</span>(Thread<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">745</span>)
Caused by: java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.ClassNotFoundException</span>: org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.commons</span><span class="hljs-preprocessor">.io</span><span class="hljs-preprocessor">.Charsets</span>
    at java<span class="hljs-preprocessor">.net</span><span class="hljs-preprocessor">.URLClassLoader</span><span class="hljs-preprocessor">.findClass</span>(URLClassLoader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">381</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.ClassLoader</span><span class="hljs-preprocessor">.loadClass</span>(ClassLoader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">424</span>)
    at sun<span class="hljs-preprocessor">.misc</span><span class="hljs-preprocessor">.Launcher</span>$AppClassLoader<span class="hljs-preprocessor">.loadClass</span>(Launcher<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">331</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.ClassLoader</span><span class="hljs-preprocessor">.loadClass</span>(ClassLoader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">357</span>)
    ... <span class="hljs-number">30</span> more
Exception <span class="hljs-keyword">in</span> thread <span class="hljs-string">"SinkRunner-PollingRunner-DefaultSinkProcessor"</span> java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.NoClassDefFoundError</span>: org/apache/commons/io/Charsets
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.ipc</span><span class="hljs-preprocessor">.Server</span>.&lt;clinit&gt;(Server<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">221</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.ipc</span><span class="hljs-preprocessor">.ProtobufRpcEngine</span>.&lt;clinit&gt;(ProtobufRpcEngine<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">71</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.Class</span><span class="hljs-preprocessor">.forName</span>0(Native Method)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.Class</span><span class="hljs-preprocessor">.forName</span>(Class<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">348</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.conf</span><span class="hljs-preprocessor">.Configuration</span><span class="hljs-preprocessor">.getClassByNameOrNull</span>(Configuration<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">2147</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.conf</span><span class="hljs-preprocessor">.Configuration</span><span class="hljs-preprocessor">.getClassByName</span>(Configuration<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">2112</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.conf</span><span class="hljs-preprocessor">.Configuration</span><span class="hljs-preprocessor">.getClass</span>(Configuration<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">2206</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.ipc</span><span class="hljs-preprocessor">.RPC</span><span class="hljs-preprocessor">.getProtocolEngine</span>(RPC<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">205</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.ipc</span><span class="hljs-preprocessor">.RPC</span><span class="hljs-preprocessor">.getProtocolProxy</span>(RPC<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">579</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.NameNodeProxies</span><span class="hljs-preprocessor">.createNNProxyWithClientProtocol</span>(NameNodeProxies<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">419</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.NameNodeProxies</span><span class="hljs-preprocessor">.createNonHAProxy</span>(NameNodeProxies<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">315</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.NameNodeProxies</span><span class="hljs-preprocessor">.createProxy</span>(NameNodeProxies<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">176</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.DFSClient</span>.&lt;init&gt;(DFSClient<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">688</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.DFSClient</span>.&lt;init&gt;(DFSClient<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">629</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.DistributedFileSystem</span><span class="hljs-preprocessor">.initialize</span>(DistributedFileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">159</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span><span class="hljs-preprocessor">.createFileSystem</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">2761</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span><span class="hljs-preprocessor">.access</span>$200(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">99</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span>$Cache<span class="hljs-preprocessor">.getInternal</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">2795</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span>$Cache<span class="hljs-preprocessor">.get</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">2777</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span><span class="hljs-preprocessor">.get</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">386</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.Path</span><span class="hljs-preprocessor">.getFileSystem</span>(Path<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">295</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$1<span class="hljs-preprocessor">.call</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">240</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$1<span class="hljs-preprocessor">.call</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">232</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$9$1<span class="hljs-preprocessor">.run</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">668</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.auth</span><span class="hljs-preprocessor">.SimpleAuthenticator</span><span class="hljs-preprocessor">.execute</span>(SimpleAuthenticator<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">50</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$9<span class="hljs-preprocessor">.call</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">665</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.FutureTask</span><span class="hljs-preprocessor">.run</span>(FutureTask<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">266</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.ThreadPoolExecutor</span><span class="hljs-preprocessor">.runWorker</span>(ThreadPoolExecutor<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1142</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.ThreadPoolExecutor</span>$Worker<span class="hljs-preprocessor">.run</span>(ThreadPoolExecutor<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">617</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.Thread</span><span class="hljs-preprocessor">.run</span>(Thread<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">745</span>)
Caused by: java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.ClassNotFoundException</span>: org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.commons</span><span class="hljs-preprocessor">.io</span><span class="hljs-preprocessor">.Charsets</span>
    at java<span class="hljs-preprocessor">.net</span><span class="hljs-preprocessor">.URLClassLoader</span><span class="hljs-preprocessor">.findClass</span>(URLClassLoader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">381</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.ClassLoader</span><span class="hljs-preprocessor">.loadClass</span>(ClassLoader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">424</span>)
    at sun<span class="hljs-preprocessor">.misc</span><span class="hljs-preprocessor">.Launcher</span>$AppClassLoader<span class="hljs-preprocessor">.loadClass</span>(Launcher<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">331</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.ClassLoader</span><span class="hljs-preprocessor">.loadClass</span>(ClassLoader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">357</span>)
    ... <span class="hljs-number">30</span> more</code></pre>

<p>解决方法：将jar包<code>common-io-2.1.jar</code>换成<code>common-io-2.4.jar</code>，此包仍然可以在Hadoop目录下的lib下找到。</p>



<h2 id="failed-to-connect-to-server-node11721641549000-try-once-and-fail">Failed to connect to server: node1/172.16.41.54:9000: try once and fail</h2>



<pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-number">2016</span>-<span class="hljs-number">12</span>-<span class="hljs-number">26</span> <span class="hljs-number">10</span>:<span class="hljs-number">30</span>:<span class="hljs-number">11</span>,<span class="hljs-number">538</span> (hdfs-hdfs-sink1-<span class="hljs-keyword">call</span>-runner-<span class="hljs-number">3</span>) [WARN - org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.ipc</span><span class="hljs-preprocessor">.Client</span>$Connection<span class="hljs-preprocessor">.handleConnectionFailure</span>(Client<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">886</span>)] Failed to connect to server: node1/<span class="hljs-number">172.16</span><span class="hljs-number">.41</span><span class="hljs-number">.54</span>:<span class="hljs-number">9000</span>: try once <span class="hljs-keyword">and</span> fail.
<span class="hljs-label">java.net.ConnectException:</span> Connection refused
    at sun<span class="hljs-preprocessor">.nio</span><span class="hljs-preprocessor">.ch</span><span class="hljs-preprocessor">.SocketChannelImpl</span><span class="hljs-preprocessor">.checkConnect</span>(Native Method)
    at sun<span class="hljs-preprocessor">.nio</span><span class="hljs-preprocessor">.ch</span><span class="hljs-preprocessor">.SocketChannelImpl</span><span class="hljs-preprocessor">.finishConnect</span>(SocketChannelImpl<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">717</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.net</span><span class="hljs-preprocessor">.SocketIOWithTimeout</span><span class="hljs-preprocessor">.connect</span>(SocketIOWithTimeout<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">206</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.net</span><span class="hljs-preprocessor">.NetUtils</span><span class="hljs-preprocessor">.connect</span>(NetUtils<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">531</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.net</span><span class="hljs-preprocessor">.NetUtils</span><span class="hljs-preprocessor">.connect</span>(NetUtils<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">495</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.ipc</span><span class="hljs-preprocessor">.Client</span>$Connection<span class="hljs-preprocessor">.setupConnection</span>(Client<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">650</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.ipc</span><span class="hljs-preprocessor">.Client</span>$Connection<span class="hljs-preprocessor">.setupIOstreams</span>(Client<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">745</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.ipc</span><span class="hljs-preprocessor">.Client</span>$Connection<span class="hljs-preprocessor">.access</span>$3200(Client<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">397</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.ipc</span><span class="hljs-preprocessor">.Client</span><span class="hljs-preprocessor">.getConnection</span>(Client<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1618</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.ipc</span><span class="hljs-preprocessor">.Client</span><span class="hljs-preprocessor">.call</span>(Client<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1449</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.ipc</span><span class="hljs-preprocessor">.Client</span><span class="hljs-preprocessor">.call</span>(Client<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1396</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.ipc</span><span class="hljs-preprocessor">.ProtobufRpcEngine</span>$Invoker<span class="hljs-preprocessor">.invoke</span>(ProtobufRpcEngine<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">233</span>)
    at <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.sun</span><span class="hljs-preprocessor">.proxy</span>.$Proxy11<span class="hljs-preprocessor">.create</span>(Unknown Source)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.protocolPB</span><span class="hljs-preprocessor">.ClientNamenodeProtocolTranslatorPB</span><span class="hljs-preprocessor">.create</span>(ClientNamenodeProtocolTranslatorPB<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">311</span>)
    at sun<span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.NativeMethodAccessorImpl</span><span class="hljs-preprocessor">.invoke</span>0(Native Method)
    at sun<span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.NativeMethodAccessorImpl</span><span class="hljs-preprocessor">.invoke</span>(NativeMethodAccessorImpl<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">62</span>)
    at sun<span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.DelegatingMethodAccessorImpl</span><span class="hljs-preprocessor">.invoke</span>(DelegatingMethodAccessorImpl<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">43</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.Method</span><span class="hljs-preprocessor">.invoke</span>(Method<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">498</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.io</span><span class="hljs-preprocessor">.retry</span><span class="hljs-preprocessor">.RetryInvocationHandler</span><span class="hljs-preprocessor">.invokeMethod</span>(RetryInvocationHandler<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">278</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.io</span><span class="hljs-preprocessor">.retry</span><span class="hljs-preprocessor">.RetryInvocationHandler</span><span class="hljs-preprocessor">.invoke</span>(RetryInvocationHandler<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">194</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.io</span><span class="hljs-preprocessor">.retry</span><span class="hljs-preprocessor">.RetryInvocationHandler</span><span class="hljs-preprocessor">.invoke</span>(RetryInvocationHandler<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">176</span>)
    at <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.sun</span><span class="hljs-preprocessor">.proxy</span>.$Proxy12<span class="hljs-preprocessor">.create</span>(Unknown Source)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.DFSOutputStream</span><span class="hljs-preprocessor">.newStreamForCreate</span>(DFSOutputStream<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1719</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.DFSClient</span><span class="hljs-preprocessor">.create</span>(DFSClient<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1699</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.DFSClient</span><span class="hljs-preprocessor">.create</span>(DFSClient<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1634</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.DistributedFileSystem</span>$8<span class="hljs-preprocessor">.doCall</span>(DistributedFileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">479</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.DistributedFileSystem</span>$8<span class="hljs-preprocessor">.doCall</span>(DistributedFileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">475</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystemLinkResolver</span><span class="hljs-preprocessor">.resolve</span>(FileSystemLinkResolver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">81</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.DistributedFileSystem</span><span class="hljs-preprocessor">.create</span>(DistributedFileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">475</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.DistributedFileSystem</span><span class="hljs-preprocessor">.create</span>(DistributedFileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">416</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span><span class="hljs-preprocessor">.create</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">926</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span><span class="hljs-preprocessor">.create</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">907</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span><span class="hljs-preprocessor">.create</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">803</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.fs</span><span class="hljs-preprocessor">.FileSystem</span><span class="hljs-preprocessor">.create</span>(FileSystem<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">792</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.HDFSSequenceFile</span><span class="hljs-preprocessor">.open</span>(HDFSSequenceFile<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">95</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.HDFSSequenceFile</span><span class="hljs-preprocessor">.open</span>(HDFSSequenceFile<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">78</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.HDFSSequenceFile</span><span class="hljs-preprocessor">.open</span>(HDFSSequenceFile<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">69</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$1<span class="hljs-preprocessor">.call</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">242</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$1<span class="hljs-preprocessor">.call</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">232</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$9$1<span class="hljs-preprocessor">.run</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">668</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.auth</span><span class="hljs-preprocessor">.SimpleAuthenticator</span><span class="hljs-preprocessor">.execute</span>(SimpleAuthenticator<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">50</span>)
    at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.sink</span><span class="hljs-preprocessor">.hdfs</span><span class="hljs-preprocessor">.BucketWriter</span>$9<span class="hljs-preprocessor">.call</span>(BucketWriter<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">665</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.FutureTask</span><span class="hljs-preprocessor">.run</span>(FutureTask<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">266</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.ThreadPoolExecutor</span><span class="hljs-preprocessor">.runWorker</span>(ThreadPoolExecutor<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1142</span>)
    at java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.concurrent</span><span class="hljs-preprocessor">.ThreadPoolExecutor</span>$Worker<span class="hljs-preprocessor">.run</span>(ThreadPoolExecutor<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">617</span>)
    at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.Thread</span><span class="hljs-preprocessor">.run</span>(Thread<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">745</span>)</code></pre>

<p>解决方法： <br>
连接被拒绝的原因其实挺简单，比如如下： <br>
1、服务进程没开，比如nodenode没开，如果开了，检验IP地址和端口号，apache默认文件系统的端口是9000，而HDP的hadoop的文件系统的端口是8020，而我之前配置的一直是9000，因此会连接不上，所以，只要修改一下<code>conf/flume.conf</code>文件里的配置就好了，把hdfs的那个地址改成8020。 <br>
2、防火墙，如果没关防火墙，可能会导致连接不上。</p>



<h2 id="malformedinputexception">MalformedInputException</h2>



<pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-number">2016</span>-<span class="hljs-number">12</span>-<span class="hljs-number">27</span> <span class="hljs-number">15</span>:<span class="hljs-number">53</span>:<span class="hljs-number">45</span>,<span class="hljs-number">467</span> (pool-<span class="hljs-number">4</span>-thread-<span class="hljs-number">1</span>) [ERROR - org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.flume</span><span class="hljs-preprocessor">.source</span><span class="hljs-preprocessor">.SpoolDirectorySource</span>$SpoolDirectoryRunnable<span class="hljs-preprocessor">.run</span>(SpoolDirectorySource<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">280</span>)] FATAL: Spool Directory source spooldir-source1: { spoolDir: /home/yang/Data/flumeSpoolDir }: Uncaught exception <span class="hljs-keyword">in</span> SpoolDirectorySource thread. Restart <span class="hljs-keyword">or</span> reconfigure Flume to continue processing.
<span class="hljs-label">java.nio.charset.MalformedInputException:</span> Input length = <span class="hljs-number">1</span></code></pre>

<p>问题原因： <br>
由于我用的source是spooldir，这个source默认的deserializer是line，而我这里需要传输的文件是avro文件，因此，才出现了这个输入格式异常的情况，因此，解决方法就是修改这个deserializer为avro就可以了，如下：</p>



<pre class="prettyprint"><code class=" hljs avrasm">agent1<span class="hljs-preprocessor">.sources</span><span class="hljs-preprocessor">.spooldir</span>-source1<span class="hljs-preprocessor">.deserializer</span> = AVRO
</code></pre>

<p>参考文献 <br>
[1] <a href="https://cwiki.apache.org/confluence/display/FLUME/Getting+Started" rel="nofollow">https://cwiki.apache.org/confluence/display/FLUME/Getting+Started</a> <br>
[2] <a href="http://flume.apache.org/FlumeUserGuide.html" rel="nofollow">http://flume.apache.org/FlumeUserGuide.html</a> <br>
[3] <a href="http://stackoverflow.com/questions/30645569/expected-timestamp-in-the-flume-event-headers-but-it-was-null" rel="nofollow">http://stackoverflow.com/questions/30645569/expected-timestamp-in-the-flume-event-headers-but-it-was-null</a> <br>
相关资源 <br>
[1] <a href="https://yq.aliyun.com/articles/33873" rel="nofollow">https://yq.aliyun.com/articles/33873</a> <br>
[2] <a href="https://yq.aliyun.com/articles/50487" rel="nofollow">https://yq.aliyun.com/articles/50487</a></p>            </div>
						<link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-9e5741c4b9.css" rel="stylesheet">
                </div>