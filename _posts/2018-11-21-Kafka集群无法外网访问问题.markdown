---
layout:     post
title:      Kafka集群无法外网访问问题
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								<div class="article-copyright">
					版权声明：本文为博主原创文章，未经博主允许不得转载。					https://blog.csdn.net/xiaofanren1111/article/details/80944005				</div>
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">本地Consumer和Producer无法使用远程Kafka服务器的处理办法</p><p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">服务搭建好kafka服务后，本机测试ok，外面机器却无法访问，很是怪异。</p><p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">kafka服务器： <br>阿里云VPC网络服务器，内网ip：10.10.10.10，绑定的弹性ip（外网ip）x.x.x.x，是单机测试环境，zk和kafka都在一台机器上，使用默认端口，kakfa是9092，zookeeper是2181。kafka版本：kafka_2.11-0.10.1.0</p><p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">kafka是默认配置，没有修改：</p><pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs ruleslanguage has-numbering"><span class="hljs-array">#listeners</span>=PLAINTEXT:<span class="hljs-comment">//:9092</span>
<span class="hljs-array">#advertised.listeners</span>=PLAINTEXT:<span class="hljs-comment">//your.host.name:9092</span>
zookeeper.connect=localhost:<span class="hljs-number">2181</span></code></pre><ul class="pre-numbering"><li style="color:rgb(153,153,153);">1</li><li style="color:rgb(153,153,153);">2</li><li style="color:rgb(153,153,153);">3</li></ul><p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">测试发现本机，可以正常发布消息、消费消息，但是公司机器不可以。</p><p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">看log发现是hostname无法识别，所以最简单的方案就是： <br>1，本机绑定host，即修改/etc/hosts，添加10.10.10.10 hostname到hosts文件。</p><p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">有没有不需要绑定hosts，更高大上的方案呢？有！ <br>2，经各种测试后发现，修改kafka的advertised.listeners配置即可：</p><pre class="prettyprint" style="font-size:14px;line-height:22px;"><code class="hljs avrasm has-numbering"><span class="hljs-preprocessor">#listeners=PLAINTEXT://:9092</span>
advertised<span class="hljs-preprocessor">.listeners</span>=PLAINTEXT://<span class="hljs-built_in">x</span><span class="hljs-preprocessor">.x</span><span class="hljs-preprocessor">.x</span><span class="hljs-preprocessor">.x</span>:<span class="hljs-number">9092</span>
zookeeper<span class="hljs-preprocessor">.connect</span>=localhost:<span class="hljs-number">2181</span></code></pre><ul class="pre-numbering"><li style="color:rgb(153,153,153);">1</li><li style="color:rgb(153,153,153);">2</li><li style="color:rgb(153,153,153);">3</li></ul><p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">advertised.listeners官网有解释： <br>Listeners to publish to ZooKeeper for clients to use, if different than the listeners above. In IaaS environments, this may need to be different from the interface to which the broker binds. If this is not set, the value for <code style="font-size:14px;line-height:22px;">listeners</code> will be used. <br>详情：<a href="http://kafka.apache.org/documentation/#configuration" rel="nofollow">http://kafka.apache.org/documentation/#configuration</a></p><p style="font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">亲测，有了这个配置，kafka就会忽略listeners配置。</p>            </div>
                </div>