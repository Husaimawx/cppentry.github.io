---
layout:     post
title:      flume的学习过程
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <p>1.flume的介绍</p><p><span style="color:rgb(51,51,51);font-family:arial, '宋体', sans-serif;font-size:14px;text-indent:28px;background-color:rgb(255,255,255);">Flume最早是Cloudera提供的日志收集系统，目前是Apache下的一个孵化项目，Flume支持在日志系统中定制各类数据发送方，用于收集数据。是目前企业正在使用的一种日志收集系统 flume的架构如下图所示</span></p><p><span style="color:rgb(51,51,51);font-family:arial, '宋体', sans-serif;font-size:14px;text-indent:28px;background-color:rgb(255,255,255);"><img src="https://img-blog.csdn.net/20180418142340242?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTMxMjczMjU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></span></p><p style="text-indent:28px;"><span style="font-family:arial, '宋体', sans-serif;color:#333333;"><span style="font-size:14px;background-color:rgb(255,255,255);">flume的内部可以说是一个一个的Agent,里面包含source,channel和sink，source即是数据的来源，sink即是数据的输出，channel可以理解为是一个通道。flume的配置和使用也是围绕这三个部分进行展开的。</span></span><span style="background-color:rgb(255,255,255);color:rgb(51,51,51);font-family:arial, '宋体', sans-serif;font-size:14px;"> source即是数据的来源，数据的来源可以分为两种，一种数据来源是主动进行获取，一种数据来源是被动去获取（别人给你传）。sink可以理解为数据存储的位置即flume接收完成数据之后 将数据存放在何处。接下来我们以flume官网上的一个例子进行搭建flume</span></p><p style="text-indent:28px;"><span style="background-color:rgb(255,255,255);color:rgb(51,51,51);font-family:arial, '宋体', sans-serif;font-size:14px;">2.flume的简单搭建</span></p><p style="text-indent:28px;"><span style="background-color:rgb(255,255,255);color:rgb(51,51,51);font-family:arial, '宋体', sans-serif;font-size:14px;">  首先我们在自己的服务器上进行安装flume，安装过程极为简单，在此不做详细的说明</span></p><p style="text-indent:28px;"><span style="font-family:arial, '宋体', sans-serif;color:#333333;"><span style="font-size:14px;background-color:rgb(255,255,255);">3.flume的简单例子</span></span></p><p style="text-indent:28px;"><span style="font-family:arial, '宋体', sans-serif;color:#333333;"><span style="font-size:14px;background-color:rgb(255,255,255);">   <span style="color:rgb(0,0,0);font-family:'Microsoft YaHei';background-color:rgb(255,255,255);vertical-align:inherit;">在这里，我们给出一个示例配置文件，描述单节点Flume部署。</span><span style="color:rgb(0,0,0);font-family:'Microsoft YaHei';background-color:rgb(255,255,255);vertical-align:inherit;">该配置允许用户生成事件并随后将其记录到控制台</span></span></span></p><p style="text-indent:28px;"><span style="color:rgb(153,153,136);font-style:italic;background-color:rgb(238,255,204);font-family:Consolas, Inconsolata, Courier, monospace;font-size:12px;">＃example.conf：单节点Flume配置</span><span style="font-family:arial, '宋体', sans-serif;color:#333333;"><span style="font-size:14px;background-color:rgb(255,255,255);"><span style="color:rgb(0,0,0);font-family:'Microsoft YaHei';background-color:rgb(255,255,255);vertical-align:inherit;"></span></span></span></p><pre style="background-color:rgb(238,255,204);color:rgb(51,51,51);line-height:15.6px;border-top:1px solid rgb(170,204,153);border-bottom:1px solid rgb(170,204,153);border-left:none;border-right:none;">
<span class="c" style="color:rgb(153,153,136);font-style:italic;">＃将该代理商的组件命名为</span>
<span class="na" style="color:rgb(0,128,128);">a1.sources </span> <span class="o" style="font-weight:bold;">= </span> <span class="s" style="color:rgb(187,136,68);">r1 </span>
<span class="na" style="color:rgb(0,128,128);">a1.sinks </span> <span class="o" style="font-weight:bold;">= </span> <span class="s" style="color:rgb(187,136,68);">k1 </span>
<span class="na" style="color:rgb(0,128,128);">a1.channels </span> <span class="o" style="font-weight:bold;">= </span> <span class="s" style="color:rgb(187,136,68);">c1</span>

<span class="c" style="color:rgb(153,153,136);font-style:italic;">＃描述/配置源</span>
<span class="na" style="color:rgb(0,128,128);">a1.sources.r1.type </span> <span class="o" style="font-weight:bold;">= </span> <span class="s" style="color:rgb(187,136,68);">netcat </span>
<span class="na" style="color:rgb(0,128,128);">a1.sources.r1.bind </span> <span class="o" style="font-weight:bold;">= </span> <span class="s" style="color:rgb(187,136,68);">localhost </span>
<span class="na" style="color:rgb(0,128,128);">a1.sources.r1.port </span> <span class="o" style="font-weight:bold;">= </span> <span class="s" style="color:rgb(187,136,68);">44444</span>

<span class="c" style="color:rgb(153,153,136);font-style:italic;">＃描述sink </span>
<span class="na" style="color:rgb(0,128,128);">a1.sinks.k1.type </span> <span class="o" style="font-weight:bold;">= </span> <span class="s" style="color:rgb(187,136,68);">logger</span>

<span class="c" style="color:rgb(153,153,136);font-style:italic;">＃使用缓冲内存中事件的通道</span>
<span class="na" style="color:rgb(0,128,128);">a1.channels.c1.type </span> <span class="o" style="font-weight:bold;">= </span> <span class="s" style="color:rgb(187,136,68);">memory </span>
<span class="na" style="color:rgb(0,128,128);">a1.channels.c1.capacity </span> <span class="o" style="font-weight:bold;">= </span> <span class="s" style="color:rgb(187,136,68);">1000 </span>
<span class="na" style="color:rgb(0,128,128);">a1.channels.c1.transactionCapacity </span> <span class="o" style="font-weight:bold;">= </span> <span class="s" style="color:rgb(187,136,68);">100</span>

<span class="c" style="color:rgb(153,153,136);font-style:italic;">＃将信源和信宿绑定到信道</span>
<span class="na" style="color:rgb(0,128,128);">a1.sources.r1.channels </span> <span class="o" style="font-weight:bold;">= </span> <span class="s" style="color:rgb(187,136,68);">c1 </span>
<span class="na" style="color:rgb(0,128,128);">a1.sinks.k1.channel </span> <span class="o" style="font-weight:bold;">= </span> <span class="s" style="color:rgb(187,136,68);">c1</span></pre><p style="text-indent:28px;"><span style="color:rgb(0,0,0);font-family:'Microsoft YaHei';background-color:rgb(255,255,255);vertical-align:inherit;">该配置定义了一个名为a1的代理。</span><span style="color:rgb(0,0,0);font-family:'Microsoft YaHei';background-color:rgb(255,255,255);vertical-align:inherit;">a1有一个侦听端口44444上的数据的源，一个缓存内存中事件数据的通道，以及一个将事件数据记录到控制台的接收器。</span><span style="color:rgb(0,0,0);font-family:'Microsoft YaHei';background-color:rgb(255,255,255);vertical-align:inherit;">配置文件命名各种组件，然后描述它们的类型和配置参数。</span><span style="color:rgb(0,0,0);font-family:'Microsoft YaHei';background-color:rgb(255,255,255);vertical-align:inherit;">给定的配置文件可能会定义多个命名代理; </span><span style="color:rgb(0,0,0);font-family:'Microsoft YaHei';background-color:rgb(255,255,255);vertical-align:inherit;">当一个给定的Flume进程启动时，会传递一个标志，告诉它哪个指定的代理要显示。</span><br></p><p style="text-indent:28px;"><span style="color:rgb(0,0,0);font-family:'Microsoft YaHei';background-color:rgb(255,255,255);vertical-align:inherit;"><span style="color:rgb(0,0,0);font-family:'Microsoft YaHei';background-color:rgb(255,255,255);">给定这个配置文件，我们可以按如下方式启动Flume：</span><br></span></p><p style="text-indent:28px;"><span style="color:rgb(0,0,0);font-family:'Microsoft YaHei';background-color:rgb(255,255,255);vertical-align:inherit;"><span style="color:rgb(0,0,0);font-family:'Microsoft YaHei';background-color:rgb(255,255,255);"></span></span></p><pre style="background-color:rgb(238,255,204);color:rgb(51,51,51);line-height:15.6px;border-top:1px solid rgb(170,204,153);border-bottom:1px solid rgb(170,204,153);border-left:none;border-right:none;"><span style="vertical-align:inherit;">$ bin / flume-ng agent --conf conf --conf -file example.conf --name a1 -Dflume.root.logger = INFO，console</span></pre><br><p style="text-indent:28px;"><span style="color:rgb(0,0,0);font-family:'Microsoft YaHei';background-color:rgb(255,255,255);vertical-align:inherit;"><span style="color:rgb(0,0,0);font-family:'Microsoft YaHei';background-color:rgb(255,255,255);"></span></span></p><p style="line-height:20.8px;color:rgb(0,0,0);font-family:'Microsoft YaHei';background-color:rgb(255,255,255);"><span style="vertical-align:inherit;">请注意，在完整部署中，我们通常会包含一个选项：-- </span><tt class="docutils literal" style="background-color:rgb(236,240,243);font-size:.95em;"><span class="pre"><span style="vertical-align:inherit;"><span style="vertical-align:inherit;">conf = &lt;conf-dir&gt;</span></span></span></tt><span style="vertical-align:inherit;"><span style="vertical-align:inherit;">。</span><span style="vertical-align:inherit;">所述</span></span><tt class="docutils literal" style="background-color:rgb(236,240,243);font-size:.95em;"><span class="pre"><span style="vertical-align:inherit;"><span style="vertical-align:inherit;">&lt;CONF-DIR&gt;</span></span></span></tt><span style="vertical-align:inherit;">目录将包括一个外壳脚本</span><em>flume-env.sh</em><span style="vertical-align:inherit;"><span style="vertical-align:inherit;">和潜在的一个log4j的属性文件。</span><span style="vertical-align:inherit;">在这个例子中，我们传递一个Java选项来强制Flume登录到控制台，我们没有自定义环境脚本。</span></span></p><p style="line-height:20.8px;color:rgb(0,0,0);font-family:'Microsoft YaHei';background-color:rgb(255,255,255);"><span style="vertical-align:inherit;">从一个单独的终端，我们可以telnet端口44444并发送一个事件给Flume：</span></p><p style="line-height:20.8px;color:rgb(0,0,0);font-family:'Microsoft YaHei';background-color:rgb(255,255,255);"><span style="vertical-align:inherit;"></span></p><pre style="background-color:rgb(238,255,204);color:rgb(51,51,51);line-height:15.6px;border-top:1px solid rgb(170,204,153);border-bottom:1px solid rgb(170,204,153);border-left:none;border-right:none;"><span style="vertical-align:inherit;">$ telnet localhost 44444</span><span style="vertical-align:inherit;">
尝试127.0.0.1 ...</span><span style="vertical-align:inherit;">
连接到localhost.localdomain（127.0.0.1）。</span><span style="vertical-align:inherit;">
转义字符是'^]'。</span><span style="vertical-align:inherit;"><span style="vertical-align:inherit;">
你好，世界！</span><span style="vertical-align:inherit;">&lt;ENTER&gt;</span></span><span style="vertical-align:inherit;">
好</span></pre><p style="line-height:20.8px;color:rgb(0,0,0);font-family:'Microsoft YaHei';background-color:rgb(255,255,255);"><span style="vertical-align:inherit;">原始的Flume终端将在日志消息中输出事件。</span></p><div class="highlight-properties" style="color:rgb(0,0,0);font-family:'Microsoft YaHei';background-color:rgb(255,255,255);"><div class="highlight"><pre style="background-color:rgb(238,255,204);color:rgb(51,51,51);line-height:15.6px;border-top:1px solid rgb(170,204,153);border-bottom:1px solid rgb(170,204,153);border-left:none;border-right:none;"><span class="na" style="color:rgb(0,128,128);">19年12月6日15 </span><span class="o" style="font-weight:bold;">：</span><span class="s" style="color:rgb(187,136,68);">32:19 INFO source.NetcatSource：创建的ServerSocket：sun.nio.ch.ServerSocketChannelImpl [/127.0.0.1:44444] </span>
<span class="na" style="color:rgb(0,128,128);">19年12月6日15 </span><span class="o" style="font-weight:bold;">：</span><span class="s" style="color:rgb(187,136,68);"><span style="vertical-align:inherit;"><span style="vertical-align:inherit;">32:34 INFO sink.LoggerSink：事件：{头：{}体：48 65 6C 6F 6C 20 77 72 6F 6C 64 21 0D世界你好！</span><span style="vertical-align:inherit;">}</span></span></span></pre></div></div><span style="color:rgb(0,0,0);font-family:'Microsoft YaHei';background-color:rgb(255,255,255);vertical-align:inherit;">恭喜 - 您已经成功配置并部署了Flume代理</span><br><br><p><span style="color:rgb(51,51,51);font-family:arial, '宋体', sans-serif;font-size:14px;text-indent:28px;background-color:rgb(255,255,255);"><br></span></p>            </div>
                </div>