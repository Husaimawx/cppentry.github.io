---
layout:     post
title:      Hive整合HBase完整笔记（亲测）
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								<div class="article-copyright">
					版权声明：本文为博主原创文章，转载请看下方转载要求！					https://blog.csdn.net/dajiangtai007/article/details/79696853				</div>
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <h3 align="center">Hive与HBase整合文档</h3><p>1、  Hive整合HBase配置</p><p>1.1   拷贝hbase 相关jar包</p><p>将hbase 相关jar包拷贝到hive lib目录下</p><p><span style="color:#FF0000;">hbase-client-0.98.13-hadoop2.jar</span></p><p><span style="color:#FF0000;">hbase-common-0.98.13-hadoop2.jar</span></p><p><span style="color:#FF0000;">hbase-server-0.98.13-hadoop2.jar</span></p><p><span style="color:#FF0000;">hbase-common-0.98.13-hadoop2-tests.jar</span></p><p><span style="color:#FF0000;">hbase-protocol-0.98.13-hadoop2.jar</span></p><p><span style="color:#FF0000;">htrace-core-2.04.jar</span></p><p><span style="color:#000000;">hive-hbase-handler-1.0.0.jar</span></p><p><span style="color:#000000;">zookeeper-3.4.5.jar</span></p><p>1.2   修改hive-site.xml配置文件</p><p>将上述jar包添加到hive-site.xml配置的hive.aux.jars.path属性中。</p><p><img src="https://img-blog.csdn.net/20180326132459865?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p>    修改hive.zookeeper.quorum属性</p><p><img src="https://img-blog.csdn.net/20180326132508339?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p>    添加hbase.zookeeper.quorum属性，此属性hive-site.xml之前不存在。</p><p><img src="https://img-blog.csdn.net/20180326132518247?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p>1.3   修改hive-env.sh配置文件</p><p>同默认配置文件中copy一份hive-env.sh文件<strong></strong></p><p><img src="https://img-blog.csdn.net/20180326132602389?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><strong></strong></p><p>修改hive-env.sh配置文件</p><p><img src="https://img-blog.csdn.net/2018032613261024?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p>1.4   启动Hive</p><p>上述配置完成之后，通过bin/hive命令启动hive</p><p><img src="https://img-blog.csdn.net/20180326132619192?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p>如果出现以上输出信息，说明hive整合hbase成功。</p><p>2、  Hive整合HBase后使用</p><p>2.1 准备测试数据</p><p>（1）测试数据文件</p><p>创建测试文件course.csv</p><p><img src="https://img-blog.csdn.net/20180326132628821?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p>第一列为课程名称，第二列为课程分数</p><p>（2）数据加载到HDFS</p><p>在hdfs文件系统中创建hive-hbase目录，并加载测试数据。</p><p>查看hdfs文件目录</p><p><img src="https://img-blog.csdn.net/20180326132638591?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p>创建/hive-hbase/course目录</p><p><img src="https://img-blog.csdn.net/20180326132648721?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p>将course.csv文件上传至/hive-hbase/course目录下</p><p><img src="https://img-blog.csdn.net/20180326132657698?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p>（3）创建Hive数据库</p><p>进入Hive Shell 客户端创建库course</p><p><img src="https://img-blog.csdn.net/20180326132705262?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p>（4）创建Hive表</p><p>进入Hive Shell 客户端创建外部表。</p><p>create external table if notexists course.testcourse(cname string,score int) row format delimited fieldsterminated by '\t' stored as textfile location '/hive-hbase/course';</p><p><img src="https://img-blog.csdn.net/20180326132719827?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p>（5）查看hive表数据</p><p>select * from course.testcourse;</p><p><img src="https://img-blog.csdn.net/20180326132732923?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p>从查询语句的执行结果可以看出，Hive表中的数据和hdfs上的数据一致。</p><p>2.2 创建Hive内部表</p><p>create table 建表语句声明</p><p>course.hbase_testcourse  所创建的Hive表名称</p><p>(cname string,score int) 所创建Hive表字段</p><p>STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler' 指定使用Hive Storage Handlers </p><p>WITHSERDEPROPERTIES("hbase.columns.mapping" = ":key,cf:score")  指定HBase表与Hive表字段映射关系。</p><p>TBLPROPERTIES("hbase.table.name"= "hbase_testcourse"); 指定HBase表名</p><p>内部表创建语句如下：</p><p>create tablecourse.hbase_testcourse(cname string,score int) STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler' WITHSERDEPROPERTIES("hbase.columns.mapping" = ":key,cf:score")TBLPROPERTIES("hbase.table.name" = "hbase_testcourse","hbase.mapred.output.outputtable" = "hbase_testcourse"); </p><p><img src="https://img-blog.csdn.net/20180326132749815?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></p><p>（1）查看Hive中所创建的表</p><p>进入Hive Shell 客户端执行</p><p>hive&gt; use course;</p><p>hive&gt; show tables;</p><p><img src="https://img-blog.csdn.net/20180326132759487?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p>（2）查看HBase 中所创建的表</p><p>进入HBase Shell 客户端执行</p><p>bin/hbase shell</p><p><img src="https://img-blog.csdn.net/20180326132806873?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p><img src="https://img-blog.csdn.net/20180326132821205?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p>2.3 加载数据</p><p> 创建完内部表，可以通过Hive支持的insert overwrite 方式将一个表的数据导入HBase。</p><p>下面是对应的执行语句：</p><p>insert overwrite table course.hbase_testcourseselect cname,score from course.testcourse;</p><p> </p><p> <img src="https://img-blog.csdn.net/20180326132829345?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p>2.4 执行查询</p><p>加载完数据后，需要验证一下加载结果是否存在问题，验证一下总记录数。</p><p>select count(*) fromcourse.hbase_testcourse;</p><p><img src="https://img-blog.csdn.net/20180326132838497?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p><img src="https://img-blog.csdn.net/20180326132853454?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></p><p> </p><p>2.5 创建外部表</p><p>创建外部表适用于该表在HBase中已经存在，但在Hive中并没有相关信息。此时可以通过创建外部表的方式，为HBase现有表提供SQL查询条件。而内部表适用于Hive和HBase都没有相关表的情况。</p><p>（1）创建HBase表</p><p>进入HBase Shell客户端执行建表命令</p><p>create 'hbase_test',{ NAME =&gt;'cf'}</p><p><img src="https://img-blog.csdn.net/20180326132904325?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p>（2）插入数据</p><p>执行以下命令插入数据</p><p>put 'hbase_test','hadoop','cf:score', '95'</p><p>put 'hbase_test','storm','cf:score', '96'</p><p>put 'hbase_test','spark','cf:score', '97'</p><p><img src="https://img-blog.csdn.net/20180326132911893?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p>（3）查看数据</p><p>执行扫描表操作</p><p>scan 'hbase_test'</p><p><img src="https://img-blog.csdn.net/20180326132919851?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p>（4）创建Hive外部表</p><p>进入Hive Shell 客户端，创建外部表course.hbase_test，建表命令如下所示：</p><p>create external tablecourse.hbase_test(cname string,score int) STORED BY  'org.apache.hadoop.hive.hbase.HBaseStorageHandler'WITH SERDEPROPERTIES("hbase.columns.mapping" =":key,cf:score") TBLPROPERTIES("hbase.table.name" ="hbase_test", "hbase.mapred.output.outputtable" = "hbase_test");</p><p>备注：创建外部表和创建内部表的命令基本一致，唯一的区别就是：创建内部表使用create table，创建外部表使用create external table。</p><p><img src="https://img-blog.csdn.net/20180326132934908?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p>（5）Hive 查看数据</p><p>执行Hive命令查询HBase 表中的数据。</p><p>select * from hbase_test;</p><p><img src="https://img-blog.csdn.net/2018032613294544?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Rhamlhbmd0YWkwMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p>通过创建外部表可以成功从Hive 查询HBase表中的数据。</p><p> 技术交流群：695520445</p>            </div>
                </div>