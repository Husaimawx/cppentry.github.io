---
layout:     post
title:      [一起学Hive]之十九-使用Hive API分析HQL的执行计划、Job数量和表的血缘关系
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
关键字：Hive HQL Job数量、Hive执行计划、Hive LineageInfo</p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
本文介绍使用Hive的API获取一条HQL的最终执行计划，从而获取这条HQL的Job数量，另外，介绍使用API分析一条HQL中所包含的输入表和输出表。这些信息在做元数据管理和Hive表的血缘分析时候很有用。</p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
Hive在执行一条HQL的时候，会经过以下步骤：</p>
<ol style="list-style:none;color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;"><li style="line-height:30px;text-indent:0px;">语法解析：Antlr定义SQL的语法规则，完成SQL词法，语法解析，将SQL转化为抽象 语法树AST Tree；</li><li style="line-height:30px;text-indent:0px;">语义解析：遍历AST Tree，抽象出查询的基本组成单元QueryBlock；</li><li style="line-height:30px;text-indent:0px;">生成逻辑执行计划：遍历QueryBlock，翻译为执行操作树OperatorTree；</li><li style="line-height:30px;text-indent:0px;">优化逻辑执行计划：逻辑层优化器进行OperatorTree变换，合并不必要的ReduceSinkOperator，减少shuffle数据量；</li></ol><ol start="5" style="list-style:none;color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;"><li style="line-height:30px;text-indent:0px;">生成物理执行计划：遍历OperatorTree，翻译为MapReduce任务；</li><li style="line-height:30px;text-indent:0px;">优化物理执行计划：物理层优化器进行MapReduce任务的变换，生成最终的执行计划；</li></ol><p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
关于这几个步骤，在美团的技术博客上有一篇文章介绍的非常好，可以参考：http://tech.meituan.com/hive-sql-to-mapreduce.html</p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
一般情况下，HQL中的每一个表或者子查询都会生成一个job，这是逻辑执行计划中生成的，但后面Hive还会优化，比如：使用MapJoin，最终一条HQL语句生成的job数量很难通过HQL观察出来。</p>
<h2 style="line-height:18px;color:rgb(85,85,85);font-size:18px;border-left-width:4px;border-left-style:solid;border-left-color:rgb(0,166,124);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;text-indent:30px;background-color:rgb(251,251,251);">
获取HQL的执行计划和Job数量</h2>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
直接看代码吧：</p>
<pre class="prettyprint linenums" style="color:rgb(68,68,68);font-size:14px;line-height:20px;border:1px solid rgb(238,238,238);overflow:hidden;text-indent:30px;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;background-color:rgb(248,248,248);"></pre><ol class="linenums" style="list-style:none;"><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">package</span><span class="pln" style="color:rgb(0,0,255);"> com</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lxw1234</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">test</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);"> </span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">fs</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">Path</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L3" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">conf</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">HiveConf</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L4" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">Context</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L5" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">QueryPlan</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L6" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="kwd" style="color:rgb(249,38,89);">exec</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">Utilities</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L7" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">parse</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">ASTNode</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L8" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">parse</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">BaseSemanticAnalyzer</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L9" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">parse</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">ParseDriver</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">parse</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">ParseUtils</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">parse</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">SemanticAnalyzerFactory</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">session</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">SessionState</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L3" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);"> </span></li><li class="L4" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">/**</span></li><li class="L5" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);"> * lxw的大数据田地 -- lxw1234.com</span></li><li class="L6" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);"> * @author lxw1234</span></li><li class="L7" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);"> *</span></li><li class="L8" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);"> */</span></li><li class="L9" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">public</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">class</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">HiveQueryPlan</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">{</span></li><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">	</span><span class="kwd" style="color:rgb(249,38,89);">public</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">static</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">void</span><span class="pln" style="color:rgb(0,0,255);"> main</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="typ" style="color:rgb(0,170,0);">String</span><span class="pun" style="color:rgb(0,170,0);">[]</span><span class="pln" style="color:rgb(0,0,255);"> args</span><span class="pun" style="color:rgb(0,170,0);">)</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">throws</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">Exception</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">{</span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		</span><span class="typ" style="color:rgb(0,170,0);">HiveConf</span><span class="pln" style="color:rgb(0,0,255);"> conf </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">new</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">HiveConf</span><span class="pun" style="color:rgb(0,170,0);">();</span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		conf</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">addResource</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="kwd" style="color:rgb(249,38,89);">new</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">Path</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="str" style="color:rgb(194,143,91);">"file:///usr/local/apache-hive-0.13.1-bin/conf/hive-site.xml"</span><span class="pun" style="color:rgb(0,170,0);">));</span></li><li class="L3" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		conf</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">addResource</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="kwd" style="color:rgb(249,38,89);">new</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">Path</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="str" style="color:rgb(194,143,91);">"file:///usr/local/apache-hive-0.13.1-bin/conf/hive-default.xml.template"</span><span class="pun" style="color:rgb(0,170,0);">));</span></li><li class="L4" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		conf</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="kwd" style="color:rgb(249,38,89);">set</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="str" style="color:rgb(194,143,91);">"javax.jdo.option.ConnectionURL"</span><span class="pun" style="color:rgb(0,170,0);">,</span></li><li class="L5" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">				</span><span class="str" style="color:rgb(194,143,91);">"jdbc:mysql://127.0.0.1:3306/hive?createDatabaseIfNotExist=true&amp;useUnicode=true&amp;characterEncoding=utf-8"</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L6" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		conf</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="kwd" style="color:rgb(249,38,89);">set</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="str" style="color:rgb(194,143,91);">"hive.metastore.local"</span><span class="pun" style="color:rgb(0,170,0);">,</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="str" style="color:rgb(194,143,91);">"true"</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L7" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		conf</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="kwd" style="color:rgb(249,38,89);">set</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="str" style="color:rgb(194,143,91);">"javax.jdo.option.ConnectionDriverName"</span><span class="pun" style="color:rgb(0,170,0);">,</span><span class="str" style="color:rgb(194,143,91);">"com.mysql.jdbc.Driver"</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L8" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		conf</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="kwd" style="color:rgb(249,38,89);">set</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="str" style="color:rgb(194,143,91);">"javax.jdo.option.ConnectionUserName"</span><span class="pun" style="color:rgb(0,170,0);">,</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="str" style="color:rgb(194,143,91);">"hive"</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L9" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		conf</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="kwd" style="color:rgb(249,38,89);">set</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="str" style="color:rgb(194,143,91);">"javax.jdo.option.ConnectionPassword"</span><span class="pun" style="color:rgb(0,170,0);">,</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="str" style="color:rgb(194,143,91);">"hive"</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		conf</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="kwd" style="color:rgb(249,38,89);">set</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="str" style="color:rgb(194,143,91);">"hive.stats.dbclass"</span><span class="pun" style="color:rgb(0,170,0);">,</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="str" style="color:rgb(194,143,91);">"jdbc:mysql"</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		conf</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="kwd" style="color:rgb(249,38,89);">set</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="str" style="color:rgb(194,143,91);">"hive.stats.jdbcdriver"</span><span class="pun" style="color:rgb(0,170,0);">,</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="str" style="color:rgb(194,143,91);">"com.mysql.jdbc.Driver"</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		conf</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="kwd" style="color:rgb(249,38,89);">set</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="str" style="color:rgb(194,143,91);">"hive.exec.dynamic.partition.mode"</span><span class="pun" style="color:rgb(0,170,0);">,</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="str" style="color:rgb(194,143,91);">"nonstrict"</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L3" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		</span></li><li class="L4" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		</span><span class="typ" style="color:rgb(0,170,0);">String</span><span class="pln" style="color:rgb(0,0,255);"> command </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> args</span><span class="pun" style="color:rgb(0,170,0);">[</span><span class="lit" style="color:rgb(204,0,204);">0</span><span class="pun" style="color:rgb(0,170,0);">];</span></li><li class="L5" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		</span><span class="typ" style="color:rgb(0,170,0);">SessionState</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">start</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="pln" style="color:rgb(0,0,255);">conf</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L6" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		</span><span class="typ" style="color:rgb(0,170,0);">Context</span><span class="pln" style="color:rgb(0,0,255);"> ctx </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">new</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">Context</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="pln" style="color:rgb(0,0,255);">conf</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L7" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		</span><span class="typ" style="color:rgb(0,170,0);">ParseDriver</span><span class="pln" style="color:rgb(0,0,255);"> pd </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">new</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">ParseDriver</span><span class="pun" style="color:rgb(0,170,0);">();</span></li><li class="L8" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		</span><span class="typ" style="color:rgb(0,170,0);">ASTNode</span><span class="pln" style="color:rgb(0,0,255);"> tree </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> pd</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">parse</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="pln" style="color:rgb(0,0,255);">command</span><span class="pun" style="color:rgb(0,170,0);">,</span><span class="pln" style="color:rgb(0,0,255);"> ctx</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L9" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		tree </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">ParseUtils</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">findRootNonNullToken</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="pln" style="color:rgb(0,0,255);">tree</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		</span><span class="typ" style="color:rgb(0,170,0);">BaseSemanticAnalyzer</span><span class="pln" style="color:rgb(0,0,255);"> sem </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">SemanticAnalyzerFactory</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="kwd" style="color:rgb(249,38,89);">get</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="pln" style="color:rgb(0,0,255);">conf</span><span class="pun" style="color:rgb(0,170,0);">,</span><span class="pln" style="color:rgb(0,0,255);"> tree</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		sem</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">analyze</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="pln" style="color:rgb(0,0,255);">tree</span><span class="pun" style="color:rgb(0,170,0);">,</span><span class="pln" style="color:rgb(0,0,255);"> ctx</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		sem</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">validate</span><span class="pun" style="color:rgb(0,170,0);">();</span></li><li class="L3" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		</span><span class="typ" style="color:rgb(0,170,0);">QueryPlan</span><span class="pln" style="color:rgb(0,0,255);"> queryPlan </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">new</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">QueryPlan</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="pln" style="color:rgb(0,0,255);">command</span><span class="pun" style="color:rgb(0,170,0);">,</span><span class="pln" style="color:rgb(0,0,255);">sem</span><span class="pun" style="color:rgb(0,170,0);">,</span><span class="lit" style="color:rgb(204,0,204);">0l</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L4" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		</span><span class="kwd" style="color:rgb(249,38,89);">int</span><span class="pln" style="color:rgb(0,0,255);"> jobs </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">Utilities</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">getMRTasks</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="pln" style="color:rgb(0,0,255);">queryPlan</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">getRootTasks</span><span class="pun" style="color:rgb(0,170,0);">()).</span><span class="pln" style="color:rgb(0,0,255);">size</span><span class="pun" style="color:rgb(0,170,0);">();</span></li><li class="L5" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		</span><span class="typ" style="color:rgb(0,170,0);">System</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="kwd" style="color:rgb(249,38,89);">out</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">println</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="str" style="color:rgb(194,143,91);">"Total jobs = "</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">+</span><span class="pln" style="color:rgb(0,0,255);"> jobs</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L6" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">		</span></li><li class="L7" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">	</span><span class="pun" style="color:rgb(0,170,0);">}</span></li><li class="L8" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pun" style="color:rgb(0,170,0);">}</span></li><li class="L9" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);"> </span></li></ol>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
将上面的代码打包成testhive.jar，运行该类需要引入Hive的依赖包，在包含Hadoop和Hive客户端的机器上执行下面的命令：</p>
<pre class="prettyprint linenums" style="color:rgb(68,68,68);font-size:14px;line-height:20px;border:1px solid rgb(238,238,238);overflow:hidden;text-indent:30px;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;background-color:rgb(248,248,248);"></pre><ol class="linenums" style="list-style:none;"><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">for</span><span class="pln" style="color:rgb(0,0,255);"> f </span><span class="kwd" style="color:rgb(249,38,89);">in</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">/</span><span class="pln" style="color:rgb(0,0,255);">usr</span><span class="pun" style="color:rgb(0,170,0);">/</span><span class="kwd" style="color:rgb(249,38,89);">local</span><span class="pun" style="color:rgb(0,170,0);">/</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">-</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">-</span><span class="lit" style="color:rgb(204,0,204);">0.13</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="lit" style="color:rgb(204,0,204);">1</span><span class="pun" style="color:rgb(0,170,0);">-</span><span class="pln" style="color:rgb(0,0,255);">bin</span><span class="pun" style="color:rgb(0,170,0);">/</span><span class="pln" style="color:rgb(0,0,255);">lib</span><span class="com" style="color:rgb(102,102,102);">/*.jar; do</span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">  HADOOP_CLASSPATH=${HADOOP_CLASSPATH}:$f;</span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">done</span></li><li class="L3" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">export HADOOP_CLASSPATH</span></li></ol>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
分别解析下面三条HQL语句：</p>
<pre class="prettyprint linenums" style="color:rgb(68,68,68);font-size:14px;line-height:20px;border:1px solid rgb(238,238,238);overflow:hidden;text-indent:30px;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;background-color:rgb(248,248,248);"></pre><ol class="linenums" style="list-style:none;"><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">HQL1</span><span class="pun" style="color:rgb(0,170,0);">：</span><span class="pln" style="color:rgb(0,0,255);">SELECT COUNT</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="lit" style="color:rgb(204,0,204);">1</span><span class="pun" style="color:rgb(0,170,0);">)</span><span class="pln" style="color:rgb(0,0,255);"> FROM liuxiaowen</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lxw1</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">HQL2</span><span class="pun" style="color:rgb(0,170,0);">：</span><span class="pln" style="color:rgb(0,0,255);">SELECT COUNT</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="lit" style="color:rgb(204,0,204);">1</span><span class="pun" style="color:rgb(0,170,0);">)</span><span class="pln" style="color:rgb(0,0,255);"> FROM </span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="pln" style="color:rgb(0,0,255);">SELECT url FROM liuxiaowen</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lxw1 GROUP BY url</span><span class="pun" style="color:rgb(0,170,0);">)</span><span class="pln" style="color:rgb(0,0,255);"> x</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">HQL3</span><span class="pun" style="color:rgb(0,170,0);">：</span><span class="pln" style="color:rgb(0,0,255);">SELECT COUNT</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="lit" style="color:rgb(204,0,204);">1</span><span class="pun" style="color:rgb(0,170,0);">)</span><span class="pln" style="color:rgb(0,0,255);"> FROM liuxiaowen</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lxw1 a join liuxiaowen</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lxw2 b ON </span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="pln" style="color:rgb(0,0,255);">a</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">url </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> b</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">domain</span><span class="pun" style="color:rgb(0,170,0);">);</span></li></ol>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
解析HQL1：</p>
<pre class="prettyprint linenums" style="color:rgb(68,68,68);font-size:14px;line-height:20px;border:1px solid rgb(238,238,238);overflow:hidden;text-indent:30px;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;background-color:rgb(248,248,248);"></pre><ol class="linenums" style="list-style:none;"><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">hadoop jar testhive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">jar com</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lxw1234</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">test</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">HiveQueryPlan</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="str" style="color:rgb(194,143,91);">"SELECT COUNT(1) FROM liuxiaowen.lxw1"</span></li></ol>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
结果如下：</p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
<img class="aligncenter" src="http://7xipth.com1.z0.glb.clouddn.com/0901-1.jpg" alt="Hive QueryPlan" width="808" height="143" style="vertical-align:middle;border:0px;display:block;text-align:center;"></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
解析HQL2：</p>
<pre class="prettyprint linenums" style="color:rgb(68,68,68);font-size:14px;line-height:20px;border:1px solid rgb(238,238,238);overflow:hidden;text-indent:30px;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;background-color:rgb(248,248,248);"></pre><ol class="linenums" style="list-style:none;"><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">hadoop jar testhive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">jar com</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lxw1234</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">test</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">HiveQueryPlan</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="str" style="color:rgb(194,143,91);">"SELECT COUNT(1) FROM (SELECT url FROM liuxiaowen.lxw1 GROUP BY url) x"</span></li></ol>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
结果如下：</p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
<img class="aligncenter" src="http://7xipth.com1.z0.glb.clouddn.com/0901-2.jpg" alt="Hive QueryPlan" width="792" height="155" style="vertical-align:middle;border:0px;display:block;text-align:center;"></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
解析HQL3：</p>
<pre class="prettyprint linenums" style="color:rgb(68,68,68);font-size:14px;line-height:20px;border:1px solid rgb(238,238,238);overflow:hidden;text-indent:30px;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;background-color:rgb(248,248,248);"></pre><ol class="linenums" style="list-style:none;"><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">hadoop jar testhive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">jar com</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lxw1234</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">test</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">HiveQueryPlan</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="str" style="color:rgb(194,143,91);">"SELECT COUNT(1) FROM liuxiaowen.lxw1 a join liuxiaowen.lxw2 b ON (a.url = b.domain)"</span></li></ol>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
结果如下：</p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
<img class="aligncenter" src="http://7xipth.com1.z0.glb.clouddn.com/0901-3.jpg" alt="Hive QueryPlan" width="779" height="188" style="vertical-align:middle;border:0px;display:block;text-align:center;"></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
在HQL3中，由于Hive自动优化使用了MapJoin，因此，两个表的join最终只用了一个job，在Hive中执行验证一下：</p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
<img class="aligncenter" src="http://7xipth.com1.z0.glb.clouddn.com/0901-4.jpg" alt="Hive QueryPlan" width="798" height="423" style="vertical-align:middle;border:0px;display:block;text-align:center;"></p>
<h2 style="line-height:18px;color:rgb(85,85,85);font-size:18px;border-left-width:4px;border-left-style:solid;border-left-color:rgb(0,166,124);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;text-indent:30px;background-color:rgb(251,251,251);">
解析HQL中表的血缘关系</h2>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
在元数据管理中，可能需要知道Hive中有哪些表，以及这些表之间的关联关系，比如：A表是由B表和C表统计汇总而来。</p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
Hive中本身自带了一个工具，用来分析一条HQL中的源表和目标表，org.apache.hadoop.hive.ql.tools.LineageInfo</p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
但该类中目标表只能是使用INSERT语句插入数据的目标表，对于使用CREATE TABLE AS语句创建的表分析不出来。</p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
下面的代码只对org.apache.hadoop.hive.ql.tools.LineageInfo做了小小的修改：</p>
<pre class="prettyprint linenums" style="color:rgb(68,68,68);font-size:14px;line-height:20px;border:1px solid rgb(238,238,238);overflow:hidden;text-indent:30px;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;background-color:rgb(248,248,248);"></pre><ol class="linenums" style="list-style:none;"><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">package</span><span class="pln" style="color:rgb(0,0,255);"> com</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lxw1234</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">test</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);"> </span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> java</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">io</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">IOException</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L3" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> java</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">util</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">ArrayList</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L4" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> java</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">util</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">LinkedHashMap</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L5" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> java</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">util</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">Map</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L6" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> java</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">util</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">Stack</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L7" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> java</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">util</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">TreeSet</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L8" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);"> </span></li><li class="L9" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lib</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">DefaultGraphWalker</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lib</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">DefaultRuleDispatcher</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lib</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">Dispatcher</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lib</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">GraphWalker</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L3" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lib</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">Node</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L4" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lib</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">NodeProcessor</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L5" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lib</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">NodeProcessorCtx</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L6" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lib</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">Rule</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L7" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">parse</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">ASTNode</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L8" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">parse</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">BaseSemanticAnalyzer</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L9" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">parse</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">HiveParser</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">parse</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">ParseDriver</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">parse</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">ParseException</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">import</span><span class="pln" style="color:rgb(0,0,255);"> org</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">apache</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hadoop</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">hive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">ql</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">parse</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">SemanticException</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L3" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);"> </span></li><li class="L4" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">/**</span></li><li class="L5" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);"> * lxw的大数据田地 -- lxw1234.com</span></li><li class="L6" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);"> * @author lxw1234</span></li><li class="L7" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);"> *</span></li><li class="L8" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);"> */</span></li><li class="L9" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="kwd" style="color:rgb(249,38,89);">public</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">class</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">HiveLineageInfo</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">implements</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">NodeProcessor</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">{</span></li><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);"> </span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">  </span><span class="com" style="color:rgb(102,102,102);">/**</span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">   * Stores input tables in sql.</span></li><li class="L3" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">   */</span></li><li class="L4" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">  </span><span class="typ" style="color:rgb(0,170,0);">TreeSet</span><span class="pln" style="color:rgb(0,0,255);"> inputTableList </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">new</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">TreeSet</span><span class="pun" style="color:rgb(0,170,0);">();</span></li><li class="L5" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">  </span><span class="com" style="color:rgb(102,102,102);">/**</span></li><li class="L6" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">   * Stores output tables in sql.</span></li><li class="L7" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">   */</span></li><li class="L8" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">  </span><span class="typ" style="color:rgb(0,170,0);">TreeSet</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">OutputTableList</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">new</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">TreeSet</span><span class="pun" style="color:rgb(0,170,0);">();</span></li><li class="L9" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);"> </span></li><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">  </span><span class="com" style="color:rgb(102,102,102);">/**</span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">   *</span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">   * @return java.util.TreeSet</span></li><li class="L3" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">   */</span></li><li class="L4" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">  </span><span class="kwd" style="color:rgb(249,38,89);">public</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">TreeSet</span><span class="pln" style="color:rgb(0,0,255);"> getInputTableList</span><span class="pun" style="color:rgb(0,170,0);">()</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">{</span></li><li class="L5" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="kwd" style="color:rgb(249,38,89);">return</span><span class="pln" style="color:rgb(0,0,255);"> inputTableList</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L6" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">  </span><span class="pun" style="color:rgb(0,170,0);">}</span></li><li class="L7" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);"> </span></li><li class="L8" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">  </span><span class="com" style="color:rgb(102,102,102);">/**</span></li><li class="L9" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">   * @return java.util.TreeSet</span></li><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">   */</span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">  </span><span class="kwd" style="color:rgb(249,38,89);">public</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">TreeSet</span><span class="pln" style="color:rgb(0,0,255);"> getOutputTableList</span><span class="pun" style="color:rgb(0,170,0);">()</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">{</span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="kwd" style="color:rgb(249,38,89);">return</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">OutputTableList</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L3" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">  </span><span class="pun" style="color:rgb(0,170,0);">}</span></li><li class="L4" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);"> </span></li><li class="L5" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">  </span><span class="com" style="color:rgb(102,102,102);">/**</span></li><li class="L6" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">   * Implements the process method for the NodeProcessor interface.</span></li><li class="L7" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">   */</span></li><li class="L8" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">  </span><span class="kwd" style="color:rgb(249,38,89);">public</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">Object</span><span class="pln" style="color:rgb(0,0,255);"> process</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="typ" style="color:rgb(0,170,0);">Node</span><span class="pln" style="color:rgb(0,0,255);"> nd</span><span class="pun" style="color:rgb(0,170,0);">,</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">Stack</span><span class="pln" style="color:rgb(0,0,255);"> stack</span><span class="pun" style="color:rgb(0,170,0);">,</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">NodeProcessorCtx</span><span class="pln" style="color:rgb(0,0,255);"> procCtx</span><span class="pun" style="color:rgb(0,170,0);">,</span></li><li class="L9" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">      </span><span class="typ" style="color:rgb(0,170,0);">Object</span><span class="pun" style="color:rgb(0,170,0);">...</span><span class="pln" style="color:rgb(0,0,255);"> nodeOutputs</span><span class="pun" style="color:rgb(0,170,0);">)</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">throws</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">SemanticException</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">{</span></li><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="typ" style="color:rgb(0,170,0);">ASTNode</span><span class="pln" style="color:rgb(0,0,255);"> pt </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="typ" style="color:rgb(0,170,0);">ASTNode</span><span class="pun" style="color:rgb(0,170,0);">)</span><span class="pln" style="color:rgb(0,0,255);"> nd</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);"> </span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="kwd" style="color:rgb(249,38,89);">switch</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="pln" style="color:rgb(0,0,255);">pt</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">getToken</span><span class="pun" style="color:rgb(0,170,0);">().</span><span class="pln" style="color:rgb(0,0,255);">getType</span><span class="pun" style="color:rgb(0,170,0);">())</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">{</span></li><li class="L3" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span></li><li class="L4" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="kwd" style="color:rgb(249,38,89);">case</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">HiveParser</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">TOK_CREATETABLE</span><span class="pun" style="color:rgb(0,170,0);">:</span></li><li class="L5" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    	</span><span class="typ" style="color:rgb(0,170,0);">OutputTableList</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">add</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="typ" style="color:rgb(0,170,0);">BaseSemanticAnalyzer</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">getUnescapedName</span><span class="pun" style="color:rgb(0,170,0);">((</span><span class="typ" style="color:rgb(0,170,0);">ASTNode</span><span class="pun" style="color:rgb(0,170,0);">)</span><span class="pln" style="color:rgb(0,0,255);">pt</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">getChild</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="lit" style="color:rgb(204,0,204);">0</span><span class="pun" style="color:rgb(0,170,0);">)));</span></li><li class="L6" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">	    </span><span class="kwd" style="color:rgb(249,38,89);">break</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L7" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="kwd" style="color:rgb(249,38,89);">case</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">HiveParser</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">TOK_TAB</span><span class="pun" style="color:rgb(0,170,0);">:</span></li><li class="L8" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">      </span><span class="typ" style="color:rgb(0,170,0);">OutputTableList</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">add</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="typ" style="color:rgb(0,170,0);">BaseSemanticAnalyzer</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">getUnescapedName</span><span class="pun" style="color:rgb(0,170,0);">((</span><span class="typ" style="color:rgb(0,170,0);">ASTNode</span><span class="pun" style="color:rgb(0,170,0);">)</span><span class="pln" style="color:rgb(0,0,255);">pt</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">getChild</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="lit" style="color:rgb(204,0,204);">0</span><span class="pun" style="color:rgb(0,170,0);">)));</span></li><li class="L9" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">      </span><span class="kwd" style="color:rgb(249,38,89);">break</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);"> </span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="kwd" style="color:rgb(249,38,89);">case</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">HiveParser</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">TOK_TABREF</span><span class="pun" style="color:rgb(0,170,0);">:</span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">      </span><span class="typ" style="color:rgb(0,170,0);">ASTNode</span><span class="pln" style="color:rgb(0,0,255);"> tabTree </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="typ" style="color:rgb(0,170,0);">ASTNode</span><span class="pun" style="color:rgb(0,170,0);">)</span><span class="pln" style="color:rgb(0,0,255);"> pt</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">getChild</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="lit" style="color:rgb(204,0,204);">0</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L3" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">      </span><span class="typ" style="color:rgb(0,170,0);">String</span><span class="pln" style="color:rgb(0,0,255);"> table_name </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="pln" style="color:rgb(0,0,255);">tabTree</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">getChildCount</span><span class="pun" style="color:rgb(0,170,0);">()</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">==</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="lit" style="color:rgb(204,0,204);">1</span><span class="pun" style="color:rgb(0,170,0);">)</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">?</span></li><li class="L4" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">          </span><span class="typ" style="color:rgb(0,170,0);">BaseSemanticAnalyzer</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">getUnescapedName</span><span class="pun" style="color:rgb(0,170,0);">((</span><span class="typ" style="color:rgb(0,170,0);">ASTNode</span><span class="pun" style="color:rgb(0,170,0);">)</span><span class="pln" style="color:rgb(0,0,255);">tabTree</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">getChild</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="lit" style="color:rgb(204,0,204);">0</span><span class="pun" style="color:rgb(0,170,0);">))</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">:</span></li><li class="L5" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">            </span><span class="typ" style="color:rgb(0,170,0);">BaseSemanticAnalyzer</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">getUnescapedName</span><span class="pun" style="color:rgb(0,170,0);">((</span><span class="typ" style="color:rgb(0,170,0);">ASTNode</span><span class="pun" style="color:rgb(0,170,0);">)</span><span class="pln" style="color:rgb(0,0,255);">tabTree</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">getChild</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="lit" style="color:rgb(204,0,204);">0</span><span class="pun" style="color:rgb(0,170,0);">))</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">+</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="str" style="color:rgb(194,143,91);">"."</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">+</span><span class="pln" style="color:rgb(0,0,255);"> tabTree</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">getChild</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="lit" style="color:rgb(204,0,204);">1</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L6" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">      inputTableList</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">add</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="pln" style="color:rgb(0,0,255);">table_name</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L7" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">      </span><span class="kwd" style="color:rgb(249,38,89);">break</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L8" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="pun" style="color:rgb(0,170,0);">}</span></li><li class="L9" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="kwd" style="color:rgb(249,38,89);">return</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">null</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">  </span><span class="pun" style="color:rgb(0,170,0);">}</span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);"> </span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">  </span><span class="com" style="color:rgb(102,102,102);">/**</span></li><li class="L3" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">   * parses given query and gets the lineage info.</span></li><li class="L4" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">   *</span></li><li class="L5" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">   * @param query</span></li><li class="L6" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">   * @throws ParseException</span></li><li class="L7" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">   */</span></li><li class="L8" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">  </span><span class="kwd" style="color:rgb(249,38,89);">public</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">void</span><span class="pln" style="color:rgb(0,0,255);"> getLineageInfo</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="typ" style="color:rgb(0,170,0);">String</span><span class="pln" style="color:rgb(0,0,255);"> query</span><span class="pun" style="color:rgb(0,170,0);">)</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">throws</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">ParseException</span><span class="pun" style="color:rgb(0,170,0);">,</span></li><li class="L9" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">      </span><span class="typ" style="color:rgb(0,170,0);">SemanticException</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">{</span></li><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);"> </span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="com" style="color:rgb(102,102,102);">/*</span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">     * Get the AST tree</span></li><li class="L3" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">     */</span></li><li class="L4" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="typ" style="color:rgb(0,170,0);">ParseDriver</span><span class="pln" style="color:rgb(0,0,255);"> pd </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">new</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">ParseDriver</span><span class="pun" style="color:rgb(0,170,0);">();</span></li><li class="L5" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="typ" style="color:rgb(0,170,0);">ASTNode</span><span class="pln" style="color:rgb(0,0,255);"> tree </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> pd</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">parse</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="pln" style="color:rgb(0,0,255);">query</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L6" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);"> </span></li><li class="L7" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="kwd" style="color:rgb(249,38,89);">while</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">((</span><span class="pln" style="color:rgb(0,0,255);">tree</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">getToken</span><span class="pun" style="color:rgb(0,170,0);">()</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">==</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">null</span><span class="pun" style="color:rgb(0,170,0);">)</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">&amp;&amp;</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="pln" style="color:rgb(0,0,255);">tree</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">getChildCount</span><span class="pun" style="color:rgb(0,170,0);">()</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">&gt;</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="lit" style="color:rgb(204,0,204);">0</span><span class="pun" style="color:rgb(0,170,0);">))</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">{</span></li><li class="L8" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">      tree </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="typ" style="color:rgb(0,170,0);">ASTNode</span><span class="pun" style="color:rgb(0,170,0);">)</span><span class="pln" style="color:rgb(0,0,255);"> tree</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">getChild</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="lit" style="color:rgb(204,0,204);">0</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L9" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="pun" style="color:rgb(0,170,0);">}</span></li><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);"> </span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="com" style="color:rgb(102,102,102);">/*</span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">     * initialize Event Processor and dispatcher.</span></li><li class="L3" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="com" style="color:rgb(102,102,102);">     */</span></li><li class="L4" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    inputTableList</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">clear</span><span class="pun" style="color:rgb(0,170,0);">();</span></li><li class="L5" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="typ" style="color:rgb(0,170,0);">OutputTableList</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">clear</span><span class="pun" style="color:rgb(0,170,0);">();</span></li><li class="L6" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);"> </span></li><li class="L7" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="com" style="color:rgb(102,102,102);">// create a walker which walks the tree in a DFS manner while maintaining</span></li><li class="L8" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="com" style="color:rgb(102,102,102);">// the operator stack. The dispatcher</span></li><li class="L9" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="com" style="color:rgb(102,102,102);">// generates the plan from the operator tree</span></li><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="typ" style="color:rgb(0,170,0);">Map</span><span class="pun" style="color:rgb(0,170,0);">&lt;</span><span class="typ" style="color:rgb(0,170,0);">Rule</span><span class="pun" style="color:rgb(0,170,0);">,</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">NodeProcessor</span><span class="pun" style="color:rgb(0,170,0);">&gt;</span><span class="pln" style="color:rgb(0,0,255);"> rules </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">new</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">LinkedHashMap</span><span class="pun" style="color:rgb(0,170,0);">&lt;</span><span class="typ" style="color:rgb(0,170,0);">Rule</span><span class="pun" style="color:rgb(0,170,0);">,</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">NodeProcessor</span><span class="pun" style="color:rgb(0,170,0);">&gt;();</span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);"> </span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="com" style="color:rgb(102,102,102);">// The dispatcher fires the processor corresponding to the closest matching</span></li><li class="L3" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="com" style="color:rgb(102,102,102);">// rule and passes the context along</span></li><li class="L4" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="typ" style="color:rgb(0,170,0);">Dispatcher</span><span class="pln" style="color:rgb(0,0,255);"> disp </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">new</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">DefaultRuleDispatcher</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="kwd" style="color:rgb(249,38,89);">this</span><span class="pun" style="color:rgb(0,170,0);">,</span><span class="pln" style="color:rgb(0,0,255);"> rules</span><span class="pun" style="color:rgb(0,170,0);">,</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">null</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L5" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="typ" style="color:rgb(0,170,0);">GraphWalker</span><span class="pln" style="color:rgb(0,0,255);"> ogw </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">new</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">DefaultGraphWalker</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="pln" style="color:rgb(0,0,255);">disp</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L6" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);"> </span></li><li class="L7" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="com" style="color:rgb(102,102,102);">// Create a list of topop nodes</span></li><li class="L8" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="typ" style="color:rgb(0,170,0);">ArrayList</span><span class="pln" style="color:rgb(0,0,255);"> topNodes </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">new</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">ArrayList</span><span class="pun" style="color:rgb(0,170,0);">();</span></li><li class="L9" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    topNodes</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">add</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="pln" style="color:rgb(0,0,255);">tree</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    ogw</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">startWalking</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="pln" style="color:rgb(0,0,255);">topNodes</span><span class="pun" style="color:rgb(0,170,0);">,</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">null</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">  </span><span class="pun" style="color:rgb(0,170,0);">}</span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);"> </span></li><li class="L3" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">  </span><span class="kwd" style="color:rgb(249,38,89);">public</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">static</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">void</span><span class="pln" style="color:rgb(0,0,255);"> main</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="typ" style="color:rgb(0,170,0);">String</span><span class="pun" style="color:rgb(0,170,0);">[]</span><span class="pln" style="color:rgb(0,0,255);"> args</span><span class="pun" style="color:rgb(0,170,0);">)</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">throws</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">IOException</span><span class="pun" style="color:rgb(0,170,0);">,</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">ParseException</span><span class="pun" style="color:rgb(0,170,0);">,</span></li><li class="L4" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">      </span><span class="typ" style="color:rgb(0,170,0);">SemanticException</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">{</span></li><li class="L5" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="typ" style="color:rgb(0,170,0);">String</span><span class="pln" style="color:rgb(0,0,255);"> query </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> args</span><span class="pun" style="color:rgb(0,170,0);">[</span><span class="lit" style="color:rgb(204,0,204);">0</span><span class="pun" style="color:rgb(0,170,0);">];</span></li><li class="L6" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="typ" style="color:rgb(0,170,0);">HiveLineageInfo</span><span class="pln" style="color:rgb(0,0,255);"> lep </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="kwd" style="color:rgb(249,38,89);">new</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="typ" style="color:rgb(0,170,0);">HiveLineageInfo</span><span class="pun" style="color:rgb(0,170,0);">();</span></li><li class="L7" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    lep</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">getLineageInfo</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="pln" style="color:rgb(0,0,255);">query</span><span class="pun" style="color:rgb(0,170,0);">);</span></li><li class="L8" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">    </span><span class="typ" style="color:rgb(0,170,0);">System</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="kwd" style="color:rgb(249,38,89);">out</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">println</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="str" style="color:rgb(194,143,91);">"Input tables = "</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">+</span><span class="pln" style="color:rgb(0,0,255);"> lep</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">getInputTableList</span><span class="pun" style="color:rgb(0,170,0);">());</span></li><li class="L9" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">	</span><span class="typ" style="color:rgb(0,170,0);">System</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="kwd" style="color:rgb(249,38,89);">out</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">println</span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="str" style="color:rgb(194,143,91);">"Output tables = "</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="pun" style="color:rgb(0,170,0);">+</span><span class="pln" style="color:rgb(0,0,255);"> lep</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">getOutputTableList</span><span class="pun" style="color:rgb(0,170,0);">());</span></li><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">  </span><span class="pun" style="color:rgb(0,170,0);">}</span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pun" style="color:rgb(0,170,0);">}</span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);"> </span></li></ol>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
将上面的程序打包成testhive.jar，同上面，执行时候需要引入Hive的依赖包：</p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
分析下面两条HQL语句：</p>
<pre class="prettyprint linenums" style="color:rgb(68,68,68);font-size:14px;line-height:20px;border:1px solid rgb(238,238,238);overflow:hidden;text-indent:30px;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;background-color:rgb(248,248,248);"></pre><ol class="linenums" style="list-style:none;"><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">HQL1</span><span class="pun" style="color:rgb(0,170,0);">:</span><span class="pln" style="color:rgb(0,0,255);">CREATE TABLE liuxiaowen</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lxw1234 AS SELECT </span><span class="pun" style="color:rgb(0,170,0);">*</span><span class="pln" style="color:rgb(0,0,255);"> FROM liuxiaowen</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lxw1</span><span class="pun" style="color:rgb(0,170,0);">;</span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">HQL2</span><span class="pun" style="color:rgb(0,170,0);">:</span><span class="pln" style="color:rgb(0,0,255);">INSERT OVERWRITE TABLE liuxiaowen</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lxw3 SELECT a</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">url FROM liuxiaowen</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lxw1 a join liuxiaowen</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lxw2 b ON </span><span class="pun" style="color:rgb(0,170,0);">(</span><span class="pln" style="color:rgb(0,0,255);">a</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">url </span><span class="pun" style="color:rgb(0,170,0);">=</span><span class="pln" style="color:rgb(0,0,255);"> b</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">domain</span><span class="pun" style="color:rgb(0,170,0);">);</span></li></ol>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
执行命令：</p>
<pre class="prettyprint linenums" style="color:rgb(68,68,68);font-size:14px;line-height:20px;border:1px solid rgb(238,238,238);overflow:hidden;text-indent:30px;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;background-color:rgb(248,248,248);"></pre><ol class="linenums" style="list-style:none;"><li class="L0" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">hadoop jar testhive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">jar com</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lxw1234</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">test</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">HiveLineageInfo</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="str" style="color:rgb(194,143,91);">"CREATE TABLE liuxiaowen.lxw1234 AS SELECT * FROM liuxiaowen.lxw1"</span></li><li class="L1" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pln" style="color:rgb(0,0,255);">hadoop jar testhive</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">jar com</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">lxw1234</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">test</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="typ" style="color:rgb(0,170,0);">HiveLineageInfo</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="str" style="color:rgb(194,143,91);">"INSERT OVERWRITE TABLE liuxiaowen.lxw3 SELECT a.url FROM liuxiaowen.lxw1 a </span></li><li class="L2" style="text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="str" style="color:rgb(194,143,91);">     join liuxiaowen.lxw2 b ON (a.url = b.domain)"</span></li></ol>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
分析结果：</p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
<img class="aligncenter" src="http://7xipth.com1.z0.glb.clouddn.com/0901-5.jpg" alt="Hive LineageInfo" width="825" height="318" style="vertical-align:middle;border:0px;display:block;text-align:center;"></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
HQL中的Input table和Output table已经正确解析出来。</p>
<h3 style="line-height:35px;color:rgb(85,85,85);font-size:16px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;text-indent:30px;">
<a title="" href="http://lxw1234.com/" rel="nofollow" style="color:rgb(0,166,124);text-decoration:none;">Hive相关文章（持续更新）</a>：</h3>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
<a title="" href="http://lxw1234.com/archives/2015/07/365.htm" rel="nofollow" style="color:rgb(0,166,124);text-decoration:none;">一起学Hive系列</a></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
—-<a title="" href="http://lxw1234.com/archives/2015/06/238.htm" rel="nofollow" style="color:rgb(0,166,124);text-decoration:none;">Hive概述，Hive是什么</a></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
—-<a title="" href="http://lxw1234.com/archives/2015/06/251.htm" rel="nofollow" style="color:rgb(0,166,124);text-decoration:none;">Hive函数大全-完整版</a></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
—-<a title="" href="http://lxw1234.com/archives/2015/06/265.htm" rel="nofollow" style="color:rgb(0,166,124);text-decoration:none;">Hive中的数据库(Database)和表(Table)</a></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
—-<a title="" href="http://lxw1234.com/archives/2015/06/269.htm" rel="nofollow" style="color:rgb(0,166,124);text-decoration:none;">Hive的安装配置</a></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
—-<a title="" href="http://lxw1234.com/archives/2015/06/284.htm" rel="nofollow" style="color:rgb(0,166,124);text-decoration:none;">Hive的视图和分区</a></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
—-<a title="" href="http://lxw1234.com/archives/2015/06/286.htm" rel="nofollow" style="color:rgb(0,166,124);text-decoration:none;">Hive的动态分区</a></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
—-<a title="" href="http://lxw1234.com/archives/2015/06/290.htm" rel="nofollow" style="color:rgb(0,166,124);text-decoration:none;">向Hive表中加载数据</a></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
—-<a title="" href="http://lxw1234.com/archives/2015/06/292.htm" rel="nofollow" style="color:rgb(0,166,124);text-decoration:none;">使用Hive命令行</a></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
—-<a title="" href="http://lxw1234.com/archives/2015/06/307.htm" rel="nofollow" style="color:rgb(0,166,124);text-decoration:none;">Hive的查询语句SELECT</a></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
—-<a title="" href="http://lxw1234.com/archives/2015/06/313.htm" rel="nofollow" style="color:rgb(0,166,124);text-decoration:none;">Hive中Join的原理和机制</a></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
—-<a title="" href="http://lxw1234.com/archives/2015/06/315.htm" rel="nofollow" style="color:rgb(0,166,124);text-decoration:none;">Hive中Join的类型和用法</a></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
—-<a title="" href="http://lxw1234.com/archives/2015/06/317.htm" rel="nofollow" style="color:rgb(0,166,124);text-decoration:none;">Hive SQL的优化</a></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
—-<a title="" href="http://lxw1234.com/archives/2015/06/319.htm" rel="nofollow" style="color:rgb(0,166,124);text-decoration:none;">Hive整合HBase，操作HBase表</a></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
—-<a title="" href="http://lxw1234.com/archives/2015/07/378.htm" rel="nofollow" style="color:rgb(0,166,124);text-decoration:none;">Hive的元数据表结构详解</a></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
—-<a title="" href="http://lxw1234.com/archives/2015/07/413.htm" rel="nofollow" style="color:rgb(0,166,124);text-decoration:none;">分析Hive表和分区的统计信息(Statistics)</a></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
—-<a title="" href="http://lxw1234.com/archives/2015/07/419.htm" rel="nofollow" style="color:rgb(0,166,124);text-decoration:none;">Hive的WEB页面接口-HWI</a></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
—-<a title="" href="http://lxw1234.com/archives/2015/08/444.htm" rel="nofollow" style="color:rgb(0,166,124);text-decoration:none;">从Hive表中进行数据抽样-Sampling</a></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
—-<a title="" href="http://lxw1234.com/archives/2015/08/454.htm" rel="nofollow" style="color:rgb(0,166,124);text-decoration:none;">Hive UDF开发</a></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;line-height:26px;text-indent:30px;">
<a title="" href="http://lxw1234.com/archives/2015/07/367.htm" rel="nofollow" style="color:rgb(0,166,124);text-decoration:none;">Hive分析函数系列</a></p>
            </div>
                </div>