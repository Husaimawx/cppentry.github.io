---
layout:     post
title:      tsdb部署
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <h1 class="post-title" style="font-size:32px;font-family:inherit;font-weight:500;line-height:1.1;color:inherit;">OpenTSDB部署与使用</h1><div class="post-content" style="color:rgb(51,51,51);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', Arial, Verdana, 'Hiragino Sans GB', STHeiti, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><p style="line-height:1.8;color:rgb(102,102,102);">OpenTSDB 是基于 HBase 存储时间序列数据的一个开源数据库，对于存储监控系统采集的数据来说非常合适，不仅在写入查询上有很高的效率，而且节省存储空间。</p><p style="line-height:1.8;color:rgb(102,102,102);">官网文档：http://opentsdb.net/docs/build/html/api_http/query/index.html</p><h3 id="安装-hbase" style="font-family:inherit;line-height:1.1;color:inherit;font-size:24px;border-left:6px solid rgb(255,126,121);">安装 HBase</h3><p style="line-height:1.8;color:rgb(102,102,102);">因为 OpenTSDB 的后端存储使用的是 HBase，所以我们需要先安装 HBase。</p><p style="line-height:1.8;color:rgb(102,102,102);">参考文档： <a href="https://hbase.apache.org/book.html#quickstart" rel="nofollow" style="background-color:transparent;color:rgb(51,122,183);">Quick Start - Standalone HBase</a></p><p style="line-height:1.8;color:rgb(102,102,102);">这里简单搭建了一个<span style="font-weight:700;color:rgb(60,70,80);">单机</span>的 HBase 环境：</p><ol><li style="line-height:1.8;font-size:16px;color:rgb(102,102,102);">安装 JDK 环境，centos 上可以直接通过 yum 安装。</li><li style="line-height:1.8;font-size:16px;color:rgb(102,102,102);">下载 HBase，<a href="http://apache.fayea.com/hbase/stable" rel="nofollow" style="background-color:transparent;color:rgb(51,122,183);">http://apache.fayea.com/hbase/stable</a>，这里我们选择下载 stable 的 1.1.3 版本，文件名为 <code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">hbase-1.1.3-bin.tar.gz</code>，解压到任意目录。</li><li style="line-height:1.8;font-size:16px;color:rgb(102,102,102);">修改 <code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">conf/hbase-env.sh</code> ，设置  <code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">JAVA_HOME=/usr</code>，这个是 <code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">/bin/java</code> 所在的目录，通过 <code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">which java</code> 查看。</li><li style="line-height:1.8;font-size:16px;color:rgb(102,102,102);">修改 <code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">conf/hbase-site.xml</code>， 设置 hbase 的数据存储目录以及 zookeeper 的数据存储目录，默认会放到 <code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">/tmp</code> 目录下，这个目录机器重启后会清空，所以需要更改目录。</li><li style="line-height:1.8;font-size:16px;color:rgb(102,102,102);">执行 <code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">bin/start-hbase.sh</code> 启动 HBase，之后可以通过 <code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">jps</code> 命令来查看 HMaster 进程是否启动成功。 <code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">bin/stop-hbase.sh</code> 用于关闭 HBase。</li></ol><p style="line-height:1.8;color:rgb(102,102,102);"><code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">conf/hbase-site.xml</code> 的配置示例如下</p><pre style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;line-height:1.42857;color:rgb(51,51,51);background-color:rgb(245,245,245);border:1px solid rgb(204,204,204);"><code class="language-xml hljs" style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;color:rgb(197,200,198);background-color:rgb(29,31,33);"><span class="hljs-tag" style="color:rgb(204,102,102);">&lt;<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-tag" style="color:rgb(204,102,102);">&lt;<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag" style="color:rgb(204,102,102);">&lt;<span class="hljs-name">name</span>&gt;</span>hbase.rootdir<span class="hljs-tag" style="color:rgb(204,102,102);">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag" style="color:rgb(204,102,102);">&lt;<span class="hljs-name">value</span>&gt;</span>file:///home/testuser/hbase<span class="hljs-tag" style="color:rgb(204,102,102);">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag" style="color:rgb(204,102,102);">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag" style="color:rgb(204,102,102);">&lt;<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag" style="color:rgb(204,102,102);">&lt;<span class="hljs-name">name</span>&gt;</span>hbase.zookeeper.property.dataDir<span class="hljs-tag" style="color:rgb(204,102,102);">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag" style="color:rgb(204,102,102);">&lt;<span class="hljs-name">value</span>&gt;</span>/home/testuser/zookeeper<span class="hljs-tag" style="color:rgb(204,102,102);">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag" style="color:rgb(204,102,102);">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag" style="color:rgb(204,102,102);">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
</code></pre><h3 id="通过命令行操作-hbase" style="font-family:inherit;line-height:1.1;color:inherit;font-size:24px;border-left:6px solid rgb(255,126,121);">通过命令行操作 HBase</h3><p style="line-height:1.8;color:rgb(102,102,102);">这里可以稍微熟悉一下 HBase 的操作，非必须。</p><h5 id="连接到-hbase" style="font-family:inherit;line-height:1.1;color:inherit;">连接到 HBase</h5><p style="line-height:1.8;color:rgb(102,102,102);"><code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">./bin/hbase shell</code></p><h5 id="创建一张表" style="font-family:inherit;line-height:1.1;color:inherit;">创建一张表</h5><p style="line-height:1.8;color:rgb(102,102,102);"><code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">create 'test', 'cf'</code></p><h5 id="查看表信息" style="font-family:inherit;line-height:1.1;color:inherit;">查看表信息</h5><p style="line-height:1.8;color:rgb(102,102,102);"><code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">list 'test'</code></p><h5 id="向表中插入数据" style="font-family:inherit;line-height:1.1;color:inherit;">向表中插入数据</h5><pre style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;line-height:1.42857;color:rgb(51,51,51);background-color:rgb(245,245,245);border:1px solid rgb(204,204,204);"><code class="language-bash hljs" style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;color:rgb(197,200,198);background-color:rgb(29,31,33);">put <span class="hljs-string" style="color:rgb(181,189,104);">'test'</span>, <span class="hljs-string" style="color:rgb(181,189,104);">'row1'</span>, <span class="hljs-string" style="color:rgb(181,189,104);">'cf:a'</span>, <span class="hljs-string" style="color:rgb(181,189,104);">'value1'</span>
put <span class="hljs-string" style="color:rgb(181,189,104);">'test'</span>, <span class="hljs-string" style="color:rgb(181,189,104);">'row2'</span>, <span class="hljs-string" style="color:rgb(181,189,104);">'cf:b'</span>, <span class="hljs-string" style="color:rgb(181,189,104);">'value2'</span>
put <span class="hljs-string" style="color:rgb(181,189,104);">'test'</span>, <span class="hljs-string" style="color:rgb(181,189,104);">'row3'</span>, <span class="hljs-string" style="color:rgb(181,189,104);">'cf:c'</span>, <span class="hljs-string" style="color:rgb(181,189,104);">'value3'</span>
</code></pre><h5 id="查看表中所有数据" style="font-family:inherit;line-height:1.1;color:inherit;">查看表中所有数据</h5><p style="line-height:1.8;color:rgb(102,102,102);"><code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">scan 'test'</code></p><h5 id="查看指定行的数据" style="font-family:inherit;line-height:1.1;color:inherit;">查看指定行的数据</h5><p style="line-height:1.8;color:rgb(102,102,102);"><code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">get 'test', 'row1'</code></p><h5 id="禁用指定表-删除表或修改表设置前需要先禁用该表" style="font-family:inherit;line-height:1.1;color:inherit;">禁用指定表（删除表或修改表设置前需要先禁用该表）</h5><p style="line-height:1.8;color:rgb(102,102,102);"><code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">disable 'test'</code></p><h5 id="恢复指定表" style="font-family:inherit;line-height:1.1;color:inherit;">恢复指定表</h5><p style="line-height:1.8;color:rgb(102,102,102);"><code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">enable 'test'</code></p><h5 id="删除表" style="font-family:inherit;line-height:1.1;color:inherit;">删除表</h5><p style="line-height:1.8;color:rgb(102,102,102);"><code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">drop 'test'</code></p><h3 id="安装opentsdb" style="font-family:inherit;line-height:1.1;color:inherit;font-size:24px;border-left:6px solid rgb(255,126,121);">安装OpenTSDB</h3><p style="line-height:1.8;color:rgb(102,102,102);"><span style="font-weight:700;color:rgb(60,70,80);">参考文章</span></p><p style="line-height:1.8;color:rgb(102,102,102);"><a href="http://debugo.com/opentsdb/" rel="nofollow" style="background-color:transparent;color:rgb(51,122,183);">http://debugo.com/opentsdb/</a></p><p style="line-height:1.8;color:rgb(102,102,102);"><a href="http://opentsdb.net/docs/build/html/installation.html#runtime-requirements" rel="nofollow" style="background-color:transparent;color:rgb(51,122,183);">http://opentsdb.net/docs/build/html/installation.html#runtime-requirements</a></p><ol><li style="line-height:1.8;font-size:16px;color:rgb(102,102,102);"><p style="line-height:1.8;color:rgb(102,102,102);">直接从 github 上下载 OpenTSDB 的 <a href="https://github.com/OpenTSDB/opentsdb" rel="nofollow" style="background-color:transparent;color:rgb(51,122,183);">release</a> 版本的 RPM 包。安装 <code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">yum localinstall opentsdb-2.2.0.noarch.rpm</code>。</p></li><li style="line-height:1.8;font-size:16px;color:rgb(102,102,102);"><p style="line-height:1.8;color:rgb(102,102,102);">配置完成后，我们通过下面命令在 HBase 中建立 opentsdb 所需的表。默认情况下 opentsdb 建立的 HBase 表启用了 lzo 压缩。需要开启 Hadoop 中的 lzo 压缩支持， 这里我们直接在下面脚本中把 COMPRESSION 的支持关闭。修改 <code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">/usr/share/opentsdb/tools/create_table.sh</code>，设置 <code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">COMPRESSION=NONE</code>，并且在文件开始处设置 HBase 所在目录， <code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">HBASE_HOME=/home/xxx/hbase-1.1.3</code>。之后执行该脚本，在 HBase 中创建相应的表。</p></li><li style="line-height:1.8;font-size:16px;color:rgb(102,102,102);"><p style="line-height:1.8;color:rgb(102,102,102);">修改 OpenTSDB 的配置文件，<code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">/etc/opentsdb/opentsdb.conf</code>，例如绑定的端口号等。<span style="font-weight:700;color:rgb(60,70,80);">这里需要注意的是 tsd.core.auto_create_metrics 从 false 改为 true。这样上传数据时会自动创建 metric，否则会提示 Unknown metric 的错误。也可以设置为 false，但是使用 <code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">tsdb mkmetric proc.loadavg.1m</code> 来手动添加 metric。</span></p></li><li style="line-height:1.8;font-size:16px;color:rgb(102,102,102);"><p style="line-height:1.8;color:rgb(102,102,102);">启动 OpenTSDB，<code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">service opentsdb start</code> 或者 <code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">nohup tsdb tsd &amp;</code>。</p></li><li style="line-height:1.8;font-size:16px;color:rgb(102,102,102);"><p style="line-height:1.8;color:rgb(102,102,102);">通过浏览器访问 <a href="http://x.x.x.x:4242/" rel="nofollow" style="background-color:transparent;color:rgb(51,122,183);">http://x.x.x.x:4242</a> 查看是否安装成功。</p></li></ol><h3 id="http-api" style="font-family:inherit;line-height:1.1;color:inherit;font-size:24px;border-left:6px solid rgb(255,126,121);">HTTP API</h3><h4 id="插入数据" style="font-family:inherit;line-height:1.1;color:inherit;">插入数据</h4><p style="line-height:1.8;color:rgb(102,102,102);"><span style="font-weight:700;color:rgb(60,70,80);">/api/put</span></p><p style="line-height:1.8;color:rgb(102,102,102);">根据 url 参数的不同，可以选择是否获取详细的信息。</p><p style="line-height:1.8;color:rgb(102,102,102);"><span style="font-weight:700;color:rgb(60,70,80);">/api/put?summary</span>        // 返回失败和成功的个数</p><pre style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;line-height:1.42857;color:rgb(51,51,51);background-color:rgb(245,245,245);border:1px solid rgb(204,204,204);"><code class="language-json hljs" style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;color:rgb(197,200,198);background-color:rgb(29,31,33);">{
    <span class="hljs-attr">"failed"</span>: <span class="hljs-number" style="color:rgb(222,147,95);">0</span>,
    <span class="hljs-attr">"success"</span>: <span class="hljs-number" style="color:rgb(222,147,95);">1</span>
}
</code></pre><p style="line-height:1.8;color:rgb(102,102,102);"><span style="font-weight:700;color:rgb(60,70,80);">/api/put?details</span>        // 返回详细信息</p><pre style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;line-height:1.42857;color:rgb(51,51,51);background-color:rgb(245,245,245);border:1px solid rgb(204,204,204);"><code class="language-json hljs" style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;color:rgb(197,200,198);background-color:rgb(29,31,33);">{
    <span class="hljs-attr">"errors"</span>: [],
    <span class="hljs-attr">"failed"</span>: <span class="hljs-number" style="color:rgb(222,147,95);">0</span>,
    <span class="hljs-attr">"success"</span>: <span class="hljs-number" style="color:rgb(222,147,95);">1</span>
}
</code></pre><p style="line-height:1.8;color:rgb(102,102,102);">通过POST方式插入数据，JSON格式，例如</p><pre style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;line-height:1.42857;color:rgb(51,51,51);background-color:rgb(245,245,245);border:1px solid rgb(204,204,204);"><code class="language-json hljs" style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;color:rgb(197,200,198);background-color:rgb(29,31,33);">{
    <span class="hljs-attr">"metric"</span>:<span class="hljs-string" style="color:rgb(181,189,104);">"self.test"</span>, 
    <span class="hljs-attr">"timestamp"</span>:<span class="hljs-number" style="color:rgb(222,147,95);">1456123787</span>, 
    <span class="hljs-attr">"value"</span>:<span class="hljs-number" style="color:rgb(222,147,95);">20</span>, 
    <span class="hljs-attr">"tags"</span>:{
        <span class="hljs-attr">"host"</span>:<span class="hljs-string" style="color:rgb(181,189,104);">"web1"</span>
    }
}
</code></pre><h3 id="查询数据" style="font-family:inherit;line-height:1.1;color:inherit;font-size:24px;border-left:6px solid rgb(255,126,121);">查询数据</h3><p style="line-height:1.8;color:rgb(102,102,102);"><span style="font-weight:700;color:rgb(60,70,80);">/api/query</span></p><p style="line-height:1.8;color:rgb(102,102,102);">可以选择 Get 或者 Post 两种方式，推荐使用 Post 方式，JSON 格式。</p><pre style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;line-height:1.42857;color:rgb(51,51,51);background-color:rgb(245,245,245);border:1px solid rgb(204,204,204);"><code class="language-json hljs" style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;color:rgb(197,200,198);background-color:rgb(29,31,33);">{
    <span class="hljs-attr">"start"</span>: <span class="hljs-number" style="color:rgb(222,147,95);">1456123705</span>,
    <span class="hljs-attr">"end"</span>: <span class="hljs-number" style="color:rgb(222,147,95);">1456124985</span>,
    <span class="hljs-attr">"queries"</span>: [
        {
            <span class="hljs-attr">"aggregator"</span>: <span class="hljs-string" style="color:rgb(181,189,104);">"sum"</span>,
            <span class="hljs-attr">"metric"</span>: <span class="hljs-string" style="color:rgb(181,189,104);">"self.test"</span>,
            <span class="hljs-attr">"tags"</span>: {
                <span class="hljs-attr">"host"</span>: <span class="hljs-string" style="color:rgb(181,189,104);">"web1"</span>
            }
        },
        {
            <span class="hljs-attr">"aggregator"</span>: <span class="hljs-string" style="color:rgb(181,189,104);">"sum"</span>,
            <span class="hljs-attr">"metric"</span>: <span class="hljs-string" style="color:rgb(181,189,104);">"self.test"</span>,
            <span class="hljs-attr">"tags"</span>: {
                <span class="hljs-attr">"host"</span>: <span class="hljs-string" style="color:rgb(181,189,104);">"web2"</span>
            }
        }
    ]
}
</code></pre><p style="line-height:1.8;color:rgb(102,102,102);">start 和 end 为指定的查询时间段。</p><p style="line-height:1.8;color:rgb(102,102,102);">queries 为一个数组，可以指定多个查询。</p><p style="line-height:1.8;color:rgb(102,102,102);">metric 和 tags 是用于过滤的查询条件。</p><p style="line-height:1.8;color:rgb(102,102,102);"><span style="font-weight:700;color:rgb(60,70,80);">返回字符串也为json格式</span></p><pre style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;line-height:1.42857;color:rgb(51,51,51);background-color:rgb(245,245,245);border:1px solid rgb(204,204,204);"><code class="language-json hljs" style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;color:rgb(197,200,198);background-color:rgb(29,31,33);">[
    {
        <span class="hljs-attr">"metric"</span>: <span class="hljs-string" style="color:rgb(181,189,104);">"self.test"</span>,
        <span class="hljs-attr">"tags"</span>: {},
        <span class="hljs-attr">"aggregateTags"</span>: [
            <span class="hljs-string" style="color:rgb(181,189,104);">"host"</span>
        ],
        <span class="hljs-attr">"dps"</span>: {
            <span class="hljs-attr">"1456123785"</span>: <span class="hljs-number" style="color:rgb(222,147,95);">10</span>,
            <span class="hljs-attr">"1456123786"</span>: <span class="hljs-number" style="color:rgb(222,147,95);">10</span>
        }
    },
    {
        <span class="hljs-attr">"metric"</span>: <span class="hljs-string" style="color:rgb(181,189,104);">"self.test"</span>,
        <span class="hljs-attr">"tags"</span>: {
            <span class="hljs-attr">"host"</span>: <span class="hljs-string" style="color:rgb(181,189,104);">"web1"</span>
        },
        <span class="hljs-attr">"aggregateTags"</span>: [],
        <span class="hljs-attr">"dps"</span>: {
            <span class="hljs-attr">"1456123784"</span>: <span class="hljs-number" style="color:rgb(222,147,95);">10</span>,
            <span class="hljs-attr">"1456123786"</span>: <span class="hljs-number" style="color:rgb(222,147,95);">15</span>
        }
    }
]
</code></pre><h4 id="聚合" style="font-family:inherit;line-height:1.1;color:inherit;">聚合</h4><p style="line-height:1.8;color:rgb(102,102,102);"><span style="font-weight:700;color:rgb(60,70,80);">aggregator</span> 是用于对查询结果进行聚合，将同一 unix 时间戳内的数据进行聚合计算后返回结果，例如如果 tags 不填，1456123705 有两条数据，一条 <code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">host=web1</code>，另外一条 <code style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:14.4px;">host=web2</code>，值都为10，那么返回的该时间点的值为 sum 后的 20。</p><h4 id="条件过滤" style="font-family:inherit;line-height:1.1;color:inherit;">条件过滤</h4><p style="line-height:1.8;color:rgb(102,102,102);">可以针对 tag 进行一些条件的过滤，返回 tag 中 host 的值以 web 开头的数据。</p><pre style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;line-height:1.42857;color:rgb(51,51,51);background-color:rgb(245,245,245);border:1px solid rgb(204,204,204);"><code class="language-json hljs" style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;color:rgb(197,200,198);background-color:rgb(29,31,33);"><span class="hljs-string" style="color:rgb(181,189,104);">"queries"</span>: [
    {
        <span class="hljs-attr">"aggregator"</span>: <span class="hljs-string" style="color:rgb(181,189,104);">"sum"</span>,
        <span class="hljs-attr">"metric"</span>: <span class="hljs-string" style="color:rgb(181,189,104);">"self.test"</span>,
        <span class="hljs-attr">"filters"</span>: [
            {
                <span class="hljs-attr">"type"</span>: <span class="hljs-string" style="color:rgb(181,189,104);">"wildcard"</span>,
                <span class="hljs-attr">"tagk"</span>: <span class="hljs-string" style="color:rgb(181,189,104);">"host"</span>,
                <span class="hljs-attr">"filter"</span>: <span class="hljs-string" style="color:rgb(181,189,104);">"web*"</span>
            }
        ]
    }
]
</code></pre><h4 id="downsample" style="font-family:inherit;line-height:1.1;color:inherit;">downsample</h4><p style="line-height:1.8;color:rgb(102,102,102);">简单来说就是对指定时间段内的数据进行聚合后返回，例如需要返回每分钟的平均值数据</p><pre style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;line-height:1.42857;color:rgb(51,51,51);background-color:rgb(245,245,245);border:1px solid rgb(204,204,204);"><code class="language-json hljs" style="font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;color:rgb(197,200,198);background-color:rgb(29,31,33);"><span class="hljs-string" style="color:rgb(181,189,104);">"queries"</span>: [
    {
        <span class="hljs-attr">"aggregator"</span>: <span class="hljs-string" style="color:rgb(181,189,104);">"sum"</span>,
        <span class="hljs-attr">"metric"</span>: <span class="hljs-string" style="color:rgb(181,189,104);">"self.test"</span>,
        <span class="hljs-attr">"downsample"</span>: <span class="hljs-string" style="color:rgb(181,189,104);">"1m-avg"</span>,
        <span class="hljs-attr">"tags"</span>: {
            <span class="hljs-attr">"host"</span>: <span class="hljs-string" style="color:rgb(181,189,104);">"web1"</span>
        }
    }
]</code></pre></div>            </div>
                </div>