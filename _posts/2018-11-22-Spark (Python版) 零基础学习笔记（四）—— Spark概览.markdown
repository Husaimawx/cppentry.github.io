---
layout:     post
title:      Spark (Python版) 零基础学习笔记（四）—— Spark概览
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								<div class="article-copyright">
					版权声明：本文为博主原创文章，未经博主允许不得转载。					https://blog.csdn.net/zhangyang10d/article/details/53300485				</div>
								            <div id="content_views" class="markdown_views prism-atom-one-dark">
							<!-- flowchart 箭头图标 勿删 -->
							<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path></svg>
							<p>结合了《Learning Spark: Lightning-Fast Big Data Analysis》和官方2.02版本的Spark Document总结了关于Spark概念性的一些知识。帮助大家对Spark有一个总体上的认知</p>

<p><strong><font size="4" face="黑体">一、Spark的两个核心概念：</font></strong></p>

<p>1、RDD：弹性分布式数据集 <br>
2、 Shared variables：共享变量</p>

<p><strong><font size="4" face="黑体">二、Spark组件：</font></strong></p>

<p>Spark集成了很多组件。Spark的内核是一个计算引擎，用于夸多个worker machines或计算集群调度，分布和监视由很与计算任务组成的应用程序。</p>

<p><strong><font size="3" face="黑体">Spark紧密集成的优点：</font></strong> <br>
1. 高层组件能够受益于底层的改进。比如Spark内核优化后，它的SQL和ML库也能提升速度。 <br>
2. 花费较少。包括部署、维修、测试、支持等的费用。一旦有新的组件加入到Spark栈中，所有使用Spark的机构都能够立即使用这一新的组件。 <br>
3. Spark建立的应用能够无缝组合其他的处理模型。比如，你用Spark写一个利用ML算法，不断数据流中接收数据，对数据进行实时分类的程序。与此同时，分析师能够通过SQL对同样的数据进行实时的查询操作。此外，数据工程师和数据科学家能够通过Python Shell获取同样的书进行不同的分析。</p>

<p><strong><font size="3" face="黑体">Spark组件介绍：</font></strong> <br>
1. Spark Core：包括Spark的基础功能，比如任务调度组件、内存管理、故障恢复、存储系统交互等。也是定义RDD（Spark最重要的编程概念）的API的所在地。 <br>
2. Spark SQL (structured data)：处理结构化数据的Spark包，利用SQL可以或者Hive进行数据查询操作。它也支持很多数据源，包括Hive表格，Parquet和JSON。Spark SQL除了给Spark提供了一个SQL接口外，还循序开发者将SQL查询和RDD支持的可编程数据操作混合使用，从而进行更加复杂的分析。 <br>
3. Spark Streaming (real-time)：是一个能够处理实时数据流的Spark组件。数据流包括生产Web服务器产生的日志文件、web服务的用户发布的状态更新的信息。Spark Streaming提供了一个操作数据流的API，它与RDD API十分接近。API的底层设计能够提供与Spark Core同等程度的容错、吞吐量和扩展支持。 <br>
4. Mlib (machine learning)：提供了多种机器学习算法，包括分类、回归、聚类、协同过滤、模型评价和数据导入等等。也提供了ML的一些底层的处理，比如通用梯度下降优化算法。这些算法都能够夸集群扩展。 <br>
5. GraphX (processing)：用于处理图像（比如社交网络的朋友关系图）和进行图形并行计算的库。与Spark Streaming和Spark SQL类似，GraphX也是Spark RDD API的扩展，允许我们创建一个有向图，并给每个节点和边任意设定属性。GraphX也提供了丰富的图像处理算子（例如subgraph和mapVertices）和常见的图像算法库（例如PageRank和triangle counting）。</p>

<p>Spark能够在很多集群管理器上运行，包括Hadoop YARN，Apache Mesos，和简单的集群管理器，包括Spark自己的Standalone Scheduler。</p>

<p><strong><font size="3" face="黑体">Core Spark概念</font></strong> <br>
每个Spark应用都含有一个驱动程序，它将并行操作投放到集群上。该驱动程序包括Spark应用的main主函数，在集群上定义分布式数据集，并将其上实施各种操作。Spark shell本身就是一个驱动程序，因此我们能够在shell中直接实施各种操作。如下图所示。 <br>
<img src="https://img-blog.csdn.net/20161123084612452" alt="这里写图片描述" title=""></p>

<p><strong><font size="4" face="黑体"> 三、初始化Spark</font></strong></p>

<p>编写Spark程序首先要做的一件事是创建一个SparkContext对象，这个对象是告诉Spark如何访问一个集群的。在创建SparkContext之前，需要先创建一个SparkConf对象，它包含了spark应用的信息。 <br>
conf =  SparkConf().setAppName(appName).setMaster(master) <br>
sc = SparkContext(conf=conf) <br>
其中， <br>
appName： 应用的名字，会在集群的UI上显示 <br>
master：是一个Spark或者Mesos或者YARN集群的URL，也可以是一个指示本地地址的string。 <br>
实际应用中，当在一个集群上运行程序时，我们一般并不愿意在程序中将master写死，而是希望通过spark-submit将应用程序启动的时候传递它。但在本地测试过程中可以使用local测试Spark。</p>

<p><strong><font size="3" face="黑体">3.1. 使用Shell </font></strong> <br>
在Pyspark shell中，已经存在一个专有的解释器可识别的SparkContext，叫做sc。如果再创建自己的SparkContext就无法工作。可以利用–matser命令设置Spark将要连接的集群。可用利用–py-files语句将Python的.zip，.egg或.py文件添加到runtime path，如果有多个文件，用逗号隔开。也可以通过在–packages语句和maven在shell会话中添加依赖（例如SparkPackages）。任何附加的可能存在依赖的代码库（例如SonaType）都可以用过–repositories语句添加。任何Spark Packages中存在的Python以来都必须通过pip命令手动安装。下面举几个例子，在4个核上运行bin/pyspark： <br>
<span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-11-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-1176" style="width: 52.287em; display: inline-block;"><span style="display: inline-block; position: relative; width: 48.398em; height: 0px; font-size: 108%;"><span style="position: absolute; clip: rect(1.731em 1000em 3.151em -0.491em); top: -2.713em; left: 0.003em;"><span class="mrow" id="MathJax-Span-1177"><span class="mo" id="MathJax-Span-1178" style="font-family: MathJax_Main;">.</span><span class="texatom" id="MathJax-Span-1179" style="padding-left: 0.188em;"><span class="mrow" id="MathJax-Span-1180"><span class="mo" id="MathJax-Span-1181" style="font-family: MathJax_Main;">/</span></span></span><span class="mi" id="MathJax-Span-1182" style="font-family: MathJax_Math-italic;">b</span><span class="mi" id="MathJax-Span-1183" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-1184" style="font-family: MathJax_Math-italic;">n</span><span class="texatom" id="MathJax-Span-1185"><span class="mrow" id="MathJax-Span-1186"><span class="mo" id="MathJax-Span-1187" style="font-family: MathJax_Main;">/</span></span></span><span class="mi" id="MathJax-Span-1188" style="font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-1189" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-1190" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-1191" style="font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-1192" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-1193" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-1194" style="font-family: MathJax_Math-italic;">k</span><span class="mo" id="MathJax-Span-1195" style="font-family: MathJax_Main;">–</span><span class="mi" id="MathJax-Span-1196" style="font-family: MathJax_Math-italic; padding-left: 0.188em;">m</span><span class="mi" id="MathJax-Span-1197" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-1198" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-1199" style="font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-1200" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-1201" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-1202" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-1203" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-1204" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-1205" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-1206" style="font-family: MathJax_Math-italic;">l</span><span class="mo" id="MathJax-Span-1207" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-1208" style="font-family: MathJax_Main;">4</span><span class="mo" id="MathJax-Span-1209" style="font-family: MathJax_Main;">]</span><span class="texatom" id="MathJax-Span-1210"><span class="mrow" id="MathJax-Span-1211"><span class="mo" id="MathJax-Span-1212"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>或</span></span></span></span><span class="texatom" id="MathJax-Span-1213"><span class="mrow" id="MathJax-Span-1214"><span class="mo" id="MathJax-Span-1215"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>者</span></span></span></span><span class="texatom" id="MathJax-Span-1216"><span class="mrow" id="MathJax-Span-1217"><span class="mo" id="MathJax-Span-1218"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>将</span></span></span></span><span class="mi" id="MathJax-Span-1219" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-1220" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-1221" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-1222" style="font-family: MathJax_Math-italic;">e</span><span class="mo" id="MathJax-Span-1223" style="font-family: MathJax_Main;">.</span><span class="mi" id="MathJax-Span-1224" style="font-family: MathJax_Math-italic; padding-left: 0.188em;">p</span><span class="mi" id="MathJax-Span-1225" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="texatom" id="MathJax-Span-1226"><span class="mrow" id="MathJax-Span-1227"><span class="mo" id="MathJax-Span-1228"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>加</span></span></span></span><span class="texatom" id="MathJax-Span-1229"><span class="mrow" id="MathJax-Span-1230"><span class="mo" id="MathJax-Span-1231"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>入</span></span></span></span><span class="texatom" id="MathJax-Span-1232"><span class="mrow" id="MathJax-Span-1233"><span class="mo" id="MathJax-Span-1234"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>到</span></span></span></span><span class="texatom" id="MathJax-Span-1235"><span class="mrow" id="MathJax-Span-1236"><span class="mo" id="MathJax-Span-1237"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>搜</span></span></span></span><span class="texatom" id="MathJax-Span-1238"><span class="mrow" id="MathJax-Span-1239"><span class="mo" id="MathJax-Span-1240"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>索</span></span></span></span><span class="texatom" id="MathJax-Span-1241"><span class="mrow" id="MathJax-Span-1242"><span class="mo" id="MathJax-Span-1243"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>路</span></span></span></span><span class="texatom" id="MathJax-Span-1244"><span class="mrow" id="MathJax-Span-1245"><span class="mo" id="MathJax-Span-1246"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>径</span></span></span></span><span class="texatom" id="MathJax-Span-1247"><span class="mrow" id="MathJax-Span-1248"><span class="mo" id="MathJax-Span-1249"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>（</span></span></span></span><span class="texatom" id="MathJax-Span-1250"><span class="mrow" id="MathJax-Span-1251"><span class="mo" id="MathJax-Span-1252"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>便</span></span></span></span><span class="texatom" id="MathJax-Span-1253"><span class="mrow" id="MathJax-Span-1254"><span class="mo" id="MathJax-Span-1255"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>于</span></span></span></span><span class="texatom" id="MathJax-Span-1256"><span class="mrow" id="MathJax-Span-1257"><span class="mo" id="MathJax-Span-1258"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>后</span></span></span></span><span class="texatom" id="MathJax-Span-1259"><span class="mrow" id="MathJax-Span-1260"><span class="mo" id="MathJax-Span-1261"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>边</span></span></span></span><span class="texatom" id="MathJax-Span-1262"><span class="mrow" id="MathJax-Span-1263"><span class="mo" id="MathJax-Span-1264"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>使</span></span></span></span><span class="texatom" id="MathJax-Span-1265"><span class="mrow" id="MathJax-Span-1266"><span class="mo" id="MathJax-Span-1267"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>用</span></span></span></span><span class="mi" id="MathJax-Span-1268" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-1269" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-1270" style="font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-1271" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-1272" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-1273" style="font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-1274" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-1275" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-1276" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-1277" style="font-family: MathJax_Math-italic;">e</span><span class="texatom" id="MathJax-Span-1278"><span class="mrow" id="MathJax-Span-1279"><span class="mo" id="MathJax-Span-1280"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>）</span></span></span></span><span class="texatom" id="MathJax-Span-1281"><span class="mrow" id="MathJax-Span-1282"><span class="mo" id="MathJax-Span-1283"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>，</span></span></span></span><span class="texatom" id="MathJax-Span-1284"><span class="mrow" id="MathJax-Span-1285"><span class="mo" id="MathJax-Span-1286"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>利</span></span></span></span><span class="texatom" id="MathJax-Span-1287"><span class="mrow" id="MathJax-Span-1288"><span class="mo" id="MathJax-Span-1289"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>用</span></span></span></span><span class="texatom" id="MathJax-Span-1290"><span class="mrow" id="MathJax-Span-1291"><span class="mo" id="MathJax-Span-1292"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>下</span></span></span></span><span class="texatom" id="MathJax-Span-1293"><span class="mrow" id="MathJax-Span-1294"><span class="mo" id="MathJax-Span-1295"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>面</span></span></span></span><span class="texatom" id="MathJax-Span-1296"><span class="mrow" id="MathJax-Span-1297"><span class="mo" id="MathJax-Span-1298"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>的</span></span></span></span><span class="texatom" id="MathJax-Span-1299"><span class="mrow" id="MathJax-Span-1300"><span class="mo" id="MathJax-Span-1301"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>语</span></span></span></span><span class="texatom" id="MathJax-Span-1302"><span class="mrow" id="MathJax-Span-1303"><span class="mo" id="MathJax-Span-1304"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>句</span></span></span></span><span class="texatom" id="MathJax-Span-1305"><span class="mrow" id="MathJax-Span-1306"><span class="mo" id="MathJax-Span-1307"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>实</span></span></span></span><span class="texatom" id="MathJax-Span-1308"><span class="mrow" id="MathJax-Span-1309"><span class="mo" id="MathJax-Span-1310"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>现</span></span></span></span><span class="texatom" id="MathJax-Span-1311"><span class="mrow" id="MathJax-Span-1312"><span class="mo" id="MathJax-Span-1313"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>：</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.719em;"></span></span></span><span style="border-left: 0.003em solid; display: inline-block; overflow: hidden; width: 0px; height: 1.27em; vertical-align: -0.33em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-11"> ./bin/pyspark –master local[4]  
或者将code.py加入到搜索路径（便于后边使用import code），利用下面的语句实现：  
</script> /bin/pyspark –master local[4] –py-files code.py <br>
如需查看pyspark的所有操作，可以执行pyspark –help命令。事实上，pyspark调用了更加通用的spark -submit脚本。</p>

<p>在IPython中也可以启动PySpark会话，PySpark能够在IPython 1.0.0以上版本上运行。如果要使用IPython，将变量PYSPARK_DRIVER_PYTHON设置为ipython就可以了。 <br>
<span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-12-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-1314" style="width: 45.003em; display: inline-block;"><span style="display: inline-block; position: relative; width: 41.67em; height: 0px; font-size: 108%;"><span style="position: absolute; clip: rect(1.731em 1000em 3.151em -0.491em); top: -2.713em; left: 0.003em;"><span class="mrow" id="MathJax-Span-1315"><span class="mi" id="MathJax-Span-1316" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.127em;"></span></span><span class="mi" id="MathJax-Span-1317" style="font-family: MathJax_Math-italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.188em;"></span></span><span class="mi" id="MathJax-Span-1318" style="font-family: MathJax_Math-italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.065em;"></span></span><span class="mi" id="MathJax-Span-1319" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.127em;"></span></span><span class="mi" id="MathJax-Span-1320" style="font-family: MathJax_Math-italic;">A</span><span class="mi" id="MathJax-Span-1321" style="font-family: MathJax_Math-italic;">R</span><span class="msubsup" id="MathJax-Span-1322"><span style="display: inline-block; position: relative; width: 1.608em; height: 0px;"><span style="position: absolute; clip: rect(1.608em 1000em 2.657em -0.491em); top: -2.466em; left: 0.003em;"><span class="mi" id="MathJax-Span-1323" style="font-family: MathJax_Math-italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.065em;"></span></span><span style="display: inline-block; width: 0px; height: 2.472em;"></span></span><span style="position: absolute; top: -2.096em; left: 0.867em;"><span class="mi" id="MathJax-Span-1324" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span><span style="display: inline-block; width: 0px; height: 2.225em;"></span></span></span></span><span class="mi" id="MathJax-Span-1325" style="font-family: MathJax_Math-italic;">R</span><span class="mi" id="MathJax-Span-1326" style="font-family: MathJax_Math-italic;">I<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.065em;"></span></span><span class="mi" id="MathJax-Span-1327" style="font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.188em;"></span></span><span class="mi" id="MathJax-Span-1328" style="font-family: MathJax_Math-italic;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="msubsup" id="MathJax-Span-1329"><span style="display: inline-block; position: relative; width: 1.299em; height: 0px;"><span style="position: absolute; clip: rect(1.608em 1000em 2.657em -0.491em); top: -2.466em; left: 0.003em;"><span class="mi" id="MathJax-Span-1330" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 2.472em;"></span></span><span style="position: absolute; top: -2.096em; left: 0.744em;"><span class="mi" id="MathJax-Span-1331" style="font-size: 70.7%; font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.065em;"></span></span><span style="display: inline-block; width: 0px; height: 2.225em;"></span></span></span></span><span class="mi" id="MathJax-Span-1332" style="font-family: MathJax_Math-italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.188em;"></span></span><span class="mi" id="MathJax-Span-1333" style="font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.127em;"></span></span><span class="mi" id="MathJax-Span-1334" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.065em;"></span></span><span class="mi" id="MathJax-Span-1335" style="font-family: MathJax_Math-italic;">O</span><span class="mi" id="MathJax-Span-1336" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.065em;"></span></span><span class="mo" id="MathJax-Span-1337" style="font-family: MathJax_Main; padding-left: 0.312em;">=</span><span class="mi" id="MathJax-Span-1338" style="font-family: MathJax_Math-italic; padding-left: 0.312em;">i</span><span class="mi" id="MathJax-Span-1339" style="font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-1340" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-1341" style="font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-1342" style="font-family: MathJax_Math-italic;">h</span><span class="mi" id="MathJax-Span-1343" style="font-family: MathJax_Math-italic;">o</span><span class="mi" id="MathJax-Span-1344" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-1345" style="font-family: MathJax_Main;">.</span><span class="texatom" id="MathJax-Span-1346" style="padding-left: 0.188em;"><span class="mrow" id="MathJax-Span-1347"><span class="mo" id="MathJax-Span-1348" style="font-family: MathJax_Main;">/</span></span></span><span class="mi" id="MathJax-Span-1349" style="font-family: MathJax_Math-italic;">b</span><span class="mi" id="MathJax-Span-1350" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-1351" style="font-family: MathJax_Math-italic;">n</span><span class="texatom" id="MathJax-Span-1352"><span class="mrow" id="MathJax-Span-1353"><span class="mo" id="MathJax-Span-1354" style="font-family: MathJax_Main;">/</span></span></span><span class="mi" id="MathJax-Span-1355" style="font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-1356" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-1357" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-1358" style="font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-1359" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-1360" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-1361" style="font-family: MathJax_Math-italic;">k</span><span class="texatom" id="MathJax-Span-1362"><span class="mrow" id="MathJax-Span-1363"><span class="mo" id="MathJax-Span-1364"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>类</span></span></span></span><span class="texatom" id="MathJax-Span-1365"><span class="mrow" id="MathJax-Span-1366"><span class="mo" id="MathJax-Span-1367"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>似</span></span></span></span><span class="texatom" id="MathJax-Span-1368"><span class="mrow" id="MathJax-Span-1369"><span class="mo" id="MathJax-Span-1370"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>的</span></span></span></span><span class="texatom" id="MathJax-Span-1371"><span class="mrow" id="MathJax-Span-1372"><span class="mo" id="MathJax-Span-1373"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>，</span></span></span></span><span class="texatom" id="MathJax-Span-1374"><span class="mrow" id="MathJax-Span-1375"><span class="mo" id="MathJax-Span-1376"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>如</span></span></span></span><span class="texatom" id="MathJax-Span-1377"><span class="mrow" id="MathJax-Span-1378"><span class="mo" id="MathJax-Span-1379"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>果</span></span></span></span><span class="texatom" id="MathJax-Span-1380"><span class="mrow" id="MathJax-Span-1381"><span class="mo" id="MathJax-Span-1382"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>要</span></span></span></span><span class="texatom" id="MathJax-Span-1383"><span class="mrow" id="MathJax-Span-1384"><span class="mo" id="MathJax-Span-1385"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>使</span></span></span></span><span class="texatom" id="MathJax-Span-1386"><span class="mrow" id="MathJax-Span-1387"><span class="mo" id="MathJax-Span-1388"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>用</span></span></span></span><span class="mi" id="MathJax-Span-1389" style="font-family: MathJax_Math-italic;">J<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.065em;"></span></span><span class="mi" id="MathJax-Span-1390" style="font-family: MathJax_Math-italic;">u</span><span class="mi" id="MathJax-Span-1391" style="font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-1392" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-1393" style="font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-1394" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-1395" style="font-family: MathJax_Math-italic;">r</span><span class="texatom" id="MathJax-Span-1396"><span class="mrow" id="MathJax-Span-1397"><span class="mo" id="MathJax-Span-1398"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>，</span></span></span></span><span class="texatom" id="MathJax-Span-1399"><span class="mrow" id="MathJax-Span-1400"><span class="mo" id="MathJax-Span-1401"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>设</span></span></span></span><span class="texatom" id="MathJax-Span-1402"><span class="mrow" id="MathJax-Span-1403"><span class="mo" id="MathJax-Span-1404"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>置</span></span></span></span><span class="texatom" id="MathJax-Span-1405"><span class="mrow" id="MathJax-Span-1406"><span class="mo" id="MathJax-Span-1407"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>为</span></span></span></span><span class="texatom" id="MathJax-Span-1408"><span class="mrow" id="MathJax-Span-1409"><span class="mo" id="MathJax-Span-1410"><span style='font-family: STIXGeneral, "Arial Unicode MS", serif; font-size: 93%; font-style: normal; font-weight: normal;'>：</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.719em;"></span></span></span><span style="border-left: 0.003em solid; display: inline-block; overflow: hidden; width: 0px; height: 1.27em; vertical-align: -0.33em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-12"> PYSPARK_DRIVER_PYTHON=ipython ./bin/pyspark  
类似的，如果要使用Jupyter，设置为：  
</script> PYSPARK_DRIVER_PYTHON=jupyter ./bin/pyspark</p>

<p><strong><font size="4" face="黑体">四、弹性分布式数据集RDDs</font></strong></p>

<p>两种方法可以创建RDD： <br>
（1）在现存的驱动程序中并行化集合 <br>
（2）引用一个外部存储系统中的数据集，例如共享文件系统，HDFS，HBase或者其他Hadoop输入格式的数据源</p>

<p><strong><font size="3" face="黑体">4.1. 并行化集合</font></strong> <br>
并行化集合通过在已有的可迭代对象挥着集合上调用SparkContext中的parallelize实现。集合中的元素被拷贝后构成一个能够进行并行操作的分布式数据集。例如创建一个包含数字1-5的并行化集合： <br>
data = [1, 2, 3, 4, 5] <br>
distData = sc.parallelize(data) <br>
并行化的一个重要参数是并行的分区数目。Spark在集群的每个分区上运行一个任务。一般来说，一个CPU一般会分2-4个分区。通常，Spark会根据集群自动设置分区的数目。但也可以进行人为设置，通过设置sc.parallelize的第二个参数实现。注意，有些地方使用分片这个术语（等同于分片）来维护反向兼容性。</p>

<p><strong><font size="3" face="黑体">4.2. 外部数据集</font></strong> <br>
Spark可以从Hadoop支持的其他存储单元创建分布式数据集，包括本地文件系统，HDFS，Cassandra，HBase，Amazon S3等等。Spark支持文本文件，文件队列和其他Hadoop输入格式。 <br>
文本文件RDD能够通过SparkContext的textFile方法创建。该方法给每个文件一个URI（一个计算机的本地地址，或是hdfs://，s3n://等URI），将文件作为行的集合读入。例如：</p>

<pre class="prettyprint"><code class=" hljs haskell">&gt;&gt;&gt; distFile = sc.textFile(“<span class="hljs-typedef"><span class="hljs-keyword">data</span>.txt”)</span></code></pre>

<p>创建后，distFile可以通过数据集的操作进行很多活动。比如，计算文件中的总行数可以通map和reduce操作实现：distFile.map(lambda s: len(s)).reduce(lambda a, b: a+b). <br>
Spark读取文件的注意事项： <br>
（1）如果使用本地文件系统的路径，那么该文件也必须能够被其他工作节点获取。或者将文件拷贝到每个工作节点，或者使用安装在网络上的共享文件系统。 <br>
（2）textFile方法通过设置第二个参数能够控制文件的分区数目。默认情况下，Spark为文件的每个block（HDFS默认一个block的大小为64MB）创建一个分区，但是可以通过设定参数获得更多的分区数目。注意，分区数目不能少于block的数目。 <br>
除了文本文件，Spark的Python API也支持其他一些数据格式： <br>
（1）SparkContext.wholeTextFiles：能够读取包含多个小的文本文件的字典，并返回每个（文件名filenames，内容content）对。这与textFile不同，textFile返回的是每个文件中每行的一个记录。 <br>
（2）RDD.saveAsPickleFile和SparkContext.pickleFile支持将RDD以一种简单的格式保存，这种格式由被pickle的python对象组成。批处理被用来进行pickle序列化，默认的大小为10。 <br>
（3）文件队列和Hadoop输入/输出格式。</p>

<p>注意：以上特性目前仍处于实验状态，主要针对高级用户。未来，也可能被给予Spark SQL的read/write支持所替代，因为Spark SQL的方法更为人偏爱。</p>

<p><strong><font size="3" face="黑体">Writable支持</font></strong> <br>
PySpark把Java键值对组成的RDD载入文件队列时，将writables转化为Java格式，然后利用Pyrolite将Java对象进行pickle。当把键值对的一个RDD存入文件队列时，PySpark会进行一系列相反的操作。它会把Python对象unpickle成Java对象，并将它们转化为writables。下列Writables能够进行自动转换：</p>

<table>
<thead>
<tr>
  <th>Writable Type</th>
  <th>Python Type</th>
</tr>
</thead>
<tbody><tr>
  <td>Text</td>
  <td>Unicode str</td>
</tr>
<tr>
  <td>IntWritable</td>
  <td>int</td>
</tr>
<tr>
  <td>FloatWritable</td>
  <td>float</td>
</tr>
<tr>
  <td>DoubleWritable</td>
  <td>float</td>
</tr>
<tr>
  <td>BooleanWritable</td>
  <td>bool</td>
</tr>
<tr>
  <td>BytesWritable</td>
  <td>bytearray</td>
</tr>
<tr>
  <td>NullWritable</td>
  <td>None</td>
</tr>
<tr>
  <td>MapWritable</td>
  <td>dict</td>
</tr>
</tbody></table>


<p>比较意外的是，array类型并不支持。在读写时，用户需要专门指定用户的ArrayWritable子类型还需要。在写入时，用户还需要指定转换器将array转换成ArrayWritable子类型。在读取时，默认的转换器能够将ArrayWritable子类型转换成Java的Object[]，然后被pickle成配Python元组（tuples）。</p>

<p><strong><font size="3" face="黑体">保存和载入文件队列</font></strong> <br>
与文本文件相似，文件队列能够以特定的路径进行保存和载入操作。对于key和value类需要被特别说明，但对于标准的Writables并不需要。</p>



<pre class="prettyprint"><code class=" hljs python"><span class="hljs-prompt">&gt;&gt;&gt; </span>rdd = sc.parallelize(range(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>).map(<span class="hljs-keyword">lambda</span> x: (x, <span class="hljs-string">"a"</span>*x)))
<span class="hljs-prompt">&gt;&gt;&gt; </span>rdd.saveAsSequenceFile(<span class="hljs-string">"path/to/file"</span>)
<span class="hljs-prompt">&gt;&gt;&gt; </span>sorted(sc.sequenceFile(<span class="hljs-string">"path/to/file"</span>).collect())
[(<span class="hljs-number">1</span>, <span class="hljs-string">'a'</span>), (<span class="hljs-number">2</span>, <span class="hljs-string">'aa'</span>), (<span class="hljs-number">3</span>, <span class="hljs-string">'aaa'</span>)]</code></pre>

<p><strong><font size="3" face="黑体">保存和载入其他Hadoop输入输出格式</font></strong> <br>
对于新旧版本的Hadoop Mapreduce API， Spark都支持任何Hadoop输入格式的读取和输出格式的写入。如果需要，Hadoop布局能够以Python字典的形式传递。</p>            </div>
						<link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-9e5741c4b9.css" rel="stylesheet">
                </div>