---
layout:     post
title:      Hive 整合Hbase（hbase.TableNotFoundException）
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								<div class="article-copyright">
					版权声明：小兄弟，慢慢熬吧......					https://blog.csdn.net/u013850277/article/details/77512952				</div>
								            <div id="content_views" class="markdown_views prism-atom-one-dark">
							<!-- flowchart 箭头图标 勿删 -->
							<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path></svg>
							<ul>
<li><p>由于数据需要经常改动，所以将数据存储在Hbase中，通过Hive关联Hbase表的方式来对Hbase进行查询操作。 </p></li>
<li><p>原先我是在本地通过虚拟机搭建的伪分布式，因此做Hive关联Hbase操作时需要做不少的操作，比如将Hbase相关的jar添加到Hive，将Hbase配置文件添加到hadoop/conf目录下等。具体操作可见如下文章： <br>
<a href="http://blog.csdn.net/u013850277/article/details/73522538" rel="nofollow">http://blog.csdn.net/u013850277/article/details/73522538</a></p></li>
<li><p>目前的平台为：HDP 并且通过Ranger做了权限管理。因为用了Hdp, 如果要用Hive 关联Hbase表则不需要再进行则不需要做任何额外的操作。直接可以通过建立Hive表就可以关联Hbase了。</p></li>
<li><p>建立Hive表关联Hbase表，有两种方式：建立Hive 内部表（对应的Hbase表不存在），另一种方式是建立Hive外部表（Hbase表以存在）。</p></li>
<li><p>Hive内部表的方式，创建表成功后，Hbase中同时自动创建对应的Hbase表，且数据是保存在Hbase中，如果删除Hive表，Hbase表同时也会被删除掉。</p></li>
<li><p>Hive 外部表的方式，创建成功后，数据同样保存在Hbase,只不过Hive表删除不会影响到Hbase表。</p></li>
<li><p>Hive表关联查询Hbase时，默认配置查询出来的结果总是Hbase最新版本所对应的数据。</p></li>
</ul>

<hr>

<p>异常一： Hive 操作时缺少Hbase对应的 jar包</p>

<p>在hdp46 机器上通过Hive连接Hbase出现如下错（这个hdp46号机器，目前装了 Hive的client，并没有安装Hbase对应的Client）</p>

<pre class="prettyprint"><code class=" hljs avrasm">hive&gt; CREATE TABLE IF NOT EXISTS t_hive_hbase10(id string, cards String, salary string)  STORED BY <span class="hljs-string">"org.apache.hadoop.hive.hbase.HBaseStorageHandler"</span>  WITH SERDEPROPERTIES ( <span class="hljs-string">"hbase.columns.mapping"</span> = <span class="hljs-string">":key,info:id,info:salary"</span>)  TBLPROPERTIES (<span class="hljs-string">"hbase.table.name"</span> =<span class="hljs-string">"t_hive_hbase10"</span>)<span class="hljs-comment">;</span>
Exception <span class="hljs-keyword">in</span> thread <span class="hljs-string">"main"</span> java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.NoClassDefFoundError</span>: org/apache/hadoop/hbase/client/Connection
        at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.Class</span><span class="hljs-preprocessor">.forName</span>0(Native Method)
        at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.Class</span><span class="hljs-preprocessor">.forName</span>(Class<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">348</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.parse</span><span class="hljs-preprocessor">.ParseUtils</span><span class="hljs-preprocessor">.ensureClassExists</span>(ParseUtils<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">230</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.parse</span><span class="hljs-preprocessor">.StorageFormat</span><span class="hljs-preprocessor">.fillStorageFormat</span>(StorageFormat<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">64</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.parse</span><span class="hljs-preprocessor">.SemanticAnalyzer</span><span class="hljs-preprocessor">.analyzeCreateTable</span>(SemanticAnalyzer<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">11114</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.parse</span><span class="hljs-preprocessor">.SemanticAnalyzer</span><span class="hljs-preprocessor">.genResolvedParseTree</span>(SemanticAnalyzer<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">10316</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.parse</span><span class="hljs-preprocessor">.SemanticAnalyzer</span><span class="hljs-preprocessor">.analyzeInternal</span>(SemanticAnalyzer<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">10401</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.parse</span><span class="hljs-preprocessor">.CalcitePlanner</span><span class="hljs-preprocessor">.analyzeInternal</span>(CalcitePlanner<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">216</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.parse</span><span class="hljs-preprocessor">.BaseSemanticAnalyzer</span><span class="hljs-preprocessor">.analyze</span>(BaseSemanticAnalyzer<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">230</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.Driver</span><span class="hljs-preprocessor">.compile</span>(Driver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">464</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.Driver</span><span class="hljs-preprocessor">.compile</span>(Driver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">320</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.Driver</span><span class="hljs-preprocessor">.compileInternal</span>(Driver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1219</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.Driver</span><span class="hljs-preprocessor">.runInternal</span>(Driver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1260</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.Driver</span><span class="hljs-preprocessor">.run</span>(Driver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1156</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.Driver</span><span class="hljs-preprocessor">.run</span>(Driver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1146</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.cli</span><span class="hljs-preprocessor">.CliDriver</span><span class="hljs-preprocessor">.processLocalCmd</span>(CliDriver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">217</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.cli</span><span class="hljs-preprocessor">.CliDriver</span><span class="hljs-preprocessor">.processCmd</span>(CliDriver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">169</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.cli</span><span class="hljs-preprocessor">.CliDriver</span><span class="hljs-preprocessor">.processLine</span>(CliDriver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">380</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.cli</span><span class="hljs-preprocessor">.CliDriver</span><span class="hljs-preprocessor">.executeDriver</span>(CliDriver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">740</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.cli</span><span class="hljs-preprocessor">.CliDriver</span><span class="hljs-preprocessor">.run</span>(CliDriver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">685</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.cli</span><span class="hljs-preprocessor">.CliDriver</span><span class="hljs-preprocessor">.main</span>(CliDriver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">625</span>)
        at sun<span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.NativeMethodAccessorImpl</span><span class="hljs-preprocessor">.invoke</span>0(Native Method)
        at sun<span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.NativeMethodAccessorImpl</span><span class="hljs-preprocessor">.invoke</span>(NativeMethodAccessorImpl<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">62</span>)
        at sun<span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.DelegatingMethodAccessorImpl</span><span class="hljs-preprocessor">.invoke</span>(DelegatingMethodAccessorImpl<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">43</span>)
        at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.Method</span><span class="hljs-preprocessor">.invoke</span>(Method<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">498</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.RunJar</span><span class="hljs-preprocessor">.run</span>(RunJar<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">233</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.RunJar</span><span class="hljs-preprocessor">.main</span>(RunJar<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">148</span>)
Caused by: java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.ClassNotFoundException</span>: org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hbase</span><span class="hljs-preprocessor">.client</span><span class="hljs-preprocessor">.Connection</span>
        at java<span class="hljs-preprocessor">.net</span><span class="hljs-preprocessor">.URLClassLoader</span><span class="hljs-preprocessor">.findClass</span>(URLClassLoader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">381</span>)
        at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.ClassLoader</span><span class="hljs-preprocessor">.loadClass</span>(ClassLoader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">424</span>)
        at sun<span class="hljs-preprocessor">.misc</span><span class="hljs-preprocessor">.Launcher</span>$AppClassLoader<span class="hljs-preprocessor">.loadClass</span>(Launcher<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">331</span>)
        at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.ClassLoader</span><span class="hljs-preprocessor">.loadClass</span>(ClassLoader<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">357</span>)
        ... <span class="hljs-number">27</span> more </code></pre>

<p>解决方案一： <br>
    根据报错将对应的Hbase的jar包copy一份到Hive中的lib目录下。</p>

<p>解决方案二：hdp46通过ambari安装一个hbase的client。因为笔者这个平台是通过Ambari+hdp搭建的，所方案二就显得很方便了。直接通过，ambari 的管理界面选择添加一个client。</p>

<hr>

<p>异常二：权限问题 <br>
笔者以前习惯通过Hive外部表管理非Hive中的数据，所以这里也同样采用外部表的方式。</p>

<p>1、在Hive中通过如下语句创建时出现异常（org.apache.hadoop.hive.ql.exec.DDLTask. MetaException(message:org.apache.hadoop.hbase.TableNotFoundException） </p>

<pre class="prettyprint"><code class=" hljs delphi">hive&gt; CREATE <span class="hljs-keyword">EXTERNAL</span> TABLE <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> EXISTS t_hbase10(id <span class="hljs-keyword">string</span>, cards <span class="hljs-keyword">String</span>, salary <span class="hljs-keyword">string</span>) <span class="hljs-keyword">STORED</span> BY <span class="hljs-string">'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span>  <span class="hljs-keyword">WITH</span> SERDEPROPERTIES (<span class="hljs-string">'hbase.columns.mapping'</span> = <span class="hljs-string">':key,info:id,info:salary'</span>)  TBLPROPERTIES (<span class="hljs-string">'hbase.table.name'</span> =<span class="hljs-string">'t_hbase10'</span>) 
    &gt; ;</code></pre>

<p>异常详情如下所示：</p>



<pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-label">FAILED:</span> Execution Error, return code <span class="hljs-number">1</span> from org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.exec</span><span class="hljs-preprocessor">.DDLTask</span>. MetaException(message:org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hbase</span><span class="hljs-preprocessor">.TableNotFoundException</span>: t_hbase10
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hbase</span><span class="hljs-preprocessor">.client</span><span class="hljs-preprocessor">.HBaseAdmin</span><span class="hljs-preprocessor">.getTableDescriptor</span>(HBaseAdmin<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">572</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hbase</span><span class="hljs-preprocessor">.client</span><span class="hljs-preprocessor">.HBaseAdmin</span><span class="hljs-preprocessor">.getTableDescriptor</span>(HBaseAdmin<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">545</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hbase</span><span class="hljs-preprocessor">.client</span><span class="hljs-preprocessor">.HBaseAdmin</span><span class="hljs-preprocessor">.getTableDescriptor</span>(HBaseAdmin<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">577</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.hbase</span><span class="hljs-preprocessor">.HBaseStorageHandler</span><span class="hljs-preprocessor">.preCreateTable</span>(HBaseStorageHandler<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">245</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.metastore</span><span class="hljs-preprocessor">.HiveMetaStoreClient</span><span class="hljs-preprocessor">.createTable</span>(HiveMetaStoreClient<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">690</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.metastore</span><span class="hljs-preprocessor">.HiveMetaStoreClient</span><span class="hljs-preprocessor">.createTable</span>(HiveMetaStoreClient<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">683</span>)
        at sun<span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.NativeMethodAccessorImpl</span><span class="hljs-preprocessor">.invoke</span>0(Native Method)
        at sun<span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.NativeMethodAccessorImpl</span><span class="hljs-preprocessor">.invoke</span>(NativeMethodAccessorImpl<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">62</span>)
        at sun<span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.DelegatingMethodAccessorImpl</span><span class="hljs-preprocessor">.invoke</span>(DelegatingMethodAccessorImpl<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">43</span>)
        at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.Method</span><span class="hljs-preprocessor">.invoke</span>(Method<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">498</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.metastore</span><span class="hljs-preprocessor">.RetryingMetaStoreClient</span><span class="hljs-preprocessor">.invoke</span>(RetryingMetaStoreClient<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">159</span>)
        at <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.sun</span><span class="hljs-preprocessor">.proxy</span>.$Proxy5<span class="hljs-preprocessor">.createTable</span>(Unknown Source)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.metadata</span><span class="hljs-preprocessor">.Hive</span><span class="hljs-preprocessor">.createTable</span>(Hive<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">757</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.exec</span><span class="hljs-preprocessor">.DDLTask</span><span class="hljs-preprocessor">.createTable</span>(DDLTask<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">4322</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.exec</span><span class="hljs-preprocessor">.DDLTask</span><span class="hljs-preprocessor">.execute</span>(DDLTask<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">314</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.exec</span><span class="hljs-preprocessor">.Task</span><span class="hljs-preprocessor">.executeTask</span>(Task<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">160</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.exec</span><span class="hljs-preprocessor">.TaskRunner</span><span class="hljs-preprocessor">.runSequential</span>(TaskRunner<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">89</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.Driver</span><span class="hljs-preprocessor">.launchTask</span>(Driver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1745</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.Driver</span><span class="hljs-preprocessor">.execute</span>(Driver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1491</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.Driver</span><span class="hljs-preprocessor">.runInternal</span>(Driver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1289</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.Driver</span><span class="hljs-preprocessor">.run</span>(Driver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1156</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.ql</span><span class="hljs-preprocessor">.Driver</span><span class="hljs-preprocessor">.run</span>(Driver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">1146</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.cli</span><span class="hljs-preprocessor">.CliDriver</span><span class="hljs-preprocessor">.processLocalCmd</span>(CliDriver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">217</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.cli</span><span class="hljs-preprocessor">.CliDriver</span><span class="hljs-preprocessor">.processCmd</span>(CliDriver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">169</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.cli</span><span class="hljs-preprocessor">.CliDriver</span><span class="hljs-preprocessor">.processLine</span>(CliDriver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">380</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.cli</span><span class="hljs-preprocessor">.CliDriver</span><span class="hljs-preprocessor">.executeDriver</span>(CliDriver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">740</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.cli</span><span class="hljs-preprocessor">.CliDriver</span><span class="hljs-preprocessor">.run</span>(CliDriver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">685</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.hive</span><span class="hljs-preprocessor">.cli</span><span class="hljs-preprocessor">.CliDriver</span><span class="hljs-preprocessor">.main</span>(CliDriver<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">625</span>)
        at sun<span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.NativeMethodAccessorImpl</span><span class="hljs-preprocessor">.invoke</span>0(Native Method)
        at sun<span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.NativeMethodAccessorImpl</span><span class="hljs-preprocessor">.invoke</span>(NativeMethodAccessorImpl<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">62</span>)
        at sun<span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.DelegatingMethodAccessorImpl</span><span class="hljs-preprocessor">.invoke</span>(DelegatingMethodAccessorImpl<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">43</span>)
        at java<span class="hljs-preprocessor">.lang</span><span class="hljs-preprocessor">.reflect</span><span class="hljs-preprocessor">.Method</span><span class="hljs-preprocessor">.invoke</span>(Method<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">498</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.RunJar</span><span class="hljs-preprocessor">.run</span>(RunJar<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">233</span>)
        at org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.hadoop</span><span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.RunJar</span><span class="hljs-preprocessor">.main</span>(RunJar<span class="hljs-preprocessor">.java</span>:<span class="hljs-number">148</span>)
)
hive&gt; </code></pre>

<p>原因： 通过Hive关联Hbase，也就是要通过Hive创建Hbase相关的关联表，这个Hive用户必须得拥有操作Hbase的相关权限。但是，笔者事先并没有对Hive授予操作Hbase表的权限。</p>

<p>解决方法： <br>
给 Hive 用户授权（授予Hive拥有操作Hbase对应表的权限），如下图所示： <br>
<img src="https://img-blog.csdn.net/20170823224140176?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMzg1MDI3Nw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" title=""></p>

<p>再次创建验证</p>



<pre class="prettyprint"><code class=" hljs delphi">hive&gt; CREATE <span class="hljs-keyword">EXTERNAL</span> TABLE <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> EXISTS t_hbase10(id <span class="hljs-keyword">string</span>, cards <span class="hljs-keyword">String</span>, salary <span class="hljs-keyword">string</span>) <span class="hljs-keyword">STORED</span> BY <span class="hljs-string">'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span>  <span class="hljs-keyword">WITH</span> SERDEPROPERTIES (<span class="hljs-string">'hbase.columns.mapping'</span> = <span class="hljs-string">':key,info:id,info:salary'</span>)  TBLPROPERTIES (<span class="hljs-string">'hbase.table.name'</span> =<span class="hljs-string">'t_hbase10'</span>);
OK
Time taken: <span class="hljs-number">0.281</span> seconds</code></pre>



<pre class="prettyprint"><code class=" hljs vhdl">hive&gt; show tables;
OK
t_hbase10

<span class="hljs-typename">Time</span> taken: <span class="hljs-number">0.158</span> seconds, Fetched: <span class="hljs-number">11</span> row(s)
hive&gt; </code></pre>

<ul>
<li><p>解决问题的过程： <br>
因为一开始笔者觉得Ambari 这个管理工具还是挺不错的，像Hive关联Hbase这类操作的相关配置应该自带了，所以试着在没有进行任何相应的配置情况下便直接使用了。但是，出现异常后，异常信息并没有很明显表明是没有相关权限，便想着是不是还得进行相应的配置才可以使用（因为笔者发现Hive中确实没有Hbase相应的jar）。进行了相应的配置完后，结果还是有同样的异常出现。无奈，只能将相应的配置进行了还原。</p></li>
<li><p>后来试了下通过Hive建立内部表的方式，出现了如下异常：</p></li>
</ul>

<pre class="prettyprint"><code class=" hljs sql"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span>  <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> t_hive_hbase10(id string, cards String, salary string) STORED <span class="hljs-keyword">BY</span> <span class="hljs-string">'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span>  <span class="hljs-keyword">WITH</span> SERDEPROPERTIES (<span class="hljs-string">'hbase.columns.mapping'</span> = <span class="hljs-string">':key,info:id,info:salary'</span>)  TBLPROPERTIES (<span class="hljs-string">'hbase.table.name'</span> =<span class="hljs-string">'t_hive_hbase10'</span>) 
java.<span class="hljs-keyword">sql</span>.SQLException: Error while processing statement: FAILED: Execution Error, return code <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> org.apache.hadoop.hive.ql.<span class="hljs-keyword">exec</span>.DDLTask. MetaException(message:org.apache.hadoop.hbase.security.AccessDeniedException: org.apache.hadoop.hbase.security.AccessDeniedException: Insufficient permissions <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> <span class="hljs-string">'hive/hdp40@BBDATA.COM'</span> (<span class="hljs-keyword">action</span>=<span class="hljs-keyword">create</span>)</span></code></pre>

<p>看到这个异常才想起应该是权限问题，也就是说要通过Hive创建Hbase相关的关联表，这个Hive用户必须得拥有操作Hbase的相关权限。</p>            </div>
						<link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-9e5741c4b9.css" rel="stylesheet">
                </div>