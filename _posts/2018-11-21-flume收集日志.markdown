---
layout:     post
title:      flume收集日志
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								<div class="article-copyright">
					版权声明：本文为博主原创文章，未经博主允许不得转载。					https://blog.csdn.net/vitaair/article/details/80220621				</div>
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                flume收集日志<br><span style="white-space:pre;">	</span>#flume测试代码<br><span style="white-space:pre;">		</span>#配置Agent<br><span style="white-space:pre;">		</span>a1.sources = r1<br><span style="white-space:pre;">		</span>a1.sinks = k1<br><span style="white-space:pre;">		</span>a1.channels = c1<br><br><br><span style="white-space:pre;">		</span>#配置source<br><span style="white-space:pre;">		</span>a1.sources.r1.type = avro<br><span style="white-space:pre;">		</span>a1.sources.r1.bind = 0.0.0.0<br><span style="white-space:pre;">		</span>a1.sources.r1.port = 44444<br><span style="white-space:pre;">		</span>a1.sources.r1.interceptors = i1<br><span style="white-space:pre;">		</span>a1.sources.r1.interceptors.i1.type = regex_extractor<br><span style="white-space:pre;">		</span>a1.sources.r1.interceptors.i1.regex = ^(?:[^\\|]*\\|){14}\\d+_\\d+_(\\d+)\\|.*$<br><span style="white-space:pre;">		</span>a1.sources.r1.interceptors.i1.serializers = s1<br><span style="white-space:pre;">		</span>a1.sources.r1.interceptors.i1.serializers.s1.name = timestamp<br><br><br><span style="white-space:pre;">		</span>#配置sink<br><span style="white-space:pre;">		</span>a1.sinks.k1.type = hdfs<br><span style="white-space:pre;">		</span>a1.sinks.k1.hdfs.path = hdfs://hadoop01:9000/flux/reportTime=%Y-%m-%d<br><span style="white-space:pre;">		</span>a1.sinks.k1.hdfs.fileType = DataStream<br><span style="white-space:pre;">		</span>a1.sinks.k1.hdfs.rollInterval = 30<br><span style="white-space:pre;">		</span>a1.sinks.k1.hdfs.rollSize = 0<br><span style="white-space:pre;">		</span>a1.sinks.k1.hdfs.rollCount = 0<br><span style="white-space:pre;">		</span>a1.sinks.k1.hdfs.timeZone = GMT+8<br><br><br><span style="white-space:pre;">		</span>a1.sinks.k2.type = org.apache.flume.sink.kafka.KafkaSink<br><span style="white-space:pre;">		</span>a1.sinks.k2.brokerList = hadoop01:9092,hadoop02:9092,hadoop03:9092<br><span style="white-space:pre;">		</span>a1.sinks.k2.topic = netflow<br><br><br><span style="white-space:pre;">		</span>#配置channel<br><span style="white-space:pre;">		</span>a1.channels.c1.type = memory<br><span style="white-space:pre;">		</span>a1.channels.c1.capacity = 1000<br><span style="white-space:pre;">		</span>a1.channels.c1.transactionCapacity = 100<br><br><br><span style="white-space:pre;">		</span>#绑定关系<br><span style="white-space:pre;">		</span>a1.sources.r1.channels = c1<br><span style="white-space:pre;">		</span>a1.sinks.k1.channel = c1<br><br><br><br><br><span style="white-space:pre;">	</span>#客户端agent<br><span style="white-space:pre;">		</span>#配置Agent<br><span style="white-space:pre;">		</span>a1.sources = r1<br><span style="white-space:pre;">		</span>a1.sinks = k1 k2 k3<br><span style="white-space:pre;">		</span>a1.channels = c1<br><br><br><span style="white-space:pre;">		</span>#配置source<br><span style="white-space:pre;">		</span>a1.sources.r1.type = avro<br><span style="white-space:pre;">		</span>a1.sources.r1.bind = 0.0.0.0<br><span style="white-space:pre;">		</span>a1.sources.r1.port = 44444<br><span style="white-space:pre;">		</span>a1.sources.r1.interceptors = i1<br><span style="white-space:pre;">		</span>a1.sources.r1.interceptors.i1.type = regex_extractor<br><span style="white-space:pre;">		</span>a1.sources.r1.interceptors.i1.regex = ^(?:[^\\|]*\\|){14}\\d+_\\d+_(\\d+)\\|.*$<br><span style="white-space:pre;">		</span>a1.sources.r1.interceptors.i1.serializers = s1<br><span style="white-space:pre;">		</span>a1.sources.r1.interceptors.i1.serializers.s1.name = timestamp<br><br><br><span style="white-space:pre;">		</span>#配置sink<br><span style="white-space:pre;">		</span>a1.sinks.k1.type = avro<br><span style="white-space:pre;">		</span>a1.sinks.k1.hostname = Park01<br><span style="white-space:pre;">		</span>a1.sinks.k1.port = 44444<br><span style="white-space:pre;">		</span><br><span style="white-space:pre;">		</span>a1.sinks.k2.type = avro<br><span style="white-space:pre;">		</span>a1.sinks.k2.hostname = Park02<br><span style="white-space:pre;">		</span>a1.sinks.k2.port = 44444<br><span style="white-space:pre;">		</span><br><span style="white-space:pre;">		</span>a1.sinks.k3.type = avro<br><span style="white-space:pre;">		</span>a1.sinks.k3.hostname = Park03<br><span style="white-space:pre;">		</span>a1.sinks.k3.port = 44444<br><br><br><span style="white-space:pre;">		</span>a1.sinkgroups = g1<br><span style="white-space:pre;">		</span>a1.sinkgroups.g1.sinks = k1 k2 k3<br><span style="white-space:pre;">		</span>a1.sinkgroups.g1.processor.type = load_balance<br><span style="white-space:pre;">		</span>a1.sinkgroups.g1.processor.backoff = true<br><span style="white-space:pre;">		</span>a1.sinkgroups.g1.processor.selector = random<br><span style="white-space:pre;">			</span><br><span style="white-space:pre;">		</span>#配置channel<br><span style="white-space:pre;">		</span>a1.channels.c1.type = memory<br><span style="white-space:pre;">		</span>a1.channels.c1.capacity = 1000<br><span style="white-space:pre;">		</span>a1.channels.c1.transactionCapacity = 100<br><br><br><span style="white-space:pre;">		</span>#绑定关系<br><span style="white-space:pre;">		</span>a1.sources.r1.channels = c1<br><span style="white-space:pre;">		</span>a1.sinks.k1.channel = c1<br><span style="white-space:pre;">		</span>a1.sinks.k2.channel = c1<br><span style="white-space:pre;">		</span>a1.sinks.k3.channel = c1<br><br><br><span style="white-space:pre;">	</span>#中心服务器agent<br><span style="white-space:pre;">		</span>#配置agent<br><span style="white-space:pre;">		</span>a1.sources = r1<br><span style="white-space:pre;">		</span>a1.sinks = k1 k2<br><span style="white-space:pre;">		</span>a1.channels = c1 c2<br><br><br><span style="white-space:pre;">		</span>#配置source<br><span style="white-space:pre;">		</span>a1.sources.r1.type = avro<br><span style="white-space:pre;">		</span>a1.sources.r1.bind = 0.0.0.0<br><span style="white-space:pre;">		</span>a1.sources.r1.port = 44444<br><br><br><span style="white-space:pre;">		</span>#配置sink<br><span style="white-space:pre;">		</span>a1.sinks.k1.type = hdfs<br><span style="white-space:pre;">		</span>a1.sinks.k1.hdfs.path = hdfs://ns/flux/reportTime=%Y-%m-%d<br><span style="white-space:pre;">		</span>a1.sinks.k1.hdfs.fileType = DataStream<br><span style="white-space:pre;">		</span>a1.sinks.k1.hdfs.rollInterval = 30<br><span style="white-space:pre;">		</span>a1.sinks.k1.hdfs.rollSize = 0<br><span style="white-space:pre;">		</span>a1.sinks.k1.hdfs.rollCount = 0<br><span style="white-space:pre;">		</span>a1.sinks.k1.hdfs.timeZone = GMT+8<br><br><br><span style="white-space:pre;">		</span>a1.sinks.k2.type = org.apache.flume.sink.kafka.KafkaSink<br><span style="white-space:pre;">		</span>a1.sinks.k2.brokerList = Park01:9092,Park02:9092,Park03:9092<br><span style="white-space:pre;">		</span>a1.sinks.k2.topic = netflow<br><br><br><span style="white-space:pre;">		</span>#配置channel<br><span style="white-space:pre;">		</span>a1.channels.c1.type = memory<br><span style="white-space:pre;">		</span>a1.channels.c1.capacity = 1000<br><span style="white-space:pre;">		</span>a1.channels.c1.transactionCapacity = 100<br><span style="white-space:pre;">		</span><br><span style="white-space:pre;">		</span>a1.channels.c2.type = memory<br><span style="white-space:pre;">		</span>a1.channels.c2.capacity = 1000<br><span style="white-space:pre;">		</span>a1.channels.c2.transactionCapacity = 100<br><br><br><span style="white-space:pre;">		</span>#绑定关系<br><span style="white-space:pre;">		</span>a1.sources.r1.channels = c1 c2<br><span style="white-space:pre;">		</span>a1.sinks.k1.channel = c1<br><span style="white-space:pre;">		</span>a1.sinks.k2.channel = c2<br><span style="white-space:pre;">		</span><br><span style="white-space:pre;">		</span><br><span style="white-space:pre;">		</span>括号在正则表达式中的作用主要有两方面 <br><span style="white-space:pre;">			</span>将一段正则内容作为一组 实现操作符对这一组内容起作用<br><span style="white-space:pre;">			</span>将一段内容作为捕获组进行捕获<br><br><br><span style="white-space:pre;">			</span>http://127.0.0.1/demo/b.jsp|b.jsp|页面B|UTF-8|1024x768|24-bit|zh-cn|1|1|18.0 r0|0.7864694688469172|http://127.0.0.1/demo/a.jsp|Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/44.0.2403.125 Safari/537.36|84488155274825025429|8736267587_6_1495160530159|0:0:0:0:0:0:0:1<br><span style="white-space:pre;">		</span>            </div>
                </div>