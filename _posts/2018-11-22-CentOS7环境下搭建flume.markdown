---
layout:     post
title:      CentOS7环境下搭建flume
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <div style="line-height:1.875;font-size:14px;"><span style="font-size:16px;"><strong>一、flume安装与配置</strong></span></div><div style="line-height:1.875;font-size:14px;"><span style="font-weight:bold;">1.将flume解压到指定目录/home/jason/bigdata下：</span></div><div style="line-height:1.875;margin-left:28px;font-size:14px;"><span style="color:rgb(0,176,80);">[root@clsserv202 bigdata]# pwd</span></div><div style="line-height:1.875;margin-left:28px;font-size:14px;"><span style="color:rgb(0,176,80);">/home/jason/bigdata</span></div><div style="line-height:1.875;margin-left:28px;font-size:14px;"><span style="color:rgb(0,176,80);">[root@clsserv202 bigdata]# ll</span></div><div style="line-height:1.875;margin-left:28px;font-size:14px;"><span style="color:rgb(0,176,80);">总用量 4</span></div><div style="line-height:1.875;margin-left:28px;font-size:14px;"><span style="color:rgb(0,176,80);">drwxrwxrwx. 8 root root 4096 9月   8 14:38 flume-1.6.0</span></div><div style="line-height:1.875;font-size:14px;"><br></div><div style="line-height:1.875;font-size:14px;"><span style="font-weight:bold;">2.将flume的目录添加到环境变量</span></div><div style="line-height:1.875;margin-left:28px;font-size:14px;"><span style="color:rgb(0,176,80);">export FLUME_HOME=/home/jason/bigdata/flume-1.6.0</span></div><div style="line-height:1.875;font-size:14px;"><br></div><div style="line-height:1.875;font-size:14px;"><span style="font-weight:bold;">1.从指定端口号读取数据到Kafka中</span></div><div style="line-height:1.875;font-size:14px;">1.1、首先指定本flume的Source、Channel、Sink的名称</div><div style="line-height:1.875;text-indent:28px;font-size:14px;">agent_ps.sources = idg-src </div><div style="margin-left:28px;line-height:1.875;font-size:14px;">agent_ps.sinks = idg-sk </div><div style="margin-left:28px;line-height:1.875;font-size:14px;">agent_ps.channels = idg-ch</div><div style="line-height:1.875;font-size:14px;">1.2、下面再对Source、Channel、Sink进行详细配置：</div><div style="line-height:1.875;margin-left:28px;font-size:14px;">（1）配置源的各项配置为：</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sources.idg-src.type = avro</div><div style="margin-left:56px;line-height:1.875;font-size:14px;">agent_ps.sources.idg-src.bind = 11.12.112.215</div><div style="margin-left:56px;line-height:1.875;font-size:14px;">agent_ps.sources.idg-src.port = 44440</div><div style="margin-left:56px;line-height:1.875;font-size:14px;">agent_ps.sources.idg-src.threads = 5</div><div style="margin-left:56px;line-height:1.875;font-size:14px;">agent_ps.sources.idg-src.channels = idg-ch</div><div style="margin-left:28px;line-height:1.875;font-size:14px;"><span style="color:rgb(255,0,0);">【注意】</span></div><div style="margin-left:56px;line-height:1.875;font-size:14px;"><span style="color:rgb(255,0,0);">type为avro，表示从本机指定的IP和端口接收数据；</span></div><div style="margin-left:56px;line-height:1.875;font-size:14px;"><span style="color:rgb(255,0,0);">channels 指定本Source对应的Channel的名称，这里的channels也表示一个Source可以对应多个Channel；</span></div><div style="margin-left:28px;line-height:1.875;font-size:14px;">（2）channel预估一下日志手机的速度以及本机的性能进行分配，这里用的是：</div><div style="margin-left:28px;line-height:1.875;text-indent:28px;font-size:14px;">agent_ps.channels.idg-ch.type = memory</div><div style="margin-left:56px;line-height:1.875;font-size:14px;">agent_ps.channels.idg-ch.keep-alive = 60</div><div style="margin-left:56px;line-height:1.875;font-size:14px;">agent_ps.channels.idg-ch.capacity = 500</div><div style="margin-left:56px;line-height:1.875;font-size:14px;">agent_ps.channels.idg-ch.transactionCapacity = 100</div><div style="line-height:1.875;margin-left:28px;font-size:14px;">（3）Sink配置为数据即将输出的Kafka的信息：</div><div style="line-height:1.875;text-indent:28px;margin-left:28px;font-size:14px;">agent_ps.sinks.idg-sk.channel = idg-ch</div><div style="margin-left:56px;line-height:1.875;font-size:14px;">agent_ps.sinks.idg-sk.type = org.apache.flume.sink.kafka.KafkaSink</div><div style="margin-left:56px;line-height:1.875;font-size:14px;">agent_ps.sinks.idg-sk.topic = flume_log</div><div style="margin-left:56px;line-height:1.875;font-size:14px;">agent_ps.sinks.idg-sk.brokerList = 11.12.112.206:9092,11.12.112.207:9092,11.12.112.208:9092</div><div style="margin-left:56px;line-height:1.875;font-size:14px;">agent_ps.sinks.idg-sk.requireAcks = 0</div><div style="margin-left:56px;line-height:1.875;font-size:14px;">agent_ps.sinks.idg-sk.batchSize = 20</div><div style="margin-left:56px;line-height:1.875;font-size:14px;"><span style="color:rgb(255,0,0);">【注意】</span></div><div style="margin-left:56px;line-height:1.875;text-indent:28px;font-size:14px;"><span style="color:rgb(255,0,0);">type中指定的Kafka的包名</span></div><div style="margin-left:56px;line-height:1.875;text-indent:28px;font-size:14px;"><span style="color:rgb(255,0,0);">brokerList中指定了Kafka集群的地址；</span></div><div style="margin-left:56px;line-height:1.875;text-indent:28px;font-size:14px;"><span style="color:rgb(255,0,0);">channel 指定本Sink对应的Channel的名称，这里的channels表示一个Sink的来源只能对应一个Channel</span></div><div style="line-height:1.875;margin-left:28px;font-size:14px;">（4）综合上述的说明，实例配置文件中的数据为：</div><div style="line-height:1.875;margin-left:56px;font-size:14px;"># list the sources, sinks and channels for the agent</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sources = idg-src </div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sinks = idg-sk </div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.channels = idg-ch</div><div style="line-height:1.875;margin-left:56px;font-size:14px;"><br></div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sources.idg-src.type = avro</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sources.idg-src.bind = 11.12.112.215</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sources.idg-src.port = 44440</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sources.idg-src.threads = 5</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sources.idg-src.channels = idg-ch</div><div style="line-height:1.875;margin-left:56px;font-size:14px;"><br></div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.channels.idg-ch.type = memory</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.channels.idg-ch.keep-alive = 60</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.channels.idg-ch.capacity = 500</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.channels.idg-ch.transactionCapacity = 100</div><div style="line-height:1.875;margin-left:56px;font-size:14px;"><br></div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sinks.idg-sk.channel = idg-ch</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sinks.idg-sk.type = org.apache.flume.sink.kafka.KafkaSink</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sinks.idg-sk.topic = flume_log</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sinks.idg-sk.brokerList = 11.12.112.206:9092,11.12.112.207:9092,11.12.112.208:9092</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sinks.idg-sk.requireAcks = 0</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sinks.idg-sk.batchSize = 20</div><div style="line-height:1.875;margin-left:56px;font-size:14px;"><br></div><div style="line-height:1.875;margin-left:56px;font-size:14px;"><span style="font-size:16px;"><strong>2.从本地的日志文件中读取数据到Kafka中</strong></span></div><div style="line-height:1.875;margin-left:56px;font-size:14px;">与1相比只需要修改Source的配置，将其从本地的某个端口读取修改为从指定的文件中读取；</div><div style="line-height:1.875;margin-left:84px;font-size:14px;">agent_ps.sources.idg-src.type = exec</div><div style="line-height:1.875;margin-left:84px;font-size:14px;">agent_ps.sources.idg-src.shell = /bin/sh -c</div><div style="line-height:1.875;margin-left:84px;font-size:14px;">agent_ps.sources.idg-src.command = tail -F /home/logs/idGen/idGen.log</div><div style="line-height:1.875;margin-left:84px;font-size:14px;">agent_ps.sources.idg-src.restartThrottle = 2000</div><div style="line-height:1.875;margin-left:84px;font-size:14px;">agent_ps.sources.idg-src.restart = true</div><div style="line-height:1.875;margin-left:84px;font-size:14px;">agent_ps.sources.idg-src.batchSize = 20</div><div style="line-height:1.875;margin-left:84px;font-size:14px;">agent_ps.sources.idg-src.channels = idg-ch</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">其他的Channel和Sink的配置与1一致；</div><div style="line-height:1.875;margin-left:56px;font-size:14px;"><br></div><div style="line-height:1.875;margin-left:56px;font-size:14px;"><span style="font-size:16px;"><strong>3.从本地日志文件中读取数据到另一个flume中</strong></span></div><div style="line-height:1.875;margin-left:56px;font-size:14px;">与2相比，只需要修改Sink，见下面的红色部分：</div><div style="line-height:1.875;margin-left:56px;font-size:14px;"># list sources, sinks and channels in the agent</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sources = idg-src</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sinks = idg-sk </div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.channels = idg-ch</div><div style="line-height:1.875;margin-left:56px;font-size:14px;"><br></div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sources.idg-src.type = exec</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sources.idg-src.shell = /bin/sh -c</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sources.idg-src.command = tail -F /home/logs/idGen/idGen.log</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sources.idg-src.restartThrottle = 2000</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sources.idg-src.restart = true</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sources.idg-src.batchSize = 20</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.sources.idg-src.channels = idg-ch</div><div style="line-height:1.875;margin-left:56px;font-size:14px;"><br></div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.channels.idg-ch.type = memory</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.channels.idg-ch.keep-alive = 60</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.channels.idg-ch.capacity = 100</div><div style="line-height:1.875;margin-left:56px;font-size:14px;">agent_ps.channels.idg-ch.transactionCapacity = 100</div><div style="line-height:1.875;margin-left:56px;font-size:14px;"><br></div><div style="line-height:1.875;margin-left:56px;font-size:14px;"><span style="color:rgb(255,0,0);">agent_ps.sinks.idg-sk.type = avro</span></div><div style="line-height:1.875;margin-left:56px;font-size:14px;"><span style="color:rgb(255,0,0);">agent_ps.sinks.idg-sk.hostname = 11.12.112.215</span></div><div style="line-height:1.875;margin-left:56px;font-size:14px;"><span style="color:rgb(255,0,0);">agent_ps.sinks.idg-sk.port = 44440</span></div><div style="line-height:1.875;margin-left:56px;font-size:14px;"><span style="color:rgb(255,0,0);">agent_ps.sinks.idg-sk.batch-size = 20</span></div><div style="line-height:1.875;margin-left:56px;font-size:14px;"><span style="color:rgb(255,0,0);">agent_ps.sinks.idg-sk.request-timeout = 3000</span></div><div style="line-height:1.875;margin-left:56px;font-size:14px;"><span style="color:rgb(255,0,0);">agent_ps.sinks.idg-sk.channel = idg-ch</span></div><div style="line-height:1.875;margin-left:56px;font-size:14px;"><br></div><div style="line-height:1.875;font-size:14px;"><span style="color:rgb(51,51,51);"><strong>二、flume启动</strong></span></div><div style="line-height:1.875;margin-left:28px;font-size:14px;">1.进入到flume的bin目录下：</div><div style="line-height:1.875;margin-left:28px;font-size:14px;"><span style="color:rgb(0,176,80);">[root@clsserv202 bin]# pwd</span></div><div style="margin-left:28px;line-height:1.875;font-size:14px;"><span style="color:rgb(0,176,80);">/home/jason/bigdata/flume-1.6.0/bin</span></div><div style="margin-left:28px;line-height:1.875;font-size:14px;"><span style="color:rgb(0,176,80);">[root@clsserv202 bin]# ll</span></div><div style="margin-left:28px;line-height:1.875;font-size:14px;"><span style="color:rgb(0,176,80);">总用量 36</span></div><div style="margin-left:28px;line-height:1.875;font-size:14px;"><span style="color:rgb(0,176,80);">-rwxrwxrwx. 1 root root 12845 9月   8 14:37 flume-ng</span></div><div style="margin-left:28px;line-height:1.875;font-size:14px;"><span style="color:rgb(0,176,80);">-rwxrwxrwx. 1 root root   936 9月   8 14:37 flume-ng.cmd</span></div><div style="margin-left:28px;line-height:1.875;font-size:14px;"><span style="color:rgb(0,176,80);">-rwxrwxrwx. 1 root root 14041 9月   8 14:37 flume-ng.ps1</span></div><div style="margin-left:28px;line-height:1.875;font-size:14px;">2.运行flume-ng</div><div style="margin-left:28px;line-height:1.875;font-size:14px;"><a href="http://172.17.0.149:9200/_plugin/bigdesk/#nodes/master" rel="nofollow"><span style="color:rgb(0,176,80);">flume-ng agent -n agent_ps -c $FLUME_HOME/conf -f $FLUME_HOME/conf/flume.conf -Dflume.root.logger=INFO,LOGFILE &gt; /dev/null 2&gt;&amp;1 &amp;   (也可以-Dflume.root.logger=INFO,console)</span></a></div><div style="line-height:1.875;text-indent:28px;font-size:14px;">3.查看flume-ng进程是否启动成功</div><div style="line-height:1.875;text-indent:28px;font-size:14px;"><span style="color:rgb(0,176,80);">[root@clsserv202 flume-1.6.0]# jps -l</span></div><div style="line-height:1.875;text-indent:28px;font-size:14px;"><span style="color:rgb(0,176,80);">6737 sun.tools.jps.Jps</span></div><div style="line-height:1.875;text-indent:28px;font-size:14px;"><span style="color:rgb(255,0,0);">6700 org.apache.flume.node.Application</span></div><div style="line-height:1.875;text-indent:28px;font-size:14px;"><span style="color:rgb(0,176,80);">6218 com.xyz.idgen.mainframe.Starter</span></div><div style="line-height:1.875;text-indent:28px;font-size:14px;"><span style="color:rgb(255,0,0);">4、在flume连接Kafka时，通过在Kafka集群创建一个消费者来消费flume创建的topic即可看到flume发来的数据，如果没有数据到来则说明这中间的连接有问题；</span></div><div style="line-height:1.875;text-indent:28px;font-size:14px;"><br></div><div style="line-height:1.875;font-size:14px;"><span style="color:rgb(51,51,51);"><strong>三、常见的source、channel、sink的含义及说明</strong></span></div><div style="line-height:1.75;font-size:14px;"><span style="color:rgb(51,51,51);"><strong>3.1.source</strong></span></div><div style="text-indent:28px;line-height:1.75;font-size:14px;"><span style="color:rgb(51,51,51);"><strong>（1）avro source</strong></span></div><div style="line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:13px;font-family:'Microsoft YaHei', STXihei;color:rgb(51,51,51);">avro可以监听和收集指定端口的日志，使用avro的source需要说明被监听的主机ip和端口号，下面给出一个具体的例子：</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sources = r1</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.channels = c1</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sources.r1.type = avro</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sources.r1.channels = c1</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sources.r1.bind = 0.0.0.0</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sources.r1.port = 4141</span></div><div style="text-align:justify;line-height:2;font-size:14px;"><span style="font-size:16px;font-family:'Microsoft YaHei', STXihei;color:rgb(51,51,51);"><strong>（2）exec source</strong></span></div><div style="line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:13px;font-family:'Microsoft YaHei', STXihei;color:rgb(51,51,51);">exec可以通过指定的操作对日志进行读取，使用exec时需要指定shell命令，对日志进行读取，下面给出一个具体的例子：</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sources = r1</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.channels = c1</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sources.r1.type = exec</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sources.r1.command = tail -F /var/log/secure</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sources.r1.channels = c1</span></div><div style="line-height:1.75;font-size:14px;"><span style="font-size:16px;font-family:'Microsoft YaHei', STXihei;color:rgb(51,51,51);"><strong>（3）spooling-directory source</strong></span></div><div style="line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:13px;font-family:'Microsoft YaHei', STXihei;color:rgb(51,51,51);">spo_dir可以读取文件夹里的日志，使用时指定一个文件夹，可以读取该文件夹中的所有文件，需要注意的是该文件夹中的文件在读取过程中不能修改，同时文件名也不能修改。下面给出一个具体的例子：</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">agent-1.channels = ch-1</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">agent-1.sources = src-1</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:13px;font-family:'Microsoft YaHei', STXihei;color:rgb(51,51,51);background-color:rgb(191,191,191);"> </span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">agent-1.sources.src-1.type = spooldir</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">agent-1.sources.src-1.channels = ch-1</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">agent-1.sources.src-1.spoolDir = /var/log/apache/flumeSpool</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">agent-1.sources.src-1.fileHeader = true</span></div><div style="line-height:1.75;font-size:14px;"><span style="font-size:16px;font-family:'Microsoft YaHei', STXihei;color:rgb(51,51,51);"><strong>（4）syslog source</strong></span></div><div style="line-height:2;font-size:14px;"><span style="font-size:13px;font-family:'Microsoft YaHei', STXihei;color:rgb(51,51,51);">syslog可以通过syslog协议读取系统日志，分为tcp和udp两种，使用时需指定ip和端口，下面给出一个udp的例子：</span></div><div style="text-align:justify;line-height:2;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sources = r1</span></div><div style="text-align:justify;line-height:2;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.channels = c1</span></div><div style="text-align:justify;line-height:2;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sources.r1.type = syslogudp</span></div><div style="text-align:justify;line-height:2;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sources.r1.port = 5140</span></div><div style="text-align:justify;line-height:2;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sources.r1.host = localhost</span></div><div style="text-align:justify;line-height:2;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sources.r1.channels = c1</span></div><div style="line-height:1.75;font-size:14px;"><span style="color:rgb(51,51,51);"><strong>3.2.常见的channel</strong></span></div><div style="line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:13px;font-family:'Microsoft YaHei', STXihei;color:rgb(51,51,51);">Flume的channel种类并不多，最常用的是memory channel，下面给出例子：</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.channels = c1</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.channels.c1.type = memory</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.channels.c1.capacity = 10000</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.channels.c1.transactionCapacity = 10000</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.channels.c1.byteCapacityBufferPercentage = 20</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.channels.c1.byteCapacity = 800000</span></div><div style="line-height:1.75;font-size:14px;"><span style="color:rgb(51,51,51);"><strong>3.3.常见的sink</strong></span></div><div style="text-indent:28px;line-height:1.75;font-size:14px;"><span style="font-size:16px;font-family:'Microsoft YaHei', STXihei;color:rgb(51,51,51);"><strong>（1）logger sink</strong></span></div><div style="line-height:2;font-size:14px;"><span style="font-size:13px;font-family:'Microsoft YaHei', STXihei;color:rgb(51,51,51);">l	ogger顾名思义，就是将收集到的日志写到flume的log中，是个十分简单但非常实用的sink</span></div><div style="text-indent:28px;line-height:1.75;font-size:14px;"><span style="font-size:16px;font-family:'Microsoft YaHei', STXihei;color:rgb(51,51,51);"><strong>（2）avro sink</strong></span></div><div style="line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:13px;font-family:'Microsoft YaHei', STXihei;color:rgb(51,51,51);">avro可以将接受到的日志发送到指定端口，供级联agent的下一跳收集和接受日志，使用时需要指定目的ip和端口：例子如下：</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.channels = c1</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks = k1</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks.k1.type = avro</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks.k1.channel = c1</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks.k1.hostname = 10.10.10.10</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks.k1.port = 4545</span></div><div style="text-indent:28px;line-height:1.75;font-size:14px;"><span style="font-size:16px;font-family:'Microsoft YaHei', STXihei;color:rgb(51,51,51);"><strong>（3）file roll sink</strong></span></div><div style="line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:13px;font-family:'Microsoft YaHei', STXihei;color:rgb(51,51,51);">file_roll可以将一定时间内收集到的日志写到一个指定的文件中，具体过程为用户指定一个文件夹和一个周期，然后启动agent，这时该文件夹会产生一个文件将该周期内收集到的日志全部写进该文件内，直到下一个周期再次产生一个新文件继续写入，以此类推，周而复始。下面给出一个具体的例子：</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.channels = c1</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks = k1</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks.k1.type = file_roll</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks.k1.channel = c1</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks.k1.sink.directory = /var/log/flume</span></div><div style="line-height:1.75;font-size:14px;"><span style="font-size:16px;font-family:'Microsoft YaHei', STXihei;color:rgb(51,51,51);"><strong>（4）hdfs sink</strong></span></div><div style="line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:13px;font-family:'Microsoft YaHei', STXihei;color:rgb(51,51,51);">hdfs与file roll有些类似，都是将收集到的日志写入到新创建的文件中保存起来，但区别是file roll的文件存储路径为系统的本地路径，而hdfs的存储路径为分布式的文件系统hdfs的路径，同时hdfs创建新文件的周期可以是时间，也可以是文件的大小，还可以是采集日志的条数。具体实例如下：</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.channels = c1</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks = k1</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks.k1.type = hdfs</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks.k1.channel = c1</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks.k1.hdfs.path = /flume/events/%y-%m-%d/%H%M/%S</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks.k1.hdfs.filePrefix = events-</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks.k1.hdfs.round = true</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks.k1.hdfs.roundValue = 10</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks.k1.hdfs.roundUnit = minute</span></div><div style="text-indent:28px;line-height:1.75;font-size:14px;"><span style="font-size:16px;font-family:'Microsoft YaHei', STXihei;color:rgb(51,51,51);"><strong>（5）hbase sink</strong></span></div><div style="line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:13px;font-family:'Microsoft YaHei', STXihei;color:rgb(51,51,51);">hbase是一种数据库，可以储存日志，使用时需要指定存储日志的表名和列族名，然后agent就可以将收集到的日志逐条插入到数据库中。例子如下：</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.channels = c1</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks = k1</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks.k1.type = hbase</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks.k1.table = foo_table</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks.k1.columnFamily = bar_cf</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks.k1.serializer = org.apache.flume.sink.hbase.RegexHbaseEventSerializer</span></div><div style="text-align:justify;line-height:2;margin-left:28px;font-size:14px;"><span style="font-size:16px;font-family:SimSun, STSong;color:rgb(51,51,51);background-color:rgb(191,191,191);">a1.sinks.k1.channel = c1</span></div><div style="line-height:1.75;font-size:14px;"><br></div>            </div>
                </div>