---
layout:     post
title:      Hive笔记八：Hive体系结构
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<span style="font-weight:700;">1、Hive架构与基本组成</span></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    下面是Hive的架构图。</div>
<div align="center" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<span><img id="aimg_1367" src="http://www.aboutyun.com/data/attachment/forum/201312/24/133809pr2utkrojsctim52.png" class="zoom" width="600" alt="" style="border:none;"></span></div>
<div align="center" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
图1.1 Hive体系结构<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<span style="font-weight:700;">    Hive的体系结构可以分为以下几部分：</span></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    （1）用户接口主要有三个：CLI，Client 和 WUI。其中最常用的是CLI，Cli启动的时候，会同时启动一个Hive副本。Client是Hive的客户端，用户连接至Hive Server。在启动 Client模式的时候，需要指出Hive Server所在节点，并且在该节点启动Hive Server。 WUI是通过浏览器访问Hive。<br>
    （2）Hive将元数据存储在数据库中，如mysql、derby。Hive中的元数据包括表的名字，表的列和分区及其属性，表的属性（是否为外部表等），表的数据所在目录等。<br>
    （3）解释器、编译器、优化器完成HQL查询语句从词法分析、语法分析、编译、优化以及查询计划的生成。生成的查询计划存储在HDFS中，并在随后有MapReduce调用执行。<br>
    （4）Hive的数据存储在HDFS中，大部分的查询、计算由MapReduce完成（包含*的查询，比如select * from tbl不会生成MapRedcue任务）。</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    Hive将元数据存储在RDBMS中，</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<span style="font-weight:700;">有三种模式可以连接到数据库：</span></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<span>    </span>（1） 单用户模式。此模式连接到一个In-memory 的数据库Derby，一般用于Unit Test。</div>
<div align="center" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<span><img id="aimg_kp9Tr" class="zoom" width="600" height="351" src="http://sishuok.com/forum/upload/2012/10/23/edfa9cf7e030a15c6a908a2e28145707__2.JPG" border="0" alt="" style="border:none;"></span></div>
<div align="center" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<span>图2.1 单用户模式</span><br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<span>    </span>（2）多用户模式。通过网络连接到一个数据库中，是最经常使用到的模式。</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div align="center" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<span><img id="aimg_1369" src="http://www.aboutyun.com/data/attachment/forum/201312/24/133812pqnnpn2myyak9iqq.png" class="zoom" width="600" alt="" style="border:none;"></span></div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div align="center" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
图2.2 多用户模式<br></div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    （3） 远程服务器模式。用于非Java客户端访问元数据库，在服务器端启动MetaStoreServer，客户端利用Thrift协议通过MetaStoreServer访问元数据库。</div>
<div align="center" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<span><img id="aimg_1370" src="http://www.aboutyun.com/data/attachment/forum/201312/24/133813w8s8j95e4zk58dse.png" class="zoom" width="600" alt="" style="border:none;"> </span><br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    对于数据存储，Hive没有专门的数据存储格式，也没有为数据建立索引，用户可以非常自由的组织Hive中的表，只需要在创建表的时候告诉Hive数据中的列分隔符和行分隔符，Hive就可以解析数据。Hive中所有的数据都存储在HDFS中，存储结构主要包括数据库、文件、表和视图。Hive中包含以下数据模型：Table内部表，External Table外部表，Partition分区，Bucket桶。Hive默认可以直接加载文本文件，还支持sequence file 、RCFile。</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<span style="font-weight:700;">    Hive的数据模型介绍如下：<br></span></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    （1）Hive数据库</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    类似传统数据库的DataBase，在第三方数据库里实际是一张表。简单示例命令行 hive &gt; create database test_database;</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    （2）内部表</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    Hive的内部表与数据库中的Table在概念上是类似。每一个Table在Hive中都有一个相应的目录存储数据。例如一个表pvs，它在HDFS中的路径为/wh/pvs，其中wh是在hive-site.xml中由${hive.metastore.warehouse.dir} 指定的数据仓库的目录，所有的Table数据（不包括External Table）都保存在这个目录中。删除表时，元数据与数据都会被删除。</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    内部表简单示例：<br>
    创建数据文件：test_inner_table.txt</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    创建表：create table test_inner_table (key string)<br>
    加载数据：LOAD DATA LOCAL INPATH ‘filepath’ INTO TABLE test_inner_table<br>
    查看数据：select * from test_inner_table;  select count(*) from test_inner_table<br>
    删除表：drop table test_inner_table</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    （3）外部表</div>
<div align="left" style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<span style="color:rgb(68,68,68);">    外部表指向已经在HDFS中存在的数据，可以创建Partition。它和内部表在元数据的组织上是相同的，而实际数据的存储则有较大的差异。内部表的创建过程和数据加载过程这两个过程可以分别独立完成，也可以在同一个语句中完成，</span><span style="color:rgb(255,0,0);">在加载数据的过程中，实际数据会被移动到数据仓库目录中；之后对数据对访问将会直接在数据仓库目录中完成。删除表时，表中的数据和元数据将会被同时删除。而外部表只有一个过程，加载数据和创建表同时完成（CREATE
 EXTERNAL TABLE ……LOCATION），实际数据是存储在LOCATION后面指定的 HDFS 路径中，并不会移动到数据仓库目录中。当删除一个External Table时，仅删除该链接。</span><br><span style="color:rgb(68,68,68);">    外部表简单示例：</span><br><span style="color:rgb(68,68,68);">    创建数据文件：test_external_table.txt</span><br><span style="color:rgb(68,68,68);">    创建表：create external table test_external_table (key string)</span><br><span style="color:rgb(68,68,68);">    加载数据：LOAD DATA INPATH ‘filepath’ INTO TABLE test_inner_table</span><br><span style="color:rgb(68,68,68);">    查看数据：select * from test_external_table;  •select count(*) from test_external_table</span><br><span style="color:rgb(68,68,68);">    删除表：drop table test_external_table</span><br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    （4）分区</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    Partition对应于数据库中的Partition列的密集索引，但是Hive中Partition的组织方式和数据库中的很不相同。在Hive中，表中的一个Partition对应于表下的一个目录，所有的Partition的数据都存储在对应的目录中。例如pvs表中包含ds和city两个Partition，则对应于ds = 20090801, ctry = US 的HDFS子目录为/wh/pvs/ds=20090801/ctry=US；对应于 ds = 20090801, ctry = CA 的HDFS子目录为/wh/pvs/ds=20090801/ctry=CA。</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    分区表简单示例：<br>
    创建数据文件：test_partition_table.txt<br>
    创建表：create table test_partition_table (key string) partitioned by (dt string)<br>
    加载数据：LOAD DATA INPATH ‘filepath’ INTO TABLE test_partition_table partition (dt=‘2006’)<br>
    查看数据：select * from test_partition_table;  select count(*) from test_partition_table<br>
    删除表：drop table test_partition_table</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    （5）桶</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    Buckets是将表的列通过Hash算法进一步分解成不同的文件存储。它对指定列计算hash，根据hash值切分数据，目的是为了并行，每一个Bucket对应一个文件。例如将user列分散至32个bucket，首先对user列的值计算hash，对应hash值为0的HDFS目录为/wh/pvs/ds=20090801/ctry=US/part-00000；hash值为20的HDFS目录为/wh/pvs/ds=20090801/ctry=US/part-00020。如果想应用很多的Map任务这样是不错的选择。<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    桶的简单示例：<br>
    创建数据文件：test_bucket_table.txt<br>
    创建表：create table test_bucket_table (key string) clustered by (key) into 20 buckets<br>
    加载数据：LOAD DATA INPATH ‘filepath’ INTO TABLE test_bucket_table<br>
    查看数据：select * from test_bucket_table;  set hive.enforce.bucketing = true;<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    （6）Hive的视图<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    视图与传统数据库的视图类似。视图是只读的，它基于的基本表，如果改变，数据增加不会影响视图的呈现；如果删除，会出现问题。•如果不指定视图的列，会根据select语句后的生成。<br>
    示例：create view test_view as select * from test</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<span style="font-weight:700;">    2、Hive的执行原理</span></div>
<div align="center" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<br><img id="aimg_1371" src="http://www.aboutyun.com/data/attachment/forum/201312/24/133815hi9ehh9oz6dfy4lh.png" class="zoom" width="598" alt="" style="border:none;"></div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div align="center" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
图2.1 Hive的执行原理<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<span style="font-weight:700;">    Hive构建在Hadoop之上， <br></span>    （1）HQL中对查询语句的解释、优化、生成查询计划是由Hive完成的 <br>
    （2）所有的数据都是存储在Hadoop中 <br>
    （3）查询计划被转化为MapReduce任务，在Hadoop中执行（有些查询没有MR任务，如：select * from table）<br>
    （4）Hadoop和Hive都是用UTF-8编码的</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    Hive编译器将一个Hive QL转换操作符。操作符Operator是Hive的最小的处理单元，每个操作符代表HDFS的一个操作或者一道MapReduce作业。Operator都是hive定义的一个处理过程，其定义有：<br>
protected List &lt;Operator&lt;? extends Serializable &gt;&gt; childOperators; <br>
protected List &lt;Operator&lt;? extends Serializable &gt;&gt; parentOperators; <br>
protected boolean done;   // 初始化值为false</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    所有的操作构成了Operator图，hive正是基于这些图关系来处理诸如limit, group by, join等操作。</div>
<div align="center" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<img id="aimg_1372" src="http://www.aboutyun.com/data/attachment/forum/201312/24/133815bvcs7rj4p55zjnps.png" class="zoom" width="600" alt="" style="border:none;"></div>
<div align="center" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
图2.2 Hive QL的操作符<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    操作符如下：<br>
    TableScanOperator：扫描hive表数据<br>
    ReduceSinkOperator：创建将发送到Reducer端的&lt;Key,Value&gt;对<br>
    JoinOperator：Join两份数据<br>
    SelectOperator：选择输出列<br>
    FileSinkOperator：建立结果数据,输出至文件<br>
    FilterOperator：过滤输入数据<br>
    GroupByOperator：GroupBy语句<br>
    MapJoinOperator：/*+mapjoin(t) */<br>
    LimitOperator：Limit语句<br>
    UnionOperator：Union语句<br>
    Hive通过ExecMapper和ExecReducer执行MapReduce任务。在执行MapReduce时有两种模式，即本地模式和分布式模式 。</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    Hive编译器的组成：</div>
<div align="center" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
   <img id="aimg_1373" src="http://www.aboutyun.com/data/attachment/forum/201312/24/133816dql9r5krrsax66ir.png" class="zoom" width="600" alt="" style="border:none;"></div>
<div align="center" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<img id="aimg_1374" src="http://www.aboutyun.com/data/attachment/forum/201312/24/133820s72ds620v1ruvwdu.png" class="zoom" width="600" alt="" style="border:none;"></div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div align="center" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
图2.3 Hive编译器的组成<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    编译流程如下：<br></div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div align="center" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
   <img id="aimg_1375" src="http://www.aboutyun.com/data/attachment/forum/201312/24/133821i55vb0dipz656ipr.png" class="zoom" width="600" alt="" style="border:none;"></div>
<div align="center" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<img id="aimg_1366" src="http://www.aboutyun.com/data/attachment/forum/201312/24/133808mte1llicesvj3li3.png" class="zoom" width="600" alt="" style="border:none;"></div>
<div align="center" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
图2.4 Hive QL编译流程<br></div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<span style="font-weight:700;">    3、Hive和数据库的异同<br></span>    由于Hive采用了SQL的查询语言HQL，因此很容易将Hive理解为数据库。其实从结构上来看，Hive和数据库除了拥有类似的查询语言，再无类似之处。数据库可以用在Online的应用中，但是Hive是为数据仓库而设计的，清楚这一点，有助于从应用角度理解Hive的特性。<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    Hive和数据库的比较如下表：</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><table cellspacing="0" class="t_table" style="border-collapse:collapse;border:1px solid rgb(227,237,245);table-layout:auto;color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><tbody><tr><td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<br></td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="left">Hive</div>
<br></td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">RDBMS</div>
</div>
</td>
</tr><tr><td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">查询语言</div>
</div>
</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">HQL</div>
</div>
</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">SQL</div>
</div>
</td>
</tr><tr><td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">数据存储</div>
</div>
</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">HDFS</div>
</div>
</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">Raw Device or Local FS</div>
</div>
</td>
</tr><tr><td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">数据格式</div>
</div>
</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">用户定义</div>
</div>
</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">系统决定</div>
</div>
</td>
</tr><tr><td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">数据更新</div>
</div>
</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">不支持</div>
</div>
</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">支持</div>
</div>
</td>
</tr><tr><td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">索引</div>
</div>
</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">无</div>
</div>
</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">有</div>
</div>
</td>
</tr><tr><td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">执行</div>
</div>
</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">MapReduce</div>
</div>
</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">Executor</div>
</div>
</td>
</tr><tr><td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">执行延迟</div>
</div>
</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">高</div>
</div>
</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">低</div>
</div>
</td>
</tr><tr><td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">处理数据规模</div>
</div>
</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">大</div>
</div>
</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">小</div>
</div>
</td>
</tr><tr><td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">可扩展性</div>
</div>
</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">高</div>
</div>
</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
<div align="center">
<div align="left">低</div>
</div>
</td>
</tr></tbody></table><br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
     （1）查询语言。由于 SQL 被广泛的应用在数据仓库中，因此专门针对Hive的特性设计了类SQL的查询语言HQL。熟悉SQL开发的开发者可以很方便的使用Hive进行开发。</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
     （2）数据存储位置。Hive是建立在Hadoop之上的，所有Hive的数据都是存储在HDFS中的。而数据库则可以将数据保存在块设备或者本地文件系统中。</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
     （3）数据格式。Hive中没有定义专门的数据格式，数据格式可以由用户指定，用户定义数据格式需要指定三个属性：列分隔符（通常为空格、”\t”、”\x001″）、行分隔符（”\n”）以及读取文件数据的方法（Hive中默认有三个文件格式TextFile，SequenceFile以及RCFile）。由于在加载数据的过程中，不需要从用户数据格式到Hive定义的数据格式的转换，因此，</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
Hive在加载的过程中不会对数据本身进行任何修改，而只是将数据内容复制或者移动到相应的HDFS目录中。</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
而在数据库中，不同的数据库有不同的存储引擎，定义了自己的数据格式。所有数据都会按照一定的组织存储，因此，数据库加载数据的过程会比较耗时。</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
     （4）数据更新。由于Hive是针对数据仓库应用设计的，而数据仓库的内容是读多写少的。因此，Hive中不支持对数据的改写和添加，所有的数据都是在加载的时候中确定好的。而数据库中的数据通常是需要经常进行修改的，因此可以使用INSERT INTO ... VALUES添加数据，使用UPDATE ... SET修改数据。</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
     （5）索引。之前已经说过，Hive在加载数据的过程中不会对数据进行任何处理，甚至不会对数据进行扫描，因此也没有对数据中的某些Key建立索引。Hive要访问数据中满足条件的特定值时，需要暴力扫描整个数据，因此访问延迟较高。由于MapReduce的引入， Hive可以并行访问数据，因此即使没有索引，对于大数据量的访问，Hive仍然可以体现出优势。数据库中，通常会针对一个或者几个列建立索引，因此对于少量的特定条件的数据的访问，数据库可以有很高的效率，较低的延迟。由于数据的访问延迟较高，决定了Hive不适合在线数据查询。</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
     （6）执行。Hive中大多数查询的执行是通过Hadoop提供的MapReduce来实现的（类似select * from tbl的查询不需要MapReduce）。而数据库通常有自己的执行引擎。</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
     （7）执行延迟。之前提到，Hive在查询数据的时候，由于没有索引，需要扫描整个表，因此延迟较高。另外一个导致Hive执行延迟高的因素是MapReduce框架。由于MapReduce本身具有较高的延迟，因此在利用MapReduce执行Hive查询时，也会有较高的延迟。相对的，数据库的执行延迟较低。当然，这个低是有条件的，即数据规模较小，当数据规模大到超过数据库的处理能力的时候，Hive的并行计算显然能体现出优势。</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
     （8）可扩展性。由于Hive是建立在Hadoop之上的，因此Hive的可扩展性是和Hadoop的可扩展性是一致的（世界上最大的Hadoop集群在Yahoo!，2009年的规模在4000台节点左右）。而数据库由于ACID语义的严格限制，扩展行非常有限。目前最先进的并行数据库Oracle在理论上的扩展能力也只有100台左右。</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
     （9）数据规模。由于Hive建立在集群上并可以利用MapReduce进行并行计算，因此可以支持很大规模的数据；对应的，数据库可以支持的数据规模较小。</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><span style="font-weight:700;color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">4、Hive元数据库<br></span><span style="font-family:Arial;font-size:14px;line-height:26px;"></span>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    Hive将元数据存储在RDBMS 中，一般常用的有MYSQL和DERBY。</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    启动HIVE的元数据库时，需要进入到hive的安装目录<br>
    启动derby数据库：/home/admin/caona/hive/build/dist/，运行startNetworkServer -h 0.0.0.0。</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    连接Derby数据库进行测试：查看/home/admin/caona/hive/build/dist/conf/hive-default.xml。找到</div>
<div class="blockcode" style="overflow:hidden;color:rgb(102,102,102);border:1px solid rgb(204,204,204);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;background-color:rgb(247,247,247);">
<div id="code_MTx">
<ol><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
&lt;P style="TEXT-ALIGN: left; PADDING-BOTTOM: 0px; WIDOWS: 2; TEXT-TRANSFORM: none; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; MARGIN: 0px; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; FONT: 14px/26px Arial; WHITE-SPACE: normal; ORPHANS: 2; LETTER-SPACING:
 normal; COLOR: rgb(0,0,0); WORD-SPACING: 0px; PADDING-TOP: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px"&gt; &lt;/P&gt;</li></ol></div>
<span style="margin-left:43px;font-size:12px;color:rgb(51,102,153) !important;">复制代码</span></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
进入derby安装目录：/home/admin/caona/hive/build/dist/db-derby-10.4.1.3-bin/bin<br>
    输入：./ij  Connect 'jdbc:derby://hadoop1:1527/metastore_db;create=true';<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    hive元数据对应的表约有20个，其中和表结构信息有关的有9张，其余的10多张或为空，或只有简单的几条记录，以下是部分主要表的简要说明。</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<table cellspacing="0" class="t_table" style="border-collapse:collapse;border:1px solid rgb(227,237,245);table-layout:auto;"><tbody><tr><td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
表名</td>
<td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
说明</td>
<td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
关联键</td>
</tr><tr><td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
TBLS</td>
<td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
所有hive表的基本信息</td>
<td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
TBL_ID,SD_ID</td>
</tr><tr><td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
TABLE_PARAM</td>
<td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
表级属性，如是否外部表，表注释等</td>
<td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
TBL_ID</td>
</tr><tr><td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
COLUMNS</td>
<td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
Hive表字段信息(字段注释，字段名，字段类型，字段序号)</td>
<td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
SD_ID</td>
</tr><tr><td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
SDS</td>
<td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
所有hive表、表分区所对应的hdfs数据目录和数据格式</td>
<td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
SD_ID,SERDE_ID</td>
</tr><tr><td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
SERDE_PARAM</td>
<td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
序列化反序列化信息，如行分隔符、列分隔符、NULL的表示字符等</td>
<td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
SERDE_ID</td>
</tr><tr><td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
PARTITIONS</td>
<td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
Hive表分区信息</td>
<td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
PART_ID,SD_ID,TBL_ID</td>
</tr><tr><td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
PARTITION_KEYS</td>
<td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
Hive分区表分区键</td>
<td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
TBL_ID</td>
</tr><tr><td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
PARTITION_KEY_VALS</td>
<td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
Hive表分区名(键值)</td>
<td width="189" style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
PART_ID</td>
</tr></tbody></table></div>
<span style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">    从上面表的内容来看，hive整个创建表的过程已经比较清楚了。</span><br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><span style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">    （1）解析用户提交hive语句，对其进行解析，分解为表、字段、分区等hive对象 </span><br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><span style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">    （2）根据解析到的信息构建对应的表、字段、分区等对象，从 SEQUENCE_TABLE中获取构建对象的最新ID，与构建对象信息（名称，类型等）一同通过DAO方法写入到元数据表中去，成功后将SEQUENCE_TABLE中对应的最新ID+5。</span><br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><span style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">    实际上我们常见的RDBMS都是通过这种方法进行组织的，典型的如postgresql，其系统表中和hive元数据一样裸露了这些id信息（oid,cid等），而Oracle等商业化的系统则隐藏了这些具体的ID。通过这些元数据我们可以很容易的读到数据诸如创建一个表的数据字典信息，比如导出建表语名等。</span><br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<span style="font-weight:700;">    5、Hive基本操作</span></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    Create Table语句的一些注意项：</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    （1）CREATE TABLE创建一个指定名字的表。如果相同名字的表已经存在，则抛出异常；用户可以用IF NOT EXIST选项来忽略这个异常。<br>
   （2）EXTERNAL 关键字可以让用户创建一个外部表，在建表的同时指定一个指向实际数据的路径（ LOCATION ），Hive 创建内部表时，会将数据移动到数据仓库指向的路径；若创建外部表，仅记录数据所在的路径，不对数据的位置做任何改变。在删除表的时候，内部表的元数据和数据会被一起删除，而外部表只删除元数据，不删除数据。<br>
    （3）LIKE允许用户复制现有的表结构，但是不复制数据。<br>
    （4）用户在建表的时候可以自定义SerDe或者使用自带的 SerDe （ Serialize/Deserilize 的简称，目的是用于序列化和反序列化 ）。如果没有指定 ROW FORMAT 或者 ROW FORMAT DELIMITED，将会使用自带的SerDe。在建表的时候，用户还需要为表指定列，用户在指定表的列的同时也会指定自定义的SerDe，Hive通过SerDe确定表的具体的列的数据。<br>
    （5）如果文件数据是纯文本，可以使用STORED AS TEXTFILE。如果数据需要压缩，使用STORED AS SEQUENCE。<br>
    （6）有分区的表可以在创建的时候使用 PARTITIONED B Y语句。一个表可以拥有一个或者多个分区，每一个分区单独存在一个目录下。而且，表和分区都可以对某个列进行CLUSTERED BY操作，将若干个列放入一个桶（bucket）中。也可以利用SORT BY对数据进行排序。这样可以为特定应用提高性能。<br>
    （7）表名和列名不区分大小写，SerDe和属性名区分大小写。表和列的注释是字符串。<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    Alter Table语句：主要功能包括Add Partitions, Drop Partitions, Rename Table, Change Column, Add/Replace Columns。</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    Create View语句：创建视图。格式CREATE VIEW [IF NOT EXISTS] view_name [ (column_name [COMMENT column_comment], ...) ]</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    Showy语句：Show tables;  Show partitions; describe查看表结构。<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    Load语句：HIVE装载数据时没有做任何转换，加载到表中的数据只是进入相应的配置单元表的位置。Load操作只是单纯的复制/移动操作，将数据文件移动到Hive表对应的位置。</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    Insert语句：插入数据。Hive不支持一条一条的用 insert 语句进行插入操作，这个应该是与hive的storage layer是有关系的，因为它的存储层是HDFS，插入一个数据要全表扫描，还不如用整个表的替换来的快些。Hive也不支持update的操作。数据是以load的方式，加载到建立好的表中。数据一旦导入，则不可修改。要么drop掉整个表，要么建立新的表，导入新的数据。</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    Drop语句：删除一个内部表的同时会同时删除表的元数据和数据。删除一个外部表，只删除元数据而保留数据。<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    Limit子句：可以限制查询的记录数。查询的结果是随机选择的。下面的查询语句从 t1 表中随机查询5条记录，SELECT * FROM t1 LIMIT 5。</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    Top K查询：下面的查询语句查询销售记录最大的 5 个销售代表。<br>
SET mapred.reduce.tasks = 1<br>
SELECT * FROM sales SORT BY amount DESC LIMIT 5</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    正则表达式使用：SELECT语句可以使用正则表达式做列选择，下面的语句查询除了ds和h 之外的所有列：<br>
SELECT `(ds|hr)?+.+` FROM sales</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    SELECT语句：查询数据。</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    Group by, Order by, Sort by子句：聚合可进一步分为多个表，甚至发送到 Hadoop 的 DFS 的文件（可以进行操作，然后使用HDFS的utilitites）。可以用hive.map.aggr控制怎么进行汇总。默认为为true，配置单元会做的第一级聚合直接在MAP上的任务。这通常提供更好的效率，但可能需要更多的内存来运行成功。</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<span style="font-weight:700;">    Join语句：连接操作。一些注意事项：</span></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    （1）Hive只支持等值连接（equality joins）、外连接（outer joins）和（left/right joins）。Hive不支持所有非等值的连接，因为非等值连接非常难转化到map/reduce任务。</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    （2）Hive 支持多于2个表的连接。<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    （3）join 时，每次 map/reduce 任务的逻辑： reducer 会缓存 join 序列中除了最后一个表的所有表的记录， 再通过最后一个表将结果序列化到文件系统。这一实现有助于在reduce端减少内存的使用量。实践中，应该把最大的那个表写在最后（否则会因为缓存浪费大量内存）。<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    （4）LEFT，RIGHT 和 FULL OUTER 关键字用于处理 join 中空记录的情况。</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    （5）LEFT SEMI JOIN 是 IN/EXISTS 子查询的一种更高效的实现。Hive 当前没有实现 IN/EXISTS 子查询，所以你可以用 LEFT SEMI JOIN 重写你的子查询语句。LEFT SEMI JOIN的限制是， JOIN子句中右边的表只能在ON子句中设置过滤条件，在WHERE子句、SELECT子句或其他地方过滤都不行。<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<span style="font-weight:700;">    6、使用HIVE注意点<br></span>    （1）字符集<br>
    Hadoop和Hive都是用UTF-8编码的，所以, 所有中文必须是UTF-8编码, 才能正常使用。<br>
    备注：中文数据load到表里面,，如果字符集不同，很有可能全是乱码需要做转码的，但是hive本身没有函数来做这个。<br>
    （2）压缩<br>
    hive.exec.compress.output 这个参数，默认是false，但是很多时候貌似要单独显式设置一遍，否则会对结果做压缩的，如果你的这个文件后面还要在hadoop下直接操作，那么就不能压缩了。<br>
    （3）count(distinct)<br>
    当前的Hive不支持在一条查询语句中有多Distinct。如果要在Hive查询语句中实现多Distinct，需要使用至少n+1条查询语句（n为distinct的数目），前n条查询分别对n个列去重，最后一条查询语句对n个去重之后的列做Join操作，得到最终结果。<br>
    （4）JOIN<br>
    只支持等值连接<br>
    （5）DML操作<br>
    只支持INSERT/LOAD操作，无UPDATE和DELTE<br>
    （6）HAVING<br>
    不支持HAVING操作。如果需要这个功能要嵌套一个子查询用where限制<br>
    （7）子查询<br>
    Hive不支持where子句中的子查询<br>
    （8）Join中处理null值的语义区别<br>
    SQL标准中，任何对null的操作（数值比较，字符串操作等）结果都为null。Hive对null值处理的逻辑和标准基本一致，除了Join时的特殊逻辑。这里的特殊逻辑指的是，Hive的Join中，作为Join key的字段比较，null=null是有意义的，且返回值为true。</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    （9）分号字符<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    分号是SQL语句结束标记，在HiveQL中也是，但是在HiveQL中，对分号的识别没有那么智慧，例如：<br>
select concat(cookie_id,concat(';',’zoo’)) from c02_clickstat_fatdt1 limit 2;<br>
FAILED: Parse Error: line 0:-1 cannot recognize input '&lt;EOF&gt;' in function specification<br>
    可以推断，Hive解析语句的时候，只要遇到分号就认为语句结束，而无论是否用引号包含起来。<br>
    解决的办法是，使用分号的八进制的ASCII码进行转义，那么上述语句应写成： <br>
select concat(cookie_id,concat('\073','zoo')) from c02_clickstat_fatdt1 limit 2;<br>
    为什么是八进制ASCII码？我尝试用十六进制的ASCII码，但Hive会将其视为字符串处理并未转义，好像仅支持八进制，原因不详。这个规则也适用于其他非SELECT语句，如CREATE TABLE中需要定义分隔符，那么对不可见字符做分隔符就需要用八进制的ASCII码来转义。<br></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    （10）Insert</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    根据语法Insert必须加“OVERWRITE”关键字，也就是说每一次插入都是一次重写。</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<span style="font-weight:700;">    7、Hive的扩展特性</span></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    Hive 是一个很开放的系统，很多内容都支持用户定制，包括：<br>
    * 文件格式：Text File，Sequence File<br>
    * 内存中的数据格式： Java Integer/String, Hadoop IntWritable/Text<br>
    * 用户提供的map/reduce脚本：不管什么语言，利用stdin/stdout传输数据<br>
    * 用户自定义函数：Substr, Trim, 1 – 1<br>
    * 用户自定义聚合函数：Sum, Average…… n – 1</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
   （1）数据文件格式</div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<table cellspacing="0" class="t_table" style="border-collapse:collapse;border:1px solid rgb(227,237,245);table-layout:auto;"><tbody><tr><td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
 </td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
TextFile</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
SequenceFIle</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
RCFFile</td>
</tr><tr><td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
Data type</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
Text Only</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
Text/Binary</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
Text/Binary</td>
</tr><tr><td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
Internal Storage Order</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
Row-based</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
Row-based</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
Column-based</td>
</tr><tr><td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
Compression</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
File Based</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
Block Based</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
Block Based</td>
</tr><tr><td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
Splitable</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
YES</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
YES</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
YES</td>
</tr><tr><td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
Splitable After Compression</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
No</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
YES</td>
<td style="font-size:14px;border:1px solid rgb(227,237,245);overflow:hidden;">
YES</td>
</tr></tbody></table></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
     例如使用文件文件格式存储创建的表：</div>
<div class="blockcode" style="overflow:hidden;color:rgb(102,102,102);border:1px solid rgb(204,204,204);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;background-color:rgb(247,247,247);">
<div id="code_JWN">
<ol><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
CREATE TABLE mylog ( user_id BIGINT, page_url STRING, unix_time INT)<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
STORED AS TEXTFILE;</li></ol></div>
<span style="margin-left:43px;font-size:12px;color:rgb(51,102,153) !important;">复制代码</span></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
  当用户的数据文件格式不能被当前Hive所识别的时候，可以自定义文件格式。可以参考contrib/src/java/org/apache/hadoop/hive/contrib/fileformat/base64中的例子。写完自定义的格式后，在创建表的时候指定相应的文件格式就可以：</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div class="blockcode" style="overflow:hidden;color:rgb(102,102,102);border:1px solid rgb(204,204,204);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;background-color:rgb(247,247,247);">
<div id="code_OoT">
<ol><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
CREATE TABLE base64_test(col1 STRING, col2 STRING)<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
STORED AS<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
INPUTFORMAT 'org.apache.hadoop.hive.contrib.<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
fileformat.base64.Base64TextInputFormat'<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
OUTPUTFORMAT 'org.apache.hadoop.hive.contrib.<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
fileformat.base64.Base64TextOutputFormat';</li></ol></div>
<span style="margin-left:43px;font-size:12px;color:rgb(51,102,153) !important;">复制代码</span></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
（2）SerDe<br>
    SerDe是Serialize/Deserilize的简称，目的是用于序列化和反序列化。序列化的格式包括：分隔符（tab、逗号、CTRL-A）、Thrift 协议<br>
    反序列化（内存内）：Java Integer/String/ArrayList/HashMap、Hadoop Writable类、用户自定义类<br>
   其中，LazyObject只有在访问到列的时候才进行反序列化。 BinarySortable保留了排序的二进制格式。<br>
    当存在以下情况时，可以考虑增加新的SerDe：<br>
    * 用户的数据有特殊的序列化格式，当前的Hive不支持，而用户又不想在将数据加载至Hive前转换数据格式。<br>
    * 用户有更有效的序列化磁盘数据的方法。<br>
    用户如果想为Text数据增加自定义Serde，可以参照contrib/src/java/org/apache/hadoop/hive/contrib/serde2/RegexSerDe.java中的例子。RegexSerDe利用用户提供的正则表倒是来反序列化数据，例如：</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div class="blockcode" style="overflow:hidden;color:rgb(102,102,102);border:1px solid rgb(204,204,204);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;background-color:rgb(247,247,247);">
<div id="code_T88">
<ol><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
CREATE TABLE apache_log(<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
host STRING,<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
identity STRING,<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
user STRING,<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
time STRING,<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
request STRING,<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
status STRING,<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
size STRING,<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
referer STRING,<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
agent STRING)<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
ROW FORMAT<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
SERDE 'org.apache.hadoop.hive.contrib.serde2.RegexSerDe'<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
WITH SERDEPROPERTIES<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
( "input.regex" = "([^ ]*) ([^ ]*) ([^ ]*) (-|\\[[^\\]]*\\])<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
([^ \"]*|\"[^\"]*\") (-|[0-9]*) (-|[0-9]*)(?: ([^ \"]*|\"[^\"]*\")<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
([^ \"]*|\"[^\"]*\"))?",<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
"output.format.string" = "%1$s %2$s %3$s %4$s %5$s %6$s %7$s %8$s %9$s";)<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
STORED AS TEXTFILE;</li></ol></div>
<span style="margin-left:43px;font-size:12px;color:rgb(51,102,153) !important;">复制代码</span></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    用户如果想为Binary数据增加自定义的SerDe，可以参考例子serde/src/java/org/apache/hadoop/hive/serde2/binarysortable，例如：</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div class="blockcode" style="overflow:hidden;color:rgb(102,102,102);border:1px solid rgb(204,204,204);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;background-color:rgb(247,247,247);">
<div id="code_jSj">
<ol><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
CREATE TABLE mythrift_table<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
ROW FORMAT SERDE<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
'org.apache.hadoop.hive.contrib.serde2.thrift.ThriftSerDe'<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
WITH SERDEPROPERTIES (<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
"serialization.class" = "com.facebook.serde.tprofiles.full",<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
"serialization.format" = "com.facebook.thrift.protocol.TBinaryProtocol";);</li></ol></div>
<span style="margin-left:43px;font-size:12px;color:rgb(51,102,153) !important;">复制代码</span></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<br>
（3）Map/Reduce脚本（Transform）<br>
    用户可以自定义Hive使用的Map/Reduce脚本，比如：</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div class="blockcode" style="overflow:hidden;color:rgb(102,102,102);border:1px solid rgb(204,204,204);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;background-color:rgb(247,247,247);">
<div id="code_Fz5">
<ol><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
FROM (<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
SELECT TRANSFORM(user_id, page_url, unix_time)<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
USING 'page_url_to_id.py'<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
AS (user_id, page_id, unix_time)<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
FROM mylog<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
DISTRIBUTE BY user_id<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
SORT BY user_id, unix_time)<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
mylog2<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
SELECT TRANSFORM(user_id, page_id, unix_time)<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
USING 'my_python_session_cutter.py' AS (user_id, session_info);</li></ol></div>
<span style="margin-left:43px;font-size:12px;color:rgb(51,102,153) !important;">复制代码</span></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<br>
    Map/Reduce脚本通过stdin/stdout进行数据的读写，调试信息输出到stderr。<br>
    （4）UDF（User-Defined-Function）<br>
    用户可以自定义函数对数据进行处理，例如：</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div class="blockcode" style="overflow:hidden;color:rgb(102,102,102);border:1px solid rgb(204,204,204);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;background-color:rgb(247,247,247);">
<div id="code_Qkr">
<ol><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
&lt;P&gt;[sql]&lt;/P&gt;<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
&lt;P&gt;add jar build/ql/test/test-udfs.jar;<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
CREATE TEMPORARY FUNCTION testlength<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
AS 'org.apache.hadoop.hive.ql.udf.UDFTestLength'; <br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
SELECT testlength(src.value) FROM src; <br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
DROP TEMPORARY FUNCTION testlength;&lt;/P&gt;</li></ol></div>
<span style="margin-left:43px;font-size:12px;color:rgb(51,102,153) !important;">复制代码</span></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<br>
UDFTestLength.java为：</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div class="blockcode" style="overflow:hidden;color:rgb(102,102,102);border:1px solid rgb(204,204,204);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;background-color:rgb(247,247,247);">
<div id="code_Kn5">
<ol><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
package org.apache.hadoop.hive.ql.udf; <br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
public class UDFTestLength extends UDF {<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
public Integer evaluate(String s) {<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
if (s == null) {<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
return null;<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
}<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
return s.length();<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
}<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
}</li></ol></div>
<span style="margin-left:43px;font-size:12px;color:rgb(51,102,153) !important;">复制代码</span></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
<br>
UDF 具有以下特性：<br>
    * 用java写UDF很容易。<br>
    * Hadoop的Writables/Text 具有较高性能。<br>
    * UDF可以被重载。<br>
    * Hive支持隐式类型转换。<br>
    * UDF支持变长的参数。<br>
    * genericUDF 提供了较好的性能（避免了反射）。</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
    （5）UDAF（User-Defined Aggregation Funcation）<br>
    例子：</div>
<div class="blockcode" style="overflow:hidden;color:rgb(102,102,102);border:1px solid rgb(204,204,204);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;background-color:rgb(247,247,247);">
<div id="code_SaV">
<ol><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
&lt;P&gt;[sql]&lt;/P&gt;<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
&lt;P&gt;SELECT page_url, count(1), count(DISTINCT user_id) FROM mylog;&lt;/P&gt;</li></ol></div>
<span style="margin-left:43px;font-size:12px;color:rgb(51,102,153) !important;">复制代码</span></div>
<div align="left" style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;">
UDAFCount.java代码如下：</div>
<br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;"><div class="blockcode" style="overflow:hidden;color:rgb(102,102,102);border:1px solid rgb(204,204,204);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14.3999996185303px;line-height:16.7999992370605px;background-color:rgb(247,247,247);">
<div id="code_mb9">
<ol><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
public class UDAFCount extends UDAF {<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
public static class Evaluator implements UDAFEvaluator {<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
private int mCount; <br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
public void init() {<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
mcount = 0;<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
} <br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
public boolean iterate(Object o) {<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
if (o!=null)<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
mCount++; <br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
return true;<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
} <br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
public Integer terminatePartial() {<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
return mCount;<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
} <br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
public boolean merge(Integer o) {<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
mCount += o;<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
return true;<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
} <br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
public Integer terminate() {<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
return mCount;<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;">
}<br></li><li style="font-family:Monaco, Consolas, 'Lucida Console', 'Courier New', serif;font-size:12px;line-height:1.8em;color:rgb(51,102,153);background-color:rgb(255,255,255);">
}</li></ol></div>
<span style="margin-left:43px;font-size:12px;color:rgb(51,102,153) !important;">复制代码</span></div>
<div><span style="margin-left:43px;font-size:12px;color:rgb(51,102,153) !important;"><br></span></div>
            </div>
                </div>