---
layout:     post
title:      使用flume问题总结1——搭建flume+测试Syslog source
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								<div class="article-copyright">
					版权声明：本文为博主原创文章，未经博主允许不得转载。					https://blog.csdn.net/anjing900812/article/details/48731159				</div>
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<h2 style="color:rgb(51,51,51);font-family:Arial;line-height:26px;">
搭建flume</h2>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<ol><li><span style="font-size:12px;">先安装JDK：参考<a href="http://wenku.baidu.com/link?url=QnE9lgoCkS2OoILGeHim7uonsth5LwiGB3IWKOnNirSE6qEOaNgdW4-DDWR2XKKoX0X8aLIbjDD0i_z4BeXh4VA_AEScZhrxvz_9BucO-Ze" rel="nofollow" style="color:rgb(51,102,153);text-decoration:none;">http://wenku.baidu.com/link?url=QnE9lgoCkS2OoILGeHim7uonsth5LwiGB3IWKOnNirSE6qEOaNgdW4-DDWR2XKKoX0X8aLIbjDD0i_z4BeXh4VA_AEScZhrxvz_9BucO-Ze</a></span></li><li>下载flume，目前最新版本1.6.0：链接<a href="http://flume.apache.org/download.html" rel="nofollow" style="color:rgb(51,102,153);text-decoration:none;">http://flume.apache.org/download.html</a></li><li>安装flume：参考<a href="http://wenku.baidu.com/link?url=LS_fM5ifOAiHumoqaZUd9G42P9vAlvePdsQsdE7FcniaGHTMuWt1LJ5SZaA6yQBq3p9jxtp9lt81n39627kNT8fxFx7EGK8WfFS_mUt5WGG" rel="nofollow" style="color:rgb(51,102,153);text-decoration:none;">http://wenku.baidu.com/link?url=LS_fM5ifOAiHumoqaZUd9G42P9vAlvePdsQsdE7FcniaGHTMuWt1LJ5SZaA6yQBq3p9jxtp9lt81n39627kNT8fxFx7EGK8WfFS_mUt5WGG</a></li><li>我的环境变变量的设置：文件/etc/profile</li><li>
<div class="dp-highlighter bg_html" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;width:661.3125px;overflow:auto;background-color:rgb(231,229,220);">
<div class="bar">
<div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left-width:3px;border-left-style:solid;border-left-color:rgb(108,226,108);background-color:rgb(248,248,248);">
<strong>[html]</strong> <a href="http://blog.csdn.net/anjing900812/article/details/48729959#" rel="nofollow" class="ViewSource" title="view plain" style="color:rgb(160,160,160);text-decoration:none;border:none;font-size:9px;display:inline-block;width:16px;text-indent:-2000px;background-color:inherit;">view
 plain</a><a href="http://blog.csdn.net/anjing900812/article/details/48729959#" rel="nofollow" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);text-decoration:none;border:none;font-size:9px;display:inline-block;width:16px;text-indent:-2000px;background-color:inherit;">copy</a>
<div style="width:18px;z-index:99;">
</div>
</div>
</div>
<ol start="1" class="dp-xml" style="border:none;color:rgb(92,92,92);background-color:rgb(255,255,255);"><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;"><span style="border:none;background-color:inherit;">if [ -z "$INPUTRC" -a ! -f "$HOME/.inputrc" ]; then  </span></span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">    <span class="attribute" style="border:none;color:#FF0000;background-color:inherit;">INPUTRC</span><span style="border:none;background-color:inherit;">=/etc/inputrc  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">fi  </span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">  </span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">export <span class="attribute" style="border:none;color:#FF0000;background-color:inherit;">JAVA_HOME</span><span style="border:none;background-color:inherit;">=/opt/jdk/jdk1.6.0_45  </span></span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">export <span class="attribute" style="border:none;color:#FF0000;background-color:inherit;">PATH</span><span style="border:none;background-color:inherit;">=$PATH:$JAVA_HOME/bin:$JAVA_HOME/jre/bin  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">export <span class="attribute" style="border:none;color:#FF0000;background-color:inherit;">CLASSPATH</span><span style="border:none;background-color:inherit;">=.:/opt/jdk/jdk1.6.0_45/lib:/opt/jdk/jdk1.6.0_45/jre/lib:$CLASSPATH  </span></span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">export <span class="attribute" style="border:none;color:#FF0000;background-color:inherit;">FLUME_HOME</span><span style="border:none;background-color:inherit;">=/usr/local/flume  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">export <span class="attribute" style="border:none;color:#FF0000;background-color:inherit;">PLUME_LOG_DIR</span><span style="border:none;background-color:inherit;">=$FLUME_HOME/log  </span></span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">export <span class="attribute" style="border:none;color:#FF0000;background-color:inherit;">PATH</span><span style="border:none;background-color:inherit;">=$PATH:$FLUME_HOME/bin  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">  </span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">export <span class="attribute" style="border:none;color:#FF0000;background-color:inherit;">KAFKA_HOME</span><span style="border:none;background-color:inherit;">=/usr/local/kafka  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">export <span class="attribute" style="border:none;color:#FF0000;background-color:inherit;">PATH</span><span style="border:none;background-color:inherit;">=$PATH:$KAFKA_HOME/bin  </span></span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">  </span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">export PATH USER LOGNAME MAIL HOSTNAME HISTSIZE INPUTRC  </span></li></ol></div>
</li></ol><h2><a name="t1" style="color:rgb(51,102,153);"></a><span style="font-family:monospace;"><span>测试</span></span></h2>
</div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<ol><li><span style="font-family:monospace;"><span>链接中有很多测试案例，可用于测试flume安装是否成功，并且初步了解各种source的使用方式以及区别：<a href="http://www.aboutyun.com/thread-8917-1-1.html" rel="nofollow" style="color:rgb(51,102,153);text-decoration:none;">http://www.aboutyun.com/thread-8917-1-1.html</a></span></span></li><li><span style="font-family:monospace;">上面博文中测试用例都是用命令行的方式实现的，实际开发中我们需要编写自己的client，与flume source对接</span></li></ol><h2><a name="t2" style="color:rgb(51,102,153);"></a><span style="font-family:monospace;">Syslog source</span></h2>
</div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<ol><li><span style="font-family:monospace;">这篇博文中用使用Java编写了一个客户端（创建socket客户端）之后发送数据，flume配置的source类型为syslog，测试可以运行。链接</span><span style="font-family:monospace;">：</span><a href="http://blog.csdn.net/shuijinglianyi/article/details/8492415" rel="nofollow" style="color:rgb(51,102,153);text-decoration:none;font-family:monospace;">http://blog.csdn.net/shuijinglianyi/article/details/8492415</a></li><li>由于业务需求，我的客户端需要用C语言实现。所以尝试着用C编写了一个类似的socket client，但是运行不成功。刚开始以为是跨语言的问题，所以用java编写了socket 服务端与我的C client通信，运行成功，说明不是语言问题。（Java与C之间的socket通信，参考：<a href="http://blog.csdn.net/yutianzuijin/article/details/24807417" rel="nofollow" style="color:rgb(51,102,153);text-decoration:none;">http://blog.csdn.net/yutianzuijin/article/details/24807417</a>）</li><li>仔细检查后才明白是发送的消息格式不正确，下面是C语言的client代码。</li><li>之前发送的消息之前没有加&lt;4&gt;，然后就发送不成功。猜测：&lt;4&gt;应该是flume event要求的一个固定字段。</li><li>由于刚开始接触flume，event的格式还不是很明白，关于为什么消息前面必须加&lt;4&gt;，在下一篇博文中说明。</li><li>
<div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;width:661.3125px;overflow:auto;background-color:rgb(231,229,220);">
<div class="bar">
<div class="tools" style="font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:#C0C0C0;border-left-width:3px;border-left-style:solid;border-left-color:rgb(108,226,108);background-color:rgb(248,248,248);">
<strong>[cpp]</strong> <a href="http://blog.csdn.net/anjing900812/article/details/48729959#" rel="nofollow" class="ViewSource" title="view plain" style="color:rgb(160,160,160);text-decoration:none;border:none;font-size:9px;display:inline-block;width:16px;text-indent:-2000px;background-color:inherit;">view
 plain</a><a href="http://blog.csdn.net/anjing900812/article/details/48729959#" rel="nofollow" class="CopyToClipboard" title="copy" style="color:rgb(160,160,160);text-decoration:none;border:none;font-size:9px;display:inline-block;width:16px;text-indent:-2000px;background-color:inherit;">copy</a>
<div style="width:18px;z-index:99;">
</div>
</div>
</div>
<ol start="1" class="dp-cpp" style="border:none;color:rgb(92,92,92);background-color:rgb(255,255,255);"><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;"><span class="preprocessor" style="border:none;color:#808080;background-color:inherit;">#include &lt;stdio.h&gt;</span><span style="border:none;background-color:inherit;">  </span></span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;"><span class="preprocessor" style="border:none;color:#808080;background-color:inherit;">#include &lt;stdlib.h&gt;</span><span style="border:none;background-color:inherit;">  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;"><span class="preprocessor" style="border:none;color:#808080;background-color:inherit;">#include &lt;arpa/inet.h&gt;</span><span style="border:none;background-color:inherit;">  </span></span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;"><span class="preprocessor" style="border:none;color:#808080;background-color:inherit;">#include &lt;sys/types.h&gt;</span><span style="border:none;background-color:inherit;">  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;"><span class="preprocessor" style="border:none;color:#808080;background-color:inherit;">#include &lt;sys/socket.h&gt;</span><span style="border:none;background-color:inherit;">  </span></span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;"><span class="preprocessor" style="border:none;color:#808080;background-color:inherit;">#include &lt;unistd.h&gt;</span><span style="border:none;background-color:inherit;">  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;"><span class="preprocessor" style="border:none;color:#808080;background-color:inherit;">#include &lt;netinet/in.h&gt;</span><span style="border:none;background-color:inherit;">  </span></span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;"><span class="preprocessor" style="border:none;color:#808080;background-color:inherit;">#include &lt;netdb.h&gt;</span><span style="border:none;background-color:inherit;">  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;"><span class="preprocessor" style="border:none;color:#808080;background-color:inherit;">#include &lt;string.h&gt;</span><span style="border:none;background-color:inherit;">  </span></span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;"><span class="preprocessor" style="border:none;color:#808080;background-color:inherit;">#include &lt;errno.h&gt;</span><span style="border:none;background-color:inherit;">  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">  </span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;"><span class="datatypes" style="border:none;color:rgb(46,139,87);font-weight:bold;background-color:inherit;">int</span><span style="border:none;background-color:inherit;"> main()  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">{  </span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">    <span class="datatypes" style="border:none;color:rgb(46,139,87);font-weight:bold;background-color:inherit;">int</span><span style="border:none;background-color:inherit;"> sock_id;  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">    <span class="datatypes" style="border:none;color:rgb(46,139,87);font-weight:bold;background-color:inherit;">char</span><span style="border:none;background-color:inherit;"> send_buf3[] = </span><span class="string" style="border:none;color:#0000FF;background-color:inherit;">"&lt;4&gt;helloworld\nnihao\n"</span><span style="border:none;background-color:inherit;">;  </span><span class="comment" style="border:none;color:rgb(0,130,0);background-color:inherit;">// 要发送给服务器的信息</span><span style="border:none;background-color:inherit;">  </span></span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">    <span class="datatypes" style="border:none;color:rgb(46,139,87);font-weight:bold;background-color:inherit;">char</span><span style="border:none;background-color:inherit;"> server_addr[16] = </span><span class="string" style="border:none;color:#0000FF;background-color:inherit;">"127.0.0.1"</span><span style="border:none;background-color:inherit;">;</span><span class="comment" style="border:none;color:rgb(0,130,0);background-color:inherit;">//服务器IP地址</span><span style="border:none;background-color:inherit;">  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">    <span class="datatypes" style="border:none;color:rgb(46,139,87);font-weight:bold;background-color:inherit;">int</span><span style="border:none;background-color:inherit;"> server_port = 5496;</span><span class="comment" style="border:none;color:rgb(0,130,0);background-color:inherit;">//服务器分配的端口号</span><span style="border:none;background-color:inherit;">  </span></span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">struct</span><span style="border:none;background-color:inherit;"> sockaddr_in servaddr;</span><span class="comment" style="border:none;color:rgb(0,130,0);background-color:inherit;">//服务器的地址信息</span><span style="border:none;background-color:inherit;">  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">    bzero(&amp;servaddr,<span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">sizeof</span><span style="border:none;background-color:inherit;">(servaddr));  </span></span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">    <span class="comment" style="border:none;color:rgb(0,130,0);background-color:inherit;">//读取IP地址</span><span style="border:none;background-color:inherit;">  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">    servaddr.sin_family = AF_INET ;  </span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">    servaddr.sin_addr.s_addr = inet_addr(server_addr);  </span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">    servaddr.sin_port = htons(server_port);  </span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">    <span class="comment" style="border:none;color:rgb(0,130,0);background-color:inherit;">//创建TCP流式socket</span><span style="border:none;background-color:inherit;">  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">    sock_id = socket(AF_INET,SOCK_STREAM,0);  </span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">if</span><span style="border:none;background-color:inherit;">(sock_id == -1){  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">            perror(<span class="string" style="border:none;color:#0000FF;background-color:inherit;">"socket() failed"</span><span style="border:none;background-color:inherit;">);  </span></span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">            <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">return</span><span style="border:none;background-color:inherit;"> -1;  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">    }  </span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">    <span class="comment" style="border:none;color:rgb(0,130,0);background-color:inherit;">//与服务器建立连接</span><span style="border:none;background-color:inherit;">  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">if</span><span style="border:none;background-color:inherit;">(connect(sock_id,(</span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">struct</span><span style="border:none;background-color:inherit;"> sockaddr *)&amp;servaddr,</span><span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">sizeof</span><span style="border:none;background-color:inherit;">(servaddr)) != 0){  </span></span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">        perror(<span class="string" style="border:none;color:#0000FF;background-color:inherit;">"connect() failed"</span><span style="border:none;background-color:inherit;">);  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">        <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">return</span><span style="border:none;background-color:inherit;"> -1;  </span></span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">    }  </span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">  </span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">    <span class="datatypes" style="border:none;color:rgb(46,139,87);font-weight:bold;background-color:inherit;">int</span><span style="border:none;background-color:inherit;"> send_len = send(sock_id,send_buf3,100,0);  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">    <span class="comment" style="border:none;color:rgb(0,130,0);background-color:inherit;">//printf("send_len=%d\n",send_len);</span><span style="border:none;background-color:inherit;">  </span></span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">if</span><span style="border:none;background-color:inherit;">(send_len &lt; 0){  </span></span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">        perror(<span class="string" style="border:none;color:#0000FF;background-color:inherit;">"send() failed"</span><span style="border:none;background-color:inherit;">);  </span></span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">    }  </span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">    printf(<span class="string" style="border:none;color:#0000FF;background-color:inherit;">"send_len=%d\n"</span><span style="border:none;background-color:inherit;">,send_len);  </span></span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">  </span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">    close(sock_id);  </span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">  </span></li><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;color:inherit;line-height:18px;">
<span style="border:none;color:#000000;background-color:inherit;">    <span class="keyword" style="border:none;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">return</span><span style="border:none;background-color:inherit;"> 0;  </span></span></li><li style="border-style:none none none solid;border-left-width:3px;border-left-color:rgb(108,226,108);list-style:outside;line-height:18px;background-color:rgb(248,248,248);">
<span style="border:none;color:#000000;background-color:inherit;">}  </span></li></ol></div>
</li></ol></div>
            </div>
                </div>