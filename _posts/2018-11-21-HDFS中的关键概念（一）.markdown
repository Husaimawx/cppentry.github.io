---
layout:     post
title:      HDFS中的关键概念（一）
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								<div class="article-copyright">
					版权声明：本文为博主原创文章，未经博主允许不得转载。					https://blog.csdn.net/sinat_31726559/article/details/51835476				</div>
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<h2 dir="ltr" align="left"><span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn"><strong>简介</strong></span></span></h2>
<p dir="ltr" style="text-indent:.29in;">HDFS<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">是作为</span></span>hadoop<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">的文件系统组件，是一个高度容错性的系统。</span></span>HDFS<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">能提供高吞吐量的数据访问，非常适合大规模数据集上的应用。</span></span>HDFS<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">放宽了一部分</span></span>POSIX<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">约束，<span lang="zh-cn" xml:lang="zh-cn">来实现流式读取文件系统数据的目的</span>。</span></span>HDFS<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">在最开始是作为</span></span>Apache
 Nutch<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">搜索引擎项目的基础架构而开发的。</span></span>HDFS<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">是</span></span>Apache Hadoop Core<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">项目的一部分。</span></span></p>
<h2 dir="ltr" align="left"><span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn"><strong>数据块（</strong></span></span><strong>block</strong><span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn"><strong>）</strong></span></span></h2>
<p dir="ltr" style="text-indent:.29in;">HDFS<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">中的文件被分割成几个</span></span>block<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">，每个</span></span>block<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">分别存储在多个</span></span>DataNode<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">，一般一个</span></span>block<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">的默认大小为</span></span>128MB<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">，用户也可根据自己的需求自定义。</span></span></p>
<h2 dir="ltr" align="left"><span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn"><strong>元数据结点（</strong></span></span><strong>NameNode)</strong></h2>
<p dir="ltr" style="text-indent:.29in;">NameNode<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">存储系统元数据。</span></span>NameNode<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">中</span></span>inode<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">记录了文件和目录属性，包括权限，修改时间和访问时间，</span></span>namespace<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">和分配的磁盘空间。元数据结点维护了一个</span></span>namespace<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">树<span style="background:#ffffff;">和</span></span></span><span style="background:#ffffff;">block</span><span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn"><span style="background:#ffffff;">到</span></span></span><span style="background:#ffffff;">DataNode<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">（文件数据的物理位置）之间的映射。</span></span></span></p>
<h2 dir="ltr" align="left"><span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn"><strong>数据结点（</strong></span></span><strong>DataNode)</strong></h2>
<p dir="ltr" style="text-indent:.29in;">DataNode<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">主要存储应用数据。为了可靠性和永久性，文件被分割成几个</span></span>block<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">，每个</span></span>block<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">副本存储在多个（<span lang="zh-cn" xml:lang="zh-cn">默认</span>为</span></span>3<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">个）</span></span>DataNode<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">。当终端访问数据时，会选取离自己最近的</span></span>DataNode<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">。在</span></span>DataNode<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">上的</span></span>block<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">副本由两个文件来表示，分别存储数据本身和</span></span>block<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">的元数据（包括对块数据的校验和，</span></span>block<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">生成时间戳）。数据文件的大小与所占用的数据块大小一致，不需要额外空间考虑对齐问题。</span></span></p>
<p dir="ltr" style="text-indent:.29in;"><span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">在启动过程中，每一个数据结点会和数据结点握手，其目的是验证</span></span>namespace ID<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">和数据结点的软件版本。如果不匹配，则数据结点关闭。</span></span></p>
<ul dir="ltr"><li>
<p style="line-height:100%;"><span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">当格式化的时候，就为文件系统指定了</span></span>namespace ID<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">，
 并永久存储在集群的所有结点中。结点的</span></span>namespace ID <span style="font-family:'WenQuanYi Zen Hei Sharp';">
<span lang="zh-cn" xml:lang="zh-cn">和集群的不同，则不能加入到此集群中，由此，保证了文件系统的完整性。</span></span></p>
</li><li>
<p style="line-height:100%;"><span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">检查软件版本防止不兼容的版本造成的数据崩溃或丢失。</span></span></p>
</li></ul><p dir="ltr" style="text-indent:.29in;"><span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">在握手结束后，数据结点注册在元数据结点，并永久存储它的</span></span>storage ID<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">。<span lang="zh-cn" xml:lang="zh-cn">（</span>一个刚初始化的没有分配</span></span>namespace
 ID<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">的数据结点可以加入集群并接受集群的</span></span>namecpace ID<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">。<span lang="zh-cn" xml:lang="zh-cn">）</span></span></span></p>
<p dir="ltr" style="text-indent:.29in;"><span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">数据结点通过发送</span></span>block report
<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">到元数据结点，告知元数据结点它所存储的</span></span>block<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">副本。一旦注册完成，第一份</span></span>block
 report<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">就发送到元数据结点， 然后，后续的报告每隔一小时发送一次，元数据结点就可根据报告定位</span></span>block<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">副本的位置。</span></span></p>
<p dir="ltr" style="text-indent:.29in;"><span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">同时，数据结点会每隔</span></span>3<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">秒<span lang="zh-cn" xml:lang="zh-cn">（用户可根据情况自定义间隔时间，
 如果集群规模比较小，间隔可设置得比较短，利于充分利用集群服务器，而规模比较大时，间隔时间可设置得比较长，从而降低网络负载，同事由于规模比较大，当</span></span></span>NameNode<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn"><span lang="zh-cn" xml:lang="zh-cn">认为</span></span></span>DataNode<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn"><span lang="zh-cn" xml:lang="zh-cn">失效时，有充分的资源可供选择。）</span>发送一个</span></span>heartbeats<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">到元数据结点，保证元数据结点确信数据结点是可用的。如果超过</span></span>10<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">分钟，元数据结点没有收到数据结点的</span></span>heatbeats<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">，则元数据结点认为此数据结点服务中断，元数据结点将创建新的文件副本到其他数据结点。元数据结点并不直接给数据结点发送信息。它通过回复</span></span>heartbeats<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">给数据结点发送指令。这些指令包括：</span></span></p>
<ul dir="ltr"><li>
<p><span style="font-family:'DejaVu Sans';">复制</span>block<span style="font-family:'DejaVu Sans';">到其他的数据结点；</span></p>
</li><li>
<p><span style="font-family:'DejaVu Sans';">删除本地</span>block<span style="font-family:'DejaVu Sans';">副本；</span></p>
</li><li>
<p><span style="font-family:'DejaVu Sans';">重新注册或者关闭数据结；</span></p>
</li><li>
<p><span style="font-family:'DejaVu Sans';">立即发送一个</span>block report<span style="font-family:'DejaVu Sans';">。</span></p>
</li></ul><h2 dir="ltr" align="left"><strong>HDFS</strong><span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn"><span lang="zh-cn" xml:lang="zh-cn"><strong>客户端</strong></span><span lang="zh-cn" xml:lang="zh-cn"><strong>与</strong></span><span lang="zh-cn" xml:lang="zh-cn"><strong>元数据结点</strong></span><span lang="zh-cn" xml:lang="zh-cn"><strong>，</strong></span><span lang="zh-cn" xml:lang="zh-cn"><strong>数据结点之间的交互如图。</strong></span></span></span></h2>
<p dir="ltr" style="text-indent:.29in;"><a href="https://www.ibm.com/developerworks/community/blogs/5144904d-5d75-45ed-9d2b-cf1754ee936a/resource/BLOGS_UPLOADED_IMAGES_2016/HDFS_fig1.gif" rel="nofollow" style="display:block;"><img alt="image" src="https://www.ibm.com/developerworks/community/blogs/5144904d-5d75-45ed-9d2b-cf1754ee936a/resource/BLOGS_UPLOADED_IMAGES_2016/HDFS_fig1.gif" style="display:block;text-align:center;"></a></p>
<h2 dir="ltr" align="left"><span style="font-family:'DejaVu Sans';"><span lang="zh-cn" xml:lang="zh-cn"><strong>总结</strong></span></span></h2>
<p dir="ltr" style="text-indent:.29in;"><span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">简单介绍了</span></span>HDFS<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">的数据块，元数据结点，数据结点，以及</span></span>HDFS<span style="font-family:'WenQuanYi Zen Hei Sharp';"><span lang="zh-cn" xml:lang="zh-cn">客户端如何<span lang="zh-cn" xml:lang="zh-cn">通过</span>元数据结点<span lang="zh-cn" xml:lang="zh-cn">，</span>数据结点<span lang="zh-cn" xml:lang="zh-cn">访问文件</span></span></span></p>
            </div>
                </div>