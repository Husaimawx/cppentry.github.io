---
layout:     post
title:      大数据第三课：Hive的使用
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">首先要学习Hive，第一步是了解Hive，Hive是基于Hadoop的一个数据仓库，可以将结构化的数据文件映射为一张表，并提供类sql查询功能，Hive底层将sql语句转化为mapreduce任务运行。相对于用java代码编写mapreduce来说，Hive的优势明显：快速开发，人员成本低，可扩展性（自由扩展集群规模），延展性（支持自定义函数）。</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">Hive的构架：</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><img src="https://images2017.cnblogs.com/blog/1233200/201710/1233200-20171017205214177-782883965.png" alt="" style="margin-bottom:0px;padding:0px;border:none;max-width:800px;"><p style="margin:10px auto;"> </p></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">Hive提供了三种用户接口：CLI、HWI和客户端。客户端是使用JDBC驱动通过thrift，远程操作Hive。HWI即提供Web界面远程访问Hive。但是最常见的使用方式还是使用CLI方式。（在linux终端操作Hive）</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">Hive有三种安装方式：</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">1、内嵌模式（元数据保村在内嵌的derby种，允许一个会话链接，尝试多个会话链接时会报错，不适合开发环境）</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"> 2、本地模式（本地安装mysql 替代derby存储元数据）</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"> 3、远程模式（远程安装mysql 替代derby存储元数据）</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">安装Hive：（本地模式）</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">首先Hive的安装是在Hadoop集群正常安装的基础上，并且集群启动</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">  安装Hive之前我们要先安装mysql，</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">  查看是否安装过mysql：rpm -qa|grep mysql*  </div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">  查看有没有安装包：yum list mysql* </div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">  安装mysql客户端：yum install -y mysql</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">  安装服务器端：yum install -y mysql-server </div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">                yum install -y mysql-devel</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">  启动数据库 service mysqld start或者/etc/init.d/mysqld start</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">  创建hadoop用户并赋予权限：</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">  mysql&gt;grant all on *.* to hadoop@'%' identified by 'hadoop';</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">  mysql&gt;grant all on *.* to hadoop@'localhost' identified by 'hadoop';</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">  mysql&gt;grant all on *.* to hadoop@'master' identified by 'hadoop';</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">  mysql&gt;flush privileges;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">  然后在Hive官网上下载需要的版本，hive.apache.org  <a href="http://archiv.apache.org/" rel="nofollow" style="margin:0px;padding:0px;color:rgb(0,0,0);text-decoration:underline;">archive.apache.org</a></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">解压：tar -zxvf apache-hive-1.2.1-bin.tar.gz</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">配置：cd /apache-hive-1.2.1-bin/conf/  vim hive-site.xml</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">    &lt;?xml version="1.0"?&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">&lt;configuration&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">    &lt;property&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">        &lt;name&gt;hive.metastore.local&lt;/name&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">        &lt;value&gt;true&lt;/value&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">    &lt;/property&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">    &lt;property&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">        &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">         &lt;value&gt;jdbc:mysql://master:3306/hive?characterEncoding=UTF-8&lt;/value&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">    &lt;/property&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">    &lt;property&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">        &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">        &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">    &lt;/property&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">    &lt;property&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">        &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">        &lt;value&gt;hadoop&lt;/value&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">    &lt;/property&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">    &lt;property&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">        &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">        &lt;value&gt;hadoop&lt;/value&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">    &lt;/property&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">&lt;/configuration&gt;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">复制依赖包：cp mysql-connector-java-5.1.43-bin.jar apache-hive-1.2.1-bin/lib/</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">配置环境变量：</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">export HIVE_HOME=$PWD/apache-hive-1.2.1-bin</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">export PATH=$PATH:$HIVE_HOME/bin</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">启动hive：hive</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">hive中可以运行shell命令:! shell命令</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"> <img src="https://images2017.cnblogs.com/blog/1233200/201710/1233200-20171017205233131-1045638578.png" alt="" style="margin-bottom:0px;padding:0px;border:none;max-width:800px;"><p style="margin:10px auto;"><img src="https://images2017.cnblogs.com/blog/1233200/201710/1233200-20171017205328037-247600045.png" alt="" style="padding:0px;border:none;max-width:800px;"></p><p style="margin:10px auto;"> </p><p style="margin:10px auto;"> </p></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">hive中可以运行hadoop命令：</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><img src="https://images2017.cnblogs.com/blog/1233200/201710/1233200-20171017205341256-973417976.png" alt="" style="margin-bottom:0px;padding:0px;border:none;max-width:800px;"><p style="margin:10px auto;"> </p></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">hive中的数据类型：</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">原子数据类型：TINYINT SMALLINT INT BIGINT FLOAT DOUBLE BOOLEAN STRING </div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">复杂数据类型：STRUCT MAP ARRAY </div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">hive的使用：</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">建表语句：</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;font-size:16px;"><span style="margin:0px;padding:0px;">DDL：</span></span></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">创建内部表：</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">create table mytable(</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">id int, </div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">name string) </div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">row format delimited fields terminated by '\t' stored as textfile;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">常见外部表：关键字 external</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><p style="margin:10px auto;">create external table mytable2(<br style="margin:0px;padding:0px;">id int, <br style="margin:0px;padding:0px;">name string)<br style="margin:0px;padding:0px;">row format delimited fields terminated by '\t' location '/user/hive/warehouse/mytable2';</p></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">创建分区表：分区字段要写在partiton by（）</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><p style="margin:10px auto;">create table mytable3(<br style="margin:0px;padding:0px;">id int, <br style="margin:0px;padding:0px;">name string)<br style="margin:0px;padding:0px;">partitioned by(sex string) row format delimited fields terminated by '\t'stored as textfile;</p><p style="margin:10px auto;">静态分区插入数据</p><p style="margin:10px auto;">load data local inpath '/root/hivedata/boy.txt' overwrite into table mytable3 partition(sex='boy');</p><p style="margin:10px auto;">增加分区：</p><p style="margin:10px auto;">alter table mytable3 add partition (sex='unknown') location '/user/hive/warehouse/mytable3/sex=unknown';</p><p style="margin:10px auto;">删除分区：alter table mytable3 drop if exists partition(sex='unknown');</p><p style="margin:10px auto;">分区表默认为静态分区，可转换为自动套分区</p><p style="margin:10px auto;">set hive.exec.dynamic.partition=true;</p><p style="margin:10px auto;">set hive.exec.dynamic.partition.mode=nonstrict;</p></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">给分区表灌入数据：</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">insert into table mytable3 partition (sex) select id,name,'boy' from student_mdf;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">查询表分区：show partitions mytable3;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">查询分区表数据：select * from mytable3;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">查询表结构：desc mytable3;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;font-size:16px;">DML:</span></span></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">重命名表：alter table student rename to student_mdf</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">增加列：alter table student_mdf add columns (sex string);</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">修改列名：alter table student_mdf change sex gender string;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">替换列结构：alter table student_mdf replace columns (id string, name string);</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">装载数据：（本地数据）load data local inpath '/home/lym/zs.txt' overwrite into student_mdf;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">                   （HDFS数据）load data inpath '/zs.txt' into table student_mdf;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">插入一条数据：insert into table student_mdf values('1','zhangsan');</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">创建表接收查询结果：create table mytable5 as select id, name from mytable3;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">导出数据：（导出到本地）insert overwrite local directory '/root/hivedata/mytable5.txt' select * from mytable5;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">                   （导出到HDFS）</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">insert overwrite directory 'hdfs://master:9000/user/hive/warehouse/mytable5_load' select * from mytable5;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;font-size:16px;"><span style="margin:0px;padding:0px;">数据查询：</span></span></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"> select * from mytable3;  查询全表</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">select uid,uname from student; 查询学生表中的学生姓名与学号字段</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">select  uname,count(*) from student group by uname; 统计学生表中每个名字的个数</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">常用的功能还有 having、order by、sort by、distribute by、cluster by；等等</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">关联查询中有</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">内连接：将符合两边连接条件的数据查询出来</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">select * from t_a a inner join t_b b on a.id=b.id;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">左外连接：以左表数据为匹配标准，右边若匹配不上则数据显示null</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">select * from t_a a left join t_b b on a.id=b.id;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">右外连接：与左外连接相反</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">select * from t_a a right join t_b b on a.id=b.id;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">左半连接：左半连接会返回左边表的记录，前提是其记录对于右边表满足on语句中的判定条件。</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">select * from t_a a left semi join t_b b on a.id=b.id;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">全连接(full outer join)：</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">select * from t_a a full join t_b b on a.id=b.id;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">in/exists关键字(1.2.1之后新特性)：效果等同于left semi join</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">select * from t_a a where a.id in (select id from t_b);</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">select * from t_a a where exists (select * from t_b b where a.id = b.id);</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;font-size:16px;">shell操作Hive指令：</span></span></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;">-e：从命令行执行指定的HQL:</span></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;"><img src="https://images2017.cnblogs.com/blog/1233200/201710/1233200-20171017212953162-438605194.png" alt="" style="margin-bottom:0px;padding:0px;border:none;max-width:800px;"></span><p style="margin:10px auto;"> </p></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;">-f：执行HQL脚本</span></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;">-v：输出执行的HQL语句到控制台</span></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;font-size:16px;"> <img src="https://images2017.cnblogs.com/blog/1233200/201710/1233200-20171017212813537-1403384921.png" alt="" style="margin-bottom:0px;padding:0px;border:none;max-width:800px;"></span></span></span><p style="margin:10px auto;"><span style="margin:0px;padding:0px;font-size:18px;"><span style="margin:0px;padding:0px;"> 内置函数<br style="margin:0px;padding:0px;"></span></span></p></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"> 查看内置函数：show functions;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">显示函数的详细信息：DESC FUNCTION abs;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"> 重要常用内置函数：sum()--求和        count()--求数据量             avg()--求平均值</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;">                                  distinct--去重       min--求最小值               max--求最大值</span></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"> 自定义函数：</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">1.先开发一个简单的Java类，org.apache.hadoop.hive.ql.exec.UDF，重载evaluate方法</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;">import org.apache.hadoop.hive.ql.exec.UDF;</span></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;">public final class AddUdf extends UDF {</span></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;">public Integer evaluate(Integer a, Integer b) {</span></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;">if (null == a || null == b) {</span></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;">return null;</span></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;">} return a + b;</span></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;">}</span></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;">public Double evaluate(Double a, Double b) {</span></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;">if (a == null || b == null)</span></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;">return null;</span></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;">return a + b;}</span></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"></span>}</span></div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"> 2.打成jar包上传到服务器</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"> 3.将jar包添加到hive  add jar /home/lan/jar/addudf.jar;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"> 4.创建临时函数与开发好的class关联起来 </div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);">     CREATE TEMPORARY FUNCTION add_example AS 'org.day0914.AddUdf';</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"> 5.使用自定义函数  SELECT add_example(scores.math, scores.art) FROM scores;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"> 销毁临时函数：DROP TEMPORARY FUNCTION add_example;</div><div style="margin:0px;padding:0px;color:rgb(51,51,51);font-family:Verdana, Arial, Helvetica, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;font-size:18px;"> Hive相关工具：Sqoop Azkaban Flume</span></span></div>            </div>
                </div>