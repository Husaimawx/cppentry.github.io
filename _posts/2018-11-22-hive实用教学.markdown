---
layout:     post
title:      hive实用教学
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<p></p>
<p>话不多说，直接上货：</p>
<p>hive -S :<span style="font-family:'宋体';">进入</span><span style="font-family:Calibri;">hive</span><span style="font-family:'宋体';">的静默模式，只显示查询结果，不显示执行过程；</span></p>
<p>hive -e ‘show tables’ :<span style="font-family:'宋体';">直接在操作系统命令下执行</span><span style="font-family:Calibri;">hive</span><span style="font-family:'宋体';">语句，不需要进入</span><span style="font-family:Calibri;">hive</span><span style="font-family:'宋体';">交互模式；</span></p>
<p>source /root/my.sql; :<span style="font-family:'宋体';">在</span><span style="font-family:Calibri;">hive</span><span style="font-family:'宋体';">模式下使用</span><span style="font-family:Calibri;">source</span><span style="font-family:'宋体';">命令执行</span><span style="font-family:Calibri;">.sql</span><span style="font-family:'宋体';">文件；</span></p>
<p> <img src="https://img-blog.csdn.net/20180126093013353?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>t1:<span style="font-family:'宋体';">创建普通表；</span></p>
<p>t2:<span style="font-family:'宋体';">在</span><span style="font-family:Calibri;">hdfs</span><span style="font-family:'宋体';">中的指定目录创建表；</span></p>
<p>t3:<span style="font-family:'宋体';">创建列分隔符为“</span><span style="font-family:Calibri;">,</span><span style="font-family:'宋体';">”的表；</span></p>
<p>t4:<span style="font-family:'宋体';">使用查询语句创建有数据的表；</span></p>
<p>t5:<span style="font-family:'宋体';">使用查询语句创建列以“</span><span style="font-family:Calibri;">,</span><span style="font-family:'宋体';">”分隔有数据的表；</span></p>
<p> </p>
<p>Hive<span style="font-family:'宋体';">复杂数据类型：</span><span style="font-family:Calibri;">array</span><span style="font-family:'宋体';">、</span><span style="font-family:Calibri;">map</span><span style="font-family:'宋体';">、</span><span style="font-family:Calibri;">struct;</span></p>
<p><img src="https://img-blog.csdn.net/20180126093039695?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p> <img src="https://img-blog.csdn.net/20180126093116997?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p> <span style="color:rgb(255,0,0);font-weight:bold;background-color:rgb(255,255,255);"> Hive</span><span style="color:rgb(255,0,0);background-color:rgb(255,255,255);font-family:'宋体';"><strong>还可以把表或分区，组织成桶。将表或分区组织成桶有以下几个目的：</strong></span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(0,0,0);"><span style="font-family:'宋体';">　　第一个目的是为看取样更高效，因为在处理大规模的数据集时，在开发、测试阶段将所有的数据全部处理一遍可能不太现实，这时取样就必不可少。</span></span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(0,0,0);"><span style="font-family:'宋体';">第二个目的是为了获得更好的查询处理效率。</span></span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(0,0,0);"><span style="font-family:'宋体';">　　桶为了表提供了额外的结构，</span>Hive<span style="font-family:'宋体';">在处理某些查询时利用这个结构，能给有效地提高查询效率。</span></span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(0,0,0);"><span style="font-family:'宋体';">　　桶是通过对</span></span><span style="color:rgb(0,0,255);"><span style="font-family:'宋体';">指定列</span></span><span style="color:rgb(0,0,0);"><span style="font-family:'宋体';">进行哈希计算来实现的，通过哈希值</span></span><strong><span style="color:rgb(0,0,255);"><span style="font-family:'宋体';">将一个列名下的数据切分为一组桶</span></span></strong><span style="color:rgb(0,0,0);"><span style="font-family:'宋体';">，并使</span></span><strong><span style="color:rgb(0,0,255);"><span style="font-family:'宋体';">每个桶对应于该列名下的一个存储文件</span></span></strong><span style="color:rgb(0,0,0);"><span style="font-family:'宋体';">。</span></span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(0,0,0);"><span style="font-family:'宋体';">在建立桶之前，需要设置</span>hive.enforce.bucketing<span style="font-family:'宋体';">属性为</span><span style="font-family:Verdana;">true</span><span style="font-family:'宋体';">，使得</span><span style="font-family:Verdana;">hive</span><span style="font-family:'宋体';">能识别桶</span></span><strong>以性别为例创建分区表：</strong></p>
<p> <img src="https://img-blog.csdn.net/20180126093146966?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>分别导入性别为”M”和”F”<span style="font-family:'宋体';">的</span>“<span style="font-family:Calibri;">sample_data</span><span style="font-family:'宋体';">”表中的数据：</span></p>
<p><img src="https://img-blog.csdn.net/20180126093209283?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""><img src="https://img-blog.csdn.net/20180126093230835?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><strong>创建外部表</strong><span style="font-family:'宋体';">（根据数据库中的对应字段创建外部表，</span>location<span style="font-family:'宋体';">指向</span><span style="font-family:Calibri;">hdfs</span><span style="font-family:'宋体';">的文件地址）：</span></p>
<p> <img src="https://img-blog.csdn.net/20180126093252748?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><span style="color:rgb(0,0,0);"><span style="font-family:'宋体';">导入数据格式为</span>JSON<span style="font-family:'宋体';">的分隔符：</span></span><span style="color:rgb(0,0,0);">ROW FORMAT SERDE</span><span style="color:rgb(0,0,0);"> </span><span style="color:rgb(0,0,255);">'org.apache.hive.hcatalog.data.JsonSerDe'</span></p>
<p> </p>
<h3><strong>创建桶表：</strong></h3>
<p> <img src="https://img-blog.csdn.net/20180126093306744?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<h3><strong><span style="font-family:'宋体';">创建视图</span>view:</strong></h3>
<p> <img src="https://img-blog.csdn.net/20180126093321292?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<h2><strong>Hive<span style="font-family:'黑体';">数据的导入：</span></strong></h2>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">使用</span>LOAD进行数据导入</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">load语句:</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">LOAD DATA [LOCAL] INPATH 'filepath' [OVERWRITE]</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">INTO TABLE tablename [PARTITION (partcoll=va11,partcoll=va12)]</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">//LOCAL表示从本地文件系统中导入数据，省略则表示从HDFS中导入数据</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">//OVERWRITE表示是否需要覆盖表中已存在的数据</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">//</span><span style="color:rgb(20,25,30);">PARTITION</span><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">表示导入分区表，后跟分区条件</span></span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">注意：在导入数据时要注意文件中数据之间的分隔符要与创建表时指定的分隔符相一致，否则数据导入进去显示为</span>null;</span></p>
<p style="background:rgb(255,255,255);"> 要导入的文件内容为：</p>
<p style="background:rgb(255,255,255);"> <img src="https://img-blog.csdn.net/20180126093342017?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p style="background:rgb(255,255,255);">t2表创建时没有指定分隔符，默认分隔符为制表符，而文件里数据是以”,”<span style="font-family:'宋体';">相分割的，因此导入后数据为</span>null，如图：</p>
<p style="background:rgb(255,255,255);"> <img src="https://img-blog.csdn.net/20180126093353599?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p style="background:rgb(255,255,255);">t3表创建时指定分隔符为“，”与文件分隔符一致：</p>
<p style="background:rgb(255,255,255);"> <img src="https://img-blog.csdn.net/20180126093401361?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<h4><strong><span style="font-family:'黑体';">有</span>overwrite<span style="font-family:'黑体';">表示会覆盖原来表中的数据</span></strong></h4>
<h4><img src="https://img-blog.csdn.net/20180126093409372?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></h4>
<p><strong>数据文件导入分区表</strong>：</p>
<p>要导入的文件：</p>
<p> <img src="https://img-blog.csdn.net/20180126093423936?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>导入语句：</p>
<p> <img src="https://img-blog.csdn.net/20180126093437881?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><img src="https://img-blog.csdn.net/20180126093442716?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<h2><strong><span style="font-family:'黑体';">使用</span>Sqoop<span style="font-family:'黑体';">进行数据的导入：</span></strong></h2>
<p>1<span style="font-family:'宋体';">、</span><span style="font-family:'宋体';">列出</span><a href="https://www.baidu.com/s?wd=mysql%E6%95%B0%E6%8D%AE%E5%BA%93&amp;tn=44039180_cpr&amp;fenlei=mv6quAkxTZn0IZRqIHckPjm4nH00T1d9ujnsrAPbmhnLPjRYrAub0ZwV5Hcvrjm3rH6sPfKWUMw85HfYnjn4nH6sgvPsT6KdThsqpZwYTjCEQLGCpyw9Uz4Bmy-bIi4WUvYETgN-TLwGUv3ErjTdPWnzrjfknHnvrjDkPHTz" rel="nofollow">mysql<span style="font-family:'宋体';">数据库</span></a><span style="font-family:'宋体';">中的所有数据库</span>：</p>
<p>sqoop list-databases \</p>
<p>--connect jdbc:mysql://192.168.0.158:3306 \</p>
<p>--username root --password password</p>
<p> </p>
<p>2<span style="font-family:'宋体';">、</span><span style="font-family:'宋体';">连接</span>mysql<span style="font-family:'宋体';">并列出数据库中的表</span>：</p>
<p>sqoop list-tables \</p>
<p>--connect jdbc:mysql://192.168.0.158:3306/testholyrobot \</p>
<p>--username root --password password</p>
<p> </p>
<p>3、<span style="font-family:'宋体';">将关系型数据的表结构复制到</span>hive<span style="font-family:'宋体';">中</span><br>
sqoop create-hive-table \</p>
<p>--connect jdbc:mysql://192.168.0.158:3306/testholyrobot \</p>
<p>--username root --password password \</p>
<p>--table holyrobot_url \</p>
<p>--hive-table holyrobot_url \</p>
<p>--fields-terminated-by "#" \</p>
<p>--lines-terminated-by "\n"</p>
<p><span style="font-family:'宋体';">参数说明：</span><br>
--fields-terminated-by "\0001"  <span style="font-family:'宋体';">是设置每列之间的分隔符，</span><span style="font-family:Calibri;">"\0001"</span><span style="font-family:'宋体';">是</span><span style="font-family:Calibri;">ASCII</span><span style="font-family:'宋体';">码中的</span><span style="font-family:Calibri;">1</span><span style="font-family:'宋体';">，它也是</span><span style="font-family:Calibri;">hive</span><span style="font-family:'宋体';">的默认行内分隔符，
 而</span><span style="font-family:Calibri;">sqoop</span><span style="font-family:'宋体';">的默认行内分隔符为</span><span style="font-family:Calibri;">"</span><span style="font-family:'宋体';">，</span><span style="font-family:Calibri;">"
</span><br>
--lines-terminated-by "\n"  <span style="font-family:'宋体';">设置的是每行之间的分隔符，此处为</span><a href="https://www.baidu.com/s?wd=%E6%8D%A2%E8%A1%8C%E7%AC%A6&amp;tn=44039180_cpr&amp;fenlei=mv6quAkxTZn0IZRqIHckPjm4nH00T1d9ujnsrAPbmhnLPjRYrAub0ZwV5Hcvrjm3rH6sPfKWUMw85HfYnjn4nH6sgvPsT6KdThsqpZwYTjCEQLGCpyw9Uz4Bmy-bIi4WUvYETgN-TLwGUv3ErjTdPWnzrjfknHnvrjDkPHTz" rel="nofollow"><span style="font-family:'宋体';">换行符</span></a><span style="font-family:'宋体';">，也是默认的分隔符；</span><br><span style="font-family:'宋体';">注意：只是复制表的结构，表中的内容没有复制</span></p>
<p> </p>
<p>4、<span style="font-family:'宋体';">将数据从关系数据库导入文件到</span>hive<span style="font-family:'宋体';">表中</span></p>
<p><br>
sqoop import -m 1 \</p>
<p>--hive-import \</p>
<p>--connect jdbc:mysql://192.168.0.158:3306/testholyrobot \</p>
<p>--username root --password password \</p>
<p>--table holyrobot_url \</p>
<p><span style="color:rgb(255,0,0);">--columns 'Url,ParentID,DataSource' \</span></p>
<p><span style="color:rgb(255,0,0);">--hive-table </span><span style="color:rgb(255,0,0);">holyrobot_url</span><span style="color:rgb(255,0,0);"> </span><span style="color:rgb(255,0,0);">\</span></p>
<p>--fields-terminated-by "#"<br><span style="font-family:'宋体';">参数说明：</span></p>
<p>-m 1 <span style="font-family:'宋体';">表示由</span>一<span style="font-family:'宋体';">个</span>map<span style="font-family:'宋体';">作业执行；</span><br>
--fields-terminated-by "\0001"  <span style="font-family:'宋体';">需同创建</span><span style="font-family:Calibri;">hive</span><span style="font-family:'宋体';">表时保持一致</span>；</p>
<p><span style="color:rgb(0,0,0);">--columns</span><span style="color:rgb(0,0,0);"> <span style="font-family:'宋体';">不指定表示导入全部数据；</span></span></p>
<p><span style="color:rgb(0,0,0);">--hive-table</span><span style="color:rgb(0,0,0);"> <span style="font-family:'宋体';">不指定</span>hive<span style="font-family:'宋体';">表名时，会自动创建一个与数据库导入表同名的表；</span></span></p>
<p><span style="color:rgb(0,0,0);"> </span></p>
<p><span style="color:rgb(0,0,0);"> </span>5<span style="font-family:'宋体';">、将数据从关系数据库导入文件到</span>hive<span style="font-family:'宋体';">表中</span>， --where
<span style="font-family:'宋体';">语句使用</span></p>
<p>sqoop import -m 1 --append \</p>
<p>--connect jdbc:mysql://192.168.0.158:3306/testholyrobot \</p>
<p>--username root --password password \</p>
<p>--table holyrobot_url \ </p>
<p>--where ‘id &gt; 3 and (age = 88 or age = 80)’ \</p>
<p>--target-dir /user/hive/warehouse/userinfos2 --fields-terminated-by ",";<br><span style="font-family:'宋体';">注意：</span>--target-dir /user/hive/warehouse/userinfos2   <span style="font-family:'宋体';">可以用  </span><span style="font-family:Calibri;">--hive-import --hive-table userinfos2</span><span style="font-family:'宋体';">进行替换</span></p>
<p><span style="color:rgb(0,0,0);"> </span></p>
<p> 6<span style="font-family:'宋体';">、</span><span style="font-family:'宋体';">将</span>hive<span style="font-family:'宋体';">中的表数据导入到</span><a href="https://www.baidu.com/s?wd=mysql%E6%95%B0%E6%8D%AE%E5%BA%93&amp;tn=44039180_cpr&amp;fenlei=mv6quAkxTZn0IZRqIHckPjm4nH00T1d9ujnsrAPbmhnLPjRYrAub0ZwV5Hcvrjm3rH6sPfKWUMw85HfYnjn4nH6sgvPsT6KdThsqpZwYTjCEQLGCpyw9Uz4Bmy-bIi4WUvYETgN-TLwGUv3ErjTdPWnzrjfknHnvrjDkPHTz" rel="nofollow">mysql<span style="font-family:'宋体';">数据库</span></a><span style="font-family:'宋体';">表中</span></p>
<p>sqoop export \</p>
<p>--connect jdbc:mysql://192.168.0.158:3306/testholyrobot \</p>
<p>--username root --password password \</p>
<p>--table holyrobot_url \ </p>
<p>--export-dir /user/hive/holyrobot_url/part-m-00000 \<br>
--input-fields-terminated-by '\0001'<span style="color:rgb(51,51,51);background:rgb(255,255,255);"><br></span><span style="font-family:'宋体';">注意：</span><br>
1<span style="font-family:'宋体';">、在进行导入之前，</span><span style="font-family:Calibri;">mysql</span><span style="font-family:'宋体';">中的表</span><span style="font-family:Calibri;">userst</span><span style="font-family:'宋体';">必须已经提起创建好了。</span><br>
2<span style="font-family:'宋体';">、</span> jdbc:mysql://192.168.0.158:3306/testholyrobot<span style="font-family:'宋体';">中的</span>IP<span style="font-family:'宋体';">地址改成</span><span style="font-family:Calibri;">localhost</span><span style="font-family:'宋体';">会报异常</span>。</p>
<p> </p>
<p>7<span style="font-family:'宋体';">、</span><span style="font-family:'宋体';">将数据从关系数据库导入文件到</span>hive<span style="font-family:'宋体';">表中，</span><span style="font-family:Calibri;">--query
</span><span style="font-family:'宋体';">语句使用</span><br>
sqoop import -m 1 --append \</p>
<p>--connect jdbc:mysql://192.168.0.158:3306/testholyrobot \</p>
<p>--username root --password password \ </p>
<p>--query "select id,age,name from userinfos where \$CONDITIONS" \</p>
<p>--target-dir /user/hive/warehouse/userinfos2 \</p>
<p>--fields-terminated-by ","</p>
<p><span style="font-family:'宋体';">注意：如果</span>SQL<span style="font-family:'宋体';">语句中使用双引号（</span><span style="font-family:Calibri;">“”</span><span style="font-family:'宋体';">），则必须使用</span><span style="font-family:Calibri;">\$CONDITIONS</span><span style="font-family:'宋体';">代替</span><span style="font-family:Calibri;">$CONDITIONS</span><span style="font-family:'宋体';">，使你的</span><span style="font-family:Calibri;">shell</span><span style="font-family:'宋体';">不将其识别为</span><span style="font-family:Calibri;">shell</span><span style="font-family:'宋体';">自身的变量</span></p>
<p> </p>
<p>8<span style="font-family:'宋体';">、</span><span style="font-family:'宋体';">从</span>mysql<span style="font-family:'宋体';">导入</span><span style="font-family:Calibri;">hdfs:</span></p>
<p>sqoop import -m 1 \</p>
<p>--connect jdbc:mysql://192.168.0.158:3306/testholyrobot \</p>
<p>--username root --password password \</p>
<p>--table holyrobot_url \</p>
<p>--target-dir /hdfs/testdata/url \</p>
<p>--fields-terminated-by '#'    //<span style="font-family:'宋体';">定义字段之间的分隔符</span></p>
<p> </p>
<p>9<span style="font-family:'宋体';">、从</span><span style="font-family:Calibri;">mysql</span><span style="font-family:'宋体';">导入指定列的数据到</span><span style="font-family:Calibri;">hdfs(</span><span style="font-family:'宋体';">使用</span><span style="font-family:Calibri;">columns):</span></p>
<p>sqoop import -m 1 \</p>
<p>&gt; --connect jdbc:mysql://192.168.0.158:3306/testholyrobot \</p>
<p>&gt; --username root --password password \</p>
<p>&gt; --table holyrobot_url \</p>
<p>&gt; --columns 'Url,ParentID,DataSource' \</p>
<p>&gt; --target-dir /hdfs/testdata/url2 \</p>
<p>&gt; --fields-terminated-by '#'</p>
<p> </p>
<p>10<span style="font-family:'宋体';">、</span><span style="font-family:'宋体';">从</span>hdfs<span style="font-family:'宋体';">导入</span><span style="font-family:Calibri;">mysql:</span></p>
<p>sqoop export -m 1 \</p>
<p>--connect jdbc:mysql://192.168.0.158:3306/testholyrobot \</p>
<p>--username root --password password \</p>
<p>--table holyrobot_url \</p>
<p>--export-dir /hdfs/testdata/url/holyrobot_url.txt \</p>
<p>--input-fields-terminated-by '#'   //<span style="font-family:'宋体';">指定文件内容是以“</span><span style="font-family:Calibri;">,</span><span style="font-family:'宋体';">”分割的，“</span><span style="font-family:Calibri;">\t</span><span style="font-family:'宋体';">”是以空格</span></p>
<p> </p>
<h3><strong>Hive<span style="font-family:'宋体';">简单查询和</span><span style="font-family:Calibri;">fetch task</span>：</strong></h3>
<p><span style="color:rgb(255,0,0);"><span style="font-family:'宋体';">查询时可使用</span>explain+HQL<span style="font-family:'宋体';">语句查看执行计划；</span></span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">现在我们打开了一个员工表</span>:</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">查询员工所有信息</span>:</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select * from emp;</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">查询员工信息</span>: 员工号 姓名 月薪</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select empno, ename,sal from emp;</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">查询员工信息</span>:员工号 姓名 月薪 年薪(需要算术表达式)</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select empno,ename,sal,sal*12 from emp;</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">查询员工信息</span>:员工号 姓名 月薪 年薪 奖金 年收入</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">(需要注意的是，若算式中有空值null则计算结果则会是空值，所以我们需要对空值进行处理)</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">这里我们介绍一个函数</span>:nvl(某个可能为空的值, 转变的值)</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select empno,ename,sal,sal*12,comm,sal*12+nvl(comm, 0) from emp;</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"> </span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">查询奖金为</span>null的员工</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select * from emp where comm=null;       //成功执行，但没有显示查询结果</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">(在HQI和SQL语句中,判断一个值是否为null，不能使用 != 或者 =, 因为它永远是不等)</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">所以我们可以使用</span>is来查询:</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select * from emp where comm is null;
</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"> </span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">使用</span>distinct去掉重复记录</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select distinct deptno from emp;</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select distinct deptno,job from emp;     //distinct作用于后面所有的列</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">//如果deptno和job的组合不同，则就被distinct认为是不同的数据</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"> </span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">Fetch Task功能:开启此功能后我们执行一条简单的查询语句(没有排序，没有函数)</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">就不会使用</span>mapreduce作业,而直接使用Fetch Task从HDFS中查询输出语句，这样对于简单的查询，效率会更高</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">fetchtask设置方法:</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">配置好开启后，执行简单查询</span>(无排序，无函数)时，不会生成MapReduce作业，使用FetchTask来直接从HDFS处理</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">1.从hive0.10版本开始支持</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">2.配置方式</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">- set hive.fetch.task.conversion = more （仅当前session下有用）</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">- hive --hiveconf hive.fetch.task.conversion = more  （仅当前session下有用）</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">- 修改hive-site.xml文件</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"> <img src="https://img-blog.csdn.net/20180126093545603?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">在查询中是引用过滤</span></span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">*查询10号部门的员工</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select * from emp where deptno = 10;</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">*查询名叫KING的员工（HIve数据库中严格区分大小写）</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select * from emp where name = 'KING';</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">*查询部门号是10，薪水小于2000的员工</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select * from emp where deptno = 10 and sal &lt; 2000;</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">*查看查询操作的执行计划</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">explain select * from emp where deptno = 10 and sal &lt; 2000;</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">*模糊查询：查询名字以S打头的员工</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select empno, ename, sal from emp where ename like 'S%';</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">*查询名字中有下滑线的员工,使用转移字符串\\</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select empno, ename, sal from emp where ename like '%\\_%';</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">模糊查询</span></span><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">：</span></span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">%：指任意个字符串</span><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">，</span></span><span style="color:rgb(20,25,30);">     </span><span style="color:rgb(20,25,30);">_：指任意一个字符</span></p>
<h4><strong>Hive<span style="font-family:'黑体';">在查询中使用排序：</span></strong></h4>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">HIVE查询中使用排序(会被转变成mapreduce作业,执行)</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">HIVE中的排序默认使用升序排列(从小到大)，也可以使用desc进行降序排列</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">-查询员工信息:员工号 姓名 月薪 按照月薪降序排序</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select empno, ename, sal from emp order by sal desc;</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">//ps: order by 后面可以跟: 列名， 列的表达式， 列的别名， 序号</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">设置排序编号：</span>set hive.groupby.orderby.position.alias=true  //默认为false</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select empno, ename, sal, sal*12 from emp order by 4;</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">如果在排序的时候含有空值</span>null:</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">升序排列时</span>null在最前面</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">降序排列时</span>null在最后面</span></p>
<h4><strong>HIVE<span style="font-family:'黑体';">数学函数</span>：</strong></h4>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">四舍五入</span>:</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select round(45.926, 2), round(45.926, 1), round(45.926, 0)</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">        round(45.926, -1), round(45.926, -2);</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">结果：</span>45.93  45.9  46.0  50.0  0.0</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">//round(某数字, [..., 2, 1, 0, -1, -2, ...])</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">//2表示保留小数点后2位，1表示保留小数点后1位，0表示保留小数点后0位</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">//-1表示保留个位， -2表示保留十位，以此类推</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">向上取整</span>:</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select ceil(45.9);</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">向下取整</span>:</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select floor(45.9);</span></p>
<h4><strong>HIVE<span style="font-family:'黑体';">的数据查询之字符函数</span><span style="font-family:Arial;">:</span></strong></h4>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">字符串转换成小写</span>:lower</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">字符串转换成大写</span>:upper</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select lower('Hello World'), upper('Hello Hive');</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">字符串长度</span>(字符数):length</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select length('Hello World'), length('你好');    //'你好'的字符数为2，字节数为4</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">拼接字符串</span>:concat</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select concat('Hello', ' World');</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">求字符串的子串</span>:substr        </span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">//substr(a, b)从a中第b位开始取，取右边所有字符</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select substr('Hello World', 3);
</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">//substr(a, b, c)   从a中,第b位开始取，取c个字符</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select substr('Hello World', 3, 4);</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">去掉字符串前后的空格</span>:trim</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">左填充</span>:lpad</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">右填充</span>:rpad</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select lpad('abcd', 10, '*');    //表示用*左填充'abcd'到10位</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select rpad('abcd', 10, '*');    //表示用*右填充'abcd'到10位</span></p>
<p style="background:rgb(255,255,255);"><strong><span style="font-family:'宋体';">收集函数</span>:size</strong><span style="color:rgb(20,25,30);">     </span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">//返回Map集合中&lt;key,value&gt;形式的数据的数量大小个数</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select size(map(1, 'Tom', 2, 'Marry'));</span><span style="color:rgb(20,25,30);">    //2</span></p>
<p style="background:rgb(255,255,255);"><strong><span style="font-family:'宋体';">转换函数</span>:cast</strong><span style="color:rgb(20,25,30);">    </span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">//把某个数据类型转换成别的数据类型</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select cast(1 as bigint);</span><span style="color:rgb(20,25,30);">          //1</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select cast(1 as float);</span><span style="color:rgb(20,25,30);">           //1.0</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select cast('2017-11-</span><span style="color:rgb(20,25,30);">0</span><span style="color:rgb(20,25,30);">7' as date);</span><span style="color:rgb(20,25,30);">   //</span><span style="color:rgb(20,25,30);">2017-11-</span><span style="color:rgb(20,25,30);">0</span><span style="color:rgb(20,25,30);">7</span></p>
<h4><strong>HIVE<span style="font-family:'黑体';">中的日期函数</span>：</strong></h4>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">取出一个字符串当中日期的部分</span>:to_date</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select to_date('2017-11-07 20:32:00');</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">取出一个日期中年</span>:year</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">取出一个日期中月</span>:month</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">取出一个日期中日</span>:day</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select year('2017-11-07 20:32:00'),month('2017-11-07 20:32:00'),day('2017-11-07 20:32:00');</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">返回一个日期在一年中是第几个星期</span>:weekofyear</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select weekofyear('2017-11-07 20:32:00');</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">两个日期相减返回他们相差的天数</span>:datediff</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select datediff('2017-11-07 20:32:00', '2017-11-11 20:32:00');</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">在一个日期值上加上多少天</span>:date_add</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select date_add('2017-11-07 20:32:00', 2);</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">在一个日期上减去多少天</span>:date_sub</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select date_sub('2017-11-07 20:32:00', 2);</span></p>
<p style="background:rgb(255,255,255);"> <img src="https://img-blog.csdn.net/20180126093614724?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p style="background:rgb(255,255,255);"><img src="https://img-blog.csdn.net/20180126093619947?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""><br></p>
<h4><strong>HIVE<span style="font-family:'黑体';">条件函数</span>：</strong></h4>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">从左到右返回第一个不为</span>null的值:coalesce</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select comm, sal,coalesce(comm, sal) from emp;</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"> <img src="https://img-blog.csdn.net/20180126093640390?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">条件表达式</span>:case...when...</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">CASE a WHEN b THEN c [WHEN d THEN e]* [ELSE f] END</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">//如果a的值等于b时返回c，如果等于d返回e，等等等等，最后如果都不是返回f</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"> </span><span style="color:rgb(20,25,30);font-family:'微软雅黑';">涨工资</span><span style="color:rgb(20,25,30);">--案例</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">(给员工涨工资，总裁1000, 经理800， 其他400)</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><img src="https://img-blog.csdn.net/20180126093700067?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select ename,job,sal, case job when 'PRESIDENT' then sal+1000 when 'MANAGER' then sal+800 else sal+400 end from emp;</span></p>
<p style="background:rgb(255,255,255);"> <img src="https://img-blog.csdn.net/20180126093716729?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<h4><strong>HIVE<span style="font-family:'黑体';">之聚合函数以及表生成函数</span>：</strong></h4>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">聚合函数</span>:</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">计数</span>:count</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">求和</span>:sum</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">最小值</span>:min</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">最大值</span>:max</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">平均值</span>:avg</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"> </span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select count(*),sum(sal),max(sal),min(sal),avg(sal) from emp;</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">//这里*代表所有列,count(*)表示对记录数进行计数操作</span></p>
<p style="background:rgb(255,255,255);"> <img src="https://img-blog.csdn.net/20180126093731316?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p style="background:rgb(255,255,255);"><img src="https://img-blog.csdn.net/20180126093737336?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""><br></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">表生成函数</span>:</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">explode  //把map集合，或者array中的元素单独生成一个行</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">&gt;select explode(map(1, 'Tom', 2, 'Mary', 3, 'Mike'));</span></p>
<p style="background:rgb(255,255,255);"> <img src="https://img-blog.csdn.net/20180126093753516?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<h4><strong>HIVE<span style="font-family:'黑体';">表连接</span><span style="font-family:Arial;">(</span><span style="font-family:'黑体';">转换成</span><span style="font-family:Arial;">mapreduce</span><span style="font-family:'黑体';">作业</span><span style="font-family:Arial;">,</span><span style="font-family:'黑体';">提交到</span><span style="font-family:Arial;">hadoop</span><span style="font-family:'黑体';">上</span><span style="font-family:Arial;">)</span>：</strong></h4>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">等值连接</span>(连接条件中为等号):</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select e.empno, e.ename, e.sal, d.dname     //选择要查询的字段</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">from emp e, dept d                          //选择表，并取别名</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">where e.deptno=d.deptno;                    //条件是表e的deptno等于表d的deptno</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"> </span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">不等值连接</span>(条件中是不等号:&gt;, &lt;, !=):</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">between and            //含有边界，并且小值在前，大值在后</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select e.empno, e.ename, e.sal, s.grade   //选择要查询的字段</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">from emp e, salgrade s                    //选择表，并取别名</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">where e.sal between 2000 and 8000;        //条件是表e的sal大于等于2000小于等于8000</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"> </span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">外连接</span>:</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">(在select语句中，所有没有包含在聚合函数中的列,都必须要出现在grouop by 子句的后面)</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">#一般的等值连接</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">按部门统计员工人数：部门号，部门名称，人数</span></span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select d.deptno, d.dname, count(e.empno)</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">from emp e, dept d</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">where e.deptno=d.deptno</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">group by d.deptno, d.dname;</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">#外连接(左外连接，右外连接)</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">左外连接</span>(当我们的连接条件不成立时，连接条件的左边的表依然可以包含在结果中)</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">右外连接</span>(当我们的连接条件不成立时，连接条件的右边的表依然可以包含在结果中)</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"> </span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">#右外连接</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select d.deptno, d.dname, count(e.empno)</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">from emp e right outer jion dept d</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">on (e.deptno=d.deptno)</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">group by d.deptno, d.dname;</span></p>
<p style="background:rgb(255,255,255);"> </p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">自连接</span>(自己和自己连接)</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">(自连接的核心:通过表的别名将一张表视为多张表)</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">查询员工的姓名和员工的老板姓名：</span></span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select e.ename, b.ename</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">from emp e, emp b</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">where e.mgr=b.empno;</span></p>
<h4><strong>HIVE<span style="font-family:'黑体';">子查询</span>：</strong></h4>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">hive只支持from和where子查询</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select e.ename from emp e where e.deptno in (select e.deptno from dept d where d.dname='SALES' or d.dname='ACCOUNTING');</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">注意的问题</span>:</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">-语法中的括号</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">-合理的书写风格</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">-hive中只支持WHERE和FEOM子句中的子查询</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">-主查询和子查询可以不是同一张表</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">-子查询的空值问题</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select * from emp e where e.empno not in (select e1.mgr from emp e1);</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">//如果子集合中不含有空值null，则可以使用not in</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">//如果子集合中含有空值，则不可以使用not in,可以使用in</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">#改进</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select * from emp e where e.empno not in (select e1.mgr from emp e1 where e1.mgr is not null);</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"> </span></p>
<h3><strong>Hive<span style="font-family:'宋体';">的</span><span style="font-family:Calibri;">Thrift</span><span style="font-family:'宋体';">操作：</span></strong></h3>
<p><span style="font-family:'宋体';">首先打开</span>hive<span style="font-family:'宋体';">服务：</span><span style="font-family:Calibri;">hive --service hiveserver;</span></p>
<p> <img src="https://img-blog.csdn.net/20180126093812563?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><span style="font-family:'宋体';">查看</span>emp<span style="font-family:'宋体';">表的列信息：</span></p>
<p><img src="https://img-blog.csdn.net/20180126093819156?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p> <img src="https://img-blog.csdn.net/20180126093826146?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p> </p>
<p> </p>
<p> </p>
<h4><strong>HIVE<span style="font-family:'黑体';">的自定义函数</span><span style="font-family:Arial;">(UDF)z;</span></strong></h4>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">可以直接应用于</span>select语句，对查询结果做格式化处理后，再输出结果</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">HIVE自定义函数实现细节:</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">首先，我们要创建一个继承</span>org.apache.hadoop.hive.ql.UDF的JAVA类</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">然后，需要实现</span>evaluate函数，evaluate函数支持重载</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">创建好自定义函数后，我们需要把程序打成</span>jar包，放到linux的hive服务器上</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">并且，进入</span>hive客户端，添加jar包:</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">add jar /root/training/udfjar/udf_test.jar</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">创建临时函数</span>(用来指向JAR包):</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">create temporary function &lt;函数名&gt;</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">as 'JAVA类名';</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">最后</span>,可以在一条select语句中,直接调用自定义函数(会执行相应的mapreduce程序,调用我们的java类,完成特定的功能);</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">select &lt;函数名&gt; from table;</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);"><span style="font-family:'微软雅黑';">销毁临时函数</span>:</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">drop temporary function &lt;函数名&gt;;</span></p>
<p style="background:rgb(255,255,255);"> <span style="font-weight:bold;font-size:24px;">Hive</span><span style="font-size:24px;font-family:'黑体';"><strong>的自定义函数：</strong></span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">1.数据类型必须使用Hadoop的MapReduce可以识别的Text类型，而不是String</span></p>
<p style="background:rgb(255,255,255);"><span style="color:rgb(20,25,30);">2.MyEclipse中打jar包，export--&gt;jar file ---&gt;</span></p>
<p><img src="https://img-blog.csdn.net/20180126093904707?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p style="background:rgb(255,255,255);"> <img src="https://img-blog.csdn.net/20180126093932602?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p style="background:rgb(255,255,255);"> <img src="https://img-blog.csdn.net/20180126093943936?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p style="background:rgb(255,255,255);"> <img src="https://img-blog.csdn.net/20180126093954456?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><span style="font-family:'宋体';">上传</span>jar<span style="font-family:'宋体';">包至</span><span style="font-family:Calibri;">linux:</span></p>
<p> <img src="https://img-blog.csdn.net/20180126094009913?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><span style="font-family:'宋体';">在</span>hive<span style="font-family:'宋体';">中添加这个</span><span style="font-family:Calibri;">jar</span><span style="font-family:'宋体';">文件：</span></p>
<p> <img src="https://img-blog.csdn.net/20180126094016067?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><span style="font-family:'宋体';">创建自定义函数</span>myconcat<span style="font-family:'宋体';">：</span></p>
<p> <img src="https://img-blog.csdn.net/20180126094020360?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><span style="font-family:'宋体';">运行</span>myconcat:</p>
<p> <img src="https://img-blog.csdn.net/20180126094024212?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfNDA3ODQ3ODM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
            </div>
                </div>