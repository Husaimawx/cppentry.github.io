---
layout:     post
title:      Hadoop Hive 搭建
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								<div class="article-copyright">
					版权声明：本文为博主原创文章，未经博主允许不得转载。					https://blog.csdn.net/qq_24505127/article/details/80430674				</div>
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <div><span style="font-size:16pt;"><strong>Hadoop Hive 搭建</strong></span></div><div><br></div><div><span style="font-size:12pt;"><strong>一、说明</strong></span></div><div><div><br></div><table style="width:543px;"><colgroup><col style="width:543px;"></colgroup><tbody><tr><td style="background-color:rgb(205,238,240);border-color:rgb(164,190,192);"><div><span style="font-size:10pt;">Hive底层的执行引擎有：MapReduce、Tez、Spark</span></div><div><span style="font-size:10pt;">    Hive on MapReduce</span></div><div><span style="font-size:10pt;">    Hive on Tez</span></div><div><span style="font-size:10pt;">    Hive on Spark</span></div><div><br></div><div><span style="font-size:10pt;">压缩：GZIP、LZO、Snappy、BZIP2..</span></div><div><span style="font-size:10pt;">存储：TextFile、SequenceFile、RCFile、ORC、Parquet</span></div><div><span style="font-size:10pt;">UDF：自定义函数</span></div></td></tr></tbody></table><div><br></div></div><div><br></div><div><span style="font-size:12pt;"><strong>二、Hive环境搭建</strong></span></div><div><span style="font-size:12pt;"><strong>  </strong></span></div><div><span style="font-size:12pt;"><strong>  注意事项：</strong></span></div><div><div style="font-size:12pt;"><br style="font-weight:bold;font-size:12pt;"></div><div><span style="font-size:10pt;">        1、首先Hadoop 需要先搭建起来已经启动。参考:</span><a href="http://blog.csdn.net/qq_24505127/article/details/80397604" rel="nofollow"> <span style="color:#69aa35;"><span style="font-size:10pt;">Hadoop HDFS环境搭建</span></span></a>、 <span style="color:#69aa35;"><a href="http://blog.csdn.net/qq_24505127/article/details/80397604" rel="nofollow">Hadoop YARN 搭建</a></span></div><div>        2、事先已经安装好Mysql，并默认创建了<span style="font-size:9pt;"><strong>sparksql 表</strong></span></div><div><span style="font-size:10pt;">        3、假如Hive  安装目录为<span style="font-size:10pt;">/www/instl/hive/hive-1.1.0-cdh5.7.0</span></span></div><div>        4、以上说明假设已经全部符合条件</div><div><br></div><div><span style="font-size:12pt;"> </span> <span style="font-size:12pt;"><strong>步骤：</strong></span></div></div><div><span style="font-size:12pt;"><span style="font-size:10pt;"><strong>【1】Hive下载并解压到<span style="font-size:10pt;">/www/instl/hive</span></strong></span></span></div><div><span style="font-size:12pt;"><span style="font-size:10pt;"><span style="font-size:10pt;"><strong> </strong></span>   地址：</span><a href="http://archive.cloudera.com/cdh5/cdh/5/" rel="nofollow" style="font-size:10pt;">http://archive.cloudera.com/cdh5/cdh/5/</a>   </span><span style="font-size:10pt;">版本：</span><a href="http://archive.cloudera.com/cdh5/cdh/5/hive-1.1.0-cdh5.7.0.tar.gz" rel="nofollow" style="font-size:10pt;color:rgb(0,0,238);">hive-1.1.0-cdh5.7.0.tar.gz</a></div><div><div><br></div><table style="width:817px;"><colgroup><col style="width:817px;"></colgroup><tbody><tr><td style="background-color:rgb(63,63,63);border-color:rgb(50,50,50);"><div><span style="font-size:10pt;color:rgb(255,255,255);"><span style="font-size:10pt;font-family:'微软雅黑';"><strong>[root@dnsdomainname /]# </strong></span>wget</span><span style="font-size:12pt;color:rgb(255,255,255);"> </span><a href="http://archive.cloudera.com/cdh5/cdh/5/hive-1.1.0-cdh5.7.0.tar.gz" rel="nofollow" style="font-size:10pt;color:#FFFFFF;">http://archive.cloudera.com/cdh5/cdh/5/hive-1.1.0-cdh5.7.0.tar.gz</a></div><div><span style="font-size:10pt;"><span style="font-size:10pt;color:rgb(255,255,255);font-family:'微软雅黑';"><strong>[root@dnsdomainname /]# </strong></span></span><span style="font-size:10pt;color:rgb(255,255,255);">tar -zxvf hive-1.1.0-cdh5.7.0.tar.gz -C </span><span style="font-size:10pt;color:rgb(255,255,255);">/www/instl/hive</span></div></td></tr></tbody></table><div><br></div></div><div><span style="font-size:10pt;"><strong>【2】配置</strong></span><span style="font-size:10pt;"><strong>环境变量（<span style="font-size:10pt;">/etc/profile)中</span></strong></span></div><div><div><br></div><table style="width:667px;"><colgroup><col style="width:667px;"></colgroup><tbody><tr><td style="background-color:rgb(205,237,216);border-color:rgb(164,190,173);"><div><span style="font-size:9pt;">export HIVE_HOME=/www/instl/hive/hive-1.1.0-cdh5.7.0</span></div><div><span style="font-size:9pt;">export PATH=$HIVE_HOME/bin:$PATH</span></div></td></tr></tbody></table><div><span style="font-size:10pt;"><span style="font-size:10pt;"><strong>    </strong></span>生效   source /etc/profile</span></div></div><div><div><br></div><div><span style="font-size:10pt;"><strong>【3】进行hive文件的配置</strong></span></div><div><span style="font-size:10pt;">    </span></div><div><span style="font-size:10pt;">在/www/instl/hive/hive-1.1.0-cdh5.7.0/conf下修改 hive-env.xml</span></div><div><div><br></div><table style="width:924px;"><colgroup><col style="width:924px;"></colgroup><tbody><tr><td style="background-color:rgb(205,237,216);border-color:rgb(164,190,173);"><span style="font-size:9pt;"><strong>HADOOP_HOME=/www/instl/hadoop/hadoop-2.6.0-cdh5.7.0/</strong></span></td></tr></tbody></table><div><br></div></div></div><div><span style="font-size:10pt;"><strong> </strong></span><span style="font-size:10pt;"> 在/www/instl/hive/hive-1.1.0-cdh5.7.0/conf下创建 hive-site.xml</span></div><div><div style="font-size:12pt;"><div><br></div><table style="width:787px;"><colgroup><col style="width:787px;"></colgroup><tbody><tr><td style="background-color:rgb(205,237,216);border-color:rgb(164,190,173);"><div><span style="font-size:9pt;">&lt;configuration&gt;</span></div><div><span style="font-size:9pt;">    &lt;property&gt;</span></div><div><span style="font-size:9pt;">          &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;</span></div><div><span style="font-size:9pt;">        &lt;value&gt;jdbc:</span><a style="font-size:9pt;">mysql://</a><a style="font-size:9pt;">hadoop000</a><span style="font-size:9pt;">:</span><span style="font-size:9pt;">3306/sparksql?createDatabaseIfNotExist=true</span><span style="font-size:9pt;">&lt;/value&gt;</span></div><div><span style="font-size:9pt;">    &lt;/property&gt;</span></div><div><span style="font-size:9pt;">    &lt;property&gt;</span></div><div><span style="font-size:9pt;">        &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;</span></div><div><span style="font-size:9pt;">        &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;</span></div><div><span style="font-size:9pt;">       &lt;/property&gt;</span></div><div><span style="font-size:9pt;">    &lt;property&gt;</span></div><div><span style="font-size:9pt;">          &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;</span></div><div><span style="font-size:9pt;">        &lt;value&gt;root&lt;/value&gt;</span></div><div><span style="font-size:9pt;">    &lt;/property&gt;</span></div><div><span style="font-size:9pt;">    &lt;property&gt;</span></div><div><span style="font-size:9pt;">          &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;</span></div><div><span style="font-size:9pt;">          &lt;value&gt;hge123!@#&lt;/value&gt;</span></div><div><span style="font-size:9pt;">    &lt;/property&gt;</span></div><div><span style="font-size:9pt;">&lt;/configuration&gt;</span></div></td></tr></tbody></table><div><span style="font-size:10pt;"><strong>【4】拷贝mysql驱动包mysql-connector-java-5.1.42-bin.jar到$HIVE_HOME/lib/</strong></span></div></div></div><div><div style="font-size:12pt;"><div><br></div><div><span style="font-size:10pt;"><strong>【5】启动hive: </strong></span><span style="font-size:10pt;"><strong>（</strong></span> <span style="font-size:14px;background-color:rgb(255,255,255);font-family:'Helvetica Neue', Helvetica, Verdana, Arial, sans-serif;"><strong> </strong></span><span style="font-size:14px;font-family:'Helvetica Neue', Helvetica, Verdana, Arial, sans-serif;"><strong>运行hive之前首先要确保meta store服务（sql服务）已经启动</strong></span><span style="font-size:10pt;"><strong>）</strong></span></div></div></div><div><span style="font-size:10pt;"><strong>     $HIVE_HOME/bin/hive 或者hive -S 。</strong></span></div><div><br></div><div><span style="font-size:10pt;"><strong>【6】测试</strong></span></div><div><div><br></div><div>   （1）<span style="font-size:10pt;">创建表</span></div><div><div><br></div><table style="width:556px;"><colgroup><col style="width:556px;"></colgroup><tbody><tr><td style="background-color:rgb(205,237,216);border-color:rgb(164,190,173);"><span style="font-size:10pt;">create table hive_wordcount(context string);</span></td></tr></tbody></table><div><br></div></div><div>此时   <span style="font-size:10pt;">hive_wordcount 的元数据储存在Mysql 当中</span></div><div><br></div><div>（2）<span style="font-size:10pt;">加载数据到 <span style="font-size:9pt;">sparksql 库中</span></span></div><div><div><br></div><table style="width:571px;"><colgroup><col style="width:571px;"></colgroup><tbody><tr><td style="background-color:rgb(205,237,216);border-color:rgb(164,190,173);"><span style="font-size:10pt;">load data local inpath '/home/hadoop/data/hello.txt' into table hive_wordcount;</span></td></tr></tbody></table><div>  此时，hive 数据默认储存在HDFS 上的/user/hive/warehouse/hive_wordcount1 中</div></div><div><br></div><div>（3）查询</div><table style="width:1015px;"><colgroup><col style="width:1015px;"></colgroup><tbody><tr><td style="background-color:rgb(205,237,216);border-color:rgb(164,190,173);"><div><br></div><div><span style="font-size:10pt;">select word, count(1) from hive_wordcount lateral view explode(split(context,'\t')) wc as word group by word;</span></div><div><br></div><div><span style="font-size:10pt;">lateral view explode(): 是把每行记录按照指定分隔符进行拆解</span></div><div><br></div><div><span style="font-size:10pt;">hive ql提交执行以后会生成mr作业，并在yarn上运行</span></div><div><br></div></td></tr></tbody></table><div><br></div></div><div>（4）其他例子</div><div><div><br></div><table style="width:744px;"><colgroup><col style="width:744px;"></colgroup><tbody><tr><td style="background-color:rgb(205,237,216);border-color:rgb(164,190,173);"><div><span style="font-size:10pt;">create table emp(</span></div><div><span style="font-size:10pt;">empno int,</span></div><div><span style="font-size:10pt;">ename string,</span></div><div><span style="font-size:10pt;">job string,</span></div><div><span style="font-size:10pt;">mgr int,</span></div><div><span style="font-size:10pt;">hiredate string,</span></div><div><span style="font-size:10pt;">sal double,</span></div><div><span style="font-size:10pt;">comm double,</span></div><div><span style="font-size:10pt;">deptno int</span></div><div><span style="font-size:10pt;">) ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t';</span></div><div><br></div><div><span style="font-size:10pt;">create table dept(</span></div><div><span style="font-size:10pt;">deptno int,</span></div><div><span style="font-size:10pt;">dname string,</span></div><div><span style="font-size:10pt;">location string</span></div><div><span style="font-size:10pt;">) ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t';</span></div><div><br></div><div><span style="font-size:10pt;">load data local inpath '/home/hadoop/data/emp.txt' into table emp;</span></div><div><span style="font-size:10pt;">load data local inpath '/home/hadoop/data/dept.txt' into table dept;</span></div><div><br></div><div><span style="font-size:10pt;">求每个部门的人数</span></div><div><span style="font-size:10pt;">select deptno, count(1) from emp group by deptno;</span></div></td></tr></tbody></table><div><br></div><div><span style="font-size:10pt;">执行hive --service hwi  命令可在 http://140.143.236.169:9999/ 中查看Web UI</span></div><div><br></div><div><span style="font-size:12pt;"><span style="font-size:12pt;"><strong>三、Hive 远程服务</strong></span></span></div><div><br></div><div><span style="font-size:12pt;">   该服务就如mysql 中，启动mysql的服务，只有启动了这个服务，远程客户端才能连接到Hive 数据库操作数据。启动方式：</span></div><div style="padding:8px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(51,51,51);background-color:rgb(251,250,248);border:1px solid rgba(0,0,0,.14902);"><span style="font-size:12pt;">hive --service hiveserver</span></div><div><br></div><div><br></div><div><br></div><div><span style="font-size:12pt;"><strong>四、</strong></span> <span style="font-size:12pt;color:rgb(51,51,51);font-family:'Microsoft Yahei';"><strong>Hive的数据存储</strong></span></div></div><div><br></div><div style="padding:0px 0px 15px;margin:0px;background-color:rgb(255,255,255);"><span><span style="font-size:10pt;color:rgb(51,51,51);font-family:'Microsoft Yahei';line-height:30px;">Hive的数据分为表数据和元数据，表数据是Hive中表格(table)具有的数据;而元数据是用来存储表的名字，表的列和分区及其属性，表的属性(是否为外部表等)，表的数据所在目录等。下面分别来介绍。</span></span></div><div style="padding:0px 0px 15px;margin:0px;background-color:rgb(255,255,255);"><span><span style="font-size:10pt;color:rgb(51,51,51);font-family:'Microsoft Yahei';line-height:30px;">1、Hive的数据存储</span></span></div><div style="padding:0px 0px 15px;margin:0px;background-color:rgb(255,255,255);"><span><span style="font-size:10pt;color:rgb(51,51,51);font-family:'Microsoft Yahei';line-height:30px;">在让你真正明白什么是hive 博文中我们提到Hive是基于Hadoop分布式文件系统的，它的数据存储在Hadoop分布式文件系统中。Hive本身是没有专门的数据存储格式，也没有为数据建立索引，只需要在创建表的时候告诉Hive数据中的列分隔符和行分隔符，Hive就可以解析数据。所以往Hive表里面导入数据只是简单的将数据移动到表所在的目录中(如果数据是在HDFS上;但如果数据是在本地文件系统中，那么是将数据复制到表所在的目录中)。</span></span></div><div style="padding:0px 0px 15px;margin:0px;background-color:rgb(255,255,255);"><span><span style="font-size:10pt;color:rgb(51,51,51);font-family:'Microsoft Yahei';line-height:30px;">Hive中主要包含以下几种数据模型：Table(表)，External Table(外部表)，Partition(分区)，Bucket(桶)(本博客会专门写几篇博文来介绍分区和桶)。</span></span></div><div style="padding:0px 0px 15px;margin:0px;background-color:rgb(255,255,255);"><span style="font-size:10pt;"><span style="font-size:10pt;color:rgb(51,51,51);font-family:'Microsoft Yahei';line-height:30px;">【1】内部表：</span><span style="font-size:10pt;color:rgb(51,51,51);font-family:'Microsoft Yahei';line-height:30px;">Hive中的表和关系型数据库中的表在概念上很类似，每个表在HDFS中都有相应的目录用来存储表的数据，这个目录可以通过${HIVE_HOME}/conf/hive-site.xml配置文件中的 hive.metastore.warehouse.dir属性来配置，这个属性默认的值是/user/hive/warehouse(这个目录在 HDFS上)，我们可以根据实际的情况来修改这个配置。如果我有一个表wyp，那么在HDFS中会创建/user/hive/warehouse/wyp 目录(这里假定hive.metastore.warehouse.dir配置为/user/hive/warehouse);wyp表所有的数据都存放在这个目录中。这个例外是外部表。</span></span></div><div style="padding:0px 0px 15px;margin:0px;background-color:rgb(255,255,255);"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:15px;text-indent:21.25pt;background-color:rgb(250,247,239);color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">内部表简单示例：</span></span></span></div><div style="margin:0cm 0cm 0pt;padding:0px;font-size:13px;text-indent:21.25pt;background-color:rgb(250,247,239);"><span style="font-size:15px;text-indent:21.25pt;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">创建数据文件：</span><span style="font-size:15px;text-indent:21.25pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>test_inner_table.txt</em></span></div><div style="margin:0cm 0cm 0pt;padding:0px;font-size:13px;text-indent:21.25pt;background-color:rgb(250,247,239);"><span style="font-size:15px;text-indent:21.25pt;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">创建表：</span><span style="font-size:15px;text-indent:21.25pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>create table test_inner_table (key string);</em></span></div><div style="margin:0cm 0cm 0pt;padding:0px;font-size:13px;text-indent:21.25pt;background-color:rgb(250,247,239);"><span style="font-size:15px;text-indent:21.25pt;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">加载数据：</span><span style="font-size:15px;text-indent:21.25pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>LOAD DATA LOCAL INPATH 'filepath' INTO TABLE test_inner_table;</em></span></div><div style="margin:0cm 0cm 0pt;padding:0px;font-size:13px;text-indent:21.25pt;background-color:rgb(250,247,239);"><span style="font-size:15px;text-indent:21.25pt;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">查看数据：</span><span style="font-size:15px;text-indent:21.25pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>select * from test_inner_table;</em></span></div><div style="padding:0px 0px 15px;margin:0px;background-color:rgb(255,255,255);"><span style="font-size:15px;text-indent:21.25pt;background-color:rgb(250,247,239);color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">删除表：</span><span style="font-size:15px;text-indent:21.25pt;background-color:rgb(250,247,239);color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>drop table test_inner_table;</em></span></div><div style="padding:0px 0px 15px;margin:0px;background-color:rgb(255,255,255);"><span style="font-size:10pt;"><span style="font-size:10pt;color:rgb(51,51,51);font-family:'Microsoft Yahei';line-height:30px;">【2】外部表：</span><span style="font-size:10pt;color:rgb(51,51,51);font-family:'Microsoft Yahei';line-height:30px;">Hive中的外部表和表很类似，但是其数据不是放在自己表所属的目录中，而是存放到别处，这样的好处是如果你要删除这个外部表，该外部表所指向的数据是不会被删除的，它只会删除外部表对应的元数据;而如果你要删除表，该表对应的所有数据包括元数据都会被删除。</span></span></div><div style="padding:0px 0px 15px;margin:0px;background-color:rgb(255,255,255);"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:15px;text-indent:21.25pt;background-color:rgb(250,247,239);color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">外部表简单示例：</span></span></span></div><div style="margin:0cm 0cm 0pt;padding:0px;font-size:13px;text-indent:21.25pt;background-color:rgb(250,247,239);"><span style="font-size:15px;text-indent:21.25pt;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">创建数据文件：</span><span style="font-size:15px;text-indent:21.25pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>test_external_table.txt</em></span></div><div style="margin:0cm 0cm 0pt;padding:0px;font-size:13px;text-indent:21.25pt;background-color:rgb(250,247,239);"><span style="font-size:15px;text-indent:21.25pt;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">创建表：</span><span style="font-size:15px;text-indent:21.25pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>create external table test_external_table (key string);</em></span></div><div style="margin:0cm 0cm 0pt;padding:0px;font-size:13px;text-indent:21.25pt;background-color:rgb(250,247,239);"><span style="font-size:15px;text-indent:21.25pt;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">加载数据：</span><span style="font-size:15px;text-indent:21.25pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>LOAD DATA INPATH</em></span><span style="font-size:15px;text-indent:21.25pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em> </em></span><span style="font-size:15px;text-indent:21.25pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>‘</em></span><span style="font-size:15px;text-indent:21.25pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>filepath</em></span><span style="font-size:15px;text-indent:21.25pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>’</em></span><span style="font-size:15px;text-indent:21.25pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em> </em></span><span style="font-size:15px;text-indent:21.25pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>INTO TABLE test_inner_table;</em></span></div><div style="margin:0cm 0cm 0pt;padding:0px;font-size:13px;text-indent:21.25pt;background-color:rgb(250,247,239);"><span style="font-size:15px;text-indent:21.25pt;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">查看数据：</span><span style="font-size:15px;text-indent:21.25pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>select * from test_external_table;</em></span></div><div style="padding:0px 0px 15px;margin:0px;background-color:rgb(255,255,255);"><span style="font-size:15px;text-indent:21.25pt;background-color:rgb(250,247,239);color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">删除表：</span><span style="font-size:15px;text-indent:21.25pt;background-color:rgb(250,247,239);color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>drop table test_external_table;</em></span></div><div style="padding:0px 0px 15px;margin:0px;background-color:rgb(255,255,255);"><span style="font-size:10pt;"><span style="font-size:10pt;color:rgb(51,51,51);font-family:'Microsoft Yahei';line-height:30px;">【3】分区：</span><span style="font-size:10pt;color:rgb(51,51,51);font-family:'Microsoft Yahei';line-height:30px;">在Hive中，表的每一个分区对应表下的相应目录，所有分区的数据都是存储在对应的目录中。比如wyp 表有dt和city两个分区，则对应dt=20131218,city=BJ对应表的目录为/user/hive/warehouse /dt=20131218/city=BJ，所有属于这个分区的数据都存放在这个目录中。</span></span></div><div style="padding:0px 0px 15px;margin:0px;background-color:rgb(255,255,255);"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:15px;text-indent:21.25pt;background-color:rgb(250,247,239);color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">分区表简单示例：</span></span></span></div><div style="margin:0cm 0cm 0pt;padding:0px;font-size:13px;text-indent:21.25pt;background-color:rgb(250,247,239);"><span style="font-size:15px;text-indent:21.25pt;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">创建数据文件：</span><span style="font-size:15px;text-indent:21.25pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>test_partition_table.txt</em></span></div><div style="margin:0cm 0cm 0pt;padding:0px;font-size:13px;text-indent:21.25pt;background-color:rgb(250,247,239);"><span style="font-size:15px;text-indent:21.25pt;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">创建表：</span><span style="font-size:15px;text-indent:21.25pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>create table test_partition_table (key string) partitioned by (dt string);</em></span></div><div style="margin:0cm 0cm 0pt 77.85pt;padding:0px;font-size:13px;text-indent:-56.65pt;background-color:rgb(250,247,239);"><span style="font-size:15px;text-indent:-56.65pt;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">加载数据：</span><span style="font-size:15px;text-indent:-56.65pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>LOAD DATA INPATH</em></span><span style="font-size:15px;text-indent:-56.65pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em> </em></span><span style="font-size:15px;text-indent:-56.65pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>‘</em></span><span style="font-size:15px;text-indent:-56.65pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>filepath</em></span><span style="font-size:15px;text-indent:-56.65pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>’</em></span><span style="font-size:15px;text-indent:-56.65pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em> </em></span><span style="font-size:15px;text-indent:-56.65pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>INTO TABLE test_partition_table partition (dt=</em></span><span style="font-size:15px;text-indent:-56.65pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>‘</em></span><span style="font-size:15px;text-indent:-56.65pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>2006</em></span><span style="font-size:15px;text-indent:-56.65pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>’</em></span><span style="font-size:15px;text-indent:-56.65pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>);</em></span></div><div style="margin:0cm 0cm 0pt;padding:0px;font-size:13px;text-indent:21.25pt;background-color:rgb(250,247,239);"><span style="font-size:15px;text-indent:21.25pt;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">查看数据：</span><span style="font-size:15px;text-indent:21.25pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>select * from test_partition_table;</em></span></div><div style="padding:0px 0px 15px;margin:0px;background-color:rgb(255,255,255);"><span style="font-size:15px;text-indent:21.25pt;background-color:rgb(250,247,239);color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">删除表：</span><span style="font-size:15px;text-indent:21.25pt;background-color:rgb(250,247,239);color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>drop table test_partition_table;</em></span></div><div style="padding:0px 0px 15px;margin:0px;background-color:rgb(255,255,255);"><span style="font-size:10pt;"><span style="font-size:10pt;color:rgb(51,51,51);font-family:'Microsoft Yahei';line-height:30px;">【4】桶：</span><span style="font-size:10pt;color:rgb(51,51,51);font-family:'Microsoft Yahei';line-height:30px;">对指定的列计算其hash，根据hash值切分数据，目的是为了并行，每一个桶对应一个文件(注意和分区的区别)。比如将wyp表id列分散至16个桶中，首先对id列的值计算hash，对应hash值为0和16的数据存储的HDFS目录为：/user /hive/warehouse/wyp/part-00000;而hash值为2的数据存储的HDFS 目录为：/user/hive/warehouse/wyp/part-00002。</span></span></div><div style="padding:0px 0px 15px;margin:0px;background-color:rgb(255,255,255);"><span style="font-size:10pt;"><span style="font-size:10pt;"><span style="font-size:15px;background-color:rgb(250,247,239);color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">桶的简单示例：</span></span></span></div><div style="margin:0cm 0cm 0pt;padding:0px;font-size:13px;background-color:rgb(250,247,239);"><span style="font-size:15px;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">   </span><span style="font-size:15px;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;"> </span><span style="font-size:15px;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">创建数据文件：</span><span style="font-size:15px;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>test_bucket_table.txt</em></span></div><div style="margin:0cm 0cm 0pt 70.65pt;padding:0px;font-size:13px;text-indent:-49.45pt;background-color:rgb(250,247,239);"><span style="font-size:15px;text-indent:-49.45pt;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">创建表：</span><span style="font-size:15px;text-indent:-49.45pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>create table test_bucket_table (key string) clustered by (key) into 20 buckets</em></span><span style="font-size:15px;text-indent:-49.45pt;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>；</em></span></div><div style="margin:0cm 0cm 0pt;padding:0px;font-size:13px;background-color:rgb(250,247,239);"><span style="font-size:15px;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">   </span><span style="font-size:15px;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;"> </span><span style="font-size:15px;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">加载数据：</span><span style="font-size:15px;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>LOAD DATA INPATH</em></span><span style="font-size:15px;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em> </em></span><span style="font-size:15px;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>‘</em></span><span style="font-size:15px;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>filepath</em></span><span style="font-size:15px;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>’</em></span><span style="font-size:15px;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em> </em></span><span style="font-size:15px;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>INTO TABLE test_bucket_table</em></span><span style="font-size:15px;color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>；</em></span></div><div style="padding:0px 0px 15px;margin:0px;background-color:rgb(255,255,255);"><span style="font-size:15px;background-color:rgb(250,247,239);color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">   </span><span style="font-size:15px;background-color:rgb(250,247,239);color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;"> </span><span style="font-size:15px;background-color:rgb(250,247,239);color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">查看数据：</span><span style="font-size:15px;background-color:rgb(250,247,239);color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>select * from test_bucket_table;</em></span><span style="font-size:15px;background-color:rgb(250,247,239);color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em> </em></span><span style="font-size:15px;background-color:rgb(250,247,239);color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em> </em></span><span style="font-size:15px;background-color:rgb(250,247,239);color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>set hive.enforce.bucketing = true;</em></span></div><div style="padding:0px 0px 15px;margin:0px;background-color:rgb(255,255,255);"><span><span style="font-size:10pt;"><span style="font-size:15px;text-indent:-42.25pt;background-color:rgb(250,247,239);color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;"><strong> </strong></span><span style="font-size:15px;text-indent:-42.25pt;background-color:rgb(250,247,239);color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;"><strong> </strong></span><span style="font-size:15px;text-indent:-42.25pt;background-color:rgb(250,247,239);color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">【5】</span><span style="font-size:15px;text-indent:-42.25pt;background-color:rgb(250,247,239);color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">Hive的视图</span></span></span></div><div style="margin:0cm 0cm 0pt;padding:0px;text-indent:21.25pt;background-color:rgb(250,247,239);"><span style="font-size:10pt;"><span style="text-indent:21.25pt;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;font-size:10pt;">视图与传统数据库的视图类似。视图是只读的，它基于的基本表，如果改变，数据增加不会影响视图的呈现；如果删除，会出现问题。如果不指定视图的列，会根据</span><span style="text-indent:21.25pt;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;font-size:10pt;">select</span><span style="text-indent:21.25pt;color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;font-size:10pt;">语句后的生成。</span></span></div><div style="padding:0px 0px 15px;margin:0px;background-color:rgb(255,255,255);"><span style="font-size:15px;background-color:rgb(250,247,239);color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">   </span><span style="font-size:15px;background-color:rgb(250,247,239);color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;"> </span><span style="font-size:15px;background-color:rgb(250,247,239);color:rgb(0,0,0);font-family:'微软雅黑';line-height:normal;">示例：</span><span style="font-size:15px;background-color:rgb(250,247,239);color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>create view test_view as select * from test</em></span><span style="font-size:15px;background-color:rgb(250,247,239);color:rgb(4,150,21);font-family:'微软雅黑';line-height:normal;"><em>；</em></span></div><div style="padding:0px 0px 15px;margin:0px;background-color:rgb(255,255,255);"><span><span style="font-size:10pt;color:rgb(51,51,51);font-family:'Microsoft Yahei';line-height:30px;">来看下Hive数据抽象结构图</span></span></div><div style="padding:0px 0px 15px;margin:0px;text-align:center;background-color:rgb(255,255,255);"><img src="https://img-blog.csdn.net/20180524102149477?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI0NTA1MTI3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></div><div><span><span style="font-size:10pt;color:rgb(51,51,51);font-family:'Microsoft Yahei';line-height:30px;">从上图可以看出，表是在数据库下面，而表里面又要分区、桶、倾斜的数据和正常的数据等;分区下面也是可以建立桶的。</span></span></div><div><br></div><div><br></div>            </div>
                </div>