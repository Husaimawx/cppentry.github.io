---
layout:     post
title:      HDFS基本原理及数据存取实战
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <div>﻿﻿</div><span style="font:14px/21px Arial;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"></span><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">本文主要介绍了hdfs的基本原理、hdfs基本操作、hdfs的读取数据流程、namenode工作机制，rpc编程以及常见的两种必会的面试题等，旨在于全面深入的理解HDFS的基本工作流程并可以开发出简易的HDFS的程序。</p><h1 style="font:bold 28px/1.5 tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">一、HDFS简介</h1><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">Hadoop分布式文件系统(HDFS)被设计成适合运行在通用硬件(commodity hardware)上的分布式文件系统。HDFS体系结构中有两类节点，一类是NameNode，又叫"元数据节点"；另一类是DataNode，又叫"数据节点"。这两类节点分别承担Master和Worker具体任务的执行节点。总的设计思想：分而治之——将大文件、大批量文件，分布式存放在大量独立的服务器上，以便于采取分而治之的方式对海量数据进行运算分析。</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><span>HDFS是一个主/从（Mater/Slave）体系结构，从最终用户的角度来看，它就像传统的文件系统一样，可以通过目录路径对文件执行CRUD（Create、Read、Update和Delete）操作。但由于分布式存储的性质，HDFS集群拥有一个NameNode和一些DataNode。NameNode管理文件系统的元数据，DataNode存储实际的数据。客户端通过同NameNode和DataNodes的交互访问文件系统。客户端联系NameNode以获取文件的元数据，而真正的文件I/O操作是直接和DataNode进行交互的。</span><br><span></span>HDFS一般是用来“一次写入，多次读取”，不适合做实时交互性很强的事情，不适合存储大量小文件（当然，如果你偏要存大量小文件的话本文末尾会有解决方案).</p><h1 style="font:bold 28px/1.5 tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">二、HDFS工作原理</h1><h2 style="font:bold 21px/1.5 tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">2.1基本原理</h2><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">１　分布式文件系统，它所管理的文件是被切块存储在若干台datanode服务器上.<br><br>２　hdfs提供了一个统一的目录树来定位hdfs中的文件，客户端访问文件时只要指定目录树的路径即可，不用关心文件的具体物理位置．<br><br>３　每一个文件的每一个切块，在hdfs集群中都可以保存多个备份（默认３份），在hdfs-site.xml中，dfs.replication的value的数量就是备份的数量．<br><br>４　hdfs中有一个关键进程服务进程：namenode，它维护了一个hdfs的目录树及hdfs目录结构与文件真实存储位置的映射关系（元数据）．而datanode服务进程专门负责接收和管理＂文件块＂－ｂｌｏｃｋ.默认大小为１２８Ｍ(可配置),(dfs.blocksize)．（老版本的hadoop的默认block是64M的）<br><br><br></p><h2 style="font:bold 21px/1.5 tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">2.2 常用操作</h2><p><span style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">hdfs的根目录,通过这条命令可以查看hdfs存储的文件，在hadoop的安装目录下面:</span><br style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"></p><div class="dp-highlighter bg_html" style="font:12px/18px Consolas, 'Courier New', Courier, mono, serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><div class="bar" style="line-height:1.5;"><div class="tools" style="color:#C0C0C0;line-height:1.5;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:9px;font-style:normal;font-variant:normal;font-weight:normal;border-left-color:rgb(108,226,108);border-left-width:3px;border-left-style:solid;background-color:rgb(248,248,248);"><strong>[html]</strong><span> </span><a title="view plain" class="ViewSource" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">view plain</a><a title="copy" class="CopyToClipboard" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">copy</a><a title="print" class="PrintSource" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">print</a><a title="?" class="About" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">?</a></div></div><ol class="dp-xml" style="list-style:decimal;border:;color:rgb(92,92,92);background-color:rgb(255,255,255);" start="1"><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span style="border:;color:rgb(0,0,0);background-color:inherit;">bin/hdfs dfs -ls /</span><span class="tag" style="border:;color:rgb(0,0,0);background-color:inherit;">&lt;</span><span class="tag-name" style="border:;color:rgb(0,0,0);background-color:inherit;">pre</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> </span><span class="attribute" style="border:;color:rgb(0,0,0);background-color:inherit;">name</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">=</span><span class="attribute-value" style="border:;color:rgb(0,0,0);background-color:inherit;">"code"</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> </span><span class="attribute" style="border:;color:rgb(0,0,0);background-color:inherit;">class</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">=</span><span class="attribute-value" style="border:;color:rgb(0,0,0);background-color:inherit;">"html"</span><span class="tag" style="border:;color:rgb(0,0,0);background-color:inherit;">&gt;</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">hdfs dfs -chmod 600 /test.txt　　　　//设置文件权限  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">bin/hdfs dfs -df -h /　　　　//查看磁盘空间  </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">bin/hdfs dfs -mkdir /aaa   //新建文件夹  </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">bin/hdfs dfs  -tail　　　　　　 //查看文件尾部  </span></li></ol></div><pre style="color:rgb(68,68,68);text-transform:none;line-height:18px;text-indent:0px;letter-spacing:normal;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;word-spacing:0px;background-color:rgb(255,255,255);"></pre><p><span style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">hdfs块的存储位置位于：（在hadoop的根目录下面的tmp文件夹中)hadoop-2.5.2/tmp/hadoop/dfs/data/current/BP-33587274-127.0.0.1-1465370300743/current/finalized</span></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><img style="border:0px;" alt="" src="https://img-blog.csdn.net/20160609204005998?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">从图中我们可以看到hdfs存储的块的，当然这里面的两个块通过合并可以形成一个新的文件，然后可以通过解压进行验证。</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"></p><div class="dp-highlighter bg_java" style="font:12px/18px Consolas, 'Courier New', Courier, mono, serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><div class="bar" style="line-height:1.5;"><div class="tools" style="color:#C0C0C0;line-height:1.5;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:9px;font-style:normal;font-variant:normal;font-weight:normal;border-left-color:rgb(108,226,108);border-left-width:3px;border-left-style:solid;background-color:rgb(248,248,248);"><strong>[java]</strong><span> </span><a title="view plain" class="ViewSource" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">view plain</a><a title="copy" class="CopyToClipboard" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">copy</a><a title="print" class="PrintSource" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">print</a><a title="?" class="About" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">?</a></div></div><ol class="dp-j" style="list-style:decimal;border:;color:rgb(92,92,92);background-color:rgb(255,255,255);" start="1"><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span style="border:;color:rgb(0,0,0);background-color:inherit;">touch full hadoop.tar.gz  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">cat blk_1073741825 &gt;&gt; hadoop.tar.gz  </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">cat blk_1073741826 &gt;&gt; hadoop.tar.gz  </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">tar -xvzf  hadoop.tar.gz   </span></li></ol></div><p><br style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><span style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">同样，在hadoop的安装目录中，直接用命令来存取文件可以通过下面的命令：</span></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">存文件：<br>./hdfs dfs -put /home/admin1/桌面/test.txt  hdfs://localhost:9000/<br>取文件：<br>./hdfs dfs -get hdfs://localhost:9000/test.txt<br><br><br>hdfs的权限控制：<br></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">客户端的操作命令<br></p><div class="dp-highlighter bg_html" style="font:12px/18px Consolas, 'Courier New', Courier, mono, serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><div class="bar" style="line-height:1.5;"><div class="tools" style="color:#C0C0C0;line-height:1.5;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:9px;font-style:normal;font-variant:normal;font-weight:normal;border-left-color:rgb(108,226,108);border-left-width:3px;border-left-style:solid;background-color:rgb(248,248,248);"><strong>[html]</strong><span> </span><a title="view plain" class="ViewSource" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">view plain</a><a title="copy" class="CopyToClipboard" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">copy</a><a title="print" class="PrintSource" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">print</a><a title="?" class="About" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">?</a></div></div><ol class="dp-xml" style="list-style:decimal;border:;color:rgb(92,92,92);background-color:rgb(255,255,255);" start="1"><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span style="border:;color:rgb(0,0,0);background-color:inherit;">bin/hdfs dfs -chown  aa:bgroup  /test.txt      </span></span></li></ol></div><p><br style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><span style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">//将test.txt文件的权限改为aa用户的bgroup组．</span><br style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><br style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><span style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">（因为我根本就没有这个组和用户，但是也可以修改成功，所以说明hadoop本身对权限的控制不是很严格）</span><br style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><br style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"></p><h2 style="font:bold 21px/1.5 tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">2.3 HDFS的shell操作</h2><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">--appendToFile  ----追加一个文件到已经存在的文件末尾</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">--&gt;hadoop fs  -appendToFile  ./hello.txt hdfs://hadoop-server01:9000/hello.txt</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">可以简写为：</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">Hadoop fs  -appendToFile  ./hello.txt /hello.txt</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><span style="color:#FF0000;">-cat  ---</span><span style="color:#FF0000;">显示文件内容</span><span style="color:#FF0000;"> </span></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">--&gt;hadoop fs -cat /hello.txt</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">-chgrp</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">-chmod</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">-chown</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">上面三个跟linux中的用法一样</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">--&gt;hadoop fs -chmod 666 /hello.txt</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">-copyFromLocal    #从本地文件系统中拷贝文件到hdfs路径去</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">--&gt;hadoop fs  -copyFromLocal  ./jdk.tar.gz /aaa/</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">-copyToLocal      #从hdfs拷贝到本地</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">Eg： hadoop fs -copyToLocal /aaa/jdk.tar.gz</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">-count         #统计一个指定目录下的文件节点数量</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">--&gt;hadoop fs -count /aaa/</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><span style="color:#FF0000;">-cp              #</span><span style="color:#FF0000;">从</span><span style="color:#FF0000;">hdfs</span><span style="color:#FF0000;">的一个路径拷贝</span><span style="color:#FF0000;">hdfs</span><span style="color:#FF0000;">的另一个路径</span></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><span style="color:#FF0000;">hadoop fs -cp/aaa/jdk.tar.gz /bbb/jdk.tar.gz.2</span></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">-createSnapshot</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">-deleteSnapshot</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">-renameSnapshot</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">以上三个用来操作hdfs文件系统目录信息快照</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">--&gt;hadoop fs -createSnapshot /</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">-df               #统计文件系统的可用空间信息</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">-du</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">--&gt;hadoop fs -df -h /</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">--&gt;hadoop fs -du -s -h /aaa/*</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><span style="color:#FF0000;">-get              #</span><span style="color:#FF0000;">等同于</span><span style="color:#FF0000;">copyToLocal</span><span style="color:#FF0000;">，就是从</span><span style="color:#FF0000;">hdfs</span><span style="color:#FF0000;">下载文件到本地</span></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><span style="color:#FF0000;">-getmerge             #</span><span style="color:#FF0000;">合并下载多个文件</span></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">--&gt; 比如hdfs的目录 /aaa/下有多个文件:log.1, log.2,log.3,...</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">hadoop fs -getmerge /aaa/log.* ./log.sum</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">-help             #输出这个命令参数手册</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><span style="color:#FF0000;">-ls                  #</span><span style="color:#FF0000;">显示目录信息</span></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">--&gt;hadoop fs -ls hdfs://hadoop-server01:9000/</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">这些参数中，所有的hdfs路径都可以简写</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">--&gt;hadoop fs -ls /   等同于上一条命令的效果</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><span style="color:#FF0000;">-mkdir              #</span><span style="color:#FF0000;">在</span><span style="color:#FF0000;">hdfs</span><span style="color:#FF0000;">上创建目录</span></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">--&gt;hadoop fs -mkdir -p /aaa/bbb/cc/dd</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">-moveFromLocal            #从本地剪切粘贴到hdfs</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">-moveToLocal              #从hdfs剪切粘贴到本地</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><span style="color:#FF0000;">-mv                     #</span><span style="color:#FF0000;">在</span><span style="color:#FF0000;">hdfs</span><span style="color:#FF0000;">目录中移动文件</span></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><span style="color:#FF0000;">-put                #</span><span style="color:#FF0000;">等同于</span><span style="color:#FF0000;">copyFromLocal</span></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><span style="color:#FF0000;">-rm                #</span><span style="color:#FF0000;">删除文件或文件夹</span></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><span style="color:#FF0000;">--&gt;</span><span style="color:#FF0000;"><span> </span>hadoop fs -rm -r/aaa/bbb/</span></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">-rmdir                 #删除空目录</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">-setrep                #设置hdfs中文件的副本数量</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">--&gt;hadoop fs -setrep 3 /aaa/jdk.tar.gz</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">-stat                  #显示一个文件或文件夹的元信息</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><span style="color:#FF0000;">-tail                  #</span><span style="color:#FF0000;">显示一个文件的末尾</span></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">-text                  #以字符形式打印一个文件的内容</p><p><br style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"></p><h1 style="font:bold 28px/1.5 tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">三、HDFS写入数据流程解析</h1><h2 style="font:bold 21px/1.5 tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">3.1 基本原理</h2><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">hdfs的数据写入是非常复杂的过程，下面来看一下简要的步骤。</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><img style="border:0px;" alt="" src="https://img-blog.csdn.net/20160609205316031?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"><br></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><img style="border:0px;" alt="" src="https://img-blog.csdn.net/20160609205044389?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"><br></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><br></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">那么问题来了，如果他们之间的一个datanode突然坏掉了怎么办。</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">1、如果传输过程中，有某个datanode出现了故障，那么当前的pipeline会被关闭，出现故障的datanode会从当前的pipeline中移除，剩余的block会继续剩下的datanode中继续以pipeline的形式传输，同时Namenode会分配一个新的datanode，保持replicas设定的数量。<br>2、关闭pipeline，将ack queue中的数据块放入data queue的开始。<br>3、当前的数据块在已经写入的数据节点中被元数据节点赋予新的标示，则错误节点重启后能够察觉其数据块是过时的，会被删除。<br>4、失败的数据节点从pipeline中移除，另外的数据块则写入pipeline中的另外两个数据节点。<br>5、元数据节点则被通知此数据块是复制块数不足，将来会再创建第三份备份。<br>6、客户端调用create()来创建文件<br>7、DistributedFileSystem用RPC调用元数据节点，在文件系统的命名空间中创建一个新的文件。<br>8、元数据节点首先确定文件原来不存在，并且客户端有创建文件的权限，然后创建新文件。<br>9、DistributedFileSystem返回DFSOutputStream，客户端用于写数据。<br>10、客户端开始写入数据，DFSOutputStream将数据分成块，写入data queue。<br>11、Data queue由Data Streamer读取，并通知元数据节点分配数据节点，用来存储数据块(每块默认复制3块)。分配的数据节点放在一个pipeline里。<br>12、Data Streamer将数据块写入pipeline中的第一个数据节点。第一个数据节点将数据块发送给第二个数据节点。第二个数据节点将数据发送给第三个数据节点。<br>13、DFSOutputStream为发出去的数据块保存了ack queue，等待pipeline中的数据节点告知数据已经写入成功。</p><h2 style="font:bold 21px/1.5 tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">3.2 编码实践</h2><div style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">这段代码的意思是从/home/admin1/hadoop/eclipse.tar.gz上传文件到hdfs文件中，URI中写的是hdfs的地址</div><div style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><div class="dp-highlighter bg_java" style="line-height:1.5;font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;"><div class="bar" style="line-height:1.5;"><div class="tools" style="color:#C0C0C0;line-height:1.5;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:9px;font-style:normal;font-variant:normal;font-weight:normal;border-left-color:rgb(108,226,108);border-left-width:3px;border-left-style:solid;background-color:rgb(248,248,248);"><strong>[java]</strong><span> </span><a title="view plain" class="ViewSource" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">view plain</a><a title="copy" class="CopyToClipboard" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">copy</a><a title="print" class="PrintSource" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">print</a><a title="?" class="About" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">?</a></div></div><ol class="dp-j" style="list-style:decimal;border:;color:rgb(92,92,92);background-color:rgb(255,255,255);" start="1"><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="annotation" style="border:;color:rgb(0,0,0);background-color:inherit;">@Test</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">    <span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">public</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> </span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">void</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> testUpload() </span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">throws</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> IOException, InterruptedException, URISyntaxException{  </span></span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">        Configuration conf = <span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">new</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> Configuration();  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">      </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">           </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">        <span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">//to get a client of the hdfs system</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">        FileSystem fs = FileSystem.get(<span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">new</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> URI(</span><span class="string" style="border:;color:#0000FF;background-color:inherit;">"hdfs://ubuntu2:9000"</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">),conf,</span><span class="string" style="border:;color:#0000FF;background-color:inherit;">"admin1"</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">);  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">          </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">        fs.copyFromLocalFile(<span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">new</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> Path(</span><span class="string" style="border:;color:#0000FF;background-color:inherit;">"/home/admin1/hadoop/eclipse.tar.gz"</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">), </span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">new</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> Path(</span><span class="string" style="border:;color:#0000FF;background-color:inherit;">"/"</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">));  </span></span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">        fs.close();  </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">          </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">          </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">    }  </span></li></ol></div><br><br></div><h1 style="font:bold 28px/1.5 tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">四、HDFS读取数据流程解析</h1><h2 style="font:bold 21px/1.5 tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">4.1 基本原理</h2><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><span></span>读取的流程比写入的流程就简单很多了。</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><img style="border:0px;" alt="" src="https://img-blog.csdn.net/20160609205914643?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"><br></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><img style="border:0px;" alt="" src="https://img-blog.csdn.net/20160609210028690?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"><br></p><h2 style="font:bold 21px/1.5 tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">4.2 编码实践</h2><div style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">下载文件：</div><div style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><div class="dp-highlighter bg_java" style="line-height:1.5;font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;"><div class="bar" style="line-height:1.5;"><div class="tools" style="color:#C0C0C0;line-height:1.5;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:9px;font-style:normal;font-variant:normal;font-weight:normal;border-left-color:rgb(108,226,108);border-left-width:3px;border-left-style:solid;background-color:rgb(248,248,248);"><strong>[java]</strong><span> </span><a title="view plain" class="ViewSource" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">view plain</a><a title="copy" class="CopyToClipboard" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">copy</a><a title="print" class="PrintSource" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">print</a><a title="?" class="About" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">?</a></div></div><ol class="dp-j" style="list-style:decimal;border:;color:rgb(92,92,92);background-color:rgb(255,255,255);" start="1"><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">/*public static void main(String[] args) throws IOException {</span> </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">        //download  from hdfs</span> </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">        </span> </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">        Configuration conf = new Configuration();</span> </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">        conf.set("fs.defaultFS", "hdfs://ubuntu2:9000/");</span> </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">        </span> </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">        </span> </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">        conf.set("dfs.blocksize", "64");</span> </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">         </span> </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">        //to get a client of the hdfs system</span> </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">        FileSystem fs = FileSystem.get(conf);</span> </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">        </span> </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">        fs.copyToLocalFile(new Path("hdfs://ubuntu2:9000/test.txt"), new Path("/home/admin1/Downloads/test1.txt"));</span> </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">        </span> </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">        fs.close();</span> </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">    }*/</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></span></li></ol></div>删除文件：</div><div style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><div class="dp-highlighter bg_java" style="line-height:1.5;font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;"><div class="bar" style="line-height:1.5;"><div class="tools" style="color:#C0C0C0;line-height:1.5;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:9px;font-style:normal;font-variant:normal;font-weight:normal;border-left-color:rgb(108,226,108);border-left-width:3px;border-left-style:solid;background-color:rgb(248,248,248);"><strong>[java]</strong><span> </span><a title="view plain" class="ViewSource" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">view plain</a><a title="copy" class="CopyToClipboard" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">copy</a><a title="print" class="PrintSource" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">print</a><a title="?" class="About" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">?</a></div></div><ol class="dp-j" style="list-style:decimal;border:;color:rgb(92,92,92);background-color:rgb(255,255,255);" start="1"><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="annotation" style="border:;color:rgb(0,0,0);background-color:inherit;">@Test</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">    <span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">public</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> </span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">void</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> rmove() </span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">throws</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> IOException, InterruptedException, URISyntaxException{  </span></span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">    Configuration conf = <span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">new</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> Configuration();  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">    FileSystem fs = FileSystem.get(<span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">new</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> URI(</span><span class="string" style="border:;color:#0000FF;background-color:inherit;">"hdfs://ubuntu2:9000"</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">),conf,</span><span class="string" style="border:;color:#0000FF;background-color:inherit;">"admin1"</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">);  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">      </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">    fs.delete(<span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">new</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> Path(</span><span class="string" style="border:;color:#0000FF;background-color:inherit;">"/test.txt"</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">));  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">      </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">    fs.close();  </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">    }  </span></li></ol></div><br><br></div><h1 style="font:bold 28px/1.5 tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">五、NameNode工作机制</h1><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">元数据放在内存中，同时需要备份，通过日志的记录（对元数据有修改操作时）写到磁盘中，用edits_ingropress,定期dump一次，当一旦断电时，很难恢复，<br>所以我们就用sercondName定期把操作日志下载和内存镜像文件，然后就定期合并操作记录，（日志+fsimage)然后生成一个新的namenode镜像文件  (fs.image.ckpt)<br>最后上传给namenode,然后namenode重命名为fsimage.<br><img style="border:0px;" alt="" src="https://img-blog.csdn.net/20160609213326171?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"><br><br>元数据管理机制：<br>1、元数据有3中存储形式：内存、edits日志、fsimage<br>2、最完整最新的元数据一定是内存中的这一部分<br></p><h1 style="font:bold 28px/1.5 tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">六、RPC编程</h1><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">使用 RPC 编程是在客户机和服务器实体之间进行可靠通信的最强大、最高效的方法之一。它为在分布式计算环境中运行的几乎所有应用程序提供基础。任何 RPC 客户机-服务器程序的重要实体都包括 IDL 文件（接口定义文件）、客户机 stub、服务器 stub 以及由客户机和服务器程序共用的头文件。客户机和服务器 stub 使用 RPC 运行时库通信。RPC 运行时库提供一套标准的运行时例程来支持 RPC 应用程序。在一般的应用程序中，被调用的过程在相同的地址空间中运行，并把结果返回给发出调用的过程。在分布式环境中，客户机和服务器在不同的机器上运行，客户端调用在服务器端运行的过程，并把结果发送回客户机。这称为远程过程调用 (RPC)，是 RPC 编程的基础。<br></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">以下实例是用来模拟用户登陆的过程。</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">在linux中的eclipse。新建一个java工程，新建java文件：</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">RPCServer.java</p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"></p><div class="dp-highlighter bg_java" style="font:12px/18px Consolas, 'Courier New', Courier, mono, serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><div class="bar" style="line-height:1.5;"><div class="tools" style="color:#C0C0C0;line-height:1.5;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:9px;font-style:normal;font-variant:normal;font-weight:normal;border-left-color:rgb(108,226,108);border-left-width:3px;border-left-style:solid;background-color:rgb(248,248,248);"><strong>[java]</strong><span> </span><a title="view plain" class="ViewSource" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">view plain</a><a title="copy" class="CopyToClipboard" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">copy</a><a title="print" class="PrintSource" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">print</a><a title="?" class="About" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">?</a></div></div><ol class="dp-j" style="list-style:decimal;border:;color:rgb(92,92,92);background-color:rgb(255,255,255);" start="1"><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">package</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> hdfsTest;  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">public</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> </span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">interface</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">  RPCService {  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">    <span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">public</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> </span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">static</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> </span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">final</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> </span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">long</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> versionID=100L;  </span><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">//定义通信接口的版本号</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">    <span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">public</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> String userLogin(String username,String password);  </span><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">//用户名和密码</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">}  </span></li></ol></div><p><span style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">RPCServerImpl.java</span></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"></p><div class="dp-highlighter bg_java" style="font:12px/18px Consolas, 'Courier New', Courier, mono, serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><div class="bar" style="line-height:1.5;"><div class="tools" style="color:#C0C0C0;line-height:1.5;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:9px;font-style:normal;font-variant:normal;font-weight:normal;border-left-color:rgb(108,226,108);border-left-width:3px;border-left-style:solid;background-color:rgb(248,248,248);"><strong>[java]</strong><span> </span><a title="view plain" class="ViewSource" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">view plain</a><a title="copy" class="CopyToClipboard" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">copy</a><a title="print" class="PrintSource" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">print</a><a title="?" class="About" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">?</a></div></div><ol class="dp-j" style="list-style:decimal;border:;color:rgb(92,92,92);background-color:rgb(255,255,255);" start="1"><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">package</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> hdfsTest;  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">public</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> </span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">class</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> RPCServiceImpl  </span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">implements</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> RPCService {  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">    <span class="annotation" style="border:;color:rgb(0,0,0);background-color:inherit;">@Override</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">    <span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">public</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> String userLogin(String username, String password) {   </span></span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">        <span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">return</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> username+</span><span class="string" style="border:;color:#0000FF;background-color:inherit;">"  logged in successfully!"</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">;  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">    }  </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">}  </span></li></ol></div><p><br style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><span style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">RPCControl.java</span></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"></p><div class="dp-highlighter bg_java" style="font:12px/18px Consolas, 'Courier New', Courier, mono, serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><div class="bar" style="line-height:1.5;"><div class="tools" style="color:#C0C0C0;line-height:1.5;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:9px;font-style:normal;font-variant:normal;font-weight:normal;border-left-color:rgb(108,226,108);border-left-width:3px;border-left-style:solid;background-color:rgb(248,248,248);"><strong>[java]</strong><span> </span><a title="view plain" class="ViewSource" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">view plain</a><a title="copy" class="CopyToClipboard" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">copy</a><a title="print" class="PrintSource" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">print</a><a title="?" class="About" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">?</a></div></div><ol class="dp-j" style="list-style:decimal;border:;color:rgb(92,92,92);background-color:rgb(255,255,255);" start="1"><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">package</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> hdfsTest;  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">import</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> java.io.IOException;  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">import</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> java.net.InetSocketAddress;  </span></span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">import</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> org.apache.hadoop.conf.Configuration;  </span></span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">import</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> org.apache.hadoop.ipc.RPC;  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">//</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">public</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> </span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">class</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> RPCController {  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">    <span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">public</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> </span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">static</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> </span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">void</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> main(String[] args) </span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">throws</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> IOException {  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">        RPCService serverceImpl=RPC.getProxy(RPCService.<span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">class</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">,</span><span class="number" style="border:;color:rgb(0,0,0);background-color:inherit;">100</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">,</span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">new</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> InetSocketAddress(</span><span class="string" style="border:;color:#0000FF;background-color:inherit;">"ubuntu2"</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">,</span><span class="number" style="border:;color:rgb(0,0,0);background-color:inherit;">10000</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">),</span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">new</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> Configuration());  </span></span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">&lt;span style=<span class="string" style="border:;color:#0000FF;background-color:inherit;">"white-space:pre"</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">&gt;        &lt;/span&gt;</span><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">//100是指前面设置的版本号，InetSocketAddress中的是hdfs主机名和10000是通信端口</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">        String result=serverceImpl.userLogin(<span class="string" style="border:;color:#0000FF;background-color:inherit;">"aaa"</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">, </span><span class="string" style="border:;color:#0000FF;background-color:inherit;">"aaa"</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">);  </span><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">//设置用户用户名和密码</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">        System.out.println(result);     </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">    }  </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">}  </span></li></ol></div><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><br></p><p><span style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">ServerRunner.java</span><br style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"></p><div class="dp-highlighter bg_java" style="font:12px/18px Consolas, 'Courier New', Courier, mono, serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><div class="bar" style="line-height:1.5;"><div class="tools" style="color:#C0C0C0;line-height:1.5;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:9px;font-style:normal;font-variant:normal;font-weight:normal;border-left-color:rgb(108,226,108);border-left-width:3px;border-left-style:solid;background-color:rgb(248,248,248);"><strong>[java]</strong><span> </span><a title="view plain" class="ViewSource" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">view plain</a><a title="copy" class="CopyToClipboard" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">copy</a><a title="print" class="PrintSource" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">print</a><a title="?" class="About" style="border:;color:rgb(160,160,160);font-size:9px;text-decoration:underline;background-image:none;background-color:inherit;" href="http://www.cnblogs.com/sdksdk0/p/5585047.html#" rel="nofollow">?</a></div></div><ol class="dp-j" style="list-style:decimal;border:;color:rgb(92,92,92);background-color:rgb(255,255,255);" start="1"><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">package</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> hdfsTest;  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">import</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> java.io.IOException;  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">import</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> org.apache.hadoop.HadoopIllegalArgumentException;  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">import</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> org.apache.hadoop.conf.Configuration;  </span></span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">import</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> org.apache.hadoop.ipc.RPC;  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">import</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> org.apache.hadoop.ipc.RPC.Builder;  </span></span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">import</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> org.apache.hadoop.ipc.Server;  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;"><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">public</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> </span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">class</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> ServerRunner {  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">    <span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">public</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> </span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">static</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> </span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">void</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> main(String[] args) </span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">throws</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> HadoopIllegalArgumentException, IOException {  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">        Builder builder=<span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">new</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> RPC.Builder(</span><span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">new</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> Configuration());  </span></span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">          </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">        builder.setBindAddress(<span class="string" style="border:;color:#0000FF;background-color:inherit;">"ubuntu2"</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">);  </span><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">//hdfs的主机名</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">        builder.setPort(<span class="number" style="border:;color:rgb(0,0,0);background-color:inherit;">10000</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">);    </span><span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">//设置通信端口号</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">          </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">        builder.setProtocol(RPCService.<span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">class</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">);  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">        builder.setInstance(<span class="keyword" style="border:;color:rgb(0,102,153);font-weight:bold;background-color:inherit;">new</span><span style="border:;color:rgb(0,0,0);background-color:inherit;"> RPCServiceImpl());  </span></span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">          </span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">        Server server=builder.build();  </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">        server.start();   <span class="comment" style="border:;color:rgb(0,130,0);background-color:inherit;">//开启服务</span><span style="border:;color:rgb(0,0,0);background-color:inherit;">  </span></span></li><li style="border-style:none none none solid;list-style:decimal;color:rgb(92,92,92);line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(248,248,248);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">    }  </span></li><li class="alt" style="border-style:none none none solid;list-style:decimal;color:inherit;line-height:1.6;border-left-color:rgb(108,226,108);border-left-width:3px;background-color:rgb(255,255,255);"><span style="border:;color:rgb(0,0,0);background-color:inherit;">}  </span></li></ol></div><p><br style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><span style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">运行结果：</span></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><img style="border:0px;" alt="" src="https://img-blog.csdn.net/20160609214745036?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"><br></p><p style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><br></p><h1 style="font:bold 28px/1.5 tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">七、常见问题分析</h1><h2 style="font:bold 21px/1.5 tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">7.1.HDFS可不可以用来做网盘</h2><div style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">答案：不可以,</div><div style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">网盘只存储，不用做分析，hdfs在增加节点，同时也加大了分析能力，主要是大容量存储之上的数据分析<br>1、容量成本太高，2、文件大小不确定，如果存大量小文件会造成很大的浪费 3、相对于网盘来说，文件读写的效率低  4、只适合一次写入，多次读取的操作<br>5、hdfs不支持文件内容修改，可支持往文件尾部追加内容。<br></div><div style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);"><br></div><h2 style="font:bold 21px/1.5 tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">7.2 HDFS大量小文件存储</h2><div style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">1、对于待上传的文件，先将小文件合并为一个大文件再上传，利用SequenceFile、MapFile、Har等方式归档小文件，这个方法的原理就是把小文件归档起来管理，HBase就是基于此的。对于这种方法，如果想找回原来的小文件内容，那就必须得知道与归档文件的映射关系。</div><div style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">2、如果对于已经上传了的文件，需要进行合并的话，我们可以使用Map-redure来进行归档。</div><div style="font:12px/18px tahoma, arial, sans-serif;color:rgb(68,68,68);text-transform:none;text-indent:0px;letter-spacing:normal;word-spacing:0px;background-color:rgb(255,255,255);">3、BlueSky解决方案，以一种two-level prefetching机制以提高小文件读取效率，即索引文件预取和数据文件预取。索引文件预取是指当用户访问某个文件时，该文件所在的block对应的索引文件被加载到内存中，这样，用户访问这些文件时不必再与namenode交互了。数据文件预取是指用户访问某个文件时，将该文件所在课件中的所有文件加载到内存中，这样，如果用户继续访问其他文件，速度会明显提高。</div><p>文章出处：</p><p><a style="font:14px/21px Arial;color:rgb(255,153,0);text-transform:none;text-indent:0px;letter-spacing:normal;text-decoration:none;word-spacing:0px;background-color:rgb(255,255,255);" href="http://blog.csdn.net/sdksdk0/article/details/51622547" rel="nofollow">http://blog.csdn.net/sdksdk0/article/details/51622547</a></p><p></p><p><br></p>            </div>
                </div>