---
layout:     post
title:      合并HDFS和本地文件系统中的小文件
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;text-indent:30px;">
关键字：hadoop hdfs 小文件、appendToFile、getmerge</p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;text-indent:30px;">
众所周知，HDFS中过多的小文件，会给NameNode造成很大的压力，所谓的小文件，是指远远小于文件块大小的文件。</p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;text-indent:30px;">
在使用HDFS的过程中，应尽量避免生成过多的小文件。</p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;text-indent:30px;">
本文以TextFile为例，介绍一下从本地–&gt;HDFS、HDFS–&gt;本地、以及HDFS–&gt;HDFS的文件上传下载移动过程中，对小文件的合并方法。</p>
<h2 style="line-height:18px;color:rgb(85,85,85);font-size:18px;border-left:4px solid rgb(0,166,124);background-color:rgb(251,251,251);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;text-indent:30px;">
将本地的小文件合并，上传到HDFS</h2>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;text-indent:30px;">
假设存放在本地的数据由很多个小文件组成，需要上传到HDFS。一般的做法是在本地使用脚本、程序先把小文件合并后再上传。</p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;text-indent:30px;">
其实没有必要，HDFS中提供了一个很有用的命令 appendToFile，就可以解决这个问题。</p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;text-indent:30px;">
假设本地有两个小文件1.txt和2.txt，里面内容如下：</p>
<pre class="prettyprint linenums" style="color:rgb(68,68,68);font-size:14px;line-height:20px;background-color:rgb(248,248,248);border:1px solid rgb(238,238,238);overflow:hidden;text-indent:30px;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;"></pre><ol class="linenums" style="list-style:none;"><li class="L0" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pun" style="color:rgb(0,170,0);">[</span><span class="pln" style="color:rgb(0,0,255);">liuxiaowen@dev </span><span class="pun" style="color:rgb(0,170,0);">~]</span><span class="pln" style="color:rgb(0,0,255);">$ cat </span><span class="lit" style="color:rgb(204,0,204);">1.txt</span><span class="pln" style="color:rgb(0,0,255);"> </span></li><li class="L1" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">111111</span></li><li class="L2" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">111111</span></li><li class="L3" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">111111</span></li><li class="L4" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">111111</span></li><li class="L5" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pun" style="color:rgb(0,170,0);">[</span><span class="pln" style="color:rgb(0,0,255);">liuxiaowen@dev </span><span class="pun" style="color:rgb(0,170,0);">~]</span><span class="pln" style="color:rgb(0,0,255);">$ cat </span><span class="lit" style="color:rgb(204,0,204);">2.txt</span><span class="pln" style="color:rgb(0,0,255);"> </span></li><li class="L6" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">222222</span></li><li class="L7" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">222222</span></li><li class="L8" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">222222</span></li><li class="L9" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">222222</span></li></ol>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;text-indent:30px;">
使用下面的命令，可以将1.txt和2.txt合并，并上传到HDFS：</p>
<pre class="prettyprint linenums" style="color:rgb(68,68,68);font-size:14px;line-height:20px;background-color:rgb(248,248,248);border:1px solid rgb(238,238,238);overflow:hidden;text-indent:30px;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;"></pre><ol class="linenums" style="list-style:none;"><li class="L0" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pun" style="color:rgb(0,170,0);">[</span><span class="pln" style="color:rgb(0,0,255);">liuxiaowen@dev </span><span class="pun" style="color:rgb(0,170,0);">~]</span><span class="pln" style="color:rgb(0,0,255);">$ hadoop fs </span><span class="pun" style="color:rgb(0,170,0);">-</span><span class="pln" style="color:rgb(0,0,255);">appendToFile </span><span class="lit" style="color:rgb(204,0,204);">1.txt</span><span class="pln" style="color:rgb(0,0,255);"> </span><span class="lit" style="color:rgb(204,0,204);">2.txt</span><span class="pln" style="color:rgb(0,0,255);"> hdfs</span><span class="pun" style="color:rgb(0,170,0);">:</span><span class="com" style="color:rgb(102,102,102);">//cdh5/tmp/lxw1234.txt</span></li><li class="L1" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pun" style="color:rgb(0,170,0);">[</span><span class="pln" style="color:rgb(0,0,255);">liuxiaowen@dev </span><span class="pun" style="color:rgb(0,170,0);">~]</span><span class="pln" style="color:rgb(0,0,255);">$ hadoop fs </span><span class="pun" style="color:rgb(0,170,0);">-</span><span class="pln" style="color:rgb(0,0,255);">cat hdfs</span><span class="pun" style="color:rgb(0,170,0);">:</span><span class="com" style="color:rgb(102,102,102);">//cdh5/tmp/lxw1234.txt</span></li><li class="L2" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">111111</span></li><li class="L3" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">111111</span></li><li class="L4" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">111111</span></li><li class="L5" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">111111</span></li><li class="L6" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">222222</span></li><li class="L7" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">222222</span></li><li class="L8" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">222222</span></li><li class="L9" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">222222</span></li></ol>
<h2 style="line-height:18px;color:rgb(85,85,85);font-size:18px;border-left:4px solid rgb(0,166,124);background-color:rgb(251,251,251);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;text-indent:30px;">
下载HDFS的小文件到本地，合并成一个大文件</h2>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;text-indent:30px;">
假设在HDFS的/tmp/lxw1234/目录下，有两个小文件1.txt和2.txt</p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;text-indent:30px;">
需要将它们下载到本地的一个文件中。</p>
<pre class="prettyprint linenums" style="color:rgb(68,68,68);font-size:14px;line-height:20px;background-color:rgb(248,248,248);border:1px solid rgb(238,238,238);overflow:hidden;text-indent:30px;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;"></pre><ol class="linenums" style="list-style:none;"><li class="L0" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pun" style="color:rgb(0,170,0);">[</span><span class="pln" style="color:rgb(0,0,255);">liuxiaowen@dev </span><span class="pun" style="color:rgb(0,170,0);">~]</span><span class="pln" style="color:rgb(0,0,255);">$ hadoop fs </span><span class="pun" style="color:rgb(0,170,0);">-</span><span class="pln" style="color:rgb(0,0,255);">cat </span><span class="pun" style="color:rgb(0,170,0);">/</span><span class="pln" style="color:rgb(0,0,255);">tmp</span><span class="pun" style="color:rgb(0,170,0);">/</span><span class="pln" style="color:rgb(0,0,255);">lxw1234</span><span class="pun" style="color:rgb(0,170,0);">/</span><span class="lit" style="color:rgb(204,0,204);">1.txt</span></li><li class="L1" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">111111</span></li><li class="L2" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">111111</span></li><li class="L3" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">111111</span></li><li class="L4" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">111111</span></li><li class="L5" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pun" style="color:rgb(0,170,0);">[</span><span class="pln" style="color:rgb(0,0,255);">liuxiaowen@dev </span><span class="pun" style="color:rgb(0,170,0);">~]</span><span class="pln" style="color:rgb(0,0,255);">$ hadoop fs </span><span class="pun" style="color:rgb(0,170,0);">-</span><span class="pln" style="color:rgb(0,0,255);">cat </span><span class="pun" style="color:rgb(0,170,0);">/</span><span class="pln" style="color:rgb(0,0,255);">tmp</span><span class="pun" style="color:rgb(0,170,0);">/</span><span class="pln" style="color:rgb(0,0,255);">lxw1234</span><span class="pun" style="color:rgb(0,170,0);">/</span><span class="lit" style="color:rgb(204,0,204);">2.txt</span></li><li class="L6" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">222222</span></li><li class="L7" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">222222</span></li><li class="L8" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">222222</span></li><li class="L9" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">222222</span></li></ol>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;text-indent:30px;">
使用下面的命令：</p>
<pre class="prettyprint linenums" style="color:rgb(68,68,68);font-size:14px;line-height:20px;background-color:rgb(248,248,248);border:1px solid rgb(238,238,238);overflow:hidden;text-indent:30px;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;"></pre><ol class="linenums" style="list-style:none;"><li class="L0" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pun" style="color:rgb(0,170,0);">[</span><span class="pln" style="color:rgb(0,0,255);">liuxiaowen@dev </span><span class="pun" style="color:rgb(0,170,0);">~]</span><span class="pln" style="color:rgb(0,0,255);">$ hadoop fs </span><span class="pun" style="color:rgb(0,170,0);">-</span><span class="pln" style="color:rgb(0,0,255);">getmerge hdfs</span><span class="pun" style="color:rgb(0,170,0);">:</span><span class="com" style="color:rgb(102,102,102);">//cdh5/tmp/lxw1234/*.txt local_largefile.txt</span></li><li class="L1" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pun" style="color:rgb(0,170,0);">[</span><span class="pln" style="color:rgb(0,0,255);">liuxiaowen@dev </span><span class="pun" style="color:rgb(0,170,0);">~]</span><span class="pln" style="color:rgb(0,0,255);">$ cat local_largefile</span><span class="pun" style="color:rgb(0,170,0);">.</span><span class="pln" style="color:rgb(0,0,255);">txt </span></li><li class="L2" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">111111</span></li><li class="L3" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">111111</span></li><li class="L4" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">111111</span></li><li class="L5" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">111111</span></li><li class="L6" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">222222</span></li><li class="L7" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">222222</span></li><li class="L8" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">222222</span></li><li class="L9" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">222222</span></li></ol>
<h2 style="line-height:18px;color:rgb(85,85,85);font-size:18px;border-left:4px solid rgb(0,166,124);background-color:rgb(251,251,251);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;text-indent:30px;">
合并HDFS上的小文件</h2>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;text-indent:30px;">
如果需要合并HDFS上的某个目录下有很多小文件，可以尝试使用下面的命令：</p>
<pre class="prettyprint linenums" style="color:rgb(68,68,68);font-size:14px;line-height:20px;background-color:rgb(248,248,248);border:1px solid rgb(238,238,238);overflow:hidden;text-indent:30px;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;"></pre><ol class="linenums" style="list-style:none;"><li class="L0" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pun" style="color:rgb(0,170,0);">[</span><span class="pln" style="color:rgb(0,0,255);">liuxiaowen@dev </span><span class="pun" style="color:rgb(0,170,0);">~]</span><span class="pln" style="color:rgb(0,0,255);">$ hadoop fs </span><span class="pun" style="color:rgb(0,170,0);">-</span><span class="pln" style="color:rgb(0,0,255);">cat hdfs</span><span class="pun" style="color:rgb(0,170,0);">:</span><span class="com" style="color:rgb(102,102,102);">//cdh5/tmp/lxw1234/*.txt | hadoop fs -appendToFile - hdfs://cdh5/tmp/hdfs_largefile.txt</span></li><li class="L1" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="pun" style="color:rgb(0,170,0);">[</span><span class="pln" style="color:rgb(0,0,255);">liuxiaowen@dev </span><span class="pun" style="color:rgb(0,170,0);">~]</span><span class="pln" style="color:rgb(0,0,255);">$ hadoop fs </span><span class="pun" style="color:rgb(0,170,0);">-</span><span class="pln" style="color:rgb(0,0,255);">cat hdfs</span><span class="pun" style="color:rgb(0,170,0);">:</span><span class="com" style="color:rgb(102,102,102);">//cdh5/tmp/hdfs_largefile.txt</span></li><li class="L2" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">111111</span></li><li class="L3" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">111111</span></li><li class="L4" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">111111</span></li><li class="L5" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">111111</span></li><li class="L6" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">222222</span></li><li class="L7" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">222222</span></li><li class="L8" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">222222</span></li><li class="L9" style="line-height:20px;text-indent:0px;color:rgb(190,190,197);margin-left:0px;list-style:decimal;"><span class="lit" style="color:rgb(204,0,204);">222222</span></li></ol>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;text-indent:30px;">
注意：这种处理方法在数据量非常大的情况下可能不太适合，最好使用MapReduce来合并。</p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;text-indent:30px;">
<br></p>
<p style="color:rgb(85,85,85);font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:15px;text-indent:30px;">
转自：<a href="http://lxw1234.com/" rel="nofollow" title="" style="color:rgb(0,166,124);">lxw的大数据田地</a> » <a href="http://lxw1234.com/archives/2015/09/481.htm" rel="nofollow" title="" style="color:rgb(0,166,124);">合并HDFS和本地文件系统中的小文件</a></p>
            </div>
                </div>