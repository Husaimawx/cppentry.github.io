---
layout:     post
title:      Kafka（ZK）安装部署
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								<div class="article-copyright">
					版权声明：本文为博主原创文章，未经博主允许不得转载。					https://blog.csdn.net/qq_32297447/article/details/80792077				</div>
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>小结：</strong></span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">      本篇博客，介绍三种安装Kafka的方式，分别为：单节点单Broker部署、单节点多Broker部署、集群部署（多节点多Broker）。实际生产环境中使用的是第三种方式，以集群的方式来部署Kafka。 </span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">      Kafka强依赖ZK，如果想要使用Kafka，就必须安装ZK，Kafka中的消费偏置信息、kafka集群、topic信息会被存储在ZK中</span></div><div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>一、Kafka 单节点部署</strong></span></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">Kafka中单节点部署又分为两种，一种为单节点单Broker部署，一种为单节点多Broker部署。因为是单节点的Kafka，所以在安装ZK时也只需要单节点即可。</span></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>ZooKeeper官网：</strong></span><a href="http://zookeeper.apache.org/" rel="nofollow"><span style="font-size:18px;background-color:rgb(255,255,255);">http://zookeeper.apache.org/</span></a></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">下载Zookeeper并解压到指定目录</span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">$ wget http://www-eu.apache.org/dist/zookeeper/zookeeper-3.5.1-alpha/zookeeper-3.5.1-alpha.tar.gz$ tar -zxvf zookeeper-3.5.1-alpha.tar.gz -c /opt/zookeeper</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">进入Zookeeper的config目录下</span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">$ cd /opt/zookeeper/conf</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">拷贝zoo_sample.cfg文件重命名为zoo.cfg，然后修改dataDir属性</span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"># 数据的存放目录dataDir=/home/hadoop/zkdata# 端口，默认就是2181clientPort=2181</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">配置环境变量</span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"># Zookeeper Environment Variableexport ZOOKEEPER_HOME=/opt/zookeeperexport PATH=$PATH:$ZOOKEEPER_HOME/bin</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>Zookeeper 启动停止命令</strong></span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">$ zkServer.sh start$ zkServer.sh stop</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;color:rgb(223,64,42);background-color:rgb(255,255,255);">安装完Zookeeper后，输入命令启动后，jps中并没有查看到QuorumPeerMain进程，说明没有启动成功，进入Zookeeper的log目录下查看日志，发现报了一个错误，如下</span></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;color:rgb(223,64,42);background-color:rgb(255,255,255);">AdminServer$AdminServerException: Problem starting AdminServer on address 0.0.0.0, port 8080 and command URL /commands</span></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;color:rgb(223,64,42);background-color:rgb(255,255,255);">原因：zookeeper的管理员端口被占用 </span></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;color:rgb(223,64,42);background-color:rgb(255,255,255);">解决：笔者使用的zookeeper的版本为3.5.1，该版本中有个内嵌的管理控制台是通过jetty启动，会占用8080 端口，需要修改配置里的“admin.serverPort=8080”，默认8080没有写出来，只要改为一个没使用的端口即可，例如：admin.serverPort=8181</span></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.33333;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>1.Kafka 单节点单Broker部署及使用</strong></span></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>部署架构</strong></span></div><div style="text-align:left;float:none;"><img src="https://img-blog.csdn.net/20180624161944283?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMyMjk3NDQ3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>配置Kafka</strong></span></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">官网下载：</span><a href="http://kafka.apache.org/quickstart" rel="nofollow"><span style="font-size:18px;background-color:rgb(255,255,255);">http://kafka.apache.org/quickstart</span></a></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;color:rgb(57,57,57);background-color:rgb(255,255,255);">配置kafka环境变量</span></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">进入kafka的config目录下，有一个server.properties，添加如下配置</span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"># broker的全局唯一编号，不能重复broker.id=0# 监听listeners=PLAINTEXT://:9092# 日志目录log.dirs=log.dirs=/home/hadoop/app/kafka/tmp/kafka-logs# 配置zookeeper的连接（如果不是本机，需要该为ip或主机名）zookeeper.connect=localhost:2181</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>启动Zookeeper</strong></span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">[hadoop@Master ~]$ zkServer.sh startZooKeeper JMX enabled by defaultUsing config: /opt/zookeeper/bin/../conf/zoo.cfgStarting zookeeper ... STARTED</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>启动Kafka</strong></span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">$ kafka-server-start.sh $KAFKA_HOME/config/server.properties</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">打印的日志信息没有报错，可以看到如下信息</span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">[Kafka Server 0], started (kafka.server.KafkaServer)</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">但是并不能保证Kafka已经启动成功，输入jps查看进程，如果可以看到Kafka进程，表示启动成功</span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">[hadoop@Master ~]$ jps9173 Kafka9462 Jps8589 QuorumPeerMain[hadoop@Master ~]$ jps -m9472 Jps -m9173 Kafka /opt/kafka/config/server.properties8589 QuorumPeerMain /opt/zookeeper/bin/../conf/zoo.cfg</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>创建topic</strong></span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">[hadoop@Master ~]$ kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">参数说明： </span></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">–zookeeper：指定kafka连接zk的连接url，该值和server.properties文件中的配置项{zookeeper.connect}一样 </span></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">–replication-factor：指定副本数量 </span></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">–partitions：指定分区数量 </span></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">–topic：主题名称</span></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>查看所有的topic信息</strong></span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">[hadoop@Master ~]$ kafka-topics.sh --list --zookeeper localhost:2181test</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>启动生产者</strong></span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">[hadoop@Master ~]$ kafka-console-producer.sh --broker-list localhost:9092 --topic test</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>启动消费者</strong></span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">[hadoop@Master ~]$ kafka-console-consumer.sh --zookeeper localhost:2181 --topic test --from-beginning</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.33333;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>2.Kafka 单节点多Broker部署及使用</strong></span></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>部署架构</strong></span></div><div style="text-align:left;float:none;"><img src="https://img-blog.csdn.net/20180624162015539?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMyMjk3NDQ3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>配置Kafka</strong></span></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">参考官网：</span><a href="http://kafka.apache.org/quickstart" rel="nofollow"><span style="font-size:18px;background-color:rgb(255,255,255);">http://kafka.apache.org/quickstart</span></a></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">拷贝server.properties三份</span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">[hadoop@Master ~]$ cd /opt/kafka/config[hadoop@Master config]$ cp server.properties server-1.properties [hadoop@Master config]$ cp server.properties server-2.properties [hadoop@Master config]$ cp server.properties server-3.properties </span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">修改server-1.properties文件</span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"># broker的全局唯一编号，不能重复broker.id=1# 监听listeners=PLAINTEXT://:9093# 日志目录log.dirs=/home/hadoop/kafka-logs-1</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">修改server-2.properties文件</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">修改server-3.properties文件</span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"># broker的全局唯一编号，不能重复broker.id=3# 监听listeners=PLAINTEXT://:9094# 日志目录log.dirs=/home/hadoop/kafka-logs-3</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>启动Zookeeper</strong></span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">[hadoop@Master ~]$ zkServer.sh startZooKeeper JMX enabled by defaultUsing config: /opt/zookeeper/bin/../conf/zoo.cfgStarting zookeeper ... STARTED</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>启动Kafka（分别启动server1、2、3）</strong></span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">$ kafka-server-start.sh $KAFKA_HOME/config/server-1.properties$ kafka-server-start.sh $KAFKA_HOME/config/server-2.properties$ kafka-server-start.sh $KAFKA_HOME/config/server-3.properties</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>查看进程</strong></span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">[hadoop@Master ~]$ jps11905 Kafka11619 Kafka8589 QuorumPeerMain12478 Jps12191 Kafka[hadoop@Master ~]$ jps -m11905 Kafka /opt/kafka/config/server-2.properties11619 Kafka /opt/kafka/config/server-1.properties12488 Jps -m8589 QuorumPeerMain /opt/zookeeper/bin/../conf/zoo.cfg12191 Kafka /opt/kafka/config/server-3.properties</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>创建topic（指定副本数量为3）</strong></span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">[hadoop@Master ~]$ kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 3 --partitions 1 --topic my-replicated-topicCreated topic "my-replicated-topic".</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>查看所有的topic信息</strong></span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">[hadoop@Master ~]$ kafka-topics.sh --list --zookeeper localhost:2181my-replicated-topictest</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>查看某个topic的详细信息</strong></span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">[hadoop@Master ~]$ kafka-topics.sh --describe --zookeeper localhost:2181 --topic my-replicated-topicTopic:my-replicated-topic   PartitionCount:1    ReplicationFactor:3 Configs:    Topic: my-replicated-topic  Partition: 0    Leader: 2   Replicas: 2,3,1 Isr: 2,3,1</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>启动生产者</strong></span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">$ kafka-console-producer.sh --broker-list localhost:9093,localhost:9094,localhost:9095 --topic my-replicated-topic</span></div><div style="white-space:pre-wrap;text-align:right;line-height:1.57143;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.625;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);"><strong>启动消费者</strong></span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><span style="font-size:18px;background-color:rgb(255,255,255);">$ kafka-console-consumer.sh --zookeeper localhost:2181 --topic my-replicated-topic --from-beginning</span></div><div style="white-space:pre-wrap;line-height:1.57143;text-align:left;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.36364;text-align:left;font-size:14px;"><br></div><div style="white-space:pre-wrap;line-height:1.36364;text-align:left;font-size:14px;"><br></div>            </div>
                </div>