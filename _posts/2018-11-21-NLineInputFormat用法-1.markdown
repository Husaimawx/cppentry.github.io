---
layout:     post
title:      NLineInputFormat用法-1
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<p>输入的数据：</p>
<div class="dp-highlighter bg_java">
<div class="bar">
<div class="tools"><strong>[java]</strong> <a href="http://blog.csdn.net/baolibin528/article/details/45075585#" rel="nofollow" class="ViewSource" title="view plain">
view plain</a><span> <a href="http://blog.csdn.net/baolibin528/article/details/45075585#" rel="nofollow" class="CopyToClipboard" title="copy">
copy</a></span><span> <a href="http://blog.csdn.net/baolibin528/article/details/45075585#" rel="nofollow" class="PrintSource" title="print">
print</a></span><a href="http://blog.csdn.net/baolibin528/article/details/45075585#" rel="nofollow" class="About" title="?">?</a></div>
</div>
<ol class="dp-j" start="1"><li class="alt"><span><span>[root</span><span class="annotation">@i</span><span>-love-you hadoop]# bin/hdfs dfs -text /input/hehe  </span></span></li><li><span>hadoop hello  </span></li><li class="alt"><span>hadoop me  </span></li><li><span>hadoop java  </span></li></ol></div>
<br><br><p>代码：</p>
<div class="dp-highlighter bg_java">
<div class="bar">
<div class="tools"><strong>[java]</strong> <a href="http://blog.csdn.net/baolibin528/article/details/45075585#" rel="nofollow" class="ViewSource" title="view plain">
view plain</a><span> <a href="http://blog.csdn.net/baolibin528/article/details/45075585#" rel="nofollow" class="CopyToClipboard" title="copy">
copy</a></span><span> <a href="http://blog.csdn.net/baolibin528/article/details/45075585#" rel="nofollow" class="PrintSource" title="print">
print</a></span><a href="http://blog.csdn.net/baolibin528/article/details/45075585#" rel="nofollow" class="About" title="?">?</a></div>
</div>
<ol class="dp-j" start="1"><li class="alt"><span><span class="keyword">package</span><span> inputformat;  </span></span></li><li><span>  </span></li><li class="alt"><span><span class="keyword">import</span><span> java.io.IOException;  </span></span></li><li><span>  </span></li><li class="alt"><span><span class="keyword">import</span><span> org.apache.hadoop.conf.Configuration;  </span></span></li><li><span><span class="keyword">import</span><span> org.apache.hadoop.fs.Path;  </span></span></li><li class="alt"><span><span class="keyword">import</span><span> org.apache.hadoop.io.LongWritable;  </span></span></li><li><span><span class="keyword">import</span><span> org.apache.hadoop.io.Text;  </span></span></li><li class="alt"><span><span class="keyword">import</span><span> org.apache.hadoop.mapreduce.Job;  </span></span></li><li><span><span class="keyword">import</span><span> org.apache.hadoop.mapreduce.Mapper;  </span></span></li><li class="alt"><span><span class="keyword">import</span><span> org.apache.hadoop.mapreduce.Reducer;  </span></span></li><li><span><span class="keyword">import</span><span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;  </span></span></li><li class="alt"><span><span class="keyword">import</span><span> org.apache.hadoop.mapreduce.lib.input.NLineInputFormat;  </span></span></li><li><span><span class="keyword">import</span><span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;  </span></span></li><li class="alt"><span><span class="keyword">import</span><span> org.apache.hadoop.mapreduce.lib.output.TextOutputFormat;  </span></span></li><li><span><span class="keyword">import</span><span> org.apache.hadoop.mapreduce.lib.partition.HashPartitioner;  </span></span></li><li class="alt"><span>  </span></li><li><span><span class="keyword">public</span><span> </span><span class="keyword">class</span><span> NLineInputFormatTest {  </span></span></li><li class="alt"><span>    <span class="keyword">public</span><span> </span><span class="keyword">static</span><span> </span><span class="keyword">class</span><span> MyMapper </span><span class="keyword">extends</span><span>  </span></span></li><li><span>            Mapper&lt;LongWritable, Text, Text, LongWritable&gt; {  </span></li><li class="alt"><span>        <span class="keyword">final</span><span> Text k2 = </span><span class="keyword">new</span><span> Text();  </span></span></li><li><span>        <span class="keyword">final</span><span> LongWritable v2 = </span><span class="keyword">new</span><span> LongWritable();  </span></span></li><li class="alt"><span>  </span></li><li><span>        <span class="keyword">protected</span><span> </span><span class="keyword">void</span><span> map(LongWritable key, Text value,  </span></span></li><li class="alt"><span>                Mapper&lt;LongWritable, Text, Text, LongWritable&gt;.Context context)  </span></li><li><span>                <span class="keyword">throws</span><span> InterruptedException, IOException {  </span></span></li><li class="alt"><span>            <span class="keyword">final</span><span> String line = value.toString();  </span></span></li><li><span>            <span class="keyword">final</span><span> String[] splited = line.split(</span><span class="string">"\\s"</span><span>);  </span></span></li><li class="alt"><span>            <span class="keyword">for</span><span> (String word : splited) {  </span></span></li><li><span>                k2.set(word);  </span></li><li class="alt"><span>                v2.set(<span class="number">1</span><span>);  </span></span></li><li><span>                context.write(k2, v2);  </span></li><li class="alt"><span>            }  </span></li><li><span>        }  </span></li><li class="alt"><span>    }  </span></li><li><span>  </span></li><li class="alt"><span>    <span class="keyword">public</span><span> </span><span class="keyword">static</span><span> </span><span class="keyword">class</span><span> MyReducer </span><span class="keyword">extends</span><span>  </span></span></li><li><span>            Reducer&lt;Text, LongWritable, Text, LongWritable&gt; {  </span></li><li class="alt"><span>        LongWritable v3 = <span class="keyword">new</span><span> LongWritable();  </span></span></li><li><span>  </span></li><li class="alt"><span>        <span class="keyword">protected</span><span> </span><span class="keyword">void</span><span> reduce(Text k2, Iterable&lt;LongWritable&gt; v2s,  </span></span></li><li><span>                Reducer&lt;Text, LongWritable, Text, LongWritable&gt;.Context context)  </span></li><li class="alt"><span>                <span class="keyword">throws</span><span> IOException, InterruptedException {  </span></span></li><li><span>            <span class="keyword">long</span><span> count = 0L;  </span></span></li><li class="alt"><span>            <span class="keyword">for</span><span> (LongWritable v2 : v2s) {  </span></span></li><li><span>                count += v2.get();  </span></li><li class="alt"><span>            }  </span></li><li><span>            v3.set(count);  </span></li><li class="alt"><span>            context.write(k2, v3);  </span></li><li><span>        }  </span></li><li class="alt"><span>    }  </span></li><li><span>  </span></li><li class="alt"><span>    <span class="keyword">public</span><span> </span><span class="keyword">static</span><span> </span><span class="keyword">void</span><span> main(String[] args) </span><span class="keyword">throws</span><span> Exception {  </span></span></li><li><span>        <span class="keyword">final</span><span> Configuration conf = </span><span class="keyword">new</span><span> Configuration();  </span></span></li><li class="alt"><span>        <span class="keyword">final</span><span> Job job = Job.getInstance(conf, NLineInputFormatTest.</span><span class="keyword">class</span><span>.getSimpleName());  </span></span></li><li><span>        <span class="comment">// 1.1</span><span>  </span></span></li><li class="alt"><span>        FileInputFormat.setInputPaths(job,  </span></li><li><span>                <span class="string">"hdfs://192.168.1.10:9000/input/hehe"</span><span>);  </span></span></li><li class="alt"><span>          </span></li><li><span>        <span class="comment">//这里改了一下，把TextInputFormat改成了NLineInputFormat</span><span>  </span></span></li><li class="alt"><span>        NLineInputFormat.setNumLinesPerSplit(job, Integer.parseInt(<span class="string">"2"</span><span>));  </span></span></li><li><span>        <span class="comment">//NLineInputFormat.setNumLinesPerSplit(job, Integer.parseInt(args[0]));</span><span>  </span></span></li><li class="alt"><span>        job.setInputFormatClass(NLineInputFormat.<span class="keyword">class</span><span>);  </span></span></li><li><span>          </span></li><li class="alt"><span>          </span></li><li><span>        <span class="comment">// 1.2</span><span>  </span></span></li><li class="alt"><span>        job.setMapperClass(MyMapper.<span class="keyword">class</span><span>);  </span></span></li><li><span>        job.setMapOutputKeyClass(Text.<span class="keyword">class</span><span>);  </span></span></li><li class="alt"><span>        job.setMapOutputValueClass(LongWritable.<span class="keyword">class</span><span>);  </span></span></li><li><span>        <span class="comment">// 1.3 默认只有一个分区</span><span>  </span></span></li><li class="alt"><span>        job.setPartitionerClass(HashPartitioner.<span class="keyword">class</span><span>);  </span></span></li><li><span>        job.setNumReduceTasks(<span class="number">1</span><span>);  </span></span></li><li class="alt"><span>        <span class="comment">// 1.4省略不写</span><span>  </span></span></li><li><span>        <span class="comment">// 1.5省略不写</span><span>  </span></span></li><li class="alt"><span>  </span></li><li><span>        <span class="comment">// 2.2</span><span>  </span></span></li><li class="alt"><span>        job.setReducerClass(MyReducer.<span class="keyword">class</span><span>);  </span></span></li><li><span>        job.setOutputKeyClass(Text.<span class="keyword">class</span><span>);  </span></span></li><li class="alt"><span>        job.setOutputValueClass(LongWritable.<span class="keyword">class</span><span>);  </span></span></li><li><span>        <span class="comment">// 2.3</span><span>  </span></span></li><li class="alt"><span>        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span><span> Path(  </span></span></li><li><span>                <span class="string">"hdfs://192.168.1.10:9000/out1"</span><span>));  </span></span></li><li class="alt"><span>        job.setOutputFormatClass(TextOutputFormat.<span class="keyword">class</span><span>);  </span></span></li><li><span>        <span class="comment">// 执行打成jar包的程序时，必须调用下面的方法</span><span>  </span></span></li><li class="alt"><span>        job.setJarByClass(NLineInputFormatTest.<span class="keyword">class</span><span>);  </span></span></li><li><span>        job.waitForCompletion(<span class="keyword">true</span><span>);  </span></span></li><li class="alt"><span>    }  </span></li><li><span>}  </span></li></ol></div>
<br><br><p>结果：</p>
<div class="dp-highlighter bg_java">
<div class="bar">
<div class="tools"><strong>[java]</strong> <a href="http://blog.csdn.net/baolibin528/article/details/45075585#" rel="nofollow" class="ViewSource" title="view plain">
view plain</a><span> <a href="http://blog.csdn.net/baolibin528/article/details/45075585#" rel="nofollow" class="CopyToClipboard" title="copy">
copy</a></span><span> <a href="http://blog.csdn.net/baolibin528/article/details/45075585#" rel="nofollow" class="PrintSource" title="print">
print</a></span><a href="http://blog.csdn.net/baolibin528/article/details/45075585#" rel="nofollow" class="About" title="?">?</a></div>
</div>
<ol class="dp-j" start="1"><li class="alt"><span><span>[root</span><span class="annotation">@i</span><span>-love-you hadoop]# bin/hadoop jar data/nline.jar  </span></span></li><li><span><span class="number">15</span><span>/</span><span class="number">04</span><span>/</span><span class="number">16</span><span> </span><span class="number">15</span><span>:</span><span class="number">04</span><span>:</span><span class="number">48</span><span> INFO client.RMProxy: Connecting to ResourceManager at /</span><span class="number">0.0</span><span>.</span><span class="number">0.0</span><span>:</span><span class="number">8032</span><span>  </span></span></li><li class="alt"><span><span class="number">15</span><span>/</span><span class="number">04</span><span>/</span><span class="number">16</span><span> </span><span class="number">15</span><span>:</span><span class="number">04</span><span>:</span><span class="number">50</span><span> WARN mapreduce.JobSubmitter: Hadoop command-line option parsing not performed. Implement the Tool </span><span class="keyword">interface</span><span> and execute your application with ToolRunner to remedy </span><span class="keyword">this</span><span>.  </span></span></li><li><span><span class="number">15</span><span>/</span><span class="number">04</span><span>/</span><span class="number">16</span><span> </span><span class="number">15</span><span>:</span><span class="number">04</span><span>:</span><span class="number">51</span><span> INFO input.FileInputFormat: Total input paths to process : </span><span class="number">1</span><span>  </span></span></li><li class="alt"><span><span class="number">15</span><span>/</span><span class="number">04</span><span>/</span><span class="number">16</span><span> </span><span class="number">15</span><span>:</span><span class="number">04</span><span>:</span><span class="number">52</span><span> INFO mapreduce.JobSubmitter: number of splits:</span><span class="number">2</span><span>  </span></span></li><li><span><span class="number">15</span><span>/</span><span class="number">04</span><span>/</span><span class="number">16</span><span> </span><span class="number">15</span><span>:</span><span class="number">04</span><span>:</span><span class="number">53</span><span> INFO mapreduce.JobSubmitter: Submitting tokens </span><span class="keyword">for</span><span> job: job_1429167587909_0001  </span></span></li><li class="alt"><span><span class="number">15</span><span>/</span><span class="number">04</span><span>/</span><span class="number">16</span><span> </span><span class="number">15</span><span>:</span><span class="number">04</span><span>:</span><span class="number">54</span><span> INFO impl.YarnClientImpl: Submitted application application_1429167587909_0001  </span></span></li><li><span><span class="number">15</span><span>/</span><span class="number">04</span><span>/</span><span class="number">16</span><span> </span><span class="number">15</span><span>:</span><span class="number">04</span><span>:</span><span class="number">54</span><span> INFO mapreduce.Job: The url to track the job: http:</span><span class="comment">//i-love-you:8088/proxy/application_1429167587909_0001/</span><span>  </span></span></li><li class="alt"><span><span class="number">15</span><span>/</span><span class="number">04</span><span>/</span><span class="number">16</span><span> </span><span class="number">15</span><span>:</span><span class="number">04</span><span>:</span><span class="number">54</span><span> INFO mapreduce.Job: Running job: job_1429167587909_0001  </span></span></li><li><span><span class="number">15</span><span>/</span><span class="number">04</span><span>/</span><span class="number">16</span><span> </span><span class="number">15</span><span>:</span><span class="number">05</span><span>:</span><span class="number">38</span><span> INFO mapreduce.Job: Job job_1429167587909_0001 running in uber mode : </span><span class="keyword">false</span><span>  </span></span></li><li class="alt"><span><span class="number">15</span><span>/</span><span class="number">04</span><span>/</span><span class="number">16</span><span> </span><span class="number">15</span><span>:</span><span class="number">05</span><span>:</span><span class="number">38</span><span> INFO mapreduce.Job:  map </span><span class="number">0</span><span>% reduce </span><span class="number">0</span><span>%  </span></span></li><li><span><span class="number">15</span><span>/</span><span class="number">04</span><span>/</span><span class="number">16</span><span> </span><span class="number">15</span><span>:</span><span class="number">08</span><span>:</span><span class="number">31</span><span> INFO mapreduce.Job:  map </span><span class="number">100</span><span>% reduce </span><span class="number">0</span><span>%  </span></span></li><li class="alt"><span><span class="number">15</span><span>/</span><span class="number">04</span><span>/</span><span class="number">16</span><span> </span><span class="number">15</span><span>:</span><span class="number">10</span><span>:</span><span class="number">03</span><span> INFO mapreduce.Job:  map </span><span class="number">100</span><span>% reduce </span><span class="number">100</span><span>%  </span></span></li><li><span><span class="number">15</span><span>/</span><span class="number">04</span><span>/</span><span class="number">16</span><span> </span><span class="number">15</span><span>:</span><span class="number">10</span><span>:</span><span class="number">07</span><span> INFO mapreduce.Job: Job job_1429167587909_0001 completed successfully  </span></span></li><li class="alt"><span><span class="number">15</span><span>/</span><span class="number">04</span><span>/</span><span class="number">16</span><span> </span><span class="number">15</span><span>:</span><span class="number">10</span><span>:</span><span class="number">08</span><span> INFO mapreduce.Job: Counters: </span><span class="number">49</span><span>  </span></span></li><li><span>        File System Counters  </span></li><li class="alt"><span>                FILE: Number of bytes read=<span class="number">101</span><span>  </span></span></li><li><span>                FILE: Number of bytes written=<span class="number">318117</span><span>  </span></span></li><li class="alt"><span>                FILE: Number of read operations=<span class="number">0</span><span>  </span></span></li><li><span>                FILE: Number of large read operations=<span class="number">0</span><span>  </span></span></li><li class="alt"><span>                FILE: Number of write operations=<span class="number">0</span><span>  </span></span></li><li><span>                HDFS: Number of bytes read=<span class="number">248</span><span>  </span></span></li><li class="alt"><span>                HDFS: Number of bytes written=<span class="number">29</span><span>  </span></span></li><li><span>                HDFS: Number of read operations=<span class="number">9</span><span>  </span></span></li><li class="alt"><span>                HDFS: Number of large read operations=<span class="number">0</span><span>  </span></span></li><li><span>                HDFS: Number of write operations=<span class="number">2</span><span>  </span></span></li><li class="alt"><span>        Job Counters  </span></li><li><span>                Launched map tasks=<span class="number">2</span><span>  </span></span></li><li class="alt"><span>                Launched reduce tasks=<span class="number">1</span><span>  </span></span></li><li><span>                Other local map tasks=<span class="number">2</span><span>  </span></span></li><li class="alt"><span>                Total time spent by all maps in occupied slots (ms)=<span class="number">356494</span><span>  </span></span></li><li><span>                Total time spent by all reduces in occupied slots (ms)=<span class="number">63006</span><span>  </span></span></li><li class="alt"><span>                Total time spent by all map tasks (ms)=<span class="number">356494</span><span>  </span></span></li><li><span>                Total time spent by all reduce tasks (ms)=<span class="number">63006</span><span>  </span></span></li><li class="alt"><span>                Total vcore-seconds taken by all map tasks=<span class="number">356494</span><span>  </span></span></li><li><span>                Total vcore-seconds taken by all reduce tasks=<span class="number">63006</span><span>  </span></span></li><li class="alt"><span>                Total megabyte-seconds taken by all map tasks=<span class="number">365049856</span><span>  </span></span></li><li><span>                Total megabyte-seconds taken by all reduce tasks=<span class="number">64518144</span><span>  </span></span></li><li class="alt"><span>        Map-Reduce Framework  </span></li><li><span>                Map input records=<span class="number">3</span><span>  </span></span></li><li class="alt"><span>                Map output records=<span class="number">6</span><span>  </span></span></li><li><span>                Map output bytes=<span class="number">83</span><span>  </span></span></li><li class="alt"><span>                Map output materialized bytes=<span class="number">107</span><span>  </span></span></li><li><span>                Input split bytes=<span class="number">200</span><span>  </span></span></li><li class="alt"><span>                Combine input records=<span class="number">0</span><span>  </span></span></li><li><span>                Combine output records=<span class="number">0</span><span>  </span></span></li><li class="alt"><span>                Reduce input groups=<span class="number">4</span><span>  </span></span></li><li><span>                Reduce shuffle bytes=<span class="number">107</span><span>  </span></span></li><li class="alt"><span>                Reduce input records=<span class="number">6</span><span>  </span></span></li><li><span>                Reduce output records=<span class="number">4</span><span>  </span></span></li><li class="alt"><span>                Spilled Records=<span class="number">12</span><span>  </span></span></li><li><span>                Shuffled Maps =<span class="number">2</span><span>  </span></span></li><li class="alt"><span>                Failed Shuffles=<span class="number">0</span><span>  </span></span></li><li><span>                Merged Map outputs=<span class="number">2</span><span>  </span></span></li><li class="alt"><span>                GC time elapsed (ms)=<span class="number">16068</span><span>  </span></span></li><li><span>                CPU time spent (ms)=<span class="number">7560</span><span>  </span></span></li><li class="alt"><span>                Physical memory (bytes) snapshot=<span class="number">356200448</span><span>  </span></span></li><li><span>                Virtual memory (bytes) snapshot=<span class="number">2527195136</span><span>  </span></span></li><li class="alt"><span>                Total committed heap usage (bytes)=<span class="number">257171456</span><span>  </span></span></li><li><span>        Shuffle Errors  </span></li><li class="alt"><span>                BAD_ID=<span class="number">0</span><span>  </span></span></li><li><span>                CONNECTION=<span class="number">0</span><span>  </span></span></li><li class="alt"><span>                IO_ERROR=<span class="number">0</span><span>  </span></span></li><li><span>                WRONG_LENGTH=<span class="number">0</span><span>  </span></span></li><li class="alt"><span>                WRONG_MAP=<span class="number">0</span><span>  </span></span></li><li><span>                WRONG_REDUCE=<span class="number">0</span><span>  </span></span></li><li class="alt"><span>        File Input Format Counters  </span></li><li><span>                Bytes Read=<span class="number">48</span><span>  </span></span></li><li class="alt"><span>        File Output Format Counters  </span></li><li><span>                Bytes Written=<span class="number">29</span><span>  </span></span></li></ol></div>
<br><br><p><br></p>
<p><br></p>
<p>解析：</p>
<p>我设置每2行为一个InputSplit：</p>
<div class="dp-highlighter bg_java">
<div class="bar">
<div class="tools"><strong>[java]</strong> <a href="http://blog.csdn.net/baolibin528/article/details/45075585#" rel="nofollow" class="ViewSource" title="view plain">
view plain</a><span> <a href="http://blog.csdn.net/baolibin528/article/details/45075585#" rel="nofollow" class="CopyToClipboard" title="copy">
copy</a></span><span> <a href="http://blog.csdn.net/baolibin528/article/details/45075585#" rel="nofollow" class="PrintSource" title="print">
print</a></span><a href="http://blog.csdn.net/baolibin528/article/details/45075585#" rel="nofollow" class="About" title="?">?</a></div>
</div>
<ol class="dp-j" start="1"><li class="alt"><span><span>NLineInputFormat.setNumLinesPerSplit(job, Integer.parseInt(</span><span class="string">"2"</span><span>));  </span></span></li></ol></div>
<br><p>在输出中可以看到splits的个数：</p>
<div class="bar">
<div class="tools"><strong>[java]</strong> <a href="http://blog.csdn.net/baolibin528/article/details/45075585#" rel="nofollow" class="ViewSource" title="view plain">
view plain</a><span> <a href="http://blog.csdn.net/baolibin528/article/details/45075585#" rel="nofollow" class="CopyToClipboard" title="copy">
copy</a></span><span> <a href="http://blog.csdn.net/baolibin528/article/details/45075585#" rel="nofollow" class="PrintSource" title="print">
print</a></span><a href="http://blog.csdn.net/baolibin528/article/details/45075585#" rel="nofollow" class="About" title="?">?</a></div>
</div>
<ol class="dp-j" start="1"><li class="alt"><span><span class="number">15</span><span>/</span><span class="number">04</span><span>/</span><span class="number">16</span><span> </span><span class="number">15</span><span>:</span><span class="number">04</span><span>:</span><span class="number">52</span><span> INFO mapreduce.JobSubmitter: number of splits:</span><span class="number">2</span><span> 
<br></span></span></li></ol>            </div>
                </div>