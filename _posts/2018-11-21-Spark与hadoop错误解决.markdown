---
layout:     post
title:      Spark与hadoop错误解决
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <div style="text-align:left;line-height:1.75;font-size:14px;">1.</div><div style="text-align:left;line-height:1.75;font-size:14px;">单机运行spark</div><div style="text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-align:left;line-height:1.75;font-size:14px;">启动spark：</div><div style="text-align:left;line-height:1.75;font-size:14px;">./sbin/start-master.sh</div><div style="text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-align:left;line-height:1.75;font-size:14px;">启动worker:</div><div style="text-align:left;line-height:1.75;font-size:14px;">./bin/spark-class org.apache.spark.deploy.worker.Worker spark://gry-VirtualBox:7077 （通过localhost:8080得到）</div><div style="text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-align:left;line-height:1.75;font-size:14px;">提交jar包：</div><div style="text-align:left;line-height:1.75;font-size:14px;">./bin/spark-submit --master spark://gry-VirtualBox:7077  --class WordCount /home/gry/submitJars/test.jar</div><div style="text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-align:left;line-height:1.75;font-size:14px;">2.更改hadoop用户名：</div><div style="text-align:left;line-height:1.75;font-size:14px;"><span style="color:rgb(68,68,68);background-color:rgb(241,241,241);">用户权限不对， 用 ls -l /home/hadoop 去看一下 hadoop-2.6.0目录属于谁 ？ 如果不是属于hadoop可以 用chown改成 hadoop</span></div><div style="text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-align:left;line-height:1.75;font-size:14px;"><span style="color:rgb(68,68,68);background-color:rgb(241,241,241);">3.</span></div><div style="text-align:left;line-height:1.75;font-size:14px;"><span style="color:rgb(68,68,68);background-color:rgb(241,241,241);">org.apache.hadoop.hdfs.server.common.InconsistentFSStateException: Directory /home/pengpeng/software/tmp/dfs/name is in an inconsistent state: storage directory does not exist or is not accessible.</span></div><div style="text-align:left;line-height:1.75;font-size:14px;"><span style="color:rgb(68,68,68);background-color:rgb(241,241,241);">文件夹权限不对，参照2.</span></div><div style="text-align:left;line-height:1.75;font-size:14px;"><span style="color:rgb(68,68,68);background-color:rgb(241,241,241);">多看log文件</span></div><div style="text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-align:left;line-height:1.75;font-size:14px;">4.91log文件：</div><div style="text-align:left;line-height:1.75;font-size:14px;"> Failed to add storage directory [DISK]file:/home/pengpeng/software/tmp/dfs/data/</div><div style="text-align:left;line-height:1.75;font-size:14px;">Incompatible clusterIDs in /home/pengpeng/software/tmp/dfs/data: namenode clusterID = CID-62c4e5e3-572e-4a4e-9dd4-e61ba00fec41; datanode clusterID = CID-052c8759-0c4b-4c18-84a6-d2f21e4b7072</div><div style="text-align:left;line-height:1.75;font-size:14px;"><a href="http://blog.csdn.net/gis_101/article/details/52679914" rel="nofollow"><span style="color:rgb(0,56,132);">http://blog.csdn.net/gis_101/article/details/52679914</span></a></div><div style="text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:15px;color:rgb(63,63,63);background-color:rgb(255,255,255);">由于无法通过直接修改VERSION文件里clusterID、namespaceID解决问题。于是尝试删除了一下各个数据节点DataNode“/tmp/hadoop-hadoop/dfs/data/”目录下current文件夹，再重新启动hadoop，发现hadoop运行起来了。各个数据节点的DataNode、NodeManager等进程信息正常，查看各个节点的日志，一切显示正常。然后查看了一下“/tmp/hadoop-hadoop/dfs/data/”目录，发现自动创建了一个current目录。</span></div><div style="text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:15px;color:rgb(63,63,63);background-color:rgb(255,255,255);">5.</span></div><div style="text-align:left;line-height:1.75;font-size:14px;"><span style="color:rgb(51,51,51);background-color:rgb(255,255,255);">hadoop dfsadmin -report 查看datanode</span></div><div style="text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-align:left;line-height:1.75;font-size:14px;"><span style="color:rgb(51,51,51);background-color:rgb(255,255,255);">6.</span></div><div style="text-align:left;line-height:1.75;font-size:14px;"><span style="color:rgb(51,51,51);background-color:rgb(255,255,255);">查看hdfs文件大小：</span></div><div style="text-align:left;line-height:1.75;font-size:14px;"><span style="font-family:'Courier New';background-color:rgb(255,255,255);">使用方法：hadoop fs -du URI [URI …]</span></div><div style="line-height:1.28;text-align:left;font-size:14px;"><span style="font-size:12px;font-family:Verdana;background-color:rgb(255,255,255);">显示目录中所有文件的大小，或者当只指定一个文件时，显示此文件的大小。</span></div><div style="line-height:1.28;text-align:left;font-size:14px;"><span style="font-size:12px;font-family:Verdana;background-color:rgb(255,255,255);">示例：</span></div><div style="line-height:1.28;text-align:left;font-size:14px;"><span style="font-family:'Courier New';background-color:rgb(255,255,255);">hadoop fs -du /user/hadoop/dir1 /user/hadoop/file1 hdfs://host:port/user/hadoop/dir1</span><span style="font-size:12px;font-family:Verdana;background-color:rgb(255,255,255);"> </span></div><div style="line-height:1.28;text-align:left;font-size:14px;"><span style="font-size:12px;font-family:Verdana;background-color:rgb(255,255,255);">返回值：</span></div><div style="line-height:1.28;text-align:left;font-size:14px;"><span style="font-family:'Courier New';background-color:rgb(255,255,255);">成功返回0，失败返回-1。</span><span style="font-size:12px;font-family:Verdana;background-color:rgb(255,255,255);"> </span></div><div style="line-height:1.28;text-align:left;font-size:14px;"><br></div><div style="line-height:1.28;text-align:left;font-size:14px;"><span style="background-color:rgb(255,255,255);">7.</span></div><div style="line-height:1.28;text-align:left;font-size:14px;"><span style="background-color:rgb(255,255,255);">spark 查看节点，输入jps</span></div><div style="line-height:1.28;text-align:left;font-size:14px;"><br></div><div style="line-height:1.28;text-align:left;font-size:14px;"><span style="background-color:rgb(255,255,255);">8.</span></div><div style="line-height:1.28;text-align:left;font-size:14px;"><span style="background-color:rgb(255,255,255);">hadoop把文件复制到本地·：</span></div><div style="line-height:1.28;text-align:left;font-size:14px;"><span style="font-size:16px;background-color:rgb(255,255,255);">hadoop fs -get /user/hadoop/file localfile</span></div><div style="text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-align:left;line-height:1.75;font-size:14px;">9.hadoop删除文件夹：</div><div style="text-align:left;line-height:1.75;font-size:14px;">hadoop fs -rm &lt; hdfs file &gt; ...</div><div style="text-align:left;line-height:1.75;font-size:14px;">hadoop fs -rm -r &lt; hdfs dir&gt;...</div><div style="text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-align:left;line-height:1.75;font-size:14px;">10.hadoop上传文件：</div><div style="text-align:left;line-height:1.75;font-size:14px;">hadoop fs -put &lt; local file &gt; &lt; hdfs file &gt;</div><div style="text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-align:left;line-height:1.75;font-size:14px;"><br></div>            </div>
                </div>