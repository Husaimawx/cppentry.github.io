---
layout:     post
title:      Hive深入浅出
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<h2 style="color:rgb(51,51,51);font-family:Arial;line-height:26px;">
</h2><p class="headline-1 bk-sidecatalog-title" style="border-bottom-color:rgb(222,223,225);border-bottom-width:1px;border-bottom-style:solid;clear:both;">
<span style="color:rgb(51,102,153);"><span style="line-height:36px;font-size:22px;">  Hive是什么</span></span></p>

<br style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"><p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
</p>
<p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:22px;">
<span style="line-height:26px;"><strong>1) Hive是什么？</strong></span></p>
<p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:22px;">
这里引用 Hive wiki 上的介绍：</p>
<p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:22px;">
<em>Hive is a data warehouse infrastructure built on top of Hadoop. It provides tools to enable easy data ETL, a mechanism to put structures on the data, and the capability to querying and analysis of large data sets stored in Hadoop files. Hive defines a simple
 SQL-like query language, called QL, that enables users familiar with SQL to query the data. At the same time, this language also allows programmers who are familiar with the MapReduce fromwork to be able to plug in their custom mappers and reducers to perform
 more sophisticated analysis that may not be supported by the built-in capabilities of the language.</em></p>
<p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:22px;">
Hive 是建立在 Hadoop 上的数据仓库基础构架。它提供了一系列的工具，可以用来进行数据提取转化加载（ETL），这是一种可以存储、查询和分析存储在 Hadoop 中的大规模数据的机制。Hive 定义了简单的类 SQL 查询语言，称为 QL，它允许熟悉 SQL 的用户查询数据。同时，这个语言也允许熟悉 MapReduce 开发者的开发自定义的 mapper 和 reducer 来处理内建的 mapper 和 reducer 无法完成的复杂的分析工作。</p>
<p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:22px;">
<em>Hive does not mandate read or written data be in the “Hive format”—there is no such thing. Hive works equally well on Thrift, control delimited, or your specialized data formats. Please see File Format and SerDe in Developer Guide for details.<br></em><img src="https://img-blog.csdn.net/20140219104739046?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGd1aXN1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" style="border:none;"><br>
Hive 没有专门的数据格式。 Hive 可以很好的工作在 Thrift 之上，控制分隔符，也允许用户指定数据格式。</p>
<p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:22px;">
<span style="line-height:26px;"><strong>2) Hive不是什么？</strong></span><br></p>
<p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:22px;">
<span style="line-height:26px;">        Hive基于hadoop，hadoop是批处理系统，不能保证低延迟，因此，hive的查询也不能保证低延迟。<br>
        <span style="color:rgb(51,102,255);"><strong>Hive的工作模式是提交一个任务，等到任务结束时被通知，而不是实时查询。</strong></span>相对应的是，类似于oracle这样的系统当运行于小数据集的时候，响应非常快，可当处理的数据集非常大的时候，可能需要数小时。需要说明的是，hive即使在很小的数据集上运行，也可能需要数分钟才能完成。<br>
    总之，低延迟不是hive追求的首要目标。hive的设计目标是：可伸缩、可扩展、容错及输入格式松耦合。<br></span></p>
<p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:22px;">
<span style="line-height:26px;"><br></span></p>
<p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:22px;">
<strong>Hive 资源</strong></p>
<p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:22px;">
Hive 本身提供了较丰富的文档，以下链接提供了 Hive 的一些基础文档：</p>
<ul style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:22px;"><li>FaceBook 镜像（被墙）：[[http://mirror.facebook.com/facebook/hive]]</li><li>Wiki 页面：[[http://wiki.apache.org/hadoop/Hive]]</li><li>入门指南：[[http://wiki.apache.org/hadoop/Hive/GettingStarted]]</li><li>查询语言指南：[[http://wiki.apache.org/hadoop/Hive/HiveQL]]</li><li>演示文稿：[[http://wiki.apache.org/hadoop/Hive/Presentations]]</li><li>蓝图：[[http://wiki.apache.org/hadoop/Hive/Roadmap]]</li></ul><p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:22px;">
大多数有关 Hive 的使用和特性的问题可以从以上的链接中寻找到答案。当然，由于 Hive 本身在不断的发展中，文档的更新速度很多时候都赶不上 Hive 本身的更新速度，若希望了解 Hive 的最新动态或者遇到 Bug，可以加入 Hive 的邮件列表：<br>
* User: hive-user@hadoop.apache.org<br>
* Developer: hive-dev@hadoop.apache.org</p>
<p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:22px;">
</p>
<h2 style="color:rgb(51,51,51);font-family:Arial;line-height:26px;">
<a name="t2" style="color:rgb(51,102,153);"></a>
</h2><p class="headline-1 bk-sidecatalog-title" style="border-bottom-color:rgb(222,223,225);border-bottom-width:1px;border-bottom-style:solid;clear:both;">
<span style="color:rgb(51,102,153);"><span style="line-height:36px;font-size:22px;">1.  为什么使用Hive</span></span></p>

<p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
</p>
<p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:22px;">
</p>
<div style="color:rgb(51,51,51);font-size:14px;border-width:0px;overflow:hidden;font-family:verdana, arial, helvetica, sans-serif;line-height:21px;background-color:rgb(250,250,250);">
<div class="O" style="border-width:0px;overflow:hidden;">
<div style="border-width:0px;overflow:hidden;">
<div class="O" style="border-width:0px;overflow:hidden;">
<span><strong>面临的问题</strong></span></div>
</div>
<div style="border-width:0px;overflow:hidden;">
<div class="O" style="border-width:0px;overflow:hidden;">
<div style="border-width:0px;overflow:hidden;">  人员学习成本太高</div>
<div style="border-width:0px;overflow:hidden;">  项目周期要求太短
<div class="O" style="border-width:0px;overflow:hidden;">
  我只是需要一个简单的环境
<div class="O" style="border-width:0px;overflow:hidden;">
  MapReduce  如何搞定
<div class="O" style="border-width:0px;overflow:hidden;">
  复杂查询好难</div>
<div class="O" style="border-width:0px;overflow:hidden;">
  Join如何实现</div>
<div class="O" style="border-width:0px;overflow:hidden;">
<div class="O" style="border-width:0px;overflow:hidden;">
<span>为什么要使用Hive</span></div>
</div>
<div class="O" style="border-width:0px;overflow:hidden;">
<div class="O" style="border-width:0px;overflow:hidden;">
<div style="border-width:0px;overflow:hidden;">•操作接口采用类SQL语法，提供快速开发的能力</div>
<div style="border-width:0px;overflow:hidden;">•避免了去写MapReduce，减少开发人员的学习成本</div>
<div style="border-width:0px;overflow:hidden;">•扩展功能很方便</div>
<div style="border-width:0px;overflow:hidden;"> </div>
<div style="border-width:0px;overflow:hidden;">
<div class="O" style="border-width:0px;overflow:hidden;">
<span class="bold" lang="en-us" style="font-weight:bold;" xml:lang="en-us">Hive的特点</span></div>
<div class="O" style="border-width:0px;overflow:hidden;">
<div style="border-width:0px;overflow:hidden;">
<div class="O" style="border-width:0px;overflow:hidden;">
•可扩展</div>
<div class="O1" style="border-width:0px;overflow:hidden;">
Hive可以自由的扩展集群的规模，一般情况下不需要重启服务</div>
<div class="O" style="border-width:0px;overflow:hidden;">
•延展性</div>
<div class="O1" style="border-width:0px;overflow:hidden;">
Hive支持用户自定义函数，用户可以根据自己的需求来实现自己的函数</div>
<div class="O" style="border-width:0px;overflow:hidden;">
•容错</div>
<div class="O1" style="border-width:0px;overflow:hidden;">
良好的容错性，节点出现问题SQL仍可完成执行</div>
<div class="O" style="border-width:0px;overflow:hidden;">
<br></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
</p>
<p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:22px;">
</p>
<p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:22px;">
</p>
<h2 style="color:rgb(51,51,51);font-family:Arial;line-height:26px;">
<a name="t3" style="color:rgb(51,102,153);"></a>
</h2><p class="headline-1 bk-sidecatalog-title" style="border-bottom-color:rgb(222,223,225);border-bottom-width:1px;border-bottom-style:solid;clear:both;">
<span style="color:rgb(51,102,153);"><span style="line-height:36px;font-size:22px;">2.  Hive体系结构</span></span></p>

<p style="color:rgb(51,51,51);font-family:verdana, sans-serif;font-size:13px;line-height:17px;">
Hive 的结构如图所示，</p>
<p style="color:rgb(51,51,51);font-family:verdana, sans-serif;font-size:13px;line-height:17px;text-align:center;">
<img src="https://img-blog.csdn.net/20140208152646000?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGd1aXN1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" style="border:none;"><br></p>
<p style="color:rgb(51,51,51);font-family:verdana, sans-serif;font-size:13px;line-height:17px;text-align:center;">
<br></p>
<p style="color:rgb(51,51,51);font-family:verdana, sans-serif;font-size:13px;line-height:17px;">
主要分为以下几个部分：</p>
<ul style="color:rgb(51,51,51);font-size:14px;font-family:verdana, sans-serif;line-height:17px;"><li style="font-size:13px;"><span style="color:rgb(255,102,0);">用户接口，</span>包括 命令行CLI，Client，<span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;">Web界面</span>WUI，<span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;">JDBC/ODBC接口等</span></li><li style="font-size:13px;"><span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;"><span style="line-height:17.316667556762695px;"><span style="line-height:17.316667556762695px;"><span style="color:rgb(255,102,0);">中间件：</span></span>包括thrift接口和JDBC/ODBC的服务端，用于整合</span><span style="line-height:17.316667556762695px;background-color:rgb(255,255,102);">Hive</span><span style="line-height:17.316667556762695px;">和其他程序。</span><br></span></li><li><span style="color:rgb(255,102,0);font-size:13px;"><span style="font-family:Arial, Helvetica, FreeSans, sans-serif;font-size:14px;line-height:17.316667556762695px;">元数据metadata</span>存储</span><span style="font-size:12px;">，通常是存储在关系数据库如 mysql, derby 中的<span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;">系统参数</span></span></li><li style="font-size:13px;"><span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;"><span style="color:rgb(255,102,0);">底层驱动</span></span><span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;">：<span style="line-height:17.316667556762695px;">包括HiveQL</span></span>解释器、编译器、优化器、执行器（引擎）。</li><li style="font-size:13px;"><span style="color:rgb(255,102,0);">Hadoop</span>：用 HDFS 进行存储，利用 MapReduce 进行计算。</li></ul><ol style="color:rgb(51,51,51);font-family:verdana, sans-serif;font-size:13px;line-height:17px;"><li>用户接口主要有三个：CLI，Client 和 WUI。其中最常用的是 CLI，Cli 启动的时候，会同时启动一个 Hive 副本。Client 是 Hive 的客户端，用户连接至 Hive Server。在启动 Client 模式的时候，需要指出 Hive Server 所在节点，并且在该节点启动 Hive Server。 WUI 是通过浏览器访问 Hive。</li><li>Hive 将元数据存储在数据库中，如 mysql、derby。Hive 中的元数据包括表的名字，表的列和分区及其属性，表的属性（是否为外部表等），表的数据所在目录等。</li><li>解释器、编译器、优化器完成 HQL 查询语句从词法分析、语法分析、编译、优化以及查询计划的生成。生成的查询计划存储在 HDFS 中，并在随后有 MapReduce 调用执行。</li><li>Hive 的数据存储在 HDFS 中，大部分的查询由 MapReduce 完成（包含 * 的查询，比如 select * from tbl 不会生成 MapRedcue 任务）。</li></ol><div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><strong>Hive与Hadoop之前的关系：</strong></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><img src="https://img-blog.csdn.net/20140219105057687?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGd1aXN1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" style="border:none;"><br></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><br></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><br></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><br></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;"><span style="line-height:17px;"></span></span>
<h2><a name="t4" style="color:rgb(51,102,153);"></a>
</h2><p class="headline-1 bk-sidecatalog-title" style="border-bottom-color:rgb(222,223,225);border-bottom-width:1px;border-bottom-style:solid;clear:both;">
<span style="color:rgb(51,102,153);"><span style="line-height:36px;font-size:22px;">3.  Hive元数据存储</span></span></p>

</div>
<p style="color:rgb(51,51,51);font-size:14px;font-family:verdana, sans-serif;line-height:17px;">
<span style="font-size:13px;">   </span><span style="font-size:12px;">    <span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;">MetaStore类似于</span><span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;background-color:rgb(255,255,102);">Hive</span><span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;">的目录。它存放了有个表、区、列、类型、规则模型的所有信息。并且它可以通过thrift接口进</span><span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;background-color:rgb(255,102,255);">行</span><span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;">修改和查询。它为编译器提供高效的服务，所以，它会存放在一个传统的RDBMS，利用关系模型进</span><span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;background-color:rgb(255,102,255);">行</span><span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;">管理。这个信息非常重要，所以需要备份，并且支持查询的可扩展性。</span></span></p>
<p style="color:rgb(51,51,51);font-family:verdana, sans-serif;font-size:13px;line-height:17px;">
     Hive 将元数据存储在 RDBMS 中，有三种模式可以连接到数据库：</p>
<ul style="color:rgb(51,51,51);font-family:verdana, sans-serif;font-size:13px;line-height:17px;"><li>Single User Mode： 此模式连接到一个 In-memory 的数据库 Derby，一般用于 Unit Test。</li></ul><div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><img src="https://img-blog.csdn.net/20140211140552890?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGd1aXN1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" style="border:none;"></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><br></span></span></div>
<ul style="color:rgb(51,51,51);font-family:verdana, sans-serif;font-size:13px;line-height:17px;"><li>Multi User Mode：通过网络连接到一个数据库中，是最经常使用到的模式。</li></ul><div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;">       </span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><img src="https://img-blog.csdn.net/20140211140617671?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGd1aXN1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" style="border:none;">、</span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><br></span></span></div>
<ul style="color:rgb(51,51,51);font-family:verdana, sans-serif;font-size:13px;line-height:17px;"><li>Remote Server Mode：用于非 Java 客户端访问元数据库，在服务器端启动一个 MetaStoreServer，客户端利用 Thrift 协议通过 MetaStoreServer 访问元数据库。</li></ul><div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><img src="https://img-blog.csdn.net/20140211140657671?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGd1aXN1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" style="border:none;"></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><br></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><span style="color:rgb(55,55,55);font-family:Arial, sans-serif;font-size:15px;line-height:23px;text-indent:30px;background-color:rgb(247,247,247);">附上元数据库数据字典（如果使用mysql，show
 tables可以看到）：</span><br></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><span style="color:rgb(55,55,55);font-family:Arial, sans-serif;font-size:15px;line-height:23px;text-indent:30px;background-color:rgb(247,247,247);">BUCKETING_COLS
  ：<br></span></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><span style="color:rgb(55,55,55);font-family:Arial, sans-serif;font-size:15px;line-height:23px;text-indent:30px;background-color:rgb(247,247,247);">COLUMNS：<span style="border:0px;vertical-align:baseline;">Hive</span><span style="border:0px;vertical-align:baseline;">表字段信息(</span>字段注释，字段名，字段类型，字段序号)<br></span></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><span style="color:rgb(55,55,55);font-family:Arial, sans-serif;font-size:15px;line-height:23px;text-indent:30px;background-color:rgb(247,247,247);">DBS：<span style="border:0px;vertical-align:baseline;">元数据库信息，存放HDFS</span>路径信息<br></span></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><span style="color:rgb(55,55,55);font-family:Arial, sans-serif;font-size:15px;line-height:23px;text-indent:30px;background-color:rgb(247,247,247);">PARTITION_KEYS
   ：<span style="border:0px;vertical-align:baseline;">Hive</span><span style="border:0px;vertical-align:baseline;">分区表分区键</span><br></span></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><span style="color:rgb(55,55,55);font-family:Arial, sans-serif;font-size:15px;line-height:23px;text-indent:30px;background-color:rgb(247,247,247);"><span style="border:0px;vertical-align:baseline;">SDS：<span style="border:0px;vertical-align:baseline;">所有hive</span>表、表分区所对应的hdfs数据目录和数据格式。<br></span></span></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><span style="color:rgb(55,55,55);font-family:Arial, sans-serif;font-size:15px;line-height:23px;text-indent:30px;background-color:rgb(247,247,247);"><span style="border:0px;vertical-align:baseline;">SD_PARAMS
 ：<span style="border:0px;vertical-align:baseline;">序列化反序列化信息，如行分隔符、列分隔符、NULL</span>的表示字符等<br></span></span></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><span style="color:rgb(55,55,55);font-family:Arial, sans-serif;font-size:15px;line-height:23px;text-indent:30px;background-color:rgb(247,247,247);"><span style="border:0px;vertical-align:baseline;">SEQUENCE_TABLE：<span style="border:0px;vertical-align:baseline;">SEQUENCE_TABLE</span><span style="border:0px;vertical-align:baseline;">表保存了hive</span>对象的下一个可用ID，如’org.apache.hadoop.hive.metastore.model.MTable’,
 21，则下一个新创建的hive表其TBL_ID就是21，同时SEQUENCE_TABLE表中271786被更新为26(这里每次都是+5?)。同样，COLUMN，PARTITION等都有相应的记录<br></span></span></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><span style="color:rgb(55,55,55);font-family:Arial, sans-serif;font-size:15px;line-height:23px;text-indent:30px;background-color:rgb(247,247,247);"><span style="border:0px;vertical-align:baseline;">SERDES
   ：<br></span></span></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><span style="color:rgb(55,55,55);font-family:Arial, sans-serif;font-size:15px;line-height:23px;text-indent:30px;background-color:rgb(247,247,247);"><span style="border:0px;vertical-align:baseline;">SERDE_PARAMS：<br></span></span></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><span style="color:rgb(55,55,55);font-family:Arial, sans-serif;font-size:15px;line-height:23px;text-indent:30px;background-color:rgb(247,247,247);"><span style="border:0px;vertical-align:baseline;">SORT_COLS
    ：<br></span></span></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><span style="color:rgb(55,55,55);font-family:Arial, sans-serif;font-size:15px;line-height:23px;text-indent:30px;background-color:rgb(247,247,247);"><span style="border:0px;vertical-align:baseline;">TABLE_PARAMS：表级属性，如是否外部表，表注释等<br></span></span></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><span style="color:rgb(55,55,55);font-family:Arial, sans-serif;font-size:15px;line-height:23px;text-indent:30px;background-color:rgb(247,247,247);"><span style="border:0px;vertical-align:baseline;"><span style="border:0px;vertical-align:baseline;">TBLS
     ： 所有hive</span>表的基本信息</span></span></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;font-size:12px;"><span style="line-height:17px;"><span style="color:rgb(55,55,55);font-family:Arial, sans-serif;font-size:15px;line-height:23px;text-indent:30px;background-color:rgb(247,247,247);"><span style="border:0px;vertical-align:baseline;"><br></span></span></span></span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="background-color:rgb(247,247,247);color:rgb(55,55,55);font-family:Arial, sans-serif;font-size:15px;line-height:23px;text-indent:30px;">上面表的内容来看，hive整个创建表的过程已经比较清楚了</span></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:verdana, sans-serif;"><span style="line-height:17px;"></span></span>
<ol type="1" start="1" style="border:0px;font-family:Arial, sans-serif;font-size:15px;vertical-align:baseline;color:rgb(55,55,55);line-height:23px;text-indent:30px;background-color:rgb(247,247,247);"><li style="border:0px;font-family:inherit;font-style:inherit;vertical-align:baseline;">
解析用户提交hive语句，对其进行解析，分解为表、字段、分区等hive对象</li><li style="border:0px;font-family:inherit;font-style:inherit;vertical-align:baseline;">
根据解析到的信息构建对应的表、字段、分区等对象，从SEQUENCE_TABLE中获取构建对象的最新ID，与构建对象信息(名称，类型等)一同通过DAO方法写入到元数据表中去，成功后将SEQUENCE_TABLE中对应的最新ID+5。</li></ol><br></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<br></div>
<div style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<h2><a name="t5" style="color:rgb(51,102,153);"></a>
</h2><p class="headline-1 bk-sidecatalog-title" style="border-bottom-color:rgb(222,223,225);border-bottom-width:1px;border-bottom-style:solid;clear:both;">
<span style="color:rgb(51,102,153);"><span style="line-height:36px;font-size:22px;">4.  Hive的数据存储</span></span></p>

</div>
<p style="color:rgb(51,51,51);font-family:verdana, sans-serif;font-size:13px;line-height:17px;">
      首先，Hive 没有专门的数据存储格式，也没有为数据建立索引，用户可以非常自由的组织 Hive 中的表，只需要在创建表的时候告诉 Hive 数据中的<span style="color:rgb(255,102,0);">列分隔符和行分隔符</span>，Hive 就可以解析数据。</p>
<p style="color:rgb(51,51,51);font-family:verdana, sans-serif;font-size:13px;line-height:17px;">
     其次，Hive 中所有的数据都存储在 HDFS 中，Hive 中包含以下数据模型：Table，External Table，Partition，Bucket。</p>
<p style="color:rgb(51,51,51);font-family:verdana, sans-serif;font-size:13px;line-height:17px;">
<span style="font-family:Arial, Helvetica, FreeSans, sans-serif;font-size:14px;line-height:17.316667556762695px;"></span></p>
<p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:Arial, Helvetica, FreeSans, sans-serif;"><span style="line-height:17.328125px;">    1）表table：一个表就是hdfs中的一个目录</span></span></p>
<p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:Arial, Helvetica, FreeSans, sans-serif;"><span style="line-height:17.328125px;">    2）区<span style="font-family:verdana, sans-serif;font-size:13px;line-height:17px;">Partition</span>：表内的一个区就是表的目录下的一个子目录</span></span></p>
<p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">
<span style="font-family:Arial, Helvetica, FreeSans, sans-serif;"><span style="line-height:17.328125px;">    3）桶<span style="font-family:verdana, sans-serif;font-size:13px;line-height:17px;">Bucket</span>：如果有分区，那么桶就是区下的一个单位，如果表内没有区，那么桶直接就是表下的单位，桶一般是文件的形式。</span></span></p>
<ol style="color:rgb(51,51,51);font-size:14px;font-family:verdana, sans-serif;line-height:17px;"><li style="font-size:13px;"><span style="color:rgb(255,102,0);"><strong>Hive 中的 Table</strong></span> 和数据库中的 Table 在概念上是类似的，每一个 Table 在 Hive 中都有一个相应的目录存储数据。例如，一个表 pvs，它在 HDFS 中的路径为：/wh/pvs，其中，wh 是在 hive-site.xml 中由 ${hive.metastore.warehouse.dir} 指定的数据仓库的目录，所有的
 Table 数据（不包括 External Table）都保存在这个目录中。</li><li><span style="font-size:13px;color:rgb(255,102,0);"><strong>Partition </strong></span><span style="font-size:13px;">对应于数据库中的 Partition 列的密集索引，但是 Hive 中 Partition 的组织方式和数据库中的很不相同。在 Hive 中，表中的一个 Partition 对应于表下的一个目录，所有的 Partition 的数据都存储在对应的目录中。</span><span style="font-size:13px;color:rgb(204,0,0);">例如：pvs
 表中包含 ds 和 city 两个 Partition，则对应于 ds = 20090801, ctry = US 的 HDFS 子目录为：/wh/pvs/ds=20090801/ctry=US；对应于 ds = 20090801, ctry = CA 的 HDFS 子目录为；/wh/pvs/ds=20090801/ctry=CA。</span><span style="font-size:12px;"><span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;">表是否分区，如何添加分区，都可以通过</span><span style="color:rgb(204,0,0);font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;background-color:rgb(255,255,102);">Hive</span><span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;">-</span><span style="color:rgb(204,0,0);font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;background-color:rgb(160,255,255);">QL</span><span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;">语言完成。通过分区，即目录的存放形式，</span><span style="color:rgb(204,0,0);font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;background-color:rgb(255,255,102);">Hive</span><span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;">可以比较容易地完成对分区条件的查询。</span></span></li><li><span style="font-size:13px;color:rgb(255,102,0);"><strong>Buckets 对指定列计算 hash</strong></span><span style="font-size:12px;">，根据 hash 值切分数据，目的是为了并行，每一个 Bucket 对应一个文件。将 user 列分散至 32 个 bucket，首先对 user 列的值计算 hash，对应 hash 值为 0 的 HDFS 目录为：/wh/pvs/ds=20090801/ctry=US/part-00000；hash
 值为 20 的 HDFS 目录为：/wh/pvs/ds=20090801/ctry=US/part-00020 。<span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;">桶是</span><span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;background-color:rgb(255,255,102);">Hive</span><span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;">的最终的存储形式。在创建表时，用户可以对桶和列进</span><span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;background-color:rgb(255,102,255);">行</span><span style="font-family:Arial, Helvetica, FreeSans, sans-serif;line-height:17.316667556762695px;">详细地描述。</span></span></li><li style="font-size:13px;"><strong><span style="color:rgb(255,102,0);">E</span></strong><span style="color:rgb(255,102,0);"><strong>xternal Table 指向已经在 HDFS 中存在的数据</strong></span>，可以创建 Partition。它和 Table 在元数据的组织上是相同的，而实际数据的存储则有较大的差异。</li></ol><ul style="color:rgb(51,51,51);font-family:verdana, sans-serif;font-size:13px;line-height:17px;"><li>Table 的创建过程和数据加载过程（这两个过程可以在同一个语句中完成），在加载数据的过程中，实际数据会被移动到数据仓库目录中；之后对数据对访问将会直接在数据仓库目录中完成。删除表时，表中的数据和元数据将会被同时删除。</li><li>External Table 只有一个过程，加载数据和创建表同时完成（CREATE EXTERNAL TABLE ……LOCATION），实际数据是存储在 LOCATION 后面指定的 HDFS 路径中，并不会移动到数据仓库目录中。当删除一个 External Table 时，仅删除</li></ul><div style="color:rgb(51,51,51);font-family:verdana, sans-serif;font-size:13px;line-height:17px;">
<h2><a name="t6" style="color:rgb(51,102,153);"></a>
</h2><p class="headline-1 bk-sidecatalog-title" style="border-bottom-color:rgb(222,223,225);border-bottom-width:1px;border-bottom-style:solid;clear:both;">
<span style="color:rgb(51,102,153);"><span style="line-height:36px;font-size:22px;">5.  Hive和普通关系型数据库的差异</span></span></p>

</div>
<div style="color:rgb(51,51,51);font-size:14px;font-family:verdana, sans-serif;line-height:17px;">
<p style="font-size:13px;">      由于 Hive 采用了 SQL 的查询语言 HQL，因此很容易将 Hive 理解为数据库。其实从结构上来看，Hive 和数据库除了拥有类似的查询语言，再无类似之处。本文将从多个方面来阐述 Hive 和数据库的差异。数据库可以用在 Online 的应用中，但是Hive 是为数据仓库而设计的，清楚这一点，有助于从应用角度理解 Hive 的特性。</p>
<p style="font-size:13px;"></p>
<h2 align="left" style="border:0px;font-family:Arial, sans-serif;font-size:15px;vertical-align:baseline;clear:both;line-height:23px;text-indent:30px;background-color:rgb(247,247,247);">
<a name="t7" style="color:rgb(51,102,153);"></a>和普通关系数据库的异同：</h2>
<table class="alignleft" border="1" cellspacing="0" cellpadding="0" style="border-width:0px 0px 1px;border-bottom-style:solid;border-bottom-color:rgb(221,221,221);font-family:Arial, sans-serif;font-size:15px;vertical-align:baseline;border-spacing:0px;display:inline;width:688px;color:rgb(55,55,55);line-height:23px;text-indent:30px;background-color:rgb(247,247,247);"><tbody style="border:0px;font-family:inherit;font-style:inherit;vertical-align:baseline;"><tr style="border:0px;font-family:inherit;font-style:inherit;vertical-align:baseline;"><td style="border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);font-family:inherit;font-size:15px;font-style:inherit;vertical-align:baseline;background-color:rgb(60,179,113);">
 </td>
<td style="border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);font-family:inherit;font-size:15px;font-style:inherit;vertical-align:baseline;background-color:rgb(60,179,113);">
Hive</td>
<td style="border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);font-family:inherit;font-size:15px;font-style:inherit;vertical-align:baseline;background-color:rgb(60,179,113);">
RDBMS</td>
</tr><tr style="border:0px;font-family:inherit;font-style:inherit;vertical-align:baseline;"><td style="border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);font-family:inherit;font-size:15px;font-style:inherit;vertical-align:baseline;background-color:rgb(60,179,113);">
查询语言</td>
<td style="border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);font-family:inherit;font-size:15px;font-style:inherit;vertical-align:baseline;background-color:rgb(240,255,240);">
HQL</td>
<td style="border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);font-family:inherit;font-size:15px;font-style:inherit;vertical-align:baseline;background-color:rgb(240,255,240);">
SQL</td>
</tr><tr style="border:0px;font-family:inherit;font-style:inherit;vertical-align:baseline;"><td style="border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);font-family:inherit;font-size:15px;font-style:inherit;vertical-align:baseline;background-color:rgb(60,179,113);">
数据存储</td>
<td style="border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);font-family:inherit;font-size:15px;font-style:inherit;vertical-align:baseline;background-color:rgb(245,245,245);">
HDFS</td>
<td style="border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);font-family:inherit;font-size:15px;font-style:inherit;vertical-align:baseline;background-color:rgb(245,245,245);">
Raw Device or Local FS</td>
</tr><tr style="border:0px;font-family:inherit;font-style:inherit;vertical-align:baseline;"><td style="border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);font-family:inherit;font-size:15px;font-style:inherit;vertical-align:baseline;background-color:rgb(60,179,113);">
索引</td>
<td style="border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);font-family:inherit;font-size:15px;font-style:inherit;vertical-align:baseline;background-color:rgb(240,255,240);">
无</td>
<td style="border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);font-family:inherit;font-size:15px;font-style:inherit;vertical-align:baseline;background-color:rgb(240,255,240);">
有</td>
</tr><tr style="border:0px;font-family:inherit;font-style:inherit;vertical-align:baseline;"><td style="border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);font-family:inherit;font-size:15px;font-style:inherit;vertical-align:baseline;background-color:rgb(60,179,113);">
执行</td>
<td style="border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);font-family:inherit;font-size:15px;font-style:inherit;vertical-align:baseline;background-color:rgb(245,245,245);">
MapReduce</td>
<td style="border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);font-family:inherit;font-size:15px;font-style:inherit;vertical-align:baseline;background-color:rgb(245,245,245);">
Excutor</td>
</tr><tr style="border:0px;font-family:inherit;font-style:inherit;vertical-align:baseline;"><td style="border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);font-family:inherit;font-size:15px;font-style:inherit;vertical-align:baseline;background-color:rgb(60,179,113);">
执行延迟</td>
<td style="border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);font-family:inherit;font-size:15px;font-style:inherit;vertical-align:baseline;background-color:rgb(240,255,240);">
高</td>
<td style="border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);font-family:inherit;font-size:15px;font-style:inherit;vertical-align:baseline;background-color:rgb(240,255,240);">
低</td>
</tr><tr style="border:0px;font-family:inherit;font-style:inherit;vertical-align:baseline;"><td style="border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);font-family:inherit;font-size:15px;font-style:inherit;vertical-align:baseline;background-color:rgb(60,179,113);">
处理数据规模</td>
<td style="border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);font-family:inherit;font-size:15px;font-style:inherit;vertical-align:baseline;background-color:rgb(245,245,245);">
大</td>
<td style="border-width:1px 0px 0px;border-top-style:solid;border-top-color:rgb(221,221,221);font-family:inherit;font-size:15px;font-style:inherit;vertical-align:baseline;background-color:rgb(245,245,245);">
小</td>
</tr></tbody></table><br><p></p>
<p style="font-size:13px;"><br></p>
<p style="font-size:13px;"><br></p>
<p style="font-size:13px;"><br></p>
<p style="font-size:13px;"><br></p>
<p style="font-size:13px;"><br></p>
<p style="font-size:13px;"><br></p>
<p style="font-size:13px;"><br></p>
<p style="font-size:13px;"><br></p>
<p style="font-size:13px;"><br></p>
<p style="font-size:13px;"><br></p>
<p style="font-size:13px;"></p>
<p align="left" style="border:0px;font-family:Arial, sans-serif;font-size:15px;vertical-align:baseline;color:rgb(55,55,55);line-height:23px;text-indent:30px;">
<span style="background-color:rgb(255,102,0);">1.  查询语言。</span><span style="background-color:rgb(247,247,247);">由于 SQL 被广泛的应用在数据仓库中，因此，专门针对 Hive 的特性设计了类 SQL 的查询语言 HQL。熟悉 SQL 开发的开发者可以很方便的使用 Hive 进行开发。</span></p>
<p align="left" style="border:0px;font-family:Arial, sans-serif;font-size:15px;vertical-align:baseline;color:rgb(55,55,55);line-height:23px;text-indent:30px;">
<span style="background-color:rgb(255,102,0);">2.  数据存储位置。</span><span style="background-color:rgb(247,247,247);">Hive 是建立在Hadoop 之上的，所有 Hive 的数据都是存储在HDFS 中的。而数据库则可以将数据保存在块设备或者本地文件系统中。</span></p>
<p align="left" style="border:0px;font-family:Arial, sans-serif;font-size:15px;vertical-align:baseline;color:rgb(55,55,55);line-height:23px;text-indent:30px;">
<span style="background-color:rgb(255,102,0);">3.  数据格式。</span><span style="background-color:rgb(247,247,247);">Hive 中没有定义专门的数据格式，数据格式可以由用户指定，用户定义数据格式需要指定三个属性：列分隔符（通常为空格、”\t”、”\x001″）、行分隔符（”\n”）以及读取文件数据的方法（Hive 中默认有三个文件格式 TextFile，SequenceFile 以及 RCFile）。由于在加载数据的过程中，不需要从用户数据格式到
 Hive 定义的数据格式的转换，因此，Hive 在加载的过程中不会对数据本身进行任何修改，而只是将数据内容复制或者移动到相应的 HDFS<br>
目录中。而在数据库中，不同的数据库有不同的存储引擎，定义了自己的数据格式。所有数据都会按照一定的组织存储，因此，数据库加载数据的过程会比较耗时。</span></p>
<p align="left" style="border:0px;font-family:Arial, sans-serif;font-size:15px;vertical-align:baseline;color:rgb(55,55,55);line-height:23px;text-indent:30px;">
<span style="background-color:rgb(255,102,0);">4.  数据更新。</span><span style="background-color:rgb(247,247,247);">由于 Hive 是针对数据仓库应用设计的，而数据仓库的内容是读多写少的。因此，Hive 中不支持对数据的改写和添加，所有的数据都是在加载的时候中确定好的。而数据库中的数据通常是需要经常进行修改的，因此可以使用 INSERT INTO …  VALUES 添加数据，使用 UPDATE… SET
 修改数据。</span></p>
<p align="left" style="border:0px;font-family:Arial, sans-serif;font-size:15px;vertical-align:baseline;line-height:23px;text-indent:30px;">
<span style="background-color:rgb(255,102,0);">5.  索引。</span><span style="background-color:rgb(247,247,247);color:rgb(55,55,55);">之前已经说过，Hive 在加载数据的过程中不会对数据进行任何处理，甚至不会对数据进行扫描，因此也没有对数据中的某些 Key 建立索引。Hive 要访问数据中满足条件的特定值时，需要暴力扫描整个数据，因此访问延迟较高。由于 MapReduce 的引入， Hive
 可以并行访问数据，因此即使没有索引，对于大数据量的访问，Hive 仍然可以体现出优势。数据库中，通常会针对一个或者几个列建立索引，因此对于少量的特定条件的数据的访问，数据库可以有很高的效率，较低的延迟。由于数据的访问延迟较高，决定了<br>
Hive 不适合在线数据查询。</span></p>
<p align="left" style="border:0px;font-family:Arial, sans-serif;font-size:15px;vertical-align:baseline;color:rgb(55,55,55);line-height:23px;text-indent:30px;">
<span style="background-color:rgb(255,102,0);">6.  执行。</span><span style="background-color:rgb(247,247,247);">Hive 中大多数查询的执行是通过 Hadoop 提供的 MapReduce 来实现的（类似 select * from tbl 的查询不需要 MapReduce）。而数据库通常有自己的执行引擎。</span></p>
<p align="left" style="border:0px;font-family:Arial, sans-serif;font-size:15px;vertical-align:baseline;color:rgb(55,55,55);line-height:23px;text-indent:30px;">
<span style="background-color:rgb(255,102,0);">7.  执行延迟。</span><span style="background-color:rgb(247,247,247);">之前提到，Hive 在查询数据的时候，由于没有索引，需要扫描整个表，因此延迟较高。另外一个导致 Hive 执行延迟高的因素是 MapReduce 框架。由于 MapReduce 本身具有较高的延迟，因此在利用 MapReduce 执行 Hive 查询时，也会有较高的延迟。相对的，数据库的执行延迟较低。当然，这个低是有条件的，即数据规模较小，当数据规模大到超过数据库的处理能力的时候，Hive
 的并行计算显然能体现出优势。</span></p>
<p align="left" style="border:0px;font-family:Arial, sans-serif;font-size:15px;vertical-align:baseline;color:rgb(55,55,55);line-height:23px;text-indent:30px;">
<span style="background-color:rgb(255,102,0);">8.  可扩展性。</span><span style="background-color:rgb(247,247,247);">由于 Hive 是建立在 Hadoop 之上的，因此 Hive 的可扩展性是和 Hadoop 的可扩展性是一致的（世界上最大的 Hadoop 集群在 Yahoo!，2009年的规模在4000 台节点左右）。而数据库由于 ACID 语义的严格限制，扩展行非常有限。目前最先进的并行数据库 Oracle
 在理论上的扩展能力也只有 100 台左右。</span></p>
<p align="left" style="border:0px;font-family:Arial, sans-serif;font-size:15px;vertical-align:baseline;color:rgb(55,55,55);line-height:23px;text-indent:30px;">
<span style="background-color:rgb(255,102,0);">9. 数据规模。</span><span style="background-color:rgb(247,247,247);">由于 Hive 建立在集群上并可以利用 MapReduce 进行并行计算，因此可以支持很大规模的数据；对应的，数据库可以支持的数据规模较小。</span></p>
<div>
<p style="font-family:Arial;line-height:26px;">
</p>
<div>
<h2><a name="t8" style="color:rgb(51,102,153);"></a>
</h2><p class="headline-1 bk-sidecatalog-title" style="border-bottom-color:rgb(222,223,225);border-bottom-width:1px;border-bottom-style:solid;clear:both;">
<span style="color:rgb(51,102,153);"><span style="line-height:36px;font-size:22px;"><br>
5.  Hive的基本概念</span></span></p>

</div>
<p></p>
<p style="font-family:Arial;line-height:26px;">
<strong>参考：https://cwiki.apache.org/confluence/display/Hive/Tutorial</strong></p>
<p style="font-family:Arial;line-height:26px;">
<strong><br></strong></p>
<p style="font-family:Arial;line-height:26px;">
<strong>1）数据单元</strong><br>
    按照数据的粒度大小，hive数据可以被组织成：<br>
    <span style="color:rgb(255,102,0);">1）databases</span>： 避免不同表产生命名冲突的一种命名空间<br>
    <span style="color:rgb(255,102,0);">2）tables：</span>具有相同scema的同质数据的集合<br>
    <span style="color:rgb(255,102,0);">3）partitions：</span>一个表可以有一个或多个决定数据如何存储的partition key<br>
   <span style="color:rgb(255,102,0);"> 4）buckets（或clusters）：</span>在同一个partition中的数据可以根据某个列的hash值分为多个bucket。partition和bucket并非必要，但是它们能大大加快数据的查询速度。</p>
<p style="font-family:Arial;line-height:26px;">
<strong>2)、数据类型<br>
    （1）简单类型：</strong><br>
      <span style="color:rgb(255,102,0);">TINYINT - 1 byte integer<br>
      SMALLINT - 2 byte integer<br>
      INT - 4 byte integer<br>
      BIGINT - 8 byte <br>
      BOOLEAN - TRUE/ FALSE<br>
      FLOAT - 单精度<br>
      DOUBLE - 双精度<br>
      STRING - 字符串集合</span><br>
    <strong>（2）复杂类型：</strong><br>
       <span style="color:rgb(255,102,0);">Structs</span>： structs内部的数据可以通过DOT（.）来存取，例如，表中一列c的类型为STRUCT{a INT; b INT}，我们可以通过c.a来访问域a。<br>
        <span style="color:rgb(255,102,0);">Maps（Key-Value对）</span>：访问指定域可以通过['element name']进行，例如，一个Map M包含了一个group-&gt;gid的k-v对，gid的值可以通过M['group']来获取。<br>
      <span style="color:rgb(255,102,0);">Arrays：</span>array中的数据为相同类型，例如，假如array A中元素['a','b','c']，则A[1]的值为'b'。<br></p>
<p style="font-family:Arial;line-height:26px;">
<strong>3）、内建运算符和函数</strong></p>
<p style="font-family:Arial;line-height:26px;">
      包括关系运算符(A=B, A!=B, A&lt;B等等）、</p>
<p style="font-family:Arial;line-height:26px;">
      算术运算符（A+B, A*B, A&amp;B, A|B等等）、</p>
<p style="font-family:Arial;line-height:26px;">
      逻辑运算符（A&amp;&amp;B, <tt>A|B等等</tt>）、</p>
<p style="font-family:Arial;line-height:26px;">
      复杂类型上的运算符（A[n], M[key], S.x）、</p>
<p style="font-family:Arial;line-height:26px;">
      各种内建函数：<span style="font-family:Arial, sans-serif;line-height:20px;">round，floor，substr</span></p>
<p style="font-family:Arial;line-height:26px;">
    </p>
<p style="font-family:Arial;line-height:26px;">
<strong>4）、语言能力</strong><br>
    hive查询语言提供基本的类sql操作，这些操作基于table和partition，包括：<br>
    1. 使用where语句过滤制定行<br>
    2. 使用select查找指定列<br>
    3. join两张table<br>
    4. group by<br>
    5. 一个表的查询结果存入另一张表<br>
    6. 将一个表的内容存入本地目录<br>
    7. 将查询结果存储到hdfs上<br>
    8. 管理table和partition(creat、drop、alert)<br>
    <span style="color:rgb(51,102,255);"><strong>9. 在查询中嵌入map-reduce程序</strong></span></p>
<p style="font-family:Arial, sans-serif;line-height:20px;">
<a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual" rel="nofollow" style="color:rgb(59,115,175);text-decoration:none;">Hive query language</a> provides the basic SQL like operations. These operations work on tables or
 partitions. These operations are:</p>
<ul style="font-family:Arial, sans-serif;line-height:20px;"><li>Ability to filter rows from a table using a where clause.</li><li>Ability to select certain columns from the table using a select clause.</li><li>Ability to do equi-joins between two tables.</li><li>Ability to evaluate aggregations on multiple "group by" columns for the data stored in a table.</li><li>Ability to store the results of a query into another table.</li><li>Ability to download the contents of a table to a local (e.g., nfs) directory.</li><li>Ability to store the results of a query in a hadoop dfs directory.</li><li>Ability to manage tables and partitions (create, drop and alter).</li><li>Ability to plug in custom scripts in the language of choice for custom map/reduce jobs.</li></ul><br></div>
<div style="font-size:13px;"><br></div>
<div style="font-size:13px;"><br></div>
<div style="font-size:13px;"><br></div>
<div style="font-size:13px;">
<h2><a name="t9" style="color:rgb(51,102,153);"></a>
</h2><p class="headline-1 bk-sidecatalog-title" style="border-bottom-color:rgb(222,223,225);border-bottom-width:1px;border-bottom-style:solid;clear:both;">
<span style="color:rgb(51,102,153);"><span style="line-height:36px;font-size:22px;">6.  Hive实际应用</span></span></p>

</div>
<div><span style="font-size:12px;"><span style="font-family:verdana, arial, helvetica, sans-serif;line-height:21px;background-color:rgb(250,250,250);"><strong></strong></span></span>
<h3 id="GettingStarted-ApacheWeblogData" style="font-size:16px;line-height:1.5625;font-family:Arial, sans-serif;">
<a name="t10" style="color:rgb(51,102,153);"></a>1、Apache Weblog Data</h3>
<p style="font-family:Arial, sans-serif;line-height:20px;">
The format of Apache weblog is customizable, while most webmasters use the default.<br>
For default Apache weblog, we can create a table with the following command.</p>
<p style="font-family:Arial, sans-serif;line-height:20px;">
More about !RegexSerDe can be found here in <a href="https://issues.apache.org/jira/browse/HIVE-662" rel="nofollow" class="external-link" style="color:rgb(59,115,175);text-decoration:none;">HIVE-662</a> and <a href="https://issues.apache.org/jira/browse/HIVE-1719" rel="nofollow" class="external-link" style="color:rgb(59,115,175);text-decoration:none;">HIVE-1719</a>.</p>
<div class="code panel pdl" style="border:1px solid rgb(204,204,204);overflow:auto;font-family:Arial, sans-serif;line-height:20px;">
<div class="codeContent panelContent pdl" style="overflow:hidden;">
<div id="highlighter_950039" class="syntaxhighlighter nogutter sql" style="overflow:auto !important;font-size:1em !important;">
<table border="0" cellpadding="0" cellspacing="0" style="border:0px !important;line-height:20px !important;overflow:visible !important;vertical-align:baseline !important;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;font-size:14px !important;min-height: !important;"><tbody style="border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;"><tr style="border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;"><td class="code" style="border:0px !important;overflow:visible !important;vertical-align:baseline !important;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;font-size:14px !important;min-height: !important;">
<div title="Hint: double-click to select code" style="border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">
<div class="line number1 index0 alt2" style="border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">
<code class="sql keyword" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;font-weight:bold !important;min-height: !important;color:rgb(0,102,153) !important;">CREATE</code> <code class="sql keyword" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;font-weight:bold !important;min-height: !important;color:rgb(0,102,153) !important;">TABLE</code> <code class="sql plain" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">apachelog
 (</code></div>
<div class="line number2 index1 alt1" style="border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">
<code class="sql spaces" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">  </code><code class="sql plain" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">host
 STRING,</code></div>
<div class="line number3 index2 alt2" style="border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">
<code class="sql spaces" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">  </code><code class="sql plain" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">identity
 STRING,</code></div>
<div class="line number4 index3 alt1" style="border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">
<code class="sql spaces" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">  </code><code class="sql color2" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;color:rgb(255,20,147) !important;">user</code> <code class="sql plain" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">STRING,</code></div>
<div class="line number5 index4 alt2" style="border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">
<code class="sql spaces" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">  </code><code class="sql keyword" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;font-weight:bold !important;min-height: !important;color:rgb(0,102,153) !important;">time</code> <code class="sql plain" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">STRING,</code></div>
<div class="line number6 index5 alt1" style="border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">
<code class="sql spaces" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">  </code><code class="sql plain" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">request
 STRING,</code></div>
<div class="line number7 index6 alt2" style="border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">
<code class="sql spaces" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">  </code><code class="sql plain" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">status
 STRING,</code></div>
<div class="line number8 index7 alt1" style="border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">
<code class="sql spaces" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">  </code><code class="sql keyword" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;font-weight:bold !important;min-height: !important;color:rgb(0,102,153) !important;">size</code> <code class="sql plain" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">STRING,</code></div>
<div class="line number9 index8 alt2" style="border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">
<code class="sql spaces" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">  </code><code class="sql plain" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">referer
 STRING,</code></div>
<div class="line number10 index9 alt1" style="border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">
<code class="sql spaces" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">  </code><code class="sql plain" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">agent
 STRING)</code></div>
<div class="line number11 index10 alt2" style="border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">
<code class="sql plain" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">ROW
 FORMAT SERDE </code><code class="sql string" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;color:#0000FF !important;">'org.apache.hadoop.hive.serde2.RegexSerDe'</code></div>
<div class="line number12 index11 alt1" style="border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">
<code class="sql keyword" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;font-weight:bold !important;min-height: !important;color:rgb(0,102,153) !important;">WITH</code> <code class="sql plain" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">SERDEPROPERTIES
 (</code></div>
<div class="line number13 index12 alt2" style="border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">
<code class="sql spaces" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">  </code><code class="sql string" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;color:#0000FF !important;">"input.regex"</code> <code class="sql plain" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">= </code><code class="sql string" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;color:#0000FF !important;">"([^]*)
 ([^]*) ([^]*) (-|\\[^\\]*\\]) ([^ \"]*|\"[^\"]*\") (-|[0-9]*) (-|[0-9]*)(?: ([^ \"]*|\".*\") ([^ \"]*|\".*\"))?"</code></div>
<div class="line number14 index13 alt1" style="border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">
<code class="sql plain" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">)</code></div>
<div class="line number15 index14 alt2" style="border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">
<code class="sql plain" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">STORED </code><code class="sql keyword" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;font-weight:bold !important;min-height: !important;color:rgb(0,102,153) !important;">AS</code> <code class="sql plain" style="font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;border:0px !important;overflow:visible !important;vertical-align:baseline !important;min-height: !important;">TEXTFILE;</code></div>
</div>
</td>
</tr></tbody></table></div>
</div>
</div>
</div>
</div>
            </div>
                </div>