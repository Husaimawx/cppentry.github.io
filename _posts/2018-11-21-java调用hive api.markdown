---
layout:     post
title:      java调用hive api
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<p style="font-size:14px;"><span style="color:#008000;">基于hadoop的Hive数据仓库JavaAPI简单调用的实例，关于Hive的简介在此不赘述。hive提供了三种用户接口：CLI，JDBC/ODBC和 WebUI</span></p>
<ol style="font-size:14px;"><li><span style="color:#008000;">CLI，即Shell命令行</span></li><li><span style="color:#008000;">JDBC/ODBC 是 Hive 的Java，与使用传统数据库JDBC的方式类似</span></li><li><span style="color:#008000;">WebGUI是通过浏览器访问 Hive</span></li></ol><p style="font-size:14px;"><span style="color:#008000;">本文主要介绍的就是第二种用户接口，直接进入正题。</span></p>
<p style="font-size:14px;"><span style="color:#008000;"> 1、Hive 安装：</span></p>
<p style="font-size:14px;"><span style="color:#008000;">        1）hive的安装请参考网上的相关文章，测试时只在hadoop一个节点上安装hive即可。</span></p>
<p style="font-size:14px;"><span style="color:#008000;">        2）测试数据data文件'\t'分隔：</span></p>
<p style="font-size:14px;"><span style="color:#008000;">              1   zhangsan</span></p>
<p style="font-size:14px;"><span style="color:#008000;">              2    lisi</span></p>
<p style="font-size:14px;"><span style="color:#008000;">              3   wangwu</span></p>
<p style="font-size:14px;"><span style="color:#008000;">        3）将测试数据data上传到linux目录下，我放置在：/home/hadoop01/data </span></p>
<p style="font-size:14px;"><span style="color:#008000;"> 2、在使用 JDBC 开发 Hive 程序时,  必须首先开启 Hive 的远程服务接口。使用下面命令进行开启:</span></p>
<p style="font-size:14px;"><span style="color:#008000;">  </span></p>
<div class="dp-highlighter">
<div class="bar">
<div class="tools">Java代码  <a title="收藏这段代码"><img class="star" src="http://787141854-qq-com.iteye.com/images/icon_star.png" alt="收藏代码"></a></div>
</div>
<ol class="dp-j" start="1"><li><span><span>hive --service hiveserver &gt;/dev/</span><span class="keyword">null</span><span> </span><span class="number">2</span><span>&gt;/dev/</span><span class="keyword">null</span><span> &amp;  </span></span></li></ol></div>
<p style="font-size:14px;"> </p>
<p style="font-size:14px;"> </p>
<p style="font-size:14px;"><span style="color:#008000;"> 3、测试代码：</span></p>
<p style="font-size:14px;"> </p>
<div class="dp-highlighter">
<div class="bar">
<div class="tools">Java代码  <a title="收藏这段代码"><img class="star" src="http://787141854-qq-com.iteye.com/images/icon_star.png" alt="收藏代码"></a></div>
</div>
<ol class="dp-j" start="1"><li><span><span class="keyword">import</span><span> java.sql.Connection;  </span></span></li><li><span><span class="keyword">import</span><span> java.sql.DriverManager;  </span></span></li><li><span><span class="keyword">import</span><span> java.sql.ResultSet;  </span></span></li><li><span><span class="keyword">import</span><span> java.sql.SQLException;  </span></span></li><li><span><span class="keyword">import</span><span> java.sql.Statement;  </span></span></li><li><span>  </span></li><li><span><span class="keyword">import</span><span> org.apache.log4j.Logger;  </span></span></li><li><span>  </span></li><li><span><span class="comment">/**</span> </span></li><li><span><span class="comment"> * Hive的JavaApi</span> </span></li><li><span><span class="comment"> * </span> </span></li><li><span><span class="comment"> * 启动hive的远程服务接口命令行执行：hive --service hiveserver &gt;/dev/null 2&gt;/dev/null &amp;</span> </span></li><li><span><span class="comment"> * </span> </span></li><li><span><span class="comment"> * @author 吖大哥</span> </span></li><li><span><span class="comment"> * </span> </span></li><li><span><span class="comment"> */</span><span>  </span></span></li><li><span><span class="keyword">public</span><span> </span><span class="keyword">class</span><span> HiveJdbcCli {  </span></span></li><li><span>  </span></li><li><span>    <span class="keyword">private</span><span> </span><span class="keyword">static</span><span> String driverName = </span><span class="string">"org.apache.hadoop.hive.jdbc.HiveDriver"</span><span>;  </span></span></li><li><span>    <span class="keyword">private</span><span> </span><span class="keyword">static</span><span> String url = </span><span class="string">"jdbc:hive://hadoop3:10000/default"</span><span>;  </span></span></li><li><span>    <span class="keyword">private</span><span> </span><span class="keyword">static</span><span> String user = </span><span class="string">"hive"</span><span>;  </span></span></li><li><span>    <span class="keyword">private</span><span> </span><span class="keyword">static</span><span> String password = </span><span class="string">"mysql"</span><span>;  </span></span></li><li><span>    <span class="keyword">private</span><span> </span><span class="keyword">static</span><span> String sql = </span><span class="string">""</span><span>;  </span></span></li><li><span>    <span class="keyword">private</span><span> </span><span class="keyword">static</span><span> ResultSet res;  </span></span></li><li><span>    <span class="keyword">private</span><span> </span><span class="keyword">static</span><span> </span><span class="keyword">final</span><span> Logger log = Logger.getLogger(HiveJdbcCli.</span><span class="keyword">class</span><span>);  </span></span></li><li><span>  </span></li><li><span>    <span class="keyword">public</span><span> </span><span class="keyword">static</span><span> </span><span class="keyword">void</span><span> main(String[] args) {  </span></span></li><li><span>        Connection conn = <span class="keyword">null</span><span>;  </span></span></li><li><span>        Statement stmt = <span class="keyword">null</span><span>;  </span></span></li><li><span>        <span class="keyword">try</span><span> {  </span></span></li><li><span>            conn = getConn();  </span></li><li><span>            stmt = conn.createStatement();  </span></li><li><span>  </span></li><li><span>            <span class="comment">// 第一步:存在就先删除</span><span>  </span></span></li><li><span>            String tableName = dropTable(stmt);  </span></li><li><span>  </span></li><li><span>            <span class="comment">// 第二步:不存在就创建</span><span>  </span></span></li><li><span>            createTable(stmt, tableName);  </span></li><li><span>  </span></li><li><span>            <span class="comment">// 第三步:查看创建的表</span><span>  </span></span></li><li><span>            showTables(stmt, tableName);  </span></li><li><span>  </span></li><li><span>            <span class="comment">// 执行describe table操作</span><span>  </span></span></li><li><span>            describeTables(stmt, tableName);  </span></li><li><span>  </span></li><li><span>            <span class="comment">// 执行load data into table操作</span><span>  </span></span></li><li><span>            loadData(stmt, tableName);  </span></li><li><span>  </span></li><li><span>            <span class="comment">// 执行 select * query 操作</span><span>  </span></span></li><li><span>            selectData(stmt, tableName);  </span></li><li><span>  </span></li><li><span>            <span class="comment">// 执行 regular hive query 统计操作</span><span>  </span></span></li><li><span>            countData(stmt, tableName);  </span></li><li><span>  </span></li><li><span>        } <span class="keyword">catch</span><span> (ClassNotFoundException e) {  </span></span></li><li><span>            e.printStackTrace();  </span></li><li><span>            log.error(driverName + <span class="string">" not found!"</span><span>, e);  </span></span></li><li><span>            System.exit(<span class="number">1</span><span>);  </span></span></li><li><span>        } <span class="keyword">catch</span><span> (SQLException e) {  </span></span></li><li><span>            e.printStackTrace();  </span></li><li><span>            log.error(<span class="string">"Connection error!"</span><span>, e);  </span></span></li><li><span>            System.exit(<span class="number">1</span><span>);  </span></span></li><li><span>        } <span class="keyword">finally</span><span> {  </span></span></li><li><span>            <span class="keyword">try</span><span> {  </span></span></li><li><span>                <span class="keyword">if</span><span> (conn != </span><span class="keyword">null</span><span>) {  </span></span></li><li><span>                    conn.close();  </span></li><li><span>                    conn = <span class="keyword">null</span><span>;  </span></span></li><li><span>                }  </span></li><li><span>                <span class="keyword">if</span><span> (stmt != </span><span class="keyword">null</span><span>) {  </span></span></li><li><span>                    stmt.close();  </span></li><li><span>                    stmt = <span class="keyword">null</span><span>;  </span></span></li><li><span>                }  </span></li><li><span>            } <span class="keyword">catch</span><span> (SQLException e) {  </span></span></li><li><span>                e.printStackTrace();  </span></li><li><span>            }  </span></li><li><span>        }  </span></li><li><span>    }  </span></li><li><span>  </span></li><li><span>    <span class="keyword">private</span><span> </span><span class="keyword">static</span><span> </span><span class="keyword">void</span><span> countData(Statement stmt, String tableName)  </span></span></li><li><span>            <span class="keyword">throws</span><span> SQLException {  </span></span></li><li><span>        sql = <span class="string">"select count(1) from "</span><span> + tableName;  </span></span></li><li><span>        System.out.println(<span class="string">"Running:"</span><span> + sql);  </span></span></li><li><span>        res = stmt.executeQuery(sql);  </span></li><li><span>        System.out.println(<span class="string">"执行“regular hive query”运行结果:"</span><span>);  </span></span></li><li><span>        <span class="keyword">while</span><span> (res.next()) {  </span></span></li><li><span>            System.out.println(<span class="string">"count ------&gt;"</span><span> + res.getString(</span><span class="number">1</span><span>));  </span></span></li><li><span>        }  </span></li><li><span>    }  </span></li><li><span>  </span></li><li><span>    <span class="keyword">private</span><span> </span><span class="keyword">static</span><span> </span><span class="keyword">void</span><span> selectData(Statement stmt, String tableName)  </span></span></li><li><span>            <span class="keyword">throws</span><span> SQLException {  </span></span></li><li><span>        sql = <span class="string">"select * from "</span><span> + tableName;  </span></span></li><li><span>        System.out.println(<span class="string">"Running:"</span><span> + sql);  </span></span></li><li><span>        res = stmt.executeQuery(sql);  </span></li><li><span>        System.out.println(<span class="string">"执行 select * query 运行结果:"</span><span>);  </span></span></li><li><span>        <span class="keyword">while</span><span> (res.next()) {  </span></span></li><li><span>            System.out.println(res.getInt(<span class="number">1</span><span>) + </span><span class="string">"\t"</span><span> + res.getString(</span><span class="number">2</span><span>));  </span></span></li><li><span>        }  </span></li><li><span>    }  </span></li><li><span>  </span></li><li><span>    <span class="keyword">private</span><span> </span><span class="keyword">static</span><span> </span><span class="keyword">void</span><span> loadData(Statement stmt, String tableName)  </span></span></li><li><span>            <span class="keyword">throws</span><span> SQLException {  </span></span></li><li><span>        String filepath = <span class="string">"/home/hadoop01/data"</span><span>;  </span></span></li><li><span>        sql = <span class="string">"load data local inpath '"</span><span> + filepath + </span><span class="string">"' into table "</span><span>  </span></span></li><li><span>                + tableName;  </span></li><li><span>        System.out.println(<span class="string">"Running:"</span><span> + sql);  </span></span></li><li><span>        res = stmt.executeQuery(sql);  </span></li><li><span>    }  </span></li><li><span>  </span></li><li><span>    <span class="keyword">private</span><span> </span><span class="keyword">static</span><span> </span><span class="keyword">void</span><span> describeTables(Statement stmt, String tableName)  </span></span></li><li><span>            <span class="keyword">throws</span><span> SQLException {  </span></span></li><li><span>        sql = <span class="string">"describe "</span><span> + tableName;  </span></span></li><li><span>        System.out.println(<span class="string">"Running:"</span><span> + sql);  </span></span></li><li><span>        res = stmt.executeQuery(sql);  </span></li><li><span>        System.out.println(<span class="string">"执行 describe table 运行结果:"</span><span>);  </span></span></li><li><span>        <span class="keyword">while</span><span> (res.next()) {  </span></span></li><li><span>            System.out.println(res.getString(<span class="number">1</span><span>) + </span><span class="string">"\t"</span><span> + res.getString(</span><span class="number">2</span><span>));  </span></span></li><li><span>        }  </span></li><li><span>    }  </span></li><li><span>  </span></li><li><span>    <span class="keyword">private</span><span> </span><span class="keyword">static</span><span> </span><span class="keyword">void</span><span> showTables(Statement stmt, String tableName)  </span></span></li><li><span>            <span class="keyword">throws</span><span> SQLException {  </span></span></li><li><span>        sql = <span class="string">"show tables '"</span><span> + tableName + </span><span class="string">"'"</span><span>;  </span></span></li><li><span>        System.out.println(<span class="string">"Running:"</span><span> + sql);  </span></span></li><li><span>        res = stmt.executeQuery(sql);  </span></li><li><span>        System.out.println(<span class="string">"执行 show tables 运行结果:"</span><span>);  </span></span></li><li><span>        <span class="keyword">if</span><span> (res.next()) {  </span></span></li><li><span>            System.out.println(res.getString(<span class="number">1</span><span>));  </span></span></li><li><span>        }  </span></li><li><span>    }  </span></li><li><span>  </span></li><li><span>    <span class="keyword">private</span><span> </span><span class="keyword">static</span><span> </span><span class="keyword">void</span><span> createTable(Statement stmt, String tableName)  </span></span></li><li><span>            <span class="keyword">throws</span><span> SQLException {  </span></span></li><li><span>        sql = <span class="string">"create table "</span><span>  </span></span></li><li><span>                + tableName  </span></li><li><span>                + <span class="string">" (key int, value string)  row format delimited fields terminated by '\t'"</span><span>;  </span></span></li><li><span>        stmt.executeQuery(sql);  </span></li><li><span>    }  </span></li><li><span>  </span></li><li><span>    <span class="keyword">private</span><span> </span><span class="keyword">static</span><span> String dropTable(Statement stmt) </span><span class="keyword">throws</span><span> SQLException {  </span></span></li><li><span>        <span class="comment">// 创建的表名</span><span>  </span></span></li><li><span>        String tableName = <span class="string">"testHive"</span><span>;  </span></span></li><li><span>        sql = <span class="string">"drop table "</span><span> + tableName;  </span></span></li><li><span>        stmt.executeQuery(sql);  </span></li><li><span>        <span class="keyword">return</span><span> tableName;  </span></span></li><li><span>    }  </span></li><li><span>  </span></li><li><span>    <span class="keyword">private</span><span> </span><span class="keyword">static</span><span> Connection getConn() </span><span class="keyword">throws</span><span> ClassNotFoundException,  </span></span></li><li><span>            SQLException {  </span></li><li><span>        Class.forName(driverName);  </span></li><li><span>        Connection conn = DriverManager.getConnection(url, user, password);  </span></li><li><span>        <span class="keyword">return</span><span> conn;  </span></span></li><li><span>    }  </span></li><li><span>  </span></li><li><span>}  </span></li></ol></div>
<p style="font-size:14px;"> </p>
<p style="font-size:14px;"><span style="color:#008000;">4、测试结果</span></p>
<p style="font-size:14px;"><img class="magplus" title="点击查看原始大小图片" alt="" src="http://dl2.iteye.com/upload/attachment/0097/2825/3c8d8054-968e-336a-b64d-c4f04e6b42d9.png" height="393" width="700"></p>
<p style="font-size:14px;"> </p>
<p style="font-size:14px;"><span style="font-size:14px;color:#008000;">5、终端查询结果：</span></p>
<p style="font-size:14px;"><span style="font-size:14px;color:#008000;">hive&gt; select * from testHive;</span></p>
<p style="font-size:14px;"><span style="font-size:14px;color:#008000;">OK</span></p>
<p style="font-size:14px;"><span style="font-size:14px;color:#008000;">1       zhangsan</span></p>
<p style="font-size:14px;"><span style="font-size:14px;color:#008000;">2       lisi</span></p>
<p style="font-size:14px;"><span style="font-size:14px;color:#008000;">3       wangwu</span></p>
<p style="font-size:14px;"><span style="font-size:14px;color:#008000;">Time taken: 11.232 seconds</span></p>
<p style="font-size:14px;"><span style="font-size:14px;color:#008000;">hive&gt; </span></p>
<p style="font-size:14px;"> </p>
            </div>
                </div>