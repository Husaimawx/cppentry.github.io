---
layout:     post
title:      hadoop(4)
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <p>1. HDFS<span style="font-family:'宋体';">分布式文件系统</span></p><p>2. HDFS<span style="font-family:'宋体';">集群的搭建</span></p><p>(1) Hdfs-site.xml</p><p>① Hdfs<span style="font-family:'宋体';">公开的访问地址</span></p><p>② Namenode<span style="font-family:'宋体';">的元数据目录</span></p><p>③ Datanode<span style="font-family:'宋体';">的元数据目录</span></p><p>④ SecondaryNamenode</p><p>(2) Hadoop-env.sh</p><p>① <span style="font-family:'宋体';">添加你的</span>javahome<span style="font-family:'宋体';">路径</span></p><p>3. HDFS<span style="font-family:'宋体';">的常用客户端命令</span></p><p>(1) Put<span style="font-family:'宋体';">、</span><span style="font-family:Calibri;">get</span><span style="font-family:'宋体';">、</span><span style="font-family:Calibri;">mv</span><span style="font-family:'宋体';">、</span><span style="font-family:Calibri;">delete</span><span style="font-family:'宋体';">、</span><span style="font-family:Calibri;">ls.....</span></p><p>4. <span style="font-family:'宋体';">常用的</span>hdfs<span style="font-family:'宋体';">客户端</span><span style="font-family:Calibri;">API</span><span style="font-family:'宋体';">的操作</span></p><p>5. 模拟真实业务场景中的日志的处理流程	</p><p>(1) Lgfj  +  <span style="font-family:'宋体';">客户端的操作上传日志数据</span></p><p>6. HDFS<span style="font-family:'宋体';">详细的上传和读取流程</span></p><p>7. NameNOde<span style="font-family:'宋体';">的</span><span style="font-family:Calibri;">checkpoint</span><span style="font-family:'宋体';">机制</span></p><p>8. MapReduce<span style="font-family:'宋体';">的框架思想</span></p><p>(1) Map<span style="font-family:'宋体';">阶段</span></p><p>(2) Reduce<span style="font-family:'宋体';">阶段</span></p><p>9. <span style="font-family:'宋体';">手动实现了</span>wordcount<span style="font-family:'宋体';">的模型</span></p><p>(1) <span style="font-family:'宋体';">核心：实现</span>key.hashcode() % 2</p><p>10. MapReduce<span style="font-family:'宋体';">框架的具体认识</span></p><p>(1) Mapper.map()</p><p>(2) Reducer.reduce()</p><p>11. <span style="font-family:'宋体';">运行</span>mr<span style="font-family:'宋体';">程序，需要一个分布式管理调度平台</span><span style="font-family:Calibri;">---yarn</span></p><h1><strong>MR<span style="font-family:'宋体';">程序的两种运行模式</span></strong></h1><p><span style="color:rgb(255,255,255);background:rgb(255,0,0);"><span style="font-family:'宋体';">分布式运行模式：</span></span><span style="font-family:'宋体';">必须在</span>yarn<span style="font-family:'宋体';">平台上</span></p><p>核心特点：</p><p><span style="font-family:'宋体';">整个运行流程由</span>MRAppMaster<span style="font-family:'宋体';">控制；</span></p><p><span style="font-family:'宋体';">每一个</span>task<span style="font-family:'宋体';">（</span><span style="font-family:Calibri;">maptask</span><span style="font-family:'宋体';">，</span><span style="font-family:Calibri;">reducetask</span><span style="font-family:'宋体';">）以及</span><span style="font-family:Calibri;">MRAppMaster</span><span style="font-family:'宋体';">，都是以独立的进程在</span><span style="font-family:Calibri;">nodemanager</span><span style="font-family:'宋体';">所提供的容器中执行；</span></p><p> </p><p><span style="color:rgb(255,255,255);background:rgb(255,0,0);"><span style="font-family:'宋体';">本地运行模式：</span></span>在本地以单进程多线程方式运行；</p><p><span style="font-family:'宋体';">核心特点：整个运行流程由</span>LocalJobRunner<span style="font-family:'宋体';">控制，每一个</span><span style="font-family:Calibri;">task</span><span style="font-family:'宋体';">（</span><span style="font-family:Calibri;">maptask</span><span style="font-family:'宋体';">、</span><span style="font-family:Calibri;">reducetask</span><span style="font-family:'宋体';">）都以线程方式执行</span></p><p> </p><p> </p><p> </p><p><span style="font-family:'宋体';">决定</span>mr<span style="font-family:'宋体';">程序是以分布式还是以本地模型运行的关键点：</span></p><p>jobclient<span style="font-family:'宋体';">端的参数：  </span><em><span style="background:rgb(255,0,0);">mapreduce.framework.name= local ? yarn ?</span></em></p><p><span style="font-family:'宋体';">参数可以在</span>jobclient<span style="font-family:'宋体';">的代码中设置；</span></p><p><span style="font-family:'宋体';">也可以在</span>jobclient<span style="font-family:'宋体';">所运行的机器的</span><span style="font-family:Calibri;">hadoop</span><span style="font-family:'宋体';">配置文件</span><span style="font-family:Calibri;">(mapred-site.xml)</span><span style="font-family:'宋体';">中配置；</span></p><p> </p><p> </p><p><em><span style="font-family:'宋体';">注意：如果以分布式模式运行</span>mr<span style="font-family:'宋体';">，则你所访问的文件系统一定要是</span><span style="font-family:Calibri;">HDFS!!!</span><span style="font-family:'宋体';">（参数： </span><span style="font-family:Calibri;">fs.defaultFS = hdfs://....</span><span style="font-family:'宋体';">）</span></em></p><p><em><span style="font-family:'宋体';">如果以本地模式运行</span>mr<span style="font-family:'宋体';">，则你所访问的文件系统可以是</span><span style="font-family:Calibri;">HDFS</span><span style="font-family:'宋体';">，也可以是本地文件系统；</span></em></p><p><em> </em></p><p><em><span style="font-family:'宋体';">本地模式运行可以在</span>windows<span style="font-family:'宋体';">系统上（需要将</span><span style="font-family:Calibri;">windows</span><span style="font-family:'宋体';">本地库的</span><span style="font-family:Calibri;">bin</span><span style="font-family:'宋体';">目录配置到环境变量</span><span style="font-family:Calibri;">PATH</span><span style="font-family:'宋体';">中），也可以在</span><span style="font-family:Calibri;">linux</span><span style="font-family:'宋体';">系统上；</span></em></p><p><em> </em></p><p><em> </em></p><p><em><span style="font-family:'宋体';">如果要在</span>windows<span style="font-family:'宋体';">上运行</span><span style="font-family:Calibri;">jobclient</span><span style="font-family:'宋体';">，把</span><span style="font-family:Calibri;">mr job</span><span style="font-family:'宋体';">提交到</span><span style="font-family:Calibri;">YARN</span><span style="font-family:'宋体';">上分布式运行，则需要一下客户端参数：</span></em></p><table border="1" cellspacing="0"><tbody><tr><td valign="top"><p><em>		Configuration conf = new Configuration(); // <span style="font-family:'宋体';">加载</span><span style="font-family:Calibri;">classpath</span><span style="font-family:'宋体';">中的</span><span style="font-family:Calibri;">hadoop</span><span style="font-family:'宋体';">配置文件</span></em></p><p><em>		// job api<span style="font-family:'宋体';">对象，在提交</span><span style="font-family:Calibri;">mrjob</span><span style="font-family:'宋体';">去运行时，有两种提交目的地选择：</span><span style="font-family:Calibri;">1.</span><span style="font-family:'宋体';">本地模拟器  </span><span style="font-family:Calibri;">2.yarn</span></em></p><p><em>		conf.set("mapreduce.framework.name", "yarn");  //  mapred-site.xml</em></p><p><em>		conf.set("fs.defaultFS", "hdfs://cts01:9000");  // core-site.xml</em></p><p><em>		conf.set("yarn.resourcemanager.hostname", "cts01");</em></p><p><em>		conf.set("mapreduce.app-submission.cross-platform", "true");  //<span style="font-family:'宋体';">跨平台提交；</span>	</em></p><p><em> </em></p></td></tr></tbody></table><p><em> </em></p><p><em> </em></p><p><strong><em>mr<span style="font-family:'宋体';">参数补充：</span></em></strong></p><p><em><span style="font-family:'宋体';">以下参数应该在</span>jobclient<span style="font-family:'宋体';">的代码中设置（也可以在</span><span style="font-family:Calibri;">mapred-site.xml</span><span style="font-family:'宋体';">中配置）</span></em></p><p><em>maptask<span style="font-family:'宋体';">和</span><span style="font-family:Calibri;">reducetask</span><span style="font-family:'宋体';">所申请的资源配额：</span></em></p><table border="1" cellspacing="2"><tbody><tr><td><p><a>mapreduce.map.memory.mb</a></p></td><td><p>1024</p></td><td><p>一个maptask所需要的分配内存</p></td></tr><tr><td><p><a>mapreduce.map.cpu.vcores</a></p></td><td><p>1</p></td><td><p>一个maptask所需要的vcore</p></td></tr><tr><td><p><a>mapreduce.reduce.memory.mb</a></p></td><td><p>1024</p></td><td><p>一个reducetask所需要的内存</p></td></tr><tr><td><p><a>mapreduce.reduce.cpu.vcores</a></p></td><td><p>1</p></td><td><p>一个reducetask所需要的vcore</p></td></tr></tbody></table><p><em> </em></p><p><em>MRAppMaster<span style="font-family:'宋体';">所申请的资源配额：</span></em></p><table border="1" cellspacing="2"><tbody><tr><td><p><a>yarn.app.mapreduce.am.resource.mb</a></p></td><td><p>1536</p></td><td><p>默认1.5G</p></td></tr><tr><td><p><a>yarn.app.mapreduce.am.resource.cpu-vcores</a></p></td><td><p>1</p></td><td><p>默认1核</p></td></tr></tbody></table><p> </p><h1><strong><span style="font-family:'宋体';">如何实现</span>MR<span style="font-family:'宋体';">框架中的</span><span style="font-family:Calibri;">Writable</span><span style="font-family:'宋体';">接口</span></strong></h1><p>接口中有两个核心方法：</p><p>write(DataOutput out)  :  <span style="font-family:'宋体';">序列化时将对象的属性数据变成二进制</span></p><p>readFields(DataInput in) <span style="font-family:'宋体';">： 反序列化时，将二进制变成数据属性并设置到对象中</span></p><p><em> </em></p><p><em> </em></p><p><em> </em></p><h1><strong>MR<span style="font-family:'宋体';">编程框架中的高级</span><span style="font-family:Calibri;">API</span></strong></h1><p><span style="font-family:'宋体';">如果要用自定义类型</span>Bean<span style="font-family:'宋体';">作为</span><span style="font-family:Calibri;">map</span><span style="font-family:'宋体';">输出的</span><span style="font-family:Calibri;">KEY</span><span style="font-family:'宋体';">，则需要以下编程接口：</span></p><p> </p><p>Bean <span style="font-family:'宋体';">必须实现  </span><span style="font-family:Calibri;">WritableComparable </span><span style="font-family:'宋体';">接口：   </span><span style="font-family:Calibri;">write()  readFields()   compareTo()</span></p><p> </p><p><span style="font-family:'宋体';">分区器：必须自定义一个分区器：</span> </p><p>XPartitioner extends Partitioner&lt;KEY,VALUE&gt;<span style="font-family:'宋体';">，核心方法：</span><span style="font-family:Calibri;">getPartition(KEY k,VALUE v,int numReduceTasks)</span></p><p><em> </em></p><p><em>分组比较器：必须自定义一个分组比较器</em></p><table border="1" cellspacing="0"><tbody><tr><td valign="top" style="background:rgb(222,235,246);"><p><em>XGroupingComparator  extends WritableComparator</em></p><p><em>public XGroupingComparator(){</em></p><p><em>super(key.class,true);<br>}</em></p><p><em>       compare(WritableComparable a,WritableComparable b){</em></p><p><em> </em></p><p><em>};</em></p></td></tr></tbody></table><p><em> </em></p><p><em> </em></p><p><em> </em></p><p><em> </em></p><h1><strong><span style="font-family:'宋体';">在</span>map<span style="font-family:'宋体';">方法中如何获取</span><span style="font-family:Calibri;">maptask</span><span style="font-family:'宋体';">所处理的任务切片信息</span></strong></h1><p><em>FileSplit fileSplit = (FileSpliut) context.getInputSplit();</em></p><p><em> </em></p><p><em> </em></p><p><em> </em></p>            </div>
                </div>