---
layout:     post
title:      hadoop的集群搭建
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
							<!-- flowchart 箭头图标 勿删 -->
							<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path></svg>
							<blockquote>
  <p>Hadoop是一个由Apache基金会所开发的分布式系统基础架构。 <br>
  用户可以在不了解分布式底层细节的情况下，开发分布式程序。充分利用集群的威力进行高速运算和存储。 <br>
  Hadoop实现了一个分布式文件系统（Hadoop Distributed File System），简称HDFS。HDFS有高容错性的特点，并且设计用来部署在低廉的（low-cost）硬件上；而且它提供高吞吐量（highthroughput）来访问应用程序的数据，适合那些有着超大数据集（large dataset）的应用程序。HDFS放宽了（relax）POSIX的要求，可以以流的形式访问（streaming access）文件系统中的数据。 <br>
  Hadoop的框架最核心的设计就是：HDFS和MapReduce。HDFS为海量的数据提供了存储，则MapReduce为海量的数据提供了计算。</p>
</blockquote>



<h2 id="单点">单点</h2>

<p>新建用户hadoop并切换到hadoop用户：</p>



<pre class="prettyprint"><code class=" hljs ruby">[root<span class="hljs-variable">@server1</span> ~]<span class="hljs-comment"># useradd -u 800 hadoop</span>
[root<span class="hljs-variable">@server1</span> ~]<span class="hljs-comment"># su - hadoop</span>
[hadoop<span class="hljs-variable">@server1</span> ~]<span class="hljs-variable">$ </span>ls
hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">3</span>.tar.gz  jdk-<span class="hljs-number">7</span>u79-linux-x64.tar.gz
</code></pre>

<p>解压jdk并制作软链接：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> ~]<span class="hljs-variable">$ </span>tar zxf jdk-<span class="hljs-number">7</span>u79-linux-x64.tar.gz 
[hadoop<span class="hljs-variable">@server1</span> ~]<span class="hljs-variable">$ </span>ln -s jdk1.<span class="hljs-number">7.0_79</span>/ java
</code></pre>

<p>解压hadoop并设定变量：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> ~]<span class="hljs-variable">$ </span>tar zxf hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">3</span>.tar.gz 
[hadoop<span class="hljs-variable">@server1</span> ~]<span class="hljs-variable">$ </span>cd hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">3</span>
[hadoop<span class="hljs-variable">@server1</span> hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">3</span>]<span class="hljs-variable">$ </span>vim etc/hadoop/hadoop-env.sh 
</code></pre>

<p><img src="https://img-blog.csdn.net/20180826151744690?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xldHRlcl9B/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p>

<p>设定全局变量：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> ~]<span class="hljs-variable">$ </span>vim .bash_profile 
[hadoop<span class="hljs-variable">@server1</span> ~]<span class="hljs-variable">$ </span>source .bash_profile 
</code></pre>

<p><img src="https://img-blog.csdn.net/20180826151921901?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xldHRlcl9B/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p>

<p>创建input目录：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> ~]<span class="hljs-variable">$ </span>cd hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">3</span>
[hadoop<span class="hljs-variable">@server1</span> hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">3</span>]<span class="hljs-variable">$ </span>cp etc/hadoop/*.xml input/
[hadoop<span class="hljs-variable">@server1</span> hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">3</span>]<span class="hljs-variable">$ </span>bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-<span class="hljs-number">2.7</span>.<span class="hljs-number">3</span>.jar grep input output <span class="hljs-string">'dfs[a-z.]+'</span>
</code></pre>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> input]<span class="hljs-variable">$ </span>cd ..
[hadoop<span class="hljs-variable">@server1</span> hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">3</span>]<span class="hljs-variable">$ </span>cd output/
[hadoop<span class="hljs-variable">@server1</span> output]<span class="hljs-variable">$ </span>ls
part-r-<span class="hljs-number">00000</span>  _SUCCESS
[hadoop<span class="hljs-variable">@server1</span> output]<span class="hljs-variable">$ </span>cat part-r-<span class="hljs-number">00000</span> 
<span class="hljs-number">1</span>   dfsadmin
</code></pre>

<p><strong>hadoop配置文件的设定：</strong></p>

<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">3</span>]<span class="hljs-variable">$ </span>vim etc/hadoop/hdfs-site.xml 
</code></pre>

<p><img src="https://img-blog.csdn.net/2018082615394057?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xldHRlcl9B/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">3</span>]<span class="hljs-variable">$ </span>vim etc/hadoop/hadoop-env.sh 
</code></pre>

<p><img src="https://img-blog.csdn.net/20180826154051632?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xldHRlcl9B/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>cd etc/hadoop/
[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>vim core-site.xml 
</code></pre>

<p><img src="https://img-blog.csdn.net/20180826154329676?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xldHRlcl9B/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>vim slaves 
</code></pre>

<p><img src="https://img-blog.csdn.net/20180826155701934?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xldHRlcl9B/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p>

<p>设定免密连接：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> ~]<span class="hljs-variable">$ </span>ssh-keygen 
[hadoop<span class="hljs-variable">@server1</span> ~]<span class="hljs-variable">$ </span>cd .ssh/
[hadoop<span class="hljs-variable">@server1</span> .ssh]<span class="hljs-variable">$ </span>cp id_rsa.pub authorized_keys 
</code></pre>

<p>测试免密：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> .ssh]<span class="hljs-variable">$ </span>ssh <span class="hljs-number">172.25</span>.<span class="hljs-number">17.1</span>
[hadoop<span class="hljs-variable">@server1</span> .ssh]<span class="hljs-variable">$ </span>ssh localhost
[hadoop<span class="hljs-variable">@server1</span> .ssh]<span class="hljs-variable">$ </span>ssh server1
[hadoop<span class="hljs-variable">@server1</span> .ssh]<span class="hljs-variable">$ </span>ssh <span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>
</code></pre>

<p>初始化：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> .ssh]<span class="hljs-variable">$ </span>cd
[hadoop<span class="hljs-variable">@server1</span> ~]<span class="hljs-variable">$ </span>cd hadoop
[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>bin/hdfs namenode -format
</code></pre>

<p>开启服务：</p>



<pre class="prettyprint"><code class=" hljs vhdl">[hadoop@server1 hadoop]$ sbin/start-dfs.sh 
Starting namenodes <span class="hljs-keyword">on</span> [server1]
server1: starting namenode, logging <span class="hljs-keyword">to</span> /home/hadoop/hadoop-<span class="hljs-number">2.7</span><span class="hljs-number">.3</span>/logs/hadoop-hadoop-namenode-server1.<span class="hljs-keyword">out</span>
<span class="hljs-number">172.25</span><span class="hljs-number">.17</span><span class="hljs-number">.1</span>: starting datanode, logging <span class="hljs-keyword">to</span> /home/hadoop/hadoop-<span class="hljs-number">2.7</span><span class="hljs-number">.3</span>/logs/hadoop-hadoop-datanode-server1.<span class="hljs-keyword">out</span>
Starting secondary namenodes [<span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>]
<span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>: starting secondarynamenode, logging <span class="hljs-keyword">to</span> /home/hadoop/hadoop-<span class="hljs-number">2.7</span><span class="hljs-number">.3</span>/logs/hadoop-hadoop-secondarynamenode-server1.<span class="hljs-keyword">out</span>
</code></pre>

<p>查看服务状态：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>jps
<span class="hljs-number">1882</span> <span class="hljs-constant">NameNode</span>
<span class="hljs-number">1975</span> <span class="hljs-constant">DataNode</span>
<span class="hljs-number">2267</span> <span class="hljs-constant">Jps</span>
<span class="hljs-number">2158</span> <span class="hljs-constant">SecondaryNameNode</span>
</code></pre>

<p>浏览器访问： <br>
<img src="https://img-blog.csdn.net/20180826160230231?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xldHRlcl9B/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p>

<p><strong>设定共享目录：</strong></p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>bin/hdfs  dfs -mkdir /user
[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>bin/hdfs  dfs -mkdir /user/hadoop
[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>bin/hdfs dfs -put input/
[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>bin/hdfs dfs -ls
<span class="hljs-constant">Found</span> <span class="hljs-number">1</span> items
drwxr-xr-x   - hadoop supergroup          <span class="hljs-number">0</span> <span class="hljs-number">2018</span>-08-<span class="hljs-number">26</span> <span class="hljs-number">15</span><span class="hljs-symbol">:</span><span class="hljs-number">35</span> input
</code></pre>

<p>浏览器访问： <br>
<img src="https://img-blog.csdn.net/20180826160350135?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xldHRlcl9B/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p>



<h2 id="设定主从集群">设定主从集群</h2>

<p>server1停掉服务并切换到超级用户</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>sbin/stop-dfs.sh 
<span class="hljs-constant">Stopping</span> namenodes on [server1]
<span class="hljs-symbol">server1:</span> stopping namenode
<span class="hljs-number">172.25</span>.<span class="hljs-number">17.1</span><span class="hljs-symbol">:</span> stopping datanode
<span class="hljs-constant">Stopping</span> secondary namenodes [<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>]
<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span><span class="hljs-symbol">:</span> stopping secondarynamenode
[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>exit
logout
</code></pre>

<p>在server1，server2和servre3端安装nfs-utils服务：</p>



<pre class="prettyprint"><code class=" hljs ruby">[root<span class="hljs-variable">@server1</span> ~]<span class="hljs-comment"># yum install nfs-utils -y</span>
</code></pre>

<p>编辑文件：</p>



<pre class="prettyprint"><code class=" hljs ruby">[root<span class="hljs-variable">@server1</span> ~]<span class="hljs-comment"># vim /etc/exports </span>
</code></pre>

<p><img src="https://img-blog.csdn.net/2018082616244489?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xldHRlcl9B/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br>
开启服务：</p>



<pre class="prettyprint"><code class=" hljs ruby">[root<span class="hljs-variable">@server1</span> ~]<span class="hljs-comment"># /etc/init.d/rpcbind start</span>
<span class="hljs-constant">Starting</span> <span class="hljs-symbol">rpcbind:</span>                                          [  <span class="hljs-constant">OK</span>  ]
[root<span class="hljs-variable">@server1</span> ~]<span class="hljs-comment"># /etc/init.d/nfs start</span>
<span class="hljs-constant">Starting</span> <span class="hljs-constant">NFS</span> <span class="hljs-symbol">services:</span>                                     [  <span class="hljs-constant">OK</span>  ]
<span class="hljs-constant">Starting</span> <span class="hljs-constant">NFS</span> <span class="hljs-symbol">mountd:</span>                                       [  <span class="hljs-constant">OK</span>  ]
<span class="hljs-constant">Starting</span> <span class="hljs-constant">NFS</span> <span class="hljs-symbol">daemon:</span>                                       [  <span class="hljs-constant">OK</span>  ]
<span class="hljs-constant">Starting</span> <span class="hljs-constant">RPC</span> <span class="hljs-symbol">idmapd:</span>                                       [  <span class="hljs-constant">OK</span>  ]
</code></pre>

<p>刷新挂载：</p>



<pre class="prettyprint"><code class=" hljs ruby">[root<span class="hljs-variable">@server1</span> ~]<span class="hljs-comment"># showmount -e</span>
<span class="hljs-constant">Export</span> list <span class="hljs-keyword">for</span> <span class="hljs-symbol">server1:</span>
/home/hadoop *
</code></pre>

<p>同样在server2和server3端安装服务并建立用户，之后开启服务，将servre1端的目录挂载：</p>



<pre class="prettyprint"><code class=" hljs ruby">[root<span class="hljs-variable">@server2</span> ~]<span class="hljs-comment"># yum install nfs-utils rpc-bind -y</span>
[root<span class="hljs-variable">@server2</span> ~]<span class="hljs-comment"># /etc/init.d/rpcbind start</span>
<span class="hljs-constant">Starting</span> <span class="hljs-symbol">rpcbind:</span>                                          [  <span class="hljs-constant">OK</span>  ]
[root<span class="hljs-variable">@server2</span> ~]<span class="hljs-comment"># /etc/init.d/nfs start</span>
<span class="hljs-constant">Starting</span> <span class="hljs-constant">NFS</span> <span class="hljs-symbol">services:</span>                                     [  <span class="hljs-constant">OK</span>  ]
<span class="hljs-constant">Starting</span> <span class="hljs-constant">NFS</span> <span class="hljs-symbol">mountd:</span>                                       [  <span class="hljs-constant">OK</span>  ]
<span class="hljs-constant">Starting</span> <span class="hljs-constant">NFS</span> <span class="hljs-symbol">daemon:</span>                                       [  <span class="hljs-constant">OK</span>  ]
<span class="hljs-constant">Starting</span> <span class="hljs-constant">RPC</span> <span class="hljs-symbol">idmapd:</span>                                       [  <span class="hljs-constant">OK</span>  ]
[root<span class="hljs-variable">@server2</span> ~]<span class="hljs-comment"># useradd -u 800 hadoop</span>
[root<span class="hljs-variable">@server2</span> ~]<span class="hljs-comment"># id hadoop</span>
uid=<span class="hljs-number">800</span>(hadoop) gid=<span class="hljs-number">800</span>(hadoop) groups=<span class="hljs-number">800</span>(hadoop)
[root<span class="hljs-variable">@server2</span> ~]<span class="hljs-comment"># mount 172.25.17.1:/home/hadoop /home/hadoop</span>
[root<span class="hljs-variable">@server2</span> ~]<span class="hljs-comment"># su - hadoop</span>
[hadoop<span class="hljs-variable">@server2</span> ~]<span class="hljs-variable">$ </span>ls
hadoop  hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">3</span>  hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">3</span>.tar.gz  java  jdk1.<span class="hljs-number">7.0_79</span>  jdk-<span class="hljs-number">7</span>u79-linux-x64.tar.gz
</code></pre>

<p>ssh测试：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> ~]<span class="hljs-variable">$ </span>ssh <span class="hljs-number">172.25</span>.<span class="hljs-number">17.2</span>
[hadoop<span class="hljs-variable">@server1</span> ~]<span class="hljs-variable">$ </span>ssh <span class="hljs-number">172.25</span>.<span class="hljs-number">17.3</span>
</code></pre>

<p>sevrer1端切换到hadoop用户并编辑文件：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> ~]<span class="hljs-variable">$ </span>cd hadoop/etc/hadoop/
[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>vim hdfs-site.xml 
</code></pre>

<p><img src="https://img-blog.csdn.net/20180826162922417?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xldHRlcl9B/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p>

<p>设定从设备：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>vim slaves </code></pre>

<p><img src="https://img-blog.csdn.net/20180826163021840?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xldHRlcl9B/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br>
重新进行服务初始化：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> ~]<span class="hljs-variable">$ </span>cd hadoop
[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>bin/hdfs namenode -format
</code></pre>

<p>开启服务：</p>



<pre class="prettyprint"><code class=" hljs vhdl">[hadoop@server1 hadoop]$ sbin/start-dfs.sh 
Starting namenodes <span class="hljs-keyword">on</span> [server1]
server1: starting namenode, logging <span class="hljs-keyword">to</span> /home/hadoop/hadoop-<span class="hljs-number">2.7</span><span class="hljs-number">.3</span>/logs/hadoop-hadoop-namenode-server1.<span class="hljs-keyword">out</span>
<span class="hljs-number">172.25</span><span class="hljs-number">.17</span><span class="hljs-number">.2</span>: starting datanode, logging <span class="hljs-keyword">to</span> /home/hadoop/hadoop-<span class="hljs-number">2.7</span><span class="hljs-number">.3</span>/logs/hadoop-hadoop-datanode-server2.<span class="hljs-keyword">out</span>
<span class="hljs-number">172.25</span><span class="hljs-number">.17</span><span class="hljs-number">.3</span>: starting datanode, logging <span class="hljs-keyword">to</span> /home/hadoop/hadoop-<span class="hljs-number">2.7</span><span class="hljs-number">.3</span>/logs/hadoop-hadoop-datanode-server3.<span class="hljs-keyword">out</span>
Starting secondary namenodes [<span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>]
<span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>: starting secondarynamenode, logging <span class="hljs-keyword">to</span> /home/hadoop/hadoop-<span class="hljs-number">2.7</span><span class="hljs-number">.3</span>/logs/hadoop-hadoop-secondarynamenode-server1.<span class="hljs-keyword">out</span>
</code></pre>

<p>查看服务状态：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>jps
<span class="hljs-number">3626</span> <span class="hljs-constant">Jps</span>
<span class="hljs-number">3329</span> <span class="hljs-constant">NameNode</span>
<span class="hljs-number">3517</span> <span class="hljs-constant">SecondaryNameNode</span>
</code></pre>

<p>重新初始化后就要重新建立共享目录：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>bin/hdfs dfs -mkdir /user
[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>bin/hdfs dfs -mkdir /user/hadoop
[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>bin/hdfs dfs -put input/
[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-<span class="hljs-number">2.7</span>.<span class="hljs-number">3</span>.jar wordcount input output
</code></pre>

<p>查看：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>bin/hdfs dfs -cat output/*
</code></pre>



<h2 id="节点的添加">节点的添加</h2>

<p>要给集群添加节点server4，需要在server4端同样地安装nsf-utils，开启服务，建立用户并挂载目录：</p>



<pre class="prettyprint"><code class=" hljs ruby">[root<span class="hljs-variable">@server4</span> ~]<span class="hljs-comment"># yum install nfs-utils -y</span>
[root<span class="hljs-variable">@server4</span> ~]<span class="hljs-comment"># /etc/init.d/rpcbind start</span>
[root<span class="hljs-variable">@server4</span> ~]<span class="hljs-comment"># /etc/init.d/nfs start</span>
<span class="hljs-constant">Starting</span> <span class="hljs-constant">NFS</span> <span class="hljs-symbol">services:</span>                                     [  <span class="hljs-constant">OK</span>  ]
<span class="hljs-constant">Starting</span> <span class="hljs-constant">NFS</span> <span class="hljs-symbol">quotas:</span>                                       [  <span class="hljs-constant">OK</span>  ]
<span class="hljs-constant">Starting</span> <span class="hljs-constant">NFS</span> <span class="hljs-symbol">mountd:</span>                                       [  <span class="hljs-constant">OK</span>  ]
<span class="hljs-constant">Starting</span> <span class="hljs-constant">NFS</span> <span class="hljs-symbol">daemon:</span>                                       [  <span class="hljs-constant">OK</span>  ]
<span class="hljs-constant">Starting</span> <span class="hljs-constant">RPC</span> <span class="hljs-symbol">idmapd:</span>                                       [  <span class="hljs-constant">OK</span>  ]
[root<span class="hljs-variable">@server4</span> ~]<span class="hljs-comment"># useradd -u 800 hadoop</span>
[root<span class="hljs-variable">@server4</span> ~]<span class="hljs-comment"># mount 172.25.17.1:/home/hadoop/ /home/hadoop/</span>
</code></pre>

<p>切换到hadoop用户并编辑文件slave：</p>



<pre class="prettyprint"><code class=" hljs ruby">[root<span class="hljs-variable">@server4</span> ~]<span class="hljs-comment"># su - hadoop</span>
[hadoop<span class="hljs-variable">@server4</span> ~]<span class="hljs-variable">$ </span>ls
hadoop  hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">3</span>  hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">3</span>.tar.gz  java  jdk1.<span class="hljs-number">7.0_79</span>  jdk-<span class="hljs-number">7</span>u79-linux-x64.tar.gz
[hadoop<span class="hljs-variable">@server4</span> ~]<span class="hljs-variable">$ </span>cd hadoop/etc/hadoop/
[hadoop<span class="hljs-variable">@server4</span> hadoop]<span class="hljs-variable">$ </span>vim slaves 
</code></pre>

<p>将节点server4写入： <br>
<img src="https://img-blog.csdn.net/20180826170009865?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xldHRlcl9B/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p>

<p>开启数据节点：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server4</span> ~]<span class="hljs-variable">$ </span>cd hadoop
[hadoop<span class="hljs-variable">@server4</span> hadoop]<span class="hljs-variable">$ </span>sbin/hadoop-daemon.sh start datanode
starting datanode, logging to /home/hadoop/hadoop-<span class="hljs-number">2.7</span>.<span class="hljs-number">3</span>/logs/hadoop-hadoop-datanode-server4.out
</code></pre>

<p><strong>效果查看：</strong>成功添加server4</p>



<pre class="prettyprint"><code class=" hljs mel">[hadoop<span class="hljs-variable">@server4</span> hadoop]$ bin/hdfs dfsadmin -report
Configured Capacity: <span class="hljs-number">58780667904</span> (<span class="hljs-number">54.74</span> GB)
Present Capacity: <span class="hljs-number">52842000384</span> (<span class="hljs-number">49.21</span> GB)
DFS Remaining: <span class="hljs-number">52841705472</span> (<span class="hljs-number">49.21</span> GB)
DFS Used: <span class="hljs-number">294912</span> (<span class="hljs-number">288</span> KB)
DFS Used<span class="hljs-variable">%:</span> <span class="hljs-number">0.00</span>%
Under replicated blocks: <span class="hljs-number">0</span>
Blocks with corrupt replicas: <span class="hljs-number">0</span>
Missing blocks: <span class="hljs-number">0</span>
Missing blocks (with replication factor <span class="hljs-number">1</span>): <span class="hljs-number">0</span>

-------------------------------------------------
Live datanodes (<span class="hljs-number">3</span>):

Name: <span class="hljs-number">172.25</span><span class="hljs-number">.17</span><span class="hljs-number">.2</span>:<span class="hljs-number">50010</span> (server2)
Hostname: server2
Decommission Status : Normal
Configured Capacity: <span class="hljs-number">19593555968</span> (<span class="hljs-number">18.25</span> GB)
DFS Used: <span class="hljs-number">135168</span> (<span class="hljs-number">132</span> KB)
Non DFS Used: <span class="hljs-number">1958719488</span> (<span class="hljs-number">1.82</span> GB)
DFS Remaining: <span class="hljs-number">17634701312</span> (<span class="hljs-number">16.42</span> GB)
DFS Used<span class="hljs-variable">%:</span> <span class="hljs-number">0.00</span>%
DFS Remaining<span class="hljs-variable">%:</span> <span class="hljs-number">90.00</span>%
Configured Cache Capacity: <span class="hljs-number">0</span> (<span class="hljs-number">0</span> B)
Cache Used: <span class="hljs-number">0</span> (<span class="hljs-number">0</span> B)
Cache Remaining: <span class="hljs-number">0</span> (<span class="hljs-number">0</span> B)
Cache Used<span class="hljs-variable">%:</span> <span class="hljs-number">100.00</span>%
Cache Remaining<span class="hljs-variable">%:</span> <span class="hljs-number">0.00</span>%
Xceivers: <span class="hljs-number">1</span>
Last contact: Sun Aug <span class="hljs-number">26</span> <span class="hljs-number">17</span>:<span class="hljs-number">02</span>:<span class="hljs-number">10</span> CST <span class="hljs-number">2018</span>


Name: <span class="hljs-number">172.25</span><span class="hljs-number">.17</span><span class="hljs-number">.3</span>:<span class="hljs-number">50010</span> (server3)
Hostname: server3
Decommission Status : Normal
Configured Capacity: <span class="hljs-number">19593555968</span> (<span class="hljs-number">18.25</span> GB)
DFS Used: <span class="hljs-number">135168</span> (<span class="hljs-number">132</span> KB)
Non DFS Used: <span class="hljs-number">1954742272</span> (<span class="hljs-number">1.82</span> GB)
DFS Remaining: <span class="hljs-number">17638678528</span> (<span class="hljs-number">16.43</span> GB)
DFS Used<span class="hljs-variable">%:</span> <span class="hljs-number">0.00</span>%
DFS Remaining<span class="hljs-variable">%:</span> <span class="hljs-number">90.02</span>%
Configured Cache Capacity: <span class="hljs-number">0</span> (<span class="hljs-number">0</span> B)
Cache Used: <span class="hljs-number">0</span> (<span class="hljs-number">0</span> B)
Cache Remaining: <span class="hljs-number">0</span> (<span class="hljs-number">0</span> B)
Cache Used<span class="hljs-variable">%:</span> <span class="hljs-number">100.00</span>%
Cache Remaining<span class="hljs-variable">%:</span> <span class="hljs-number">0.00</span>%
Xceivers: <span class="hljs-number">1</span>
Last contact: Sun Aug <span class="hljs-number">26</span> <span class="hljs-number">17</span>:<span class="hljs-number">02</span>:<span class="hljs-number">07</span> CST <span class="hljs-number">2018</span>


Name: <span class="hljs-number">172.25</span><span class="hljs-number">.17</span><span class="hljs-number">.4</span>:<span class="hljs-number">50010</span> (server4)
Hostname: server4
Decommission Status : Normal
Configured Capacity: <span class="hljs-number">19593555968</span> (<span class="hljs-number">18.25</span> GB)
DFS Used: <span class="hljs-number">24576</span> (<span class="hljs-number">24</span> KB)
Non DFS Used: <span class="hljs-number">2025205760</span> (<span class="hljs-number">1.89</span> GB)
DFS Remaining: <span class="hljs-number">17568325632</span> (<span class="hljs-number">16.36</span> GB)
DFS Used<span class="hljs-variable">%:</span> <span class="hljs-number">0.00</span>%
DFS Remaining<span class="hljs-variable">%:</span> <span class="hljs-number">89.66</span>%
Configured Cache Capacity: <span class="hljs-number">0</span> (<span class="hljs-number">0</span> B)
Cache Used: <span class="hljs-number">0</span> (<span class="hljs-number">0</span> B)
Cache Remaining: <span class="hljs-number">0</span> (<span class="hljs-number">0</span> B)
Cache Used<span class="hljs-variable">%:</span> <span class="hljs-number">100.00</span>%
Cache Remaining<span class="hljs-variable">%:</span> <span class="hljs-number">0.00</span>%
Xceivers: <span class="hljs-number">1</span>
Last contact: Sun Aug <span class="hljs-number">26</span> <span class="hljs-number">17</span>:<span class="hljs-number">02</span>:<span class="hljs-number">09</span> CST <span class="hljs-number">2018</span>
</code></pre>

<p>在浏览器中也可以查看到节点数量变为3个： <br>
<img src="https://img-blog.csdn.net/20180826170357482?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xldHRlcl9B/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br>
<img src="https://img-blog.csdn.net/2018082617040776?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xldHRlcl9B/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p>



<h2 id="节点删除">节点删除</h2>

<p>为了测试效果，在server1端将一个大文加加到文件系统中：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>pwd
/home/hadoop/hadoop
[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>dd <span class="hljs-keyword">if</span>=<span class="hljs-regexp">/dev/zero</span> of=bigfile bs=<span class="hljs-number">1</span>M count=<span class="hljs-number">300</span>
<span class="hljs-number">300</span>+<span class="hljs-number">0</span> records <span class="hljs-keyword">in</span>
<span class="hljs-number">300</span>+<span class="hljs-number">0</span> records out
<span class="hljs-number">314572800</span> bytes (<span class="hljs-number">315</span> <span class="hljs-constant">MB</span>) copied, <span class="hljs-number">2.26836</span> s, <span class="hljs-number">139</span> <span class="hljs-constant">MB</span>/s
[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>bin/hdfs dfs -put bigfile 
</code></pre>

<p>浏览器查看文件成功加入到文件系统： <br>
<img src="https://img-blog.csdn.net/20180826170841245?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xldHRlcl9B/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p>

<p>查看节点信息： <br>
可以发现server3端存有302.9M的数据</p>



<pre class="prettyprint"><code class=" hljs mel">[hadoop<span class="hljs-variable">@server1</span> hadoop]$ bin/hdfs dfsadmin -report
Configured Capacity: <span class="hljs-number">58780667904</span> (<span class="hljs-number">54.74</span> GB)
Present Capacity: <span class="hljs-number">52842024974</span> (<span class="hljs-number">49.21</span> GB)
DFS Remaining: <span class="hljs-number">52207644672</span> (<span class="hljs-number">48.62</span> GB)
DFS Used: <span class="hljs-number">634380302</span> (<span class="hljs-number">604.99</span> MB)
DFS Used<span class="hljs-variable">%:</span> <span class="hljs-number">1.20</span>%
Under replicated blocks: <span class="hljs-number">0</span>
Blocks with corrupt replicas: <span class="hljs-number">0</span>
Missing blocks: <span class="hljs-number">0</span>
Missing blocks (with replication factor <span class="hljs-number">1</span>): <span class="hljs-number">0</span>

-------------------------------------------------
Live datanodes (<span class="hljs-number">3</span>):

Name: <span class="hljs-number">172.25</span><span class="hljs-number">.17</span><span class="hljs-number">.2</span>:<span class="hljs-number">50010</span> (server2)
Hostname: server2
Decommission Status : Normal
Configured Capacity: <span class="hljs-number">19593555968</span> (<span class="hljs-number">18.25</span> GB)
DFS Used: <span class="hljs-number">46637056</span> (<span class="hljs-number">44.48</span> MB)
Non DFS Used: <span class="hljs-number">1958719488</span> (<span class="hljs-number">1.82</span> GB)
DFS Remaining: <span class="hljs-number">17588199424</span> (<span class="hljs-number">16.38</span> GB)
DFS Used<span class="hljs-variable">%:</span> <span class="hljs-number">0.24</span>%
DFS Remaining<span class="hljs-variable">%:</span> <span class="hljs-number">89.77</span>%
Configured Cache Capacity: <span class="hljs-number">0</span> (<span class="hljs-number">0</span> B)
Cache Used: <span class="hljs-number">0</span> (<span class="hljs-number">0</span> B)
Cache Remaining: <span class="hljs-number">0</span> (<span class="hljs-number">0</span> B)
Cache Used<span class="hljs-variable">%:</span> <span class="hljs-number">100.00</span>%
Cache Remaining<span class="hljs-variable">%:</span> <span class="hljs-number">0.00</span>%
Xceivers: <span class="hljs-number">1</span>
Last contact: Sun Aug <span class="hljs-number">26</span> <span class="hljs-number">17</span>:<span class="hljs-number">09</span>:<span class="hljs-number">19</span> CST <span class="hljs-number">2018</span>


Name: <span class="hljs-number">172.25</span><span class="hljs-number">.17</span><span class="hljs-number">.3</span>:<span class="hljs-number">50010</span> (server3)
Hostname: server3
Decommission Status : Normal
Configured Capacity: <span class="hljs-number">19593555968</span> (<span class="hljs-number">18.25</span> GB)
DFS Used: <span class="hljs-number">317181952</span> (<span class="hljs-number">302.49</span> MB)
Non DFS Used: <span class="hljs-number">1954742272</span> (<span class="hljs-number">1.82</span> GB)
DFS Remaining: <span class="hljs-number">17321631744</span> (<span class="hljs-number">16.13</span> GB)
DFS Used<span class="hljs-variable">%:</span> <span class="hljs-number">1.62</span>%
DFS Remaining<span class="hljs-variable">%:</span> <span class="hljs-number">88.40</span>%
Configured Cache Capacity: <span class="hljs-number">0</span> (<span class="hljs-number">0</span> B)
Cache Used: <span class="hljs-number">0</span> (<span class="hljs-number">0</span> B)
Cache Remaining: <span class="hljs-number">0</span> (<span class="hljs-number">0</span> B)
Cache Used<span class="hljs-variable">%:</span> <span class="hljs-number">100.00</span>%
Cache Remaining<span class="hljs-variable">%:</span> <span class="hljs-number">0.00</span>%
Xceivers: <span class="hljs-number">1</span>
Last contact: Sun Aug <span class="hljs-number">26</span> <span class="hljs-number">17</span>:<span class="hljs-number">09</span>:<span class="hljs-number">19</span> CST <span class="hljs-number">2018</span>


Name: <span class="hljs-number">172.25</span><span class="hljs-number">.17</span><span class="hljs-number">.4</span>:<span class="hljs-number">50010</span> (server4)
Hostname: server4
Decommission Status : Normal
Configured Capacity: <span class="hljs-number">19593555968</span> (<span class="hljs-number">18.25</span> GB)
DFS Used: <span class="hljs-number">270561294</span> (<span class="hljs-number">258.03</span> MB)
Non DFS Used: <span class="hljs-number">2025181170</span> (<span class="hljs-number">1.89</span> GB)
DFS Remaining: <span class="hljs-number">17297813504</span> (<span class="hljs-number">16.11</span> GB)
DFS Used<span class="hljs-variable">%:</span> <span class="hljs-number">1.38</span>%
DFS Remaining<span class="hljs-variable">%:</span> <span class="hljs-number">88.28</span>%
Configured Cache Capacity: <span class="hljs-number">0</span> (<span class="hljs-number">0</span> B)
Cache Used: <span class="hljs-number">0</span> (<span class="hljs-number">0</span> B)
Cache Remaining: <span class="hljs-number">0</span> (<span class="hljs-number">0</span> B)
Cache Used<span class="hljs-variable">%:</span> <span class="hljs-number">100.00</span>%
Cache Remaining<span class="hljs-variable">%:</span> <span class="hljs-number">0.00</span>%
Xceivers: <span class="hljs-number">1</span>
Last contact: Sun Aug <span class="hljs-number">26</span> <span class="hljs-number">17</span>:<span class="hljs-number">09</span>:<span class="hljs-number">18</span> CST <span class="hljs-number">2018</span>
</code></pre>

<p>编辑slave文件将sevrer3删除： <br>
<img src="https://img-blog.csdn.net/20180826171238423?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xldHRlcl9B/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p>

<p>新建文件hosta-exclude：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>vim hosts-exclude
</code></pre>

<p>写入被删除的节点ip： <br>
<img src="https://img-blog.csdn.net/20180826173910919?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xldHRlcl9B/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p>

<p>编辑文件etc/hadoop/hdfs-site.xml：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>vim etc/hadoop/hdfs-site.xml 
</code></pre>



<pre class="prettyprint"><code class=" hljs xml"><span class="hljs-comment">&lt;!-- Put site-specific property overrides in this file. --&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">configuration</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">property</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>dfs.replication<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
                   <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">property</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>dfs.hosts.exclude<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>/home/hadoop/hadoop/etc/hadoop/hosts-exclude<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">configuration</span>&gt;</span>
</code></pre>

<p>刷新：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>bin/hdfs dfsadmin -refreshNodes
<span class="hljs-constant">Refresh</span> nodes successful
</code></pre>

<p>查看集群状态：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server1</span> hadoop]<span class="hljs-variable">$ </span>bin/hdfs dfsadmin -report
</code></pre>

<p>server3正在迁移： <br>
<img src="https://img-blog.csdn.net/20180826180847262?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xldHRlcl9B/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p>

<p><img src="https://img-blog.csdn.net/20180826180857530?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xldHRlcl9B/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p>

<p>迁移完成，并且server3的数据转移到server4上： <br>
<img src="https://img-blog.csdn.net/20180826180923168?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xldHRlcl9B/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p>

<p>之后在server3端停掉服务：</p>



<pre class="prettyprint"><code class=" hljs ruby">[hadoop<span class="hljs-variable">@server3</span> hadoop]<span class="hljs-variable">$ </span>sbin/hadoop-daemon.sh stop datanode
stopping datanode
</code></pre>            </div>
						<link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-9e5741c4b9.css" rel="stylesheet">
                </div>