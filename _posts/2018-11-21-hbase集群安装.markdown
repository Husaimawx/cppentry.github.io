---
layout:     post
title:      hbase集群安装
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <p>hbase集群安装</p><h1>1      集群规划</h1><table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td valign="top"><p>Hadoop-master1</p></td>  <td valign="top"><p>192.168.2.100</p></td>  <td valign="top"><p>Hbase主</p></td> </tr><tr><td valign="top"><p>Hadoop-master2</p></td>  <td valign="top"><p>192.168.2.101</p></td>  <td valign="top"><p>Hbase被</p></td> </tr><tr><td valign="top"><p>Hadoop-slave1~hadoop-slave2</p></td>  <td valign="top"><p> </p></td>  <td valign="top"><p>Zookeeper集群</p></td> </tr></tbody></table><p> </p><h1>2      linux内核调整</h1><h2>2.1   用户限制</h2><p>vim /etc/security/limits.conf</p><p>root   soft   nproc   50000</p><p>root   hard   nproc   50000</p><p>root   soft   nofile  25535</p><p>root   hard   nofile  25535</p><p>hadoop   soft   nproc   50000</p><p>hadoop   hard   nproc   50000</p><p>hadoop   soft   nofile  25535</p><p>hadoop   hard   nofile  25535</p><h2>2.2   内核参数</h2><p>vim/etc/sysctl.conf</p><p>net.ipv4.ip_forward= 0</p><p>net.ipv4.conf.default.rp_filter= 1</p><p>net.ipv4.conf.default.accept_source_route=0</p><p>kernel.core_users_pid= 1</p><p>net.ipv4.tcp_syncookies= 1</p><p>net.bridge.bridge-nf-call-ip6tables= 0</p><p>net.bridge.bridge-nf-call-iptables= 0</p><p>net.bridge.bridge-nf-call-arptables= 0</p><p>kernel.mggmnb= 65536</p><p>kernel.mggmax= 65536</p><p>kernel.shmmax= 68719476736</p><p>kernel.shmall= 268435456</p><p>net.ipv4.tcp_max_syn_backlog= 65000</p><p>net.core.netdev_max_backlog= 32768</p><p>net.core.somaxconn= 32768</p><p>fs.file-max= 65000</p><p>net.core.wmem_default= 8388608</p><p>net.core.rmem_default= 8388608</p><p>net.core.rmem_max= 16777216</p><p>net.core.wmem_max= 16777216</p><p>net.ipv4.tcp_timestamps= 1</p><p>net.ipv4.tcp_synack_retries= 2</p><p>net.ipv4.tcp_syn_retries= 2</p><p>net.ipv4.tcp_mem= 94500000 915000000927000000</p><p>net.ipv4.tcp_max_orphans= 3276800</p><p>net.ipv4.tcp_tw_reuse= 1</p><p>net.ipv4.tcp_tw_recycle= 1</p><p>net.ipv4.tcp_keepalive_time= 1200</p><p>net.ipv4.tcp_syncookies= 1</p><p>net.ipv4.tcp_fin_timeout= 10</p><p>net.ipv4.tcp_keepalive_intvl= 15</p><p>net.ipv4.tcp_keepalive_probes= 3</p><p>net.ipv4.ip_local_port_range= 1024 65535</p><p>net.ipv4.conf.eml.send_redirects= 0</p><p>net.ipv4.conf.lo.send_redirects= 0</p><p>net.ipv4.conf.default.send_redirects= 0</p><p>net.ipv4.conf.all.send_redirects= 0</p><p>net.ipv4.icmp_echo_ignore_broadcasts= 1</p><p>net.ipv4.conf.eml.accept_source_route= 0</p><p>net.ipv4.conf.lo.accept_source_route= 0</p><p>net.ipv4.conf.default.accept_source_route=0</p><p>net.ipv4.conf.all.accept_source_route= 0</p><p>net.ipv4.icmp_ignore_bogus_error_responses=1</p><p>kernel.core_pattern= /tmp/core</p><p>vm.overcommit_memory= 1</p><p>#sysctl -p</p><h1>3      hbase安装</h1><h2>3.1   软件材料</h2><p>hbase-1.2.4-bin.tar.gz</p><h2>3.2   安装过程</h2><h3>3.2.1  上传资料</h3><p>mkdir /home/hadoop/hbase</p><p>将hbase-1.2.4-bin.tar.gz上传到hbase目录并解压</p><h3>3.2.2  修改环境变量</h3><p>vim ~/.bash_profile</p><p> </p><p></p><p>source ~/.bash_profile</p><h3>3.2.3  hbase-env.sh</h3><p>&lt;?xml version="1.0"?&gt;</p><p>&lt;!--</p><p> Licensed under the Apache License, Version 2.0 (the"License");</p><p>  youmay not use this file except in compliance with the License.</p><p>  Youmay obtain a copy of the License at</p><p> </p><p>   http://www.apache.org/licenses/LICENSE-2.0</p><p> </p><p> Unless required by applicable law or agreed to in writing, software</p><p> distributed under the License is distributed on an "AS IS"BASIS,</p><p> WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</p><p>  Seethe License for the specific language governing permissions and</p><p> limitations under the License. See accompanying LICENSE file.</p><p>--&gt;</p><p>&lt;configuration&gt;</p><p>         &lt;property&gt;</p><p>                   &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;</p><p>                   &lt;value&gt;mapreduce_shuffle&lt;/value&gt;</p><p>         &lt;/property&gt;</p><p>         &lt;property&gt;</p><p>                   &lt;name&gt;yarn.web-proxy.address&lt;/name&gt;</p><p>                   &lt;value&gt;hadoop-master2:8888&lt;/value&gt;</p><p>         &lt;/property&gt;</p><p>         &lt;property&gt;</p><p>                   &lt;name&gt;yarn.log-aggregation-enable&lt;/name&gt;</p><p>                   &lt;value&gt;true&lt;/value&gt;</p><p>         &lt;/property&gt;</p><p>         &lt;property&gt;</p><p>                   &lt;name&gt;yarn.nodemanager.remote-app-log-dir&lt;/name&gt;</p><p>                   &lt;value&gt;/logs&lt;/value&gt;</p><p>         &lt;/property&gt;</p><p>         &lt;property&gt;</p><p>                   &lt;name&gt;yarn.log-aggregation.retain-seconds&lt;/name&gt;</p><p>                   &lt;value&gt;604800&lt;/value&gt;</p><p>         &lt;/property&gt;</p><p>         &lt;property&gt;</p><p>                   &lt;name&gt;yarn.nodemanager.resource.memory-mb&lt;/name&gt;</p><p>                   &lt;value&gt;2048&lt;/value&gt;</p><p>         &lt;/property&gt;</p><p>         &lt;property&gt;</p><p>                   &lt;name&gt;yarn.nodemanager.resource.cpu-vcores&lt;/name&gt;</p><p>                   &lt;value&gt;2&lt;/value&gt;</p><p>         &lt;/property&gt;</p><p>         &lt;property&gt;</p><p>                   &lt;name&gt;yarn.resourcemanager.ha.enabled&lt;/name&gt;</p><p>                   &lt;value&gt;true&lt;/value&gt;</p><p>         &lt;/property&gt;</p><p>         &lt;property&gt;</p><p>                   &lt;name&gt;yarn.resourcemanager.ha.automatic-failover.enabled&lt;/name&gt;</p><p>                   &lt;value&gt;true&lt;/value&gt;</p><p>         &lt;/property&gt;</p><p>         &lt;property&gt;</p><p>                   &lt;name&gt;yarn.resourcemanager.cluster-id&lt;/name&gt;</p><p>                   &lt;value&gt;yarncluster&lt;/value&gt;</p><p>         &lt;/property&gt;</p><p>         &lt;property&gt;</p><p>                   &lt;name&gt;yarn.resourcemanager.ha.rm-ids&lt;/name&gt;</p><p>                   &lt;value&gt;rm1,rm2&lt;/value&gt;</p><p>         &lt;/property&gt;</p><p>         &lt;property&gt;</p><p>                   &lt;name&gt;yarn.resourcemanager.hostname.rm1&lt;/name&gt;</p><p>                   &lt;value&gt;hadoop-master1&lt;/value&gt;</p><p>         &lt;/property&gt;</p><p>         &lt;property&gt;</p><p>                   &lt;name&gt;yarn.resourcemanager.hostname.rm2&lt;/name&gt;</p><p>                   &lt;value&gt;hadoop-master2&lt;/value&gt;</p><p>         &lt;/property&gt;</p><p>         &lt;property&gt;</p><p>                   &lt;name&gt;yarn.resourcemanager.webapp.address.rm1&lt;/name&gt;</p><p>                   &lt;value&gt;hadoop-master1:8088&lt;/value&gt;</p><p>         &lt;/property&gt;</p><p>         &lt;property&gt;</p><p>                   &lt;name&gt;yarn.resourcemanager.webapp.address.rm2&lt;/name&gt;</p><p>                   &lt;value&gt;hadoop-master2:8088&lt;/value&gt;</p><p>         &lt;/property&gt;</p><p>         &lt;property&gt;</p><p>                   &lt;name&gt;yarn.resourcemanager.zk-address&lt;/name&gt;</p><p>                   &lt;value&gt;hadoop-slave1:2181,hadoop-slave2:2181,hadoop-slave3:2181&lt;/value&gt;</p><p>         &lt;/property&gt;</p><p>         &lt;property&gt;</p><p>                   &lt;name&gt;yarn.resourcemanager.zk-state-store.parent-path&lt;/name&gt;</p><p>                   &lt;value&gt;/rmstore&lt;/value&gt;</p><p>         &lt;/property&gt;</p><p>         &lt;property&gt;</p><p>                   &lt;name&gt;yarn.resourcemanager.recovery.enabled&lt;/name&gt;</p><p>                   &lt;value&gt;true&lt;/value&gt;</p><p>         &lt;/property&gt;</p><p> </p><p>         &lt;property&gt;</p><p>                   &lt;name&gt;yarn.resourcemanager.store.class&lt;/name&gt;</p><p>                   &lt;value&gt;org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore&lt;/value&gt;</p><p>         &lt;/property&gt;</p><p>         &lt;property&gt;</p><p>                   &lt;name&gt;yarn.nodemanager.recovery.enabled&lt;/name&gt;</p><p>                   &lt;value&gt;true&lt;/value&gt;</p><p>         &lt;/property&gt;</p><p>         &lt;property&gt;</p><p>                   &lt;name&gt;yarn.nodemanager.address&lt;/name&gt;</p><p>                   &lt;value&gt;0.0.0.0:45454&lt;/value&gt;</p><p>         &lt;/property&gt;</p><p>&lt;/configuration&gt;</p><p> </p><h3>3.2.4  regionservers</h3><p>vim ~/hbase/hbase-1.2.4/conf/regionservers</p><p>hadoop-slave1</p><p>hadoop-slave2</p><p>hadoop-slave3</p><h3>3.2.5  backup-masters</h3><p>vim ~/hbase/hbase-1.2.4/conf/backup-masters</p><p>hadoop-master2</p><h3>3.2.6  创建目录</h3><p>mkdir ~/hbase/data/tmp</p><p>mkdir ~/hbase/hbase-1.2.4/logs</p><p>mkdir ~/hbase/hbase-1.2.4/pids</p><h3>3.2.7  将hbase工作目录同步到集群其它节点</h3><p>scp –r ~/hbase hadoop-master2:~/</p><h3>3.2.8  在集群各节点上修改用户环境变量</h3><p>vim .bash_profile</p><p></p><p>source .bash_profile</p><h3>3.2.9  删除hbase的slf4j-log4j12-1.7.5.jar，解决hbase和hadoop的LSF4J包冲突</h3><p>cd ~/hbase/hbase-1.2.4/lib</p><p>mv slf4j-log4j12-1.7.5.jarslf4j-log4j12-1.7.5.jar.bk</p><h1>4      集群启动</h1><p>// 启动zookeeper集群（分别在slave1、slave2和slave3上执行）</p><p>$ zkServer.shstart</p><p>备注：此命令分别在slave1/slave2/slave3节点启动了QuorumPeerMain。</p><p>// 启动HDFS（在master1执行）</p><p>$ start-dfs.sh</p><p>备注：此命令分别在master1/master2节点启动了NameNode和ZKFC，分别在slave1/slave2/slave3节点启动了DataNode和JournalNode。</p><p>// 启动YARN（在master2执行）</p><p>$ start-yarn.sh</p><p>备注：此命令在master2节点启动了ResourceManager，分别在slave1/slave2/slave3节点启动了NodeManager。</p><p>// 启动YARN的另一个ResourceManager（在master1执行，用于容灾）</p><p>$ yarn-daemon.sh start resourcemanager</p><p>备注：此命令在master1节点启动了ResourceManager。</p><p>// 启动HBase（在master1执行）</p><p>$ start-hbase.sh</p><p>备注：此命令分别在master1/master2节点启动了HMaster，分别在slave1/slave2/slave3节点启动了HRegionServer</p><p> </p>            </div>
                </div>