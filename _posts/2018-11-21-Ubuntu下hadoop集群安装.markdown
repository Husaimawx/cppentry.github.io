---
layout:     post
title:      Ubuntu下hadoop集群安装
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								<div class="article-copyright">
					版权声明：					https://blog.csdn.net/ajing454266432/article/details/79893834				</div>
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <h2><a>8、had</a>8.1 安装</h2><p>将hadoop压缩包hadoop-2.6.0.tar.gz放在/home/hduser目录下，并解压缩到本地，重命名为hadoop；配置hadoop环境变量，执行：</p><pre><code class="language-html">sudogedit /etc/profile</code></pre><p>将以下复制到profile内：</p><pre><code class="language-html"> #hadoop

exportHADOOP_HOME=/home/hduser/hadoop   

exportPATH=$HADOOP_HOME/bin:$PATH</code></pre><p>执行：</p><pre><code class="language-html">source /etc/profile</code></pre><p>注意：Ubuntu1、ubuntu2都要配置以上步骤；</p><p>8.2 配置</p><p>主要涉及的配置文件有7个：都在/hadoop/etc/hadoop文件夹下，可以用gedit命令对其进行编辑。</p><p><strong>（1）进去hadoop配置文件目录</strong></p><p>cd /home/hduser/hadoop/etc/hadoop/</p><p><strong>（2）配置 hadoop-env.sh文件--&gt;修改JAVA_HOME</strong></p><p>gedit hadoop-env.sh</p><p>添加如下内容</p><p># The java implementation to use.</p><p>export JAVA_HOME=/usr/lib/jvm/java-7-openjdk-i386/</p><p><strong>（3）配置 yarn-env.sh 文件--&gt;&gt;修改JAVA_HOME</strong></p><p>添加如下内容</p><p># some Java parameters</p><p>exportJAVA_HOME=/opt/jdk1.6.0_45</p><p><strong>（4）配置slaves文件--&gt;&gt;增加slave节点 </strong></p><p>（删除原来的localhost）</p><p>添加如下内容</p><p>Ubuntu1</p><p>Ubuntu2</p><p><strong>（5）配置 core-site.xml文件--&gt;&gt;增加hadoop核心配置</strong></p><p>（hdfs文件端口是9000、file:/home/hduser/hadoop/tmp）</p><p>添加如下内容</p><p>&lt;configuration&gt;<br> &lt;property&gt;<br>  &lt;name&gt;fs.defaultFS&lt;/name&gt;<br>  &lt;value&gt;hdfs://Ubuntu1:9000&lt;/value&gt;<br> &lt;/property&gt;</p><p> &lt;property&gt;<br>  &lt;name&gt;io.file.buffer.size&lt;/name&gt;<br>  &lt;value&gt;131072&lt;/value&gt;<br> &lt;/property&gt;<br> &lt;property&gt;<br>  &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;<br>  &lt;value&gt;file:/home/hduser/hadoop/tmp&lt;/value&gt;<br>  &lt;description&gt;Abasefor other temporarydirectories.&lt;/description&gt;<br> &lt;/property&gt;</p><p>&lt;property&gt;</p><p> &lt;name&gt;hadoop.native.lib&lt;/name&gt;<br>  &lt;value&gt;true&lt;/value&gt;<br>  &lt;description&gt;Should native hadoop libraries, if present, beused.&lt;/description&gt;<br>&lt;/property&gt; </p><p>&lt;/configuration&gt;</p><p><strong>（6）配置  hdfs-site.xml 文件--&gt;&gt;增加hdfs配置信息</strong></p><p>（namenode、datanode端口和目录位置）</p><p>&lt;configuration&gt;<br> &lt;property&gt;<br>  &lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt;<br>  &lt;value&gt;Ubuntu1:9001&lt;/value&gt;<br> &lt;/property&gt;<br><br>  &lt;property&gt;<br>   &lt;name&gt;dfs.namenode.name.dir&lt;/name&gt;<br>   &lt;value&gt;file:/home/hduser/hadoop/dfs/name&lt;/value&gt;<br> &lt;/property&gt;<br><br> &lt;property&gt;<br>  &lt;name&gt;dfs.datanode.data.dir&lt;/name&gt;<br>  &lt;value&gt; file:/home/hduser/hadoop/dfs/data&lt;/value&gt;<br>  &lt;/property&gt;<br><br> &lt;property&gt;<br>  &lt;name&gt;dfs.replication&lt;/name&gt;<br>  &lt;value&gt;2&lt;/value&gt;<br> &lt;/property&gt;<br><br> &lt;property&gt;<br>  &lt;name&gt;dfs.webhdfs.enabled&lt;/name&gt;<br>  &lt;value&gt;true&lt;/value&gt;<br> &lt;/property&gt;<br>&lt;/configuration&gt;</p><p><strong>（7）配置  mapred-site.xml 文件--&gt;&gt;增加mapreduce配置</strong></p><p>（使用yarn框架、jobhistory使用地址以及web地址）</p><p>&lt;configuration&gt;<br>  &lt;property&gt;<br>   &lt;name&gt;mapreduce.framework.name&lt;/name&gt;<br>   &lt;value&gt;yarn&lt;/value&gt;<br> &lt;/property&gt;<br> &lt;property&gt;<br>  &lt;name&gt;mapreduce.jobhistory.address&lt;/name&gt;<br>  &lt;value&gt;Ubuntu1:10020&lt;/value&gt;<br> &lt;/property&gt;<br> &lt;property&gt;<br>  &lt;name&gt;mapreduce.jobhistory.webapp.address&lt;/name&gt;<br>  &lt;value&gt; Ubuntu1:19888&lt;/value&gt;<br> &lt;/property&gt;<br>&lt;/configuration&gt;</p><p><strong>（8）配置   yarn-site.xml  文件--&gt;&gt;增加yarn功能</strong></p><p>&lt;configuration&gt;<br>  &lt;property&gt;<br>   &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;<br>   &lt;value&gt;mapreduce_shuffle&lt;/value&gt;<br>  &lt;/property&gt;<br>  &lt;property&gt;<br>  &lt;name&gt;yarn.nodemanager.aux-services.mapreduce.shuffle.class&lt;/name&gt;<br>   &lt;value&gt;org.apache.hadoop.mapred.ShuffleHandler&lt;/value&gt;<br>  &lt;/property&gt;<br>  &lt;property&gt;<br>   &lt;name&gt;yarn.resourcemanager.address&lt;/name&gt;<br>   &lt;value&gt;Ubuntu1:8032&lt;/value&gt;<br>  &lt;/property&gt;<br>  &lt;property&gt;<br>   &lt;name&gt;yarn.resourcemanager.scheduler.address&lt;/name&gt;<br>   &lt;value&gt;Ubuntu1:8030&lt;/value&gt;<br>  &lt;/property&gt;<br>  &lt;property&gt;<br>  &lt;name&gt;yarn.resourcemanager.resource-tracker.address&lt;/name&gt;<br>   &lt;value&gt;Ubuntu1:8035&lt;/value&gt;<br>  &lt;/property&gt;<br>  &lt;property&gt;<br>   &lt;name&gt;yarn.resourcemanager.admin.address&lt;/name&gt;<br>   &lt;value&gt;Ubuntu1:8033&lt;/value&gt;<br>  &lt;/property&gt;<br>  &lt;property&gt;<br>   &lt;name&gt;yarn.resourcemanager.webapp.address&lt;/name&gt;<br>   &lt;value&gt;Ubuntu1:8088&lt;/value&gt;<br>  &lt;/property&gt;<br><br>&lt;/configuration&gt;</p><p><strong>（9）将配置好的Ubuntu1中/hadoop/etc/hadoop文件夹复制到到Ubuntu2对应位置</strong>（删除Ubuntu2原来的文件夹/hadoop/etc/hadoop）</p><p>scp-r /home/hduser/hadoop/etc/hadoop/hduser@Ubuntu2:/home/hduser/hadoop/etc/</p><p>8.3 验证</p><p>下面验证Hadoop配置是否正确：</p><p><strong>（1）格式化namenode:</strong></p><p><strong>Ubuntu1：<br></strong></p><pre><code class="language-html">cd hadoop

./bin/hdfs namenode -format</code></pre><strong>Ubuntu2：</strong><br><pre><code class="language-html">cd hadoop

./bin/hdfs namenode -format</code></pre><p><strong>（2）启动hdfs:</strong></p><pre><code class="language-html">cd hadoop
./sbin/start-dfs.sh</code></pre><p>15/04/2704:18:45 WARN util.NativeCodeLoader: Unable to load native-hadoop library foryour platform... using builtin-java classes where applicable</p><p>Startingnamenodes on [Ubuntu1]</p><p>Ubuntu1:starting namenode, logging to/home/hduser/hadoop/logs/hadoop-hduser-namenode-Ubuntu1.out</p><p>Ubuntu1:starting datanode, logging to /home/hduser/hadoop/logs/hadoop-hduser-datanode-Ubuntu1.out</p><p>Ubuntu2:starting datanode, logging to/home/hduser/hadoop/logs/hadoop-hduser-datanode-Ubuntu2.out</p><p>Startingsecondary namenodes [Ubuntu1]</p><p>Ubuntu1:starting secondarynamenode, logging to /home/hduser/hadoop/logs/hadoop-hduser-secondarynamenode-Ubuntu1.out</p><p>15/04/2704:19:07 WARN util.NativeCodeLoader: Unable to load native-hadoop library foryour platform... using builtin-java classes where applicable</p><p> </p><p>查看java进程（Java Virtual Machine Process Status Tool）</p><p>hduser@Ubuntu1:~/hadoop$ jps</p><p>8008 NameNode</p><p>8443 Jps</p><p>8158 DataNode</p><p>8314SecondaryNameNode</p><p style="background:#FFFFFF;"><span style="color:#4F4F4F;background:#FFFFFF;">使用 jps</span>发现NameNode进程没有正确运行，</p><p style="background:#FFFFFF;"><span style="color:#4F4F4F;background:#FFFFFF;">停止服务，</span></p><p style="background:#FFFFFF;"><span style="color:#4F4F4F;background:#FFFFFF;">重新格式化namenode</span>，</p><pre><code class="language-html">hadoop namenode  -format</code></pre><pre><code class="language-html">start-all.sh</code></pre><p style="background:#FFFFFF;"><span style="color:#4F4F4F;background:#FFFFFF;">NameNode</span><span style="color:#4F4F4F;background:#FFFFFF;">进程已运行</span></p><p><strong>（3）停止hdfs:</strong></p><pre><code class="language-html">cd hadoop
./sbin/stop-dfs.sh</code></pre><p>Stoppingnamenodes on [Ubuntu1]</p><p>Ubuntu1:stopping namenode</p><p>Ubuntu1:stopping datanode</p><p>Ubuntu2:stopping datanode</p><p>Stoppingsecondary namenodes [Ubuntu1]</p><p>Ubuntu1:stopping secondarynamenode</p><p>查看java进程</p><p>hduser@Ubuntu1:~/hadoop$ jps</p><p>8850 Jps</p><p><strong>（4）启动yarn:</strong></p><pre><code class="language-html">cd hadoop
./sbin/start-yarn.sh</code></pre><p>starting yarndaemons</p><p>startingresourcemanager, logging to/home/hduser/hadoop/logs/yarn-hduser-resourcemanager-Ubuntu1.out</p><p>Ubuntu2:starting nodemanager, logging to/home/hduser/hadoop/logs/yarn-hduser-nodemanager-Ubuntu2.out</p><p>Ubuntu1:starting nodemanager, logging to/home/hduser/hadoop/logs/yarn-hduser-nodemanager-Ubuntu1.out</p><p> </p><p>查看java进程</p><pre><code class="language-html"></code></pre><pre class="html">cd hadoop
jps</pre><p>8911ResourceManager</p><p>9247 Jps</p><p>9034NodeManager</p><p><strong>（5）停止yarn:</strong></p><pre><code class="language-html">cd hadoop
./sbin/stop-yarn.sh</code></pre><p>stopping yarndaemons</p><p>stoppingresourcemanager</p><p>Ubuntu1:stopping nodemanager</p><p>Ubuntu2:stopping nodemanager</p><p>no proxyserverto stop</p><p>查看java进程</p><p></p><pre><code class="language-html">cd hadoop
jps</code></pre><p>9542 Jps</p><p><strong>（6）查看集群状态：</strong></p><p>首先启动集群：</p><pre><code class="language-html">./sbin/start-dfs.sh</code></pre><pre><code class="language-html">cd hadoop
./bin/hdfs dfsadmin -report</code></pre><p>ConfiguredCapacity: 39891361792 (37.15 GB)</p><p>PresentCapacity: 28707627008 (26.74 GB)</p><p>DFS Remaining: 28707569664(26.74 GB)</p><p>DFS Used: 57344(56 KB)</p><p>DFS Used%: 0.00%</p><p>Under replicatedblocks: 0</p><p>Blocks withcorrupt replicas: 0</p><p>Missing blocks:0</p><p> </p><p>-------------------------------------------------</p><p>Live datanodes(2):</p><p> </p><p>Name:192.168.159.132:50010 (Ubuntu2)</p><p>Hostname:Ubuntu2</p><p>DecommissionStatus : Normal</p><p>ConfiguredCapacity: 19945680896 (18.58 GB)</p><p>DFS Used: 28672(28 KB)</p><p>Non DFS Used:5575745536 (5.19 GB)</p><p>DFS Remaining:14369906688 (13.38 GB)</p><p>DFS Used%: 0.00%</p><p>DFS Remaining%:72.05%</p><p>Configured CacheCapacity: 0 (0 B)</p><p>Cache Used: 0 (0B)</p><p>Cache Remaining:0 (0 B)</p><p>Cache Used%:100.00%</p><p>CacheRemaining%: 0.00%</p><p>Xceivers: 1</p><p>Last contact:Mon Apr 27 04:26:09 PDT 2015</p><p> </p><p>Name:192.168.159.131:50010 (Ubuntu1)</p><p>Hostname:Ubuntu1</p><p>DecommissionStatus : Normal</p><p>ConfiguredCapacity: 19945680896 (18.58 GB)</p><p>DFS Used: 28672(28 KB)</p><p>Non DFS Used:5607989248 (5.22 GB)</p><p>DFS Remaining:14337662976 (13.35 GB)</p><p>DFS Used%: 0.00%</p><p>DFS Remaining%:71.88%</p><p>Configured CacheCapacity: 0 (0 B)</p><p>Cache Used: 0 (0B)</p><p>Cache Remaining:0 (0 B)</p><p>Cache Used%:100.00%</p><p>CacheRemaining%: 0.00%</p><p>Xceivers: 1</p><p>Last contact:Mon Apr 27 04:26:08 PDT 2015</p><p><strong>（7）查看hdfs：http://Ubuntu1:50070/</strong></p><br>            </div>
                </div>