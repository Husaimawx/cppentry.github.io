---
layout:     post
title:      linux上kafka安装
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                1.下载kafka <br><span>	</span>Apache官网<br><span>	</span>http://kafka.apache.org/downloads.html<br><br><br>2.解压重命名<br><span>	</span>tar -zxvf kafka_2.12-1.0.0.tgz<br><span>	</span>mv kafka_2.12-1.0.0 kafka<br><span>	</span>rm -rf kafka_2.12-1.0.0.tgz(删除包)<br><span>	</span><br>3.配置kafka<br><span>	</span>vi /usr/local/kafka/config/server.properties<br><span>	</span>broker.id：依次增长的整数，0、1、2，集群中Broker的唯一id<br><span>	</span>advertised.listeners=PLAINTEXT://cache03:9092        cache01 公网地址已经在/etc/hosts做好了映射，其他三台也一样<br><span>	</span>zookeeper.connect=cache01:2181,cache02:2181,cache03:2181<br><span>	</span><br><br><br>4.启动kafka和关闭命令<br><span>	</span>在三台机器上的kafka目录下，分别执行以下命令：<br><span>	</span>nohup bin/kafka-server-start.sh config/server.properties &amp;<br><span>	</span>或者<br><span>	</span>bin/kafka-server-start.sh config/server.properties &amp;<br><span>	</span>使用jps检查启动是否成功<br><span>	</span><br><span>	</span><br><span>	</span>关闭kafka <br><span>	</span>bin/kafka-server-stop.sh<br><span>	</span>或者<br><span>	</span>kill -9 端口号<br><span>	</span><br><br><br>5.使用基本命令检查kafka是否搭建成功<br><br><br><span>	</span>创建一个名称为test的Topic，1个分区，并且复制因子为1  <br><span>		</span>bin/kafka-topics.sh  --zookeeper cache01:2181,cache02:2181,cache03:2181  --replication-factor 1 --partitions 1 --create --topic test01<br><br><br><span>	</span>删除一个名称为test的Topic，但不是马上，先标记，一段时间后才会删除<span>	</span><br><span>		</span>bin/kafka-topics.sh --delete   --zookeeper cache01:2181,cache02:2181,cache03:2181 --topic test<br><span>		</span><br><span>		</span>你看到的“ Topic test is already marked for deletion.”是正常的。Kafka删除topic的过程实际上<br><span>		</span>是异步的：命令行仅仅是提交一个删除申请给到controller，并标记该topic为“待删除”状态。其实在Kafka服务器端<br><span>		</span>真正的删除逻辑应该已经开启，正常情况下您需要多等待一段时间topic自然会被成功删除。<br><br><br><span>		</span><br><span>	</span>查看创建的Topic  <br><span>		</span>bin/kafka-topics.sh --describe  --zookeeper cache01:2181,cache02:2181,cache03:2181 --topic test01<br><br><br><span>	</span>查看所有的Topic <span>	</span><br><span>		</span>bin/kafka-topics.sh --list  --zookeeper cache01:2181,cache02:2181,cache03:2181<br><br><br><span>		</span><br><span>	</span>启动Producer ,并向我们上面创建的名称为test的Topic中生产消息，  <br><span>		</span>bin/kafka-console-producer.sh --broker-list cache01:9092,cache02:9092,cache03:9092 --topic test01<br><br><br><span>	</span>启动Consumer ，并订阅我们上面创建的名称为test的Topic中生产的消息  <br><span>		</span>bin/kafka-console-consumer.sh --zookeeper  cache01:2181,cache02:2181,cache03:2181  --from-beginning --topic test01<br><br><br><br><br><br><br><br><br><br><br>1. kafka 启动的时候报错了，生成了一个类似这样的日志文件hs_err_pid4301.log<br><span>	</span>主要原因原因：kafka启动脚本kafka-server-start.sh中指定了kafka启动时需要的最小内存，默认为1G<br><span>	</span>export KAFKA_HEAP_OPTS="-Xmx1G -Xms1G"<br><span>	</span>虚拟机分配的虚拟内存在1G以下时就会出现该错误<br><span>	</span>解决：<br><br><br><span>	</span>vi /usr/local/kafka/bin/kafka-server-start.sh<br><br><br><span>	</span>将export KAFKA_HEAP_OPTS="-Xmx1G -Xms1G"<br><span>	</span>改为export KAFKA_HEAP_OPTS="-Xmx256M -Xms128M"<br><br><br>2. kafka 启动的时候报错了：<br>java.lang.OutOfMemoryError: Java heap space<br><span>	</span>at java.nio.HeapByteBuffer.&lt;init&gt;(HeapByteBuffer.java:57)<br><span>	</span>at java.nio.ByteBuffer.allocate(ByteBuffer.java:335)<br><span>	</span>at kafka.log.SkimpyOffsetMap.&lt;init&gt;(OffsetMap.scala:45)<br><span>	</span>at kafka.log.LogCleaner$CleanerThread.&lt;init&gt;(LogCleaner.scala:222)<br><span>	</span>at kafka.log.LogCleaner.$anonfun$cleaners$1(LogCleaner.scala:108)<br><span>	</span>at kafka.log.LogCleaner.$anonfun$cleaners$1$adapted(LogCleaner.scala:108)<br><span>	</span>at kafka.log.LogCleaner$$Lambda$143/783191662.apply(Unknown Source)<br><span>	</span>at scala.collection.TraversableLike.$anonfun$map$1(TraversableLike.scala:234)<br><span>	</span>at scala.collection.TraversableLike$$Lambda$12/2074185499.apply(Unknown Source)<br><span>	</span>at scala.collection.immutable.Range.foreach(Range.scala:156)<br><span>	</span>at scala.collection.TraversableLike.map(TraversableLike.scala:234)<br><span>	</span>at scala.collection.TraversableLike.map$(TraversableLike.scala:227)<br><span>	</span>at scala.collection.AbstractTraversable.map(Traversable.scala:104)<br><span>	</span>at kafka.log.LogCleaner.&lt;init&gt;(LogCleaner.scala:108)<br><br><br>原因：kafka启动时分配的内存过小导致<br>解决方法：同样脚本kafka-server-start.sh中的最小启动内存，设置为较大值<br><br><br><br><br>3. kafka producer报了一个错kafka org.apache.kafka.clients.producer.internals.ErrorLoggingCallback<br><br><br><br><br>原因：配置文件的advertised.listeners配置出错了<br><br><br><br><br><br><br><br>            </div>
                </div>