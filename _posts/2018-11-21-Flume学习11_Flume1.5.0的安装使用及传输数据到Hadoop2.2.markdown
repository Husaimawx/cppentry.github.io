---
layout:     post
title:      Flume学习11_Flume1.5.0的安装使用及传输数据到Hadoop2.2
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">问题导读：<br><span style="color:#ff0000;">1.什么是flume？</span></span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="color:#ff0000;">2.如何安装flume？<br>
3.flume的配置文件与其它软件有什么不同？</span></span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-size:18px;"><br><img id="aimg_Ru7rb" src="http://www.aboutyun.com/static/image/hrline/4.gif" border="0" alt="" width="500" height="35"><br><br><br><br>
一、认识flume</span></span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">1.flume是什么？</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">这里简单介绍一下，它是Cloudera的一个产品</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">2.flume是干什么的？</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">收集日志的</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">3.flume如何搜集日志？</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="color:#ff0000;">我们把flume比作情报人员</span></span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">（1）搜集信息</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">（2）获取记忆信息</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">（3）传递报告间谍信息</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">flume是怎么完成上面三件事情的，三个组件：</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">source： 搜集信息</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">channel：传递信息</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">sink：存储信息</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">上面有点简练，详细可以参考</span><a href="http://www.aboutyun.com/thread-7415-1-1.html%5C%22+target=%5C%22_blank%5C%22+.=%5C%22word-wrap:+break-word;+color:+rgb%2851,+102,+153%29;+font-family:+Tahoma,+%27Microsoft+Yahei%27,+Simsun;+line-height:+21px;+background-color:+rgb%28255,+255,+255%29;%5C%22+target=%5C%22_blank%5C%22+target=%5C%22_blank" rel="nofollow" style="color:rgb(51,51,51);text-decoration:none;font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">Flume内置channel,source,sink三组件介绍</a><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">上面我们认识了，flume。</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">下面我们来安装flume1.5</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><img id="aimg_cQ45d" src="http://www.aboutyun.com/static/image/hrline/1.gif" border="0" alt="" width="430" height="20" style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-size:18px;"><br></span></span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-size:18px;">二、安装flume1.5</span></span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">1.下载安装包</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">（1）官网下载</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><a href="http://www.apache.org/dyn/closer.cgi/flume/1.5.0/apache-flume-1.5.0-bin.tar.gz%5C%22+target=%5C%22_blank%5C%22+.=%5C%22word-wrap:+break-word;+color:+rgb%2851,+102,+153%29;+font-family:+Tahoma,+%27Microsoft+Yahei%27,+Simsun;+line-height:+21px;+background-color:+rgb%28255,+255,+255%29;%5C%22+target=%5C%22_blank%5C%22+target=%5C%22_blank" rel="nofollow" style="color:rgb(51,51,51);text-decoration:none;font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">apache-flume-1.5.0-bin.tar.gz</a><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><a href="http://www.apache.org/dyn/closer.cgi/flume/1.5.0/apache-flume-1.5.0-src.tar.gz%5C%22+target=%5C%22_blank%5C%22+.=%5C%22word-wrap:+break-word;+color:+rgb%2851,+102,+153%29;+font-family:+Tahoma,+%27Microsoft+Yahei%27,+Simsun;+line-height:+21px;+background-color:+rgb%28255,+255,+255%29;%5C%22+target=%5C%22_blank%5C%22+target=%5C%22_blank" rel="nofollow" style="color:rgb(51,51,51);text-decoration:none;font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">apache-flume-1.5.0-src.tar.gz</a><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">（2）百度网盘下载</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">链接: </span><a href="http://pan.baidu.com/s/1dDip8RZ%5C%22+target=%5C%22_blank%5C%22+.=%5C%22word-wrap:+break-word;+color:+rgb%2851,+102,+153%29;+font-family:+Tahoma,+%27Microsoft+Yahei%27,+Simsun;+line-height:+21px;+background-color:+rgb%28255,+255,+255%29;%5C%22+target=%5C%22_blank%5C%22+target=%5C%22_blank" rel="nofollow" style="color:rgb(51,51,51);text-decoration:none;font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">http://pan.baidu.com/s/1dDip8RZ</a><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"> 密码:
 268r</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><div style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">
<blockquote>我们走到这一步，我们会想到一个问题，我的电脑是32位的，不知道能否安装？如果我的电脑是64位的，能否安装。之前我们装的hadoop就分为32位和64位，想到这个问题是正常的，但是这里不用担心，因为我们下载的是二进制包，也就是说你32位和64位都可以安装。</blockquote>
</div>
<br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">2.分别解压：<br></span><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">下载之后，我们看到下面两个包：</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">（1）上传Linux<br></span><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"></span><img id="aimg_4473" src="http://www.aboutyun.com/data/attachment/forum/201406/02/102842hsz6afvzsv6kvs5m.png" width="274" alt="" style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"> </span><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"></span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">上面两个包，可以下载window，然后通过WinSCP,如果不会 </span><a href="http://www.aboutyun.com/thread-7663-1-1.html%5C%22+target=%5C%22_blank%5C%22+.=%5C%22word-wrap:+break-word;+color:+rgb%2851,+102,+153%29;+font-family:+Tahoma,+%27Microsoft+Yahei%27,+Simsun;+line-height:+21px;+background-color:+rgb%28255,+255,+255%29;%5C%22+target=%5C%22_blank%5C%22+target=%5C%22_blank" rel="nofollow" style="color:rgb(51,51,51);text-decoration:none;font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">新手指导：使用
 WinSCP（下载） 上文件到 Linux图文教程</a><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">（2）解压包</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">解压apache-flume-1.5.0-bin.tar.gz，</span><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">解压到usr文件夹下面</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><div style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">
<div id="code_MfZ">
<ol><li>sudo tar zxvf apache-flume-1.5.0-bin.tar.gz</li></ol></div>
<br></div>
<img id="aimg_4482" src="http://www.aboutyun.com/data/attachment/forum/201406/02/104722ok69na1y1kfb4yvq.png" width="594" alt="" style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"> </span><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"></span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">解压apache-flume-1.5.0-src.tar.gz，</span><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">解压到usr文件夹下面</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><div style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">
<div id="code_Bt8">
<ol><li>sudo tar zxvf apache-flume-1.5.0-src.tar.gz</li></ol></div>
<br></div>
<img id="aimg_4481" src="http://www.aboutyun.com/data/attachment/forum/201406/02/104600jbaaml2lbc2jzj2f.png" width="597" alt="" style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"> </span><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"></span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">(3) src里面文件内容，覆盖解压后bin文件里面的内容<br></span>
<div style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">
<div id="code_MV5">
<ol><li>sudo cp -ri apache-flume-1.5.0-src/* apache-flume-1.5.0-bin<br></li><li></ol></div>
<br></div>
<img id="aimg_4483" src="http://www.aboutyun.com/data/attachment/forum/201406/02/111238jkkavgz0msyvgkgs.png" width="600" alt="" style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"> </span><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"></span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">(4)重命名</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><div style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">
<div id="code_Ttx">
<ol><li>mv apache-flume-1.5.0-bin/ flume</li></ol></div>
<br></div>
<img id="aimg_4484" src="http://www.aboutyun.com/data/attachment/forum/201406/02/111454ci0uw0343yigywnk.png" width="508" alt="" style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"> </span><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"></span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">3.配置环境变量：</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><img id="aimg_4485" src="http://www.aboutyun.com/data/attachment/forum/201406/02/112449pb7itqrn7j54wqz4.png" width="600" alt="" style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"> </span><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"></span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">配置环境变量生效</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><div style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">
<div id="code_glD">
<ol><li>source /etc/environment</li></ol></div>
<br></div>
<br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">3.建立配置文件</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">这里面的配置文件还是比较特别的，不同于以往我们安装的软件，我们这里可以自己建立配置文件。</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">首先我们建立一个 example文件</span>
<div style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">
<div id="code_OFL">
<ol><li>vi example</li></ol></div>
<br></div>
<br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">，然后把下面内容，粘帖到里面就可以了，注意不要有乱码，有乱码的话，可以直接创建一个文件，然后上传。方法也有很多，能解决就好。</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">对于下面红字部分，记得创建文件夹，并且注意他们的权限一致，这个比较简单的，就不在书写了。对于下面的配置项，可以参考</span><a href="http://www.aboutyun.com/thread-7924-1-1.html%5C%22+target=%5C%22_blank%5C%22+.=%5C%22word-wrap:+break-word;+color:+rgb%2851,+102,+153%29;+font-family:+Tahoma,+%27Microsoft+Yahei%27,+Simsun;+line-height:+21px;+background-color:+rgb%28255,+255,+255%29;%5C%22+target=%5C%22_blank%5C%22+target=%5C%22_blank" rel="nofollow" style="color:rgb(51,51,51);text-decoration:none;font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">flume参考文档</a><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">，这里面的参数很详细。</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><div style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">
<blockquote><pre><code class="language-html">agent1表示代理名称
agent1.sources=source1
agent1.sinks=sink1
agent1.channels=channel1


#配置source1
agent1.sources.source1.type=spooldir
agent1.sources.source1.spoolDir=/usr/aboutyunlog
agent1.sources.source1.channels=channel1
agent1.sources.source1.fileHeader = false

#配置sink1
agent1.sinks.sink1.type=hdfs
agent1.sinks.sink1.hdfs.path=hdfs://master:8020/aboutyunlog
agent1.sinks.sink1.hdfs.fileType=DataStream
agent1.sinks.sink1.hdfs.writeFormat=TEXT
agent1.sinks.sink1.hdfs.rollInterval=4
agent1.sinks.sink1.channel=channel1


#配置channel1
agent1.channels.channel1.type=file
agent1.channels.channel1.checkpointDir=/usr/aboutyun_tmp123
agent1.channels.channel1.dataDirs=/usr/aboutyun_tmp</code></pre></blockquote>
</div>
<br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><img id="aimg_4487" src="http://www.aboutyun.com/data/attachment/forum/201406/02/120948ybh3uu0xub4c8xuk.png" width="547" alt="" style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"> </span><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"></span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">4.启动flume</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><div style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">
<blockquote>flume-ng agent -n agent1 -c conf -f <span style="color:#f00000;">/<span>us</span></span><span style="color:#ff0000;">r/flume/conf/example</span> <span style="color:#9acd32;">-Dflume.root.logger=DEBUG,console</span></blockquote>
</div>
<br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">上面注意红字部分，是我们自己建立的文件，而对于绿色部分，则是输出调试信息，也可以在配置文件中配置。</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">5.我们启动flume之后</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">会看到下面信息，并且信息不停的重复。这个其实是在</span><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">空文件的时候，</span><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">监控的信息输出。</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><img id="aimg_4488" src="http://www.aboutyun.com/data/attachment/forum/201406/02/122520v7jdaeueudui2dik.png" width="600" alt="" style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"> </span><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"></span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">一旦有文件输入，我们会看到下面信息。</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><div style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">
<blockquote>注意：这个不要关闭，我们另外开启一个shell，在监控文件夹中放入要上传的文件</blockquote>
</div>
<br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">比如我们在监控文件夹下，创建一个test1文件，内容如下</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><img id="aimg_4490" src="http://www.aboutyun.com/data/attachment/forum/201406/02/123422fqtbxdbwbj6ffdkd.png" width="239" alt=""> <br></span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">这时候flume监控shell，会有相应的如下下面变化</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><div style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">
<blockquote><pre><code class="language-html">2014-06-02 12:01:04,066 (pool-6-thread-1) [INFO - org.apache.flume.client.avro.ReliableSpoolingFileEventReader.rollCurrentFile(ReliableSpoolingFileEventReader.java:332)] Preparing to move file /usr/aboutyunlog/test1 to /usr/aboutyunlog/test1.COMPLETED
&lt;span style="color:#ff0000;background-color: rgb(204, 204, 204);"&gt;2014-06-02 12:01:04,070 (pool-6-thread-1)&lt;span style="color:#ff0000;"&gt; [ERROR - org.apache.flume.source.SpoolDirectorySource$SpoolDirectoryRunnable.run(SpoolDirectorySource.java:256)] FATAL: Spool Directory source source1: { spoolDir: /usr/aboutyunlog }: Uncaught exception in SpoolDirectorySource thread. Restart or reconfigure Flume to continue processing.
java.lang.IllegalStateException: File name has been re-used with different files. Spooling assumptions violated for /usr/aboutyunlog/test1.COMPLETED&lt;/span&gt;&lt;/span&gt;
at org.apache.flume.client.avro.ReliableSpoolingFileEventReader.rollCurrentFile(ReliableSpoolingFileEventReader.java:362)
at org.apache.flume.client.avro.ReliableSpoolingFileEventReader.retireCurrentFile(ReliableSpoolingFileEventReader.java:314)
at org.apache.flume.client.avro.ReliableSpoolingFileEventReader.readEvents(ReliableSpoolingFileEventReader.java:243)
at org.apache.flume.source.SpoolDirectorySource$SpoolDirectoryRunnable.run(SpoolDirectorySource.java:227)
at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:304)
at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:178)
at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
at java.lang.Thread.run(Thread.java:744)
2014-06-02 12:01:07,749 (SinkRunner-PollingRunner-DefaultSinkProcessor) [INFO - org.apache.flume.sink.hdfs.HDFSDataStream.configure(HDFSDataStream.java:58)] Serializer = TEXT, UseRawLocalFileSystem = false
2014-06-02 12:01:07,803 (SinkRunner-PollingRunner-DefaultSinkProcessor) [INFO - org.apache.flume.sink.hdfs.BucketWriter.open(BucketWriter.java:261)] Creating hdfs://master:8020/aboutyunlog/FlumeData.1401681667750.tmp
2014-06-02 12:01:07,871 (hdfs-sink1-call-runner-2) [DEBUG - org.apache.flume.sink.hdfs.AbstractHDFSWriter.reflectGetNumCurrentReplicas(AbstractHDFSWriter.java:195)] Using getNumCurrentReplicas--HDFS-826
2014-06-02 12:01:07,871 (hdfs-sink1-call-runner-2) [DEBUG - org.apache.flume.sink.hdfs.AbstractHDFSWriter.reflectGetDefaultReplication(AbstractHDFSWriter.java:223)] Using FileSystem.getDefaultReplication(Path) from HADOOP-8014
2014-06-02 12:01:10,945 (Log-BackgroundWorker-channel1) [INFO - org.apache.flume.channel.file.EventQueueBackingStoreFile.beginCheckpoint(EventQueueBackingStoreFile.java:214)] Start checkpoint for /usr/aboutyun_tmp123/checkpoint, elements to sync = 3
2014-06-02 12:01:10,949 (Log-BackgroundWorker-channel1) [INFO - org.apache.flume.channel.file.EventQueueBackingStoreFile.checkpoint(EventQueueBackingStoreFile.java:239)] Updating checkpoint metadata: logWriteOrderID: 1401681430998, queueSize: 0, queueHead: 11
2014-06-02 12:01:10,952 (Log-BackgroundWorker-channel1) [INFO - org.apache.flume.channel.file.Log.writeCheckpoint(Log.java:1005)] Updated checkpoint for file: /usr/aboutyun_tmp/log-8 position: 2482 logWriteOrderID: 1401681430998
2014-06-02 12:01:10,953 (Log-BackgroundWorker-channel1) [DEBUG - org.apache.flume.channel.file.Log.removeOldLogs(Log.java:1067)] Files currently in use: [8]
2014-06-02 12:01:11,872 (hdfs-sink1-roll-timer-0) [DEBUG - org.apache.flume.sink.hdfs.BucketWriter$2.call(BucketWriter.java:303)] Rolling file (hdfs://master:8020/aboutyunlog/FlumeData.1401681667750.tmp): Roll scheduled after 4 sec elapsed.
2014-06-02 12:01:11,873 (hdfs-sink1-roll-timer-0) [INFO - org.apache.flume.sink.hdfs.BucketWriter.close(BucketWriter.java:409)] Closing hdfs://master:8020/aboutyunlog/FlumeData.1401681667750.tmp
2014-06-02 12:01:11,873 (hdfs-sink1-call-runner-7) [INFO - org.apache.flume.sink.hdfs.BucketWriter$3.call(BucketWriter.java:339)] Close tries incremented
2014-06-02 12:01:11,895 (hdfs-sink1-call-runner-8) [INFO - org.apache.flume.sink.hdfs.BucketWriter$8.call(BucketWriter.java:669)] Renaming hdfs://master:8020/aboutyunlog/FlumeData.1401681667750.tmp to hdfs://master:8020/aboutyunlog/FlumeData.1401681667750
2014-06-02 12:01:11,897 (hdfs-sink1-roll-timer-0) [INFO - org.apache.flume.sink.hdfs.HDFSEventSink$1.run(HDFSEventSink.java:402)] Writer callback called.
2014-06-02 12:01:12,423 (conf-file-poller-0) [DEBUG - org.apache.flume.node.PollingPropertiesFileConfigurationProvider$FileWatcherRunnable.run(PollingPropertiesFileConfigurationProvider.java:126)] Checking file:conf/example for changes
2014-06-02 12:01:40,953 (Log-BackgroundWorker-channel1) [DEBUG - org.apache.flume.channel.file.FlumeEventQueue.checkpoint(FlumeEventQueue.java:137)] Checkpoint not required</code></pre><br><br></blockquote>
</div>
<br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">上传成功之后，我们去hdfs上，查看上传文件：</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><img id="aimg_4491" src="http://www.aboutyun.com/data/attachment/forum/201406/02/123658zdo1imfufdwrdyad.png" width="600" alt="" style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"> </span><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"></span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">这样我们做到了flume上传到hadoop2.2。</span><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><p><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">完毕</span></p>
<p><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br></span></p>
<p><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">原文来自：http://www.aboutyun.com/blog-61-218.html</span></p>
<p><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br></span></p>
<p><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">备注：</span></p>
<p><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">flume监控shell中，有一段标红的信息，是Flume的报错，虽然报错的前半部分与我遇到的错误相同，但是实质不是一种错误。</span></p>
<p><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">对比：</span></p>
<p><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"></span></p>
<pre><code class="language-html">2014-06-02 12:01:04,070 (pool-6-thread-1)&lt;span style="color:#ff0000;"&gt; [ERROR - org.apache.flume.source.SpoolDirectorySource$SpoolDirectoryRunnable.run(SpoolDirectorySource.java:256)] FATAL: Spool Directory source source1: { spoolDir: /usr/aboutyunlog }: Uncaught exception in SpoolDirectorySource thread. Restart or reconfigure Flume to continue processing.
java.lang.IllegalStateException: File name has been re-used with different files. Spooling assumptions violated for /usr/aboutyunlog/test1.COMPLETED&lt;/span&gt;</code></pre>
<p></p>
<p><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;">和</span></p>
<p><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"></span></p>
<pre><code class="language-html">ERROR ({pool-4-thread-1} SpoolDirectorySource.java[run]:256) [2015-10-30 02:06:36,030] - FATAL: Spool Directory source r1: { spoolDir: /home/hadoop/flumeSpool }: Uncaught exception in SpoolDirectorySource thread. Restart or reconfigure Flume to continue processing.
java.nio.charset.MalformedInputException: Input length = 1
	at java.nio.charset.CoderResult.throwException(CoderResult.java:281)
	at org.apache.flume.serialization.ResettableFileInputStream.readChar(ResettableFileInputStream.java:195)</code></pre>
<p></p>
<p><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br></span></p>
标红的错误原因是：
<p><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><span style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:12px;line-height:18px;">flume监控目录下有重复文件名称了，</span></span></p>
<p><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;"><span style="color:#444444;"><span style="line-height:17.98611068725586px;"><span style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:12px;line-height:18px;">flume的传输可以正常传输，上传几个都没有问题。检查下自己的配置。</span><br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:12px;line-height:18px;"><br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:12px;line-height:18px;"><span style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:12px;line-height:18px;">需要保证flume一直运行。</span><br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:12px;line-height:18px;"><br style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:12px;line-height:18px;"><span style="color:rgb(68,68,68);font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:12px;line-height:18px;">第二次重启的时候，需要清空上传目录。</span><br></span></span><br></span></p>
<p><span style="font-family:Tahoma, 'Microsoft Yahei', Simsun;font-size:14px;line-height:25px;"><br></span></p>
            </div>
                </div>