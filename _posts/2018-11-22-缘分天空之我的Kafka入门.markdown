---
layout:     post
title:      缘分天空之我的Kafka入门
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<div></div>
<span style="font-family:'宋体';font-size:14px;"></span>
<h1 align="center" style="text-align:center;"><span style="font-size:32px;"><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">Kafka</span></span><span style="font-family:'宋体';">入门</span></span></h1>
<span style="font-family:'宋体';font-size:14px;"></span>
<h2><span style="font-size:24px;"><span style="font-family:Cambria;"><span lang="en-us" xml:lang="en-us">1</span></span><span style="font-family:'宋体';">基本概念</span></span></h2>
<span style="font-family:'宋体';font-size:14px;"></span>
<h3><span style="font-size:24px;"><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">1.1</span></span><span style="font-family:'宋体';">什么是</span><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;">Kafka</span></span></span></h3>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Kafka</span><span style="font-family:'宋体';font-size:12pt;">是一个分布式的、可分区的、可复制的消息系统（</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Kafka
 is a distributed, partitioned,replicated commit logservice</span><span style="font-family:'宋体';font-size:12pt;">）。</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Kafka</span><span style="font-family:'宋体';font-size:12pt;">将消息以</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">topic</span><span style="font-family:'宋体';font-size:12pt;">为单位进行归纳。发布消息者为</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">producer,</span><span style="font-family:'宋体';font-size:12pt;">订阅消息者为</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">consumer</span><span style="font-family:'宋体';font-size:12pt;">。</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Kafka
 cluster</span><span style="font-family:'宋体';font-size:12pt;">有多个实例</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">(server)</span><span style="font-family:'宋体';font-size:12pt;">组成，每个实例称为</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">broker</span><span style="font-family:'宋体';font-size:12pt;">。</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span style="font-family:'宋体';font-size:12pt;">无论是</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Kafka cluster</span><span style="font-family:'宋体';font-size:12pt;">，还是</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">producer</span><span style="font-family:'宋体';font-size:12pt;">和</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">consumer</span><span style="font-family:'宋体';font-size:12pt;">，都依赖于</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Zookeeper</span><span style="font-family:'宋体';font-size:12pt;">来保证系统可用性。</span></p>
<p align="center" style="text-align:left;text-indent:24pt;"><span style="font-family:'宋体';font-size:14px;"><img alt="" src="https://img-blog.csdn.net/20160822123926433?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="center" style="text-align:center;text-indent:24pt;">
<span lang="en-us" style="font-family:'宋体';font-size:12pt;" xml:lang="en-us"></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<h3><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;font-size:24px;">1.2 Topics/Partitions/Logs</span></span></h3>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Topic</span><span style="font-family:'宋体';font-size:12pt;">是对一组消息的归纳，</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Kafka</span><span style="font-family:'宋体';font-size:12pt;">将</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">topic</span><span style="font-family:'宋体';font-size:12pt;">进行分区</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">(partition)</span><span style="font-family:'宋体';font-size:12pt;">，每个分区在存储层面表现为日志文件</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">(log)</span><span style="font-family:'宋体';font-size:12pt;">。</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span style="font-family:'宋体';font-size:12pt;">每个分区都由一系列有序的、不可变的消息组成，这些消息被连续的追加到分区中。分区中的每个消息都有一个连续的序列号叫做</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">offset</span><span style="font-family:'宋体';font-size:12pt;">，用来在分区中唯一的标识这个消息。</span></p>
<p align="left" style="text-align:left;text-indent:24pt;"><span style="font-family:'宋体';font-size:14px;"> <img alt="" src="https://img-blog.csdn.net/20160822124438314?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="center" style="text-align:center;text-indent:24pt;">
<span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us"></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span style="font-family:'宋体';font-size:12pt;">举个例子，一个叫做</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">“cmb_topic”</span><span style="font-family:'宋体';font-size:12pt;">的</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">topic</span><span style="font-family:'宋体';font-size:12pt;">，有两个分区，那么它的日志有两个文件夹组成：</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">cmb_topic_0</span><span style="font-family:'宋体';font-size:12pt;">和</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">cmb_topic_1</span><span style="font-family:'宋体';font-size:12pt;">，每个文件夹里放着具体的日志文件，日志文件名为</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">offset</span><span style="font-family:'宋体';font-size:12pt;">。</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<h3><span style="font-size:24px;"><span lang="en-us" style="font-family:'Times New Roman', serif;" xml:lang="en-us">1.3</span><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;">Distribution</span></span></span></h3>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span style="font-family:'宋体';font-size:12pt;">一个</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Topic</span><span style="font-family:'宋体';font-size:12pt;">可以配置多个分区，这些分区被分布在</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">kafka</span><span style="font-family:'宋体';font-size:12pt;">集群中的多个实例上。每个实例负责</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">partitions</span><span style="font-family:'宋体';font-size:12pt;">中消息的读写操作，这样为并发操作</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">topic</span><span style="font-family:'宋体';font-size:12pt;">提供了一种可能。</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span style="font-family:'宋体';font-size:12pt;">每个分区都由一个实例作为</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">“leader”</span><span style="font-family:'宋体';font-size:12pt;">，零或若干服务器作为</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">“followers”</span><span style="font-family:'宋体';font-size:12pt;">，</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">leader</span><span style="font-family:'宋体';font-size:12pt;">负责处理消息的读和写，</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">followers</span><span style="font-family:'宋体';font-size:12pt;">则去复制</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">leader</span><span style="font-family:'宋体';font-size:12pt;">。如果</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">leader</span><span style="font-family:'宋体';font-size:12pt;">失效，那么将会有</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">followers</span><span style="font-family:'宋体';font-size:12pt;">来接管</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">(</span><span style="font-family:'宋体';font-size:12pt;">成为新的</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">leader)</span><span style="font-family:'宋体';font-size:12pt;">。</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span style="font-family:'宋体';font-size:12pt;">集群中的每个实例都会同时扮演两个角色：作为它所持有的一部分分区的</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">leader</span><span style="font-family:'宋体';font-size:12pt;">，同时作为其他分区的</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">followers</span><span style="font-family:'宋体';font-size:12pt;">，这样集群就会据有较好的负载均衡。</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<h3><span lang="en-us" style="font-family:'Times New Roman', serif;" xml:lang="en-us"><span style="font-size:24px;">1.4 Producers</span></span></h3>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Producer</span><span style="font-family:'宋体';font-size:12pt;">将消息发布到它指定的</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">topic</span><span style="font-family:'宋体';font-size:12pt;">中，并负责决定发布到哪个分区。通常简单的由负载均衡机制随机选择分区，但也可以通过特定的分区函数选择分区。</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<h3><span lang="en-us" style="font-family:'Times New Roman', serif;" xml:lang="en-us"><span style="font-size:24px;">1.5 Consumers</span></span></h3>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span style="font-family:'宋体';font-size:12pt;">每个</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">consumer</span><span style="font-family:'宋体';font-size:12pt;">属于一个</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">consumer
 group</span><span style="font-family:'宋体';font-size:12pt;">；每个</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">group</span><span style="font-family:'宋体';font-size:12pt;">中可以有多个</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">consumer</span><span style="font-family:'宋体';font-size:12pt;">。</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Producer</span><span style="font-family:'宋体';font-size:12pt;">发送到</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Topic</span><span style="font-family:'宋体';font-size:12pt;">的消息，只会被订阅此</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Topic</span><span style="font-family:'宋体';font-size:12pt;">的<strong>每个</strong></span><strong><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">group</span></strong><span style="font-family:'宋体';font-size:12pt;">中的<strong>一个</strong></span><strong><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">consumer</span></strong><span style="font-family:'宋体';font-size:12pt;">消费。</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us"></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;font-size:14px;"> <img alt="" src="https://img-blog.csdn.net/20160822124517190?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"></span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;font-size:14px;"> </span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;font-size:14px;"> </span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<h2><span style="font-size:24px;"><span style="font-family:Cambria;"><span lang="en-us" xml:lang="en-us">2</span></span><span style="font-family:'宋体';">使用场景</span></span></h2>
<span style="font-family:'宋体';font-size:14px;"></span>
<h3><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;font-size:24px;">2.1 Messaging   </span></span></h3>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Kafka</span><span style="font-family:'宋体';font-size:12pt;">具有良好的扩展性和性能优势。对于一些常规的消息系统，</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Kafka</span><span style="font-family:'宋体';font-size:12pt;">是个不错的选择。</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Kafka</span><span style="font-family:'宋体';font-size:12pt;">在一定程度上，尚未确保消息的发送与接收绝对可靠</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">(</span><span style="font-family:'宋体';font-size:12pt;">比如消息重发、消息发送丢失等</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">)</span><span style="font-family:'宋体';font-size:12pt;">。</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<h3><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;font-size:24px;">2.2 Websit activity tracking</span></span></h3>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Kafka</span><span style="font-family:'宋体';font-size:12pt;">可以作为“网站活性跟踪”的最佳工具，可以将网页</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">/</span><span style="font-family:'宋体';font-size:12pt;">用户操作等信息发送到</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Kafka</span><span style="font-family:'宋体';font-size:12pt;">中，既可实时监控，也可离线统计分析等。</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<h3><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;font-size:24px;">2.3 Log Aggregation</span></span></h3>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Kafka</span><span style="font-family:'宋体';font-size:12pt;">的特性决定它非常适合作为“日志收集中心”。应用可以将操作日志批量、异步的发送到</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Kafka</span><span style="font-family:'宋体';font-size:12pt;">集群中，而不是保存在本地磁盘或者</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">DB</span><span style="font-family:'宋体';font-size:12pt;">中。</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Kafka</span><span style="font-family:'宋体';font-size:12pt;">可以批量提交、压缩消息等。</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Producer</span><span style="font-family:'宋体';font-size:12pt;">端几乎感觉不到性能的开支，</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Consumer</span><span style="font-family:'宋体';font-size:12pt;">端则可以使用</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">hadoop</span><span style="font-family:'宋体';font-size:12pt;">系统、数据仓储等。</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<h2><span style="font-size:24px;"><span style="font-family:Cambria;"><span lang="en-us" xml:lang="en-us">3</span></span><span style="font-family:'宋体';">单机环境搭建（</span><span style="font-family:Cambria;"><span lang="en-us" xml:lang="en-us">Windows</span></span><span style="font-family:'宋体';">）</span></span></h2>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">1</span><span style="font-family:'宋体';font-size:12pt;">、安装</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">jdk</span><span style="font-family:'宋体';font-size:12pt;">，选取的版本是</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">1.7.0_45</span><span style="font-family:'宋体';font-size:12pt;">。</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">2</span><span style="font-family:'宋体';font-size:12pt;">、下载</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Kafka</span><span style="font-family:'宋体';font-size:12pt;">并解压缩到本地，</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">CMD</span><span style="font-family:'宋体';font-size:12pt;">目录</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">%KAFKA_HOME%/bin/windows</span><span style="font-family:'宋体';font-size:12pt;">。我的</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">KAFKA_HOME</span><span style="font-family:'宋体';font-size:12pt;">为</span><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;font-size:14px;">D:\Kafka\kafka_2.11-0.9.0.1</span></span><span style="font-family:'宋体';font-size:12pt;">，为了统一日志存放位置：</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span style="font-family:'宋体';font-size:12pt;">修改文件</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">zookeeper.properties</span><span style="font-family:'宋体';font-size:12pt;">，</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">dataDir=D:/Kafka/tmp/zookeeper</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span style="font-family:'宋体';font-size:12pt;">修改文件</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">server.properties</span><span style="font-family:'宋体';font-size:12pt;">，</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">log.dirs=D:/Kafka/kafka-logs</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span style="font-family:'宋体';font-size:12pt;">修改文件</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">log4j.properties</span><span style="font-family:'宋体';font-size:12pt;">，添加</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">kafka.logs.dir=D:/Kafka/tmp</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">3</span><span style="font-family:'宋体';font-size:12pt;">、启动</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Zookeeper</span><span style="font-family:'宋体';font-size:12pt;">（窗口一）：</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">zookeeper-server-start.bat../../config/zookeeper.properties</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">
  </span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">4</span><span style="font-family:'宋体';font-size:12pt;">、启动</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Kafka</span><span style="font-family:'宋体';font-size:12pt;">（窗口二）：</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">kafka-server-start.bat..\..\config\server.properties</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">5</span><span style="font-family:'宋体';font-size:12pt;">、创建</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">topic</span><span style="font-family:'宋体';font-size:12pt;">（窗口三）</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">kafka-topics.bat --create --zookeeperlocalhost:2181 --replication-factor 1 --partitions
 3 --topic cmb_topic</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">6</span><span style="font-family:'宋体';font-size:12pt;">、查看</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">topic</span><span style="font-family:'宋体';font-size:12pt;">（窗口三）</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">kafka-topics.bat --describe --zookeeperlocalhost:2181 --topic cmb_topic</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">7</span><span style="font-family:'宋体';font-size:12pt;">、发布消息（窗口四）</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">kafka-console-producer.bat --broker-listlocalhost:9092 --topic cmb_topic</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">8</span><span style="font-family:'宋体';font-size:12pt;">、消费消息（窗口五）</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">kafka-console-consumer.bat --zookeeperlocalhost:2181 --from-beginning --topic cmb_topic</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;text-indent:24pt;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">9</span><span style="font-family:'宋体';font-size:12pt;">、发布消息窗口（窗口四）输入，在消费消息窗口（窗口五）查看输出。</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<h2><span style="font-size:24px;"><span style="font-family:Cambria;"><span lang="en-us" xml:lang="en-us">4</span></span><span style="font-family:'宋体';">搭建</span><span style="font-family:Cambria;"><span lang="en-us" xml:lang="en-us">Kafka</span></span><span style="font-family:'宋体';">开发环境（</span><span style="font-family:Cambria;"><span lang="en-us" xml:lang="en-us">RTC</span></span><span style="font-family:'宋体';">）</span></span></h2>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span style="font-size:14px;"><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">1</span></span><span style="font-family:'宋体';">、新建</span><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">Java</span></span><span style="font-family:'宋体';">工程。</span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span style="font-size:14px;"><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">2</span></span><span style="font-family:'宋体';">、配置构建路径，</span><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">JDK</span></span><span style="font-family:'宋体';">选取</span><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">1.7.0_45</span></span><span style="font-family:'宋体';">版本，并导入依赖的</span><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">jar</span></span><span style="font-family:'宋体';">（</span></span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">%KAFKA_HOME%</span><span style="font-size:14px;"><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">\libs</span></span><span style="font-family:'宋体';">下的</span><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">jar</span></span><span style="font-family:'宋体';">）。</span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="center" style="text-align:center;"><span lang="en-us" style="color:#008000;font-size:11.5pt;" xml:lang="en-us"><span style="font-family:Calibri;"></span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;"><span style="font-size:14px;"><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">3</span></span><span style="font-family:'宋体';">、学习官网样例代码。</span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span style="font-size:14px;"><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">4</span></span><span style="font-family:'宋体';">、启动</span><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">Zookeeper</span></span><span style="font-family:'宋体';">。</span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span style="font-size:14px;"><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">5</span></span><span style="font-family:'宋体';">、启动</span><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">Kafka</span></span><span style="font-family:'宋体';">服务。</span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span style="font-size:14px;"><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">6</span></span><span style="font-family:'宋体';">、启动</span><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">Producer</span></span><span style="font-family:'宋体';">和</span><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">Consumer</span></span><span style="font-family:'宋体';">（运行</span><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">KafkaConsumerProducerDemo</span></span><span style="font-family:'宋体';">）。</span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span style="font-size:14px;"><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">7</span></span><span style="font-family:'宋体';">、观察输出</span><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">D:\Kafka\tmp\kafka-logs</span></span><span style="font-family:'宋体';">，可见有三个分区</span><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">cmb_topic-0</span></span><span style="font-family:'宋体';">、</span><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">cmb_topic-1</span></span><span style="font-family:'宋体';">、</span><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">cmb_topic-2</span></span><span style="font-family:'宋体';">。由于没有采用备份，故仅分区</span><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">cmb_topic-0</span></span><span style="font-family:'宋体';">下存储了发送的消息。</span></span></p>
<p><span style="font-family:'宋体';font-size:14px;"><img alt="" src="https://img-blog.csdn.net/20160822124637596?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center"></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span lang="en-us" style="color:#008000;font-size:11.5pt;" xml:lang="en-us"><span style="font-family:Calibri;"></span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<h2><span style="font-size:24px;"><span style="font-family:Cambria;"><span lang="en-us" xml:lang="en-us">5</span></span><span style="font-family:'宋体';">遇到的问题</span></span></h2>
<span style="font-family:'宋体';font-size:14px;"></span>
<p align="left" style="text-align:left;"><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">1</span><span style="font-family:'宋体';font-size:12pt;">、</span><span style="font-family:'Times New Roman', serif;font-size:12pt;"></span><span style="font-family:'宋体';font-size:12pt;">启动</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Kafka</span><span style="font-family:'宋体';font-size:12pt;">报错“</span><span lang="en-us" style="font-family:'Times New Roman', serif;font-size:12pt;" xml:lang="en-us">Error
 occurred during initialization of VM</span><span style="font-family:'宋体';font-size:12pt;">”</span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span style="font-family:'宋体';"><span style="font-size:14px;">详细包错信息如下：</span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;font-size:14px;">D:\Kafka\kafka_2.11-0.9.0.1\bin\windows&gt;kafka-server-start.bat..\..\config\server.pro</span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;font-size:14px;">perties</span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;font-size:14px;">Error occurred during initialization of VM</span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;font-size:14px;">Could not reserve enough space for1048576KB object heap</span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span style="font-family:'宋体';"><span style="font-size:14px;">解决方案：</span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span style="font-size:14px;"><span style="font-family:'宋体';">修改文件</span><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">kafka-server-start.bat</span></span><span style="font-family:'宋体';">，</span><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;">set
 KAFKA_HEAP_OPTS=-Xmx512M -Xms512M</span></span><span style="font-family:'宋体';">（默认均为</span><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;">1G</span></span><span style="font-family:'宋体';">）</span><span style="font-family:'宋体';">即可。</span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<h2><span style="font-size:24px;"><span style="font-family:Cambria;"><span lang="en-us" xml:lang="en-us">6</span></span><span style="font-family:'宋体';">参考资料</span></span></h2>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span style="font-size:14px;"><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">1</span></span><span style="font-family:'宋体';">、</span><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">Kafka</span></span><span style="font-family:'宋体';">入门经典教程（均为对官网的翻译，建议大概看下然后看官网原版）</span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;font-size:14px;">http://www.aboutyun.com/thread-12882-1-1.html</span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;font-size:14px;">http://www.aboutyun.com/thread-9341-1-1.html</span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;font-size:14px;"> </span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span style="font-size:14px;"><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">2 windows</span></span><span style="font-family:'宋体';">环境搭建（单机环境）</span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;font-size:14px;">http://blog.csdn.net/laputa73/article/details/48826167</span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;font-size:14px;"> </span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span style="font-size:14px;"><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">3</span></span><span style="font-family:'宋体';">、</span><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">kafka</span></span><span style="font-family:'宋体';">系列文章索引</span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span lang="en-us" xml:lang="en-us"><a href="http://my.oschina.net/ielts0909/blog/117489" rel="nofollow"><span style="text-decoration:none;"><span style="font-family:Calibri;font-size:14px;">http://my.oschina.net/ielts0909/blog/117489</span></span></a></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span lang="en-us" xml:lang="en-us"><span style="font-family:Calibri;font-size:14px;"> </span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span style="font-size:14px;"><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">4</span></span><span style="font-family:'宋体';">、</span><span style="font-family:Calibri;"><span lang="en-us" xml:lang="en-us">Kafka</span></span><span style="font-family:'宋体';">详解（推荐）</span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
<p><span lang="en-us" xml:lang="en-us"><a href="http://rockybean.github.com/" rel="nofollow"><span style="text-decoration:none;"><span style="font-family:Calibri;font-size:14px;">http://rockybean.github.com/</span></span></a><span style="font-family:Calibri;font-size:14px;"> </span></span></p>
<span style="font-family:'宋体';font-size:14px;"></span>
            </div>
                </div>