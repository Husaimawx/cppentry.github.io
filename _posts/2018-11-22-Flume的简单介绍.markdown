---
layout:     post
title:      Flume的简单介绍
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <p><span style="font-weight:bold;">Flume</span><span style="font-family:'宋体';"><strong>概述：</strong></span></p><p>Apache Flume<span style="font-family:'宋体';">是一个分布式的、可靠的、可用的系统，用于有效地收集、</span></p><p>聚合和将大量日志数据从许多不同的源移动到一个集中的数据存储。</p><p> </p><p>Apache Flume<span style="font-family:'宋体';">的使用不仅仅局限于日志数据聚合。由于数据源是可定制的，</span></p><p>Flume<span style="font-family:'宋体';">可以用于传输大量事件数据，包括但不限于网络流量数据、</span></p><p>社交媒体生成的数据、电子邮件消息和几乎所有可能的数据源。</p><p>=================================================================</p><p><strong>flume<span style="font-family:'宋体';">的优点</span></strong>：</p><p>1.<span style="font-family:'宋体';">可以和任意集中式存储进行集成（</span><span style="font-family:Calibri;">HDFS</span><span style="font-family:'宋体';">，</span><span style="font-family:Calibri;">HBASE</span><span style="font-family:'宋体';">）</span></p><p>2.<span style="font-family:'宋体';">输入的数据速率大于写入存储目的地速率，</span><span style="font-family:Calibri;">flume</span><span style="font-family:'宋体';">会进行缓冲</span></p><p>3.flume<span style="font-family:'宋体';">提供上下文路由（数据流路线）</span></p><p>4.flume<span style="font-family:'宋体';">中的事物基于</span><span style="font-family:Calibri;">channel</span><span style="font-family:'宋体';">，使用了两个事物模型（</span><span style="font-family:Calibri;">sender+receiver</span><span style="font-family:'宋体';">）</span></p><p>确保消息被可靠发送</p><p>5.flume<span style="font-family:'宋体';">是 可靠的，容错的，可扩展的，。</span></p><p><strong>flume<span style="font-family:'宋体';">特点</span></strong></p><p>----------------------------------------</p><p>1.flume<span style="font-family:'宋体';">高效收集</span><span style="font-family:Calibri;">web server</span><span style="font-family:'宋体';">的</span><span style="font-family:Calibri;">log</span><span style="font-family:'宋体';">到</span><span style="font-family:Calibri;">HDFS HBASE</span><span style="font-family:'宋体';">）</span></p><p>2.<span style="font-family:'宋体';">高校获取数据到</span><span style="font-family:Calibri;">hadoop</span></p><p>3.<span style="font-family:'宋体';">导入大量数据</span></p><p>4.flume<span style="font-family:'宋体';">支持大量的</span><span style="font-family:Calibri;">source</span><span style="font-family:'宋体';">和</span><span style="font-family:Calibri;">destination</span><span style="font-family:'宋体';">类型</span></p><p>5.flume<span style="font-family:'宋体';">支持多级跳跃，</span><span style="font-family:Calibri;">source</span><span style="font-family:'宋体';">和</span><span style="font-family:Calibri;">destination</span><span style="font-family:'宋体';">的扇入和扇出</span></p><p>6.flume<span style="font-family:'宋体';">可以水平伸缩</span></p><p> </p><p><strong><span style="font-family:'宋体';">为什么用</span>flume<span style="font-family:'宋体';">而不用</span><span style="font-family:Calibri;">hdfs</span><span style="font-family:'宋体';">的</span><span style="font-family:Calibri;">put</span></strong></p><p>------------------------------------------</p><p>1.<span style="font-family:'宋体';">同一时刻只能传输一个文件</span></p><p>2.put<span style="font-family:'宋体';">处理的是静态文件</span></p><p> </p><p><strong><span style="font-family:'宋体';">架构</span>-<span style="font-family:'宋体';">组件</span><span style="font-family:Calibri;">-</span><span style="font-family:'宋体';">配置说明</span></strong></p><p> </p><p> <img src="https://img-blog.csdn.net/20180709105204201?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDI4OTU4/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p><strong>Flume<span style="font-family:'宋体';">架构：</span></strong></p><p> </p><p>1. <strong>描述</strong></p><p><span style="font-family:'宋体';">在数据生成器运行的节点上启动单独的</span>flume agent<span style="font-family:'宋体';">。来收集数据</span></p><p><span style="font-family:'宋体';">数据收集器收集数据，推送到</span>HDFS,HBASE</p><p>2. <strong>Flume Event</strong></p><p><span style="font-family:'宋体';">事件是</span>flume<span style="font-family:'宋体';">的传输单元，主要是</span><span style="font-family:Calibri;">byte[]</span><span style="font-family:'宋体';">，可以含有一些</span><span style="font-family:Calibri;">header</span><span style="font-family:'宋体';">信息</span></p><p><span style="font-family:'宋体';">在</span>source<span style="font-family:'宋体';">和</span><span style="font-family:Calibri;">destination</span><span style="font-family:'宋体';">之间</span></p><p> </p><p> <img src="https://img-blog.csdn.net/20180709105153373?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDI4OTU4/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p> </p><p> </p><p>3. <strong>Flume agent</strong></p><p><span style="font-family:'宋体';">每个</span>agent<span style="font-family:'宋体';">是一个独立的</span><span style="font-family:Calibri;">Java</span><span style="font-family:'宋体';">进程，从客户端（其他</span><span style="font-family:Calibri;">agent</span><span style="font-family:'宋体';">）接收数据</span></p><p><span style="font-family:'宋体';">然后转发到下一个</span>destination<span style="font-family:'宋体';">（</span><span style="font-family:Calibri;">sink(</span><span style="font-family:'宋体';">沉槽</span><span style="font-family:Calibri;">) | agent</span><span style="font-family:'宋体';">）</span></p><p>Agent<span style="font-family:'宋体';">包含三个组件</span><span style="font-family:Calibri;">:</span></p><p>A. Source<span style="font-family:'宋体';">（源）</span><span style="font-family:Calibri;">-&gt;</span><span style="font-family:'宋体';">生成数据的地方</span></p><p><span style="font-family:'宋体';">从事件生成器接收数据，以</span>event<span style="font-family:'宋体';">事件的形式传给一个或多个</span><span style="font-family:Calibri;">channel</span></p><p>B. Channel<span style="font-family:'宋体';">（通道）</span></p><p><span style="font-family:'宋体';">从</span>source<span style="font-family:'宋体';">中接受</span><span style="font-family:Calibri;">flume event</span><span style="font-family:'宋体';">，作为临时存放地，缓存到</span><span style="font-family:Calibri;">buffer</span><span style="font-family:'宋体';">中，直到</span><span style="font-family:Calibri;">sink</span></p><p><span style="font-family:'宋体';">将其消费掉，是</span>source<span style="font-family:'宋体';">和</span><span style="font-family:Calibri;">sink</span><span style="font-family:'宋体';">之间的桥梁</span></p><p>Channel<span style="font-family:'宋体';">是事务的，可以和多个</span><span style="font-family:Calibri;">source</span><span style="font-family:'宋体';">或</span><span style="font-family:Calibri;">sink</span><span style="font-family:'宋体';">协同</span></p><p>C.sink<span style="font-family:'宋体';">（沉槽）</span></p><p><span style="font-family:'宋体';">存放数据到</span>HDFS<span style="font-family:'宋体';">，从</span><span style="font-family:Calibri;">channel</span><span style="font-family:'宋体';">中消费</span><span style="font-family:Calibri;">event</span><span style="font-family:'宋体';">，并分发给</span><span style="font-family:Calibri;">destination</span><span style="font-family:'宋体';">，</span><span style="font-family:Calibri;">sink</span><span style="font-family:'宋体';">的</span></p><p>Destination <span style="font-family:'宋体';">也可以是另一个</span><span style="font-family:Calibri;">agent</span><span style="font-family:'宋体';">或者</span><span style="font-family:Calibri;">HDFS</span><span style="font-family:'宋体';">，</span><span style="font-family:Calibri;">HBASE</span></p><p> </p><p><span style="font-family:'宋体';">注意：一个</span>flume<span style="font-family:'宋体';">的</span><span style="font-family:Calibri;">agent</span><span style="font-family:'宋体';">，可以有多个</span><span style="font-family:Calibri;">source</span><span style="font-family:'宋体';">，</span><span style="font-family:Calibri;">channel</span><span style="font-family:'宋体';">，</span><span style="font-family:Calibri;">sink</span></p><p> </p><p> </p><p> <img src="https://img-blog.csdn.net/20180709105132796?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDI4OTU4/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p> </p><p> </p><p> </p><p> </p><p>                           </p><p> </p><p><strong>Flume<span style="font-family:'宋体';">的附加组件</span></strong></p><p> </p><p>1. 拦截器</p><p>2. 通道选择器</p><p>3. Sink<span style="font-family:'宋体';">处理器</span></p><p align="justify"><strong><span style="font-family:'宋体';">安装</span>flumn-1.6.0</strong></p><p align="justify">------------------------</p><p align="justify">1.<span style="font-family:'宋体';">下载</span><span style="font-family:Calibri;">flume-</span></p><p align="justify">2.tar			ln -s apahe-flume-1.6.-bin flume</p><p align="justify">3.<span style="font-family:'宋体';">配置环境变量</span></p><p align="justify">export FLUMN_HOME=/usr/local/soft/flume-1.6.0</p><p align="justify">export PATH=$PATH:$FLUMN_HOME/bin</p><p align="justify">4.<span style="font-family:'宋体';">验证安装</span></p><p align="justify">[hadoop@master conf]$ flume-ng 			version</p><p align="justify">5.<span style="font-family:'宋体';">配置</span><span style="font-family:Calibri;">flume</span></p><p align="justify">flume-env.sh</p><p align="justify">export JAVA_HOME=/usr/local/soft/jdk1.8.0</p><p align="justify"> </p><p align="justify"> </p><p align="justify"><span style="font-family:'宋体';">配置</span>Flume</p><p align="justify">1.<span style="font-family:'宋体';">命名</span><span style="font-family:Calibri;">agent</span><span style="font-family:'宋体';">组件</span></p><p align="justify">2.<span style="font-family:'宋体';">描述配置</span><span style="font-family:Calibri;">source</span></p><p align="justify">3.<span style="font-family:'宋体';">描述配置</span><span style="font-family:Calibri;">channel</span></p><p align="justify">4.<span style="font-family:'宋体';">描述配置</span><span style="font-family:Calibri;">sink</span></p><p align="justify">5.<span style="font-family:'宋体';">绑定</span><span style="font-family:Calibri;">source</span><span style="font-family:'宋体';">，</span><span style="font-family:Calibri;">sink,</span><span style="font-family:'宋体';">到</span><span style="font-family:Calibri;">channel</span></p><p align="justify"> <img src="https://img-blog.csdn.net/20180709105058351?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDI4OTU4/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p align="justify">agent_name)</p><p align="justify">a1.sources=r1,r2</p><p align="justify">a1.sinks=s1,s2</p><p align="justify">a1.channels=c1,c2</p><p align="justify"> </p><p align="justify">#sources-r1</p><p align="justify">a1.sources.r1.type=</p><p align="justify">a1.sources.r1.xxx=</p><p align="justify">a1.sources.r1.yyy=</p><p align="justify"> </p><p align="justify">#sink-s1</p><p align="justify">a1.source.r1.type=</p><p align="justify">a1.sources.r1.xxx=</p><p align="justify"> </p><p align="justify">#channels-c1</p><p align="justify">a1.channels.c1.type=</p><p align="justify">a1.channels.c1.xxx=</p><p align="justify"> </p><p align="justify">#binding(<span style="font-family:'宋体';">绑定</span><span style="font-family:Calibri;">)</span><span style="font-family:'宋体';">一个</span><span style="font-family:Calibri;">source</span><span style="font-family:'宋体';">可以配置多个</span><span style="font-family:Calibri;">channel</span></p><p align="justify">a1.sources.r1.channels=c1	(<span style="font-family:'宋体';">可以配多个通道</span><span style="font-family:Calibri;">)</span></p><p align="justify">a1.sinks.s1.channel=c1		(sink<span style="font-family:'宋体';">只能配置一个</span><span style="font-family:Calibri;">channel)</span></p><p align="justify"> <img src="https://img-blog.csdn.net/20180709105041664?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDI4OTU4/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p align="justify"> </p><p align="justify"><strong>Flume<span style="font-family:'宋体';">核心类考察</span></strong></p><p align="justify"> </p><p align="justify">Simple<span style="font-family:'宋体';">案例</span></p><p align="justify"><strong>flume-conf.properties</strong>：</p><p align="justify"> </p><p align="justify"># Name the components on this agent</p><p align="justify">a1.sources = r1</p><p align="justify">a1.sinks = k1</p><p align="justify">a1.channels = c1</p><p align="justify"> </p><p align="justify"># Describe/configure the source</p><p align="justify">a1.sources.r1.type = netcat</p><p align="justify">a1.sources.r1.bind =localhost		 //0.0.0.0 <span style="font-family:'宋体';">（统配到本机的所有</span><span style="font-family:Calibri;">ip</span><span style="font-family:'宋体';">上面去）</span></p><p align="justify">a1.sources.r1.port = 44444</p><p align="justify"> </p><p align="justify"># Describe the sink</p><p align="justify">a1.sinks.k1.type = logger  --&gt;<span style="font-family:'宋体';">通过控制台或者文件可以控制输出</span></p><p align="justify"> </p><p align="justify"># Use a channel which buffers events in memory</p><p align="justify">a1.channels.c1.type = memory</p><p align="justify">a1.channels.c1.capacity = 1000</p><p align="justify">a1.channels.c1.transactionCapacity = 100</p><p align="justify"> </p><p align="justify"># Bind the source and sink to the channel</p><p align="justify">a1.sources.r1.channels = c1</p><p align="justify">a1.sinks.k1.channel = c1</p><p align="justify"> </p><p align="justify"> </p><p align="justify"> </p><p align="justify"> </p><p align="justify"> </p><p align="justify"> </p><p align="justify"><strong><span style="font-family:'宋体';">运行</span>flume agent</strong></p><p align="justify">#--conf		:<span style="font-family:'宋体';">配置目录</span></p><p align="justify">#--conf-file		:<span style="font-family:'宋体';">配置文件</span></p><p align="justify">#--name  :<span style="font-family:'宋体';">代理名称</span></p><p align="justify">#-D    <span style="font-family:'宋体';">：指定额外的参数</span></p><p align="justify">$&gt;cd flume/conf</p><p align="justify">$&gt;flume-ng agent --conf .--conf-file flume-conf.properties --name a1 -Dflume.root.logger=INFO,console</p><p align="justify">				  </p><p align="justify">flume-ng agent --conf . --conf-file flume-conf.properties --name a1 -Dflume.root.logger=INFO,console<span style="font-family:'宋体';">（控制台）</span></p><p align="justify"> </p><p align="justify">打开另一个终端：</p><p align="justify">[hadoop@master ~]$ nc localhost 44444</p><p align="justify">helloworld</p><p align="justify">OK</p><p align="justify"> </p><p align="justify"> </p><p align="justify"><strong>核心类考察</strong></p><p align="justify">1. Source</p><p align="justify"><span style="font-family:'宋体';">生成</span>Event<span style="font-family:'宋体';">，调用</span><span style="font-family:Calibri;">ChannelProcessor</span><span style="font-family:'宋体';">的方法，将</span><span style="font-family:Calibri;">Event put</span><span style="font-family:'宋体';">到</span><span style="font-family:Calibri;">Channel</span><span style="font-family:'宋体';">中去</span></p><p align="justify"> <img src="https://img-blog.csdn.net/20180709104935312?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDI4OTU4/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p align="justify"> <img src="https://img-blog.csdn.net/20180709104945572?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDI4OTU4/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p><p align="justify"> </p><p align="justify"><br></p><p align="justify">2.Sink</p><p align="justify"><span style="font-family:'宋体';">连接到</span>Channel<span style="font-family:'宋体';">，消费里面的</span><span style="font-family:Calibri;">Event</span><span style="font-family:'宋体';">，将其发送到</span><span style="font-family:Calibri;">destination</span><span style="font-family:'宋体';">，有很多相应的</span><span style="font-family:Calibri;">sink</span><span style="font-family:'宋体';">类型你</span></p><p align="justify">Sink<span style="font-family:'宋体';">可以根据</span><span style="font-family:Calibri;">Sinkgroup</span><span style="font-family:'宋体';">和</span><span style="font-family:Calibri;">Sinkprocessor</span><span style="font-family:'宋体';">进行分组</span></p><p align="justify">Sink<span style="font-family:'宋体';">的</span><span style="font-family:Calibri;">process()</span><span style="font-family:'宋体';">方法只能有一个线程访问</span></p><p align="justify">SetChannel()	getCannel()	process()</p><p align="justify"> </p><p align="justify">3.Channel</p><p align="justify"><span style="font-family:'宋体';">连接</span>Source<span style="font-family:'宋体';">（</span><span style="font-family:Calibri;">Event Procuder</span><span style="font-family:'宋体';">）和</span><span style="font-family:Calibri;">Sink(Event Consumer),</span><span style="font-family:'宋体';">本质上</span><span style="font-family:Calibri;">Channel</span><span style="font-family:'宋体';">就是</span><span style="font-family:Calibri;">Buffer</span></p><p align="justify"><span style="font-family:'宋体';">支持事务处理，保证原子性（</span>Put+take<span style="font-family:'宋体';">）</span></p><p align="justify">Channel<span style="font-family:'宋体';">是线程安全的</span></p><p align="justify">Put()		take()	getTransaction()</p><br>            </div>
                </div>