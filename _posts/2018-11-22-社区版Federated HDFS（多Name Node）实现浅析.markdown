---
layout:     post
title:      社区版Federated HDFS（多Name Node）实现浅析
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <p><span style="font-family:'宋体';font-size:10.5pt;">    </span><span style="font-family:'宋体';font-size:10.5pt;">目前，</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">HDFS</span><span style="font-family:'宋体';font-size:10.5pt;">集群的架构包括了单个</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Name Node</span><span style="font-family:'宋体';font-size:10.5pt;">和若干个</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Data Node</span><span style="font-family:'宋体';font-size:10.5pt;">。</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Name Node</span><span style="font-family:'宋体';font-size:10.5pt;">负责两方面的事情：一方面是存储和管理整个命名空间，包括创建、修改、删除和列举文件目录等文件系统级别的操作；另一方面是管理</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Data Node</span><span style="font-family:'宋体';font-size:10.5pt;">和文件块。</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Data Node</span><span style="font-family:'宋体';font-size:10.5pt;">主要负责文件块的持久化存储和远程访问。</span></p>
<p style="text-align:center;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><img src="http://hi.csdn.net/attachment/201105/28/0_1306573408rt2z.gif" alt=""></span></span></p>
<p> </p>
<p><span style="font-family:'宋体';font-size:10.5pt;">    <span style="font-family:'宋体';font-size:10.5pt;">在现有模式下，存储负载的增加对</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Data Node</span><span style="font-family:'宋体';font-size:10.5pt;">和</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Name Node</span><span style="font-family:'宋体';font-size:10.5pt;">都会造成影响。对于</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Data Node</span><span style="font-family:'宋体';font-size:10.5pt;">而言，可以通过添加节点实现水平扩展；而对于单个的</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Name Node</span><span style="font-family:'宋体';font-size:10.5pt;">而言，只能通过增加内存和硬盘的方式实现垂直扩展。正是单个</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Name Node</span><span style="font-family:'宋体';font-size:10.5pt;">的垂直扩展方式成为了</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">HDFS</span><span style="font-family:'宋体';font-size:10.5pt;">集群的瓶颈。</span></span></p>
<p><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;">    <span style="font-family:'宋体';font-size:10.5pt;">根据</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Yahoo HDFS</span><span style="font-family:'宋体';font-size:10.5pt;">团队的报告，一个存储能力为</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">10.4PB</span><span style="font-family:'宋体';font-size:10.5pt;">，拥有</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">3700</span><span style="font-family:'宋体';font-size:10.5pt;">个</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Data Node</span><span style="font-family:'宋体';font-size:10.5pt;">的</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">HDFS</span><span style="font-family:'宋体';font-size:10.5pt;">集群，分配给</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Name Node</span><span style="font-family:'宋体';font-size:10.5pt;">的</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">JAVA</span><span style="font-family:'宋体';font-size:10.5pt;">堆已达到</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">40GB</span><span style="font-family:'宋体';font-size:10.5pt;">，随着存储负载的继续增加，很快就会达到单机可配置物理内存的极限（在一些机器上是</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">64GB</span><span style="font-family:'宋体';font-size:10.5pt;">）。使用如此大的</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">JAVA</span><span style="font-family:'宋体';font-size:10.5pt;">堆会造成多方面的性能问题，比如：垃圾回收会变得低效，更长的初始化时间，甚至调试</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">JVM</span><span style="font-family:'宋体';font-size:10.5pt;">也会变得困难。</span></span></span></p>
<p><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;">    <span style="font-family:'宋体';font-size:10.5pt;">为了解决</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">HDFS</span><span style="font-family:'宋体';font-size:10.5pt;">单个</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Name Node</span><span style="font-family:'宋体';font-size:10.5pt;">的垂直扩展问题，</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Yahoo HDFS</span><span style="font-family:'宋体';font-size:10.5pt;">团队提出了采用多</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Name Node</span><span style="font-family:'宋体';font-size:10.5pt;">提高</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">HDFS</span><span style="font-family:'宋体';font-size:10.5pt;">集群的扩展性，即实现</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Name Node</span><span style="font-family:'宋体';font-size:10.5pt;">的水平扩展。大致思路是，在一个</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">HDFS</span><span style="font-family:'宋体';font-size:10.5pt;">集群里面可以拥有多个</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Name Node</span><span style="font-family:'宋体';font-size:10.5pt;">，每个</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Name Node</span><span style="font-family:'宋体';font-size:10.5pt;">负责管理一个命名空间（</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Namespace</span><span style="font-family:'宋体';font-size:10.5pt;">），而且命名空间之间是相互独立的，这些命名空间共享该</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">HDFS</span><span style="font-family:'宋体';font-size:10.5pt;">集群里</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Data Node</span><span style="font-family:'宋体';font-size:10.5pt;">的存储空间，其共享方式并不是以</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Data Node</span><span style="font-family:'宋体';font-size:10.5pt;">粒度来划分，而是引入了</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Block Pool</span><span style="font-family:'宋体';font-size:10.5pt;">的概念。所谓</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Block Pool</span><span style="font-family:'宋体';font-size:10.5pt;">是一组文件块的集合，这些文件块分散在</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">HDFS</span><span style="font-family:'宋体';font-size:10.5pt;">集群的</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Data Node</span><span style="font-family:'宋体';font-size:10.5pt;">上，每个文件块唯一属于一个</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Block Pool</span><span style="font-family:'宋体';font-size:10.5pt;">，每个</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Block Pool</span><span style="font-family:'宋体';font-size:10.5pt;">唯一属于一个命名空间。根据</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Yahoo HDFS</span><span style="font-family:'宋体';font-size:10.5pt;">团队的设计，一个命名空间可以拥有一个或者多个</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Block Pool</span><span style="font-family:'宋体';font-size:10.5pt;">，不过在最新的实现中一个命名空间只拥有一个</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Block Pool</span><span style="font-family:'宋体';font-size:10.5pt;">。另外，一个命名空间和它所拥有的</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Block Pool</span><span style="font-family:'宋体';font-size:10.5pt;">称为一个</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Namespace Volume</span><span style="font-family:'宋体';font-size:10.5pt;">，它是一个自包含的管理单位。下图是改进后的</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">HDFS</span><span style="font-family:'宋体';font-size:10.5pt;">模型：</span></span></span></span></p>
<p style="text-align:center;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><img src="http://hi.csdn.net/attachment/201105/28/0_1306573450BfsF.gif" alt=""></span></span></span></span></p>
<p><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;">    <span style="font-family:'宋体';font-size:10.5pt;">从功能层次来看，</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">HDFS</span><span style="font-family:'宋体';font-size:10.5pt;">从上到下包括命名空间管理，文件块管理（包括对</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Data Node</span><span style="font-family:'宋体';font-size:10.5pt;">的管理）和文件块存储及访问，在上图中，后两项统称为</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Block Storage</span><span style="font-family:'宋体';font-size:10.5pt;">。如前所述，目前</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">HDFS</span><span style="font-family:'宋体';font-size:10.5pt;">的命名空间管理和文件块管理都实现在</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Name Node</span><span style="font-family:'宋体';font-size:10.5pt;">上，在</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">API</span><span style="font-family:'宋体';font-size:10.5pt;">级别这两种功能都没有明确的区分开。不过，</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Block Pool</span><span style="font-family:'宋体';font-size:10.5pt;">的引入使得对文件块的抽象管理变得清晰。因此，实现新的模型也有两种方式，一种是沿用现在的方式，</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Block Pool</span><span style="font-family:'宋体';font-size:10.5pt;">放入</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Name Node</span><span style="font-family:'宋体';font-size:10.5pt;">中实现；另外一种是将文件块管理从</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Name Node</span><span style="font-family:'宋体';font-size:10.5pt;">中分离出来，单独创建一个服务来管理</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Block Pool</span><span style="font-family:'宋体';font-size:10.5pt;">。相对而言，第一种更简单，第二种更加灵活，比如能够支持非</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">HDFS</span><span style="font-family:'宋体';font-size:10.5pt;">命名空间对文件块的直接访问。在最新的社区版本实现中，</span><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">Yahoo HDFS</span><span style="font-family:'宋体';font-size:10.5pt;">团队采用的是第一种方式，如下图，但是从长远来看，还是会采用第二种方式。</span></span></span></span></span></p>
<p style="text-align:center;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><img src="http://hi.csdn.net/attachment/201105/28/0_1306573489aaR2.gif" alt=""></span></span></span></span></span></span></p>
<p style="text-align:center;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"></span></span></span></span></span></p>
<p style="text-align:left;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:Calibri, 'sans-serif';font-size:10.5pt;" lang="en-us" xml:lang="en-us">       最后，Federated HDFS补丁在apache上的链接是：<a href="https://issues.apache.org/jira/browse/HDFS-1052" rel="nofollow">https://issues.apache.org/jira/browse/HDFS-1052</a>，有兴趣的同学可以多去研究研究。</span></span></span></span></span></span></span></p>
<p><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"><span style="font-family:'宋体';font-size:10.5pt;"></span></span></span></span></p>            </div>
                </div>