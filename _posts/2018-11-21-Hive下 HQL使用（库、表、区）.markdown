---
layout:     post
title:      Hive下 HQL使用（库、表、区）
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								<div class="article-copyright">
					版权声明：本文为博主原创文章，未经博主允许不得转载。					https://blog.csdn.net/qq_32297447/article/details/79848306				</div>
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <div style="text-align:left;line-height:1.75;font-size:14px;"><div style="text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>准备：</strong></span></div><p><span style="line-height:28px;text-align:left;text-indent:28px;">Mysql&amp;Hive:</span><a href="https://blog.csdn.net/qq_32297447/article/details/79734894" rel="nofollow" style="font-weight:bold;line-height:1.75;text-align:left;"><span style="text-indent:28px;">Mysql&amp;Hive:</span>基于Hive的伪分布式Hadoop集群环境的配置的博客</a></p></div><div style="text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>hive使用(HQL)</strong></span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;color:rgb(57,57,57);"><strong>不用进入hive的客户端，可以使用如下命令来查看</strong></span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;color:rgb(57,57,57);">$ hive -e 'show databases'</span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>数据库操作</strong></span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;color:rgb(67,67,67);background-color:rgb(255,255,255);">创建数据库：create database db;</span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;color:rgb(67,67,67);background-color:rgb(255,255,255);">如果数据库不存在就创建：</span><span style="font-size:16px;">create database if not exists db;</span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">在指定的路径下创建数据库：create database db location '/my/directory';</span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">创建数据库，并为数据库添加描述信息：</span></div><div style="margin-left:56px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">create database db comment 'it is my database'</span></div><div style="margin-left:56px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">with dbproperties('creator'='zhangsan','date'='2018-01-10');</span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">查看数据库：show databases;  </span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;color:rgb(57,57,57);">查看创建数据库sql语句：</span><span style="font-size:16px;">show create database school;</span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">查询以hive开头的数据库：show databases like 'hive*';  </span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">查看数据库hive结构：desc database hive;  </span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">查看数据库hive的详细描述信息：desc database extended hive;  </span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">切换数据库：use default;   </span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;color:rgb(67,67,67);background-color:rgb(255,255,255);">删除数据库：drop database if exists school cascade;</span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>表操作</strong></span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;color:rgb(67,67,67);background-color:rgb(255,255,255);">创建表：</span><span style="font-size:16px;">create table student(表字段) row format delimited fields terminated by ',';</span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">重命名表：alter table 原表名 rename to 新表名;</span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">删除表：drop table if exists 表名;</span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">查看当前数据库的所有表：show tables;  </span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">查看当前数据库中以emp开头的表：show tables 'emp*';  </span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">查看表emp的结构：desc emp;  </span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">查看表emp的详细描述信息：desc extended emp;  </span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">查看表emp的详细描述信息（详细信息以特定的格式展现）：desc formatted emp;  </span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">导入数据：load data local inpath '导入数据的文件路径' into table 表名;</span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>内部表和外部表的区别</strong></span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">内部表：managed_table</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">在删除时，HDFS数据被删除，MySQL元数据也被删除</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">外部表：external</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">在删除时，HDFS数据不被删除，MySQL元数据被删除</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>将emp中的数据导出到本地系统的指定目录下</strong></span></div><div style="margin-left:56px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">insert overwrite local directory '/home/hadoop/dataFile/tmp.txt'</span></div><div style="margin-left:56px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">row format delimited fields terminated by '\t' select * from emp;</span></div><div style="margin-left:56px;text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>用hdfs命令将数据库表emp中的数据导出到本地文件系统的当前目录下</strong></span></div><div style="text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">hadoop fs -get /user/hive/warehouse/emp</span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">================================================================</span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>Hive分区表</strong></span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>静态分区：单级分区、多级分区</strong></span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"> </span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>创建单级分区表</strong></span><span style="font-size:16px;">T_USER：</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">要求按性别分区</span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">按年龄分桶到3个桶中进行排序</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">create table T_USER(</span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">name string,</span></div><div style="text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">age int</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">)</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">partitioned by(sex string)</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">clustered by (age) sorted by (age asc) into 3 buckets; </span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">增加数据</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:18px;">insert into table </span><span style="font-size:16px;">T_USER </span><span style="font-size:18px;">partition(sex='man') values</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:18px;">('张三',18), </span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:18px;">('李四',17),</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:18px;">('王五',16),</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:18px;">('赵六',15);</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>加载本地数据到到分区表</strong></span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">load data local inpath '/home/hadoop/text.txt' overwrite into table T_USER partition(event_month='2014-05');</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>在hdfs上创建分区目录</strong></span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">hadoop fs -mkdir -p /user/hive/warehouse/T_USER/event_month=2014-06</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>将本地数据上传到hdfs上创建好的分区目录</strong></span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">hadoop fs -put order.txt /user/hive/warehouse/T_USER/event_month=2014-06</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"> </span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>刷新表</strong></span><span style="font-size:16px;">T_USER</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">Msck repair table T_USER;</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><br></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>创建多级分区表</strong></span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">order_multi_partition</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">create table order_multi_partition(</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">order_number string,</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">event_time string</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">)</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">PARTITIONED BY(event_month string, step string)</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t';</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"> </span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>加载本地数据到多级分区表中</strong></span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">load data local inpath '/home/hadoop/data/order.txt'</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">overwrite into table order_multi_partition partition(event_month='2014-05',step='1');</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"> </span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">load data local inpath '/home/hadoop/data/order.txt'</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">overwrite into table order_multi_partition partition(event_month='2014-05',step='2');</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"> </span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"> </span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>创建数组表</strong></span><span style="font-size:16px;">hive_array</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">create table hive_array(</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">name string,</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">work_locations array&lt;string&gt;</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">)</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t'</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">COLLECTION ITEMS TERMINATED BY ',';</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"> </span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>加载本地数据到数组表</strong></span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">load data local inpath '/home/hadoop/data/hive_array.txt'</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">overwrite into table hive_array ;</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"> </span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>查询数组的大小</strong></span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">select name,size(work_locations) from hive_array;</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"> </span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>创建map表</strong></span><span style="font-size:16px;">hive_map</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">create table hive_map(</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">name string,</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">scores map&lt;string,int&gt;</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">)</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t'</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">COLLECTION ITEMS TERMINATED BY ','</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">MAP KEYS TERMINATED BY ':';</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"> </span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"><strong>加载本地数据到</strong></span><span style="font-size:16px;">hive_map</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">load data local inpath '/home/hadoop/data/hive_map.txt'</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">overwrite into table hive_map ;</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">查询学生的英语成绩</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">select name,scores[english] from hive_map;</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"> </span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">创建结构体表hive_struct</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">create table hive_struct(</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">ip string,</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">userinfo struct&lt;name:string,age:int&gt;</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">)</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">ROW FORMAT DELIMITED FIELDS TERMINATED BY '#'</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">COLLECTION ITEMS TERMINATED BY ':';</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;"> </span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">加载本地数据到表hive_struct</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">load data local inpath '/home/hadoop/data/hive_struct.txt'</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><span style="font-size:16px;">overwrite into table hive_struct ;</span></div><div style="margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"><br></div>            </div>
                </div>