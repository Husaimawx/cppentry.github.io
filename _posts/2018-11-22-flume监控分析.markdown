---
layout:     post
title:      flume监控分析
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								<div class="article-copyright">
					版权声明：本文为博主原创文章，未经博主允许不得转载。					https://blog.csdn.net/ty_laurel/article/details/53927176				</div>
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<h2 id="wiz_toc_0" style="font-size:20px;font-family:Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;">
flume 监控分析</h2>
<p style="font-size:15px;font-family:Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height:24px;">
由启动flume时可以发现,flume 入口函数位于flume-ng-node目录中的Application.java文件中:</p>
<pre class="prettyprint linenums prettyprinted" style="border:1px solid rgb(225,225,232);font-size:13px;line-height:19px;overflow:auto;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background-color:rgb(247,247,249);"></pre><ol class="linenums" style="color:rgb(30,52,123);"><li class="L0" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="typ" style="color:#008080;">Info</span><span class="pun" style="color:rgb(147,161,161);">:</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">Sourcing</span><span class="pln" style="color:rgb(72,72,76);"> environment configuration script </span><span class="pun" style="color:rgb(147,161,161);">/</span><span class="pln" style="color:rgb(72,72,76);">home</span><span class="pun" style="color:rgb(147,161,161);">/</span><span class="pln" style="color:rgb(72,72,76);">bjtianye1</span><span class="pun" style="color:rgb(147,161,161);">/</span><span class="pln" style="color:rgb(72,72,76);">apache</span><span class="pun" style="color:rgb(147,161,161);">-</span><span class="pln" style="color:rgb(72,72,76);">flume</span><span class="pun" style="color:rgb(147,161,161);">-</span><span class="lit" style="color:rgb(25,95,145);">1.7</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="lit" style="color:rgb(25,95,145);">0</span><span class="pun" style="color:rgb(147,161,161);">-</span><span class="pln" style="color:rgb(72,72,76);">bin</span><span class="pun" style="color:rgb(147,161,161);">/</span><span class="pln" style="color:rgb(72,72,76);">conf</span><span class="pun" style="color:rgb(147,161,161);">/</span><span class="pln" style="color:rgb(72,72,76);">flume</span><span class="pun" style="color:rgb(147,161,161);">-</span><span class="pln" style="color:rgb(72,72,76);">env</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">sh</span></code></li><li class="L1" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="typ" style="color:#008080;">Info</span><span class="pun" style="color:rgb(147,161,161);">:</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">Including</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">Hadoop</span><span class="pln" style="color:rgb(72,72,76);"> libraries found via </span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="str" style="color:rgb(221,17,68);">/home/</span><span class="pln" style="color:rgb(72,72,76);">hadoop</span><span class="pun" style="color:rgb(147,161,161);">/</span><span class="pln" style="color:rgb(72,72,76);">hadoop</span><span class="com" style="color:rgb(147,161,161);">//bin/hadoop) for HDFS access</span></code></li><li class="L2" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="typ" style="color:#008080;">Info</span><span class="pun" style="color:rgb(147,161,161);">:</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">Including</span><span class="pln" style="color:rgb(72,72,76);"> HBASE libraries found via </span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="str" style="color:rgb(221,17,68);">/home/</span><span class="pln" style="color:rgb(72,72,76);">hbase</span><span class="pun" style="color:rgb(147,161,161);">/</span><span class="pln" style="color:rgb(72,72,76);">hbase</span><span class="pun" style="color:rgb(147,161,161);">/</span><span class="pln" style="color:rgb(72,72,76);">bin</span><span class="pun" style="color:rgb(147,161,161);">/</span><span class="pln" style="color:rgb(72,72,76);">hbase</span><span class="pun" style="color:rgb(147,161,161);">)</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">for</span><span class="pln" style="color:rgb(72,72,76);"> HBASE access</span></code></li><li class="L3" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="typ" style="color:#008080;">Info</span><span class="pun" style="color:rgb(147,161,161);">:</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">Including</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">Hive</span><span class="pln" style="color:rgb(72,72,76);"> libraries found via </span><span class="pun" style="color:rgb(147,161,161);">()</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">for</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">Hive</span><span class="pln" style="color:rgb(72,72,76);"> access</span></code></li><li class="L4" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pun" style="color:rgb(147,161,161);">+</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">exec</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">/</span><span class="pln" style="color:rgb(72,72,76);">home</span><span class="pun" style="color:rgb(147,161,161);">/</span><span class="pln" style="color:rgb(72,72,76);">jdk</span><span class="com" style="color:rgb(147,161,161);">//bin/java -Xmx20m -Dflume.root.logger=DEBUG,console,LOGFILE -Xms100m -Xmx2000m -Dflume.monitoring.type=ganglia -Dflume.monitoring.hosts=10.172.152.66:8666 -DisGanglia3=true -cp '/home/bjtianye1/apache-flume-1.7.0-bin/conf:/home/hadoop/hadoop-2.5.2/lib/native org.apache.flume.node.Application -f conf/flume.conf -n agent1</span></code></li></ol>
<p style="font-size:15px;font-family:Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height:24px;">
根据命令中含有no-reload-conf（默认为动态加载）参数，决定采用那种加载配置文件方式：一、没有此参数，会动态加载配置文件，默认每30秒加载一次配置文件，因此可以动态修改配置文件；二、有此参数，则只在启动时加载一次配置文件。实现动态加载功能采用了发布订阅模式，使用guava中的EventBus实现。</p>
<p style="font-size:15px;font-family:Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height:24px;">
main方法首先解析各个传入的参数，然后调用handleConfigurationEvent方法，在该方法中调用startAllComponents方法，在该方法中调用loadMonitoring方法加载监控的一些信息，并开始监控服务monitorServer.start()(monitorServer实现了接口MonitorService，该接口中只有两个方法start和stop)</p>
<pre class="prettyprint linenums prettyprinted" style="border:1px solid rgb(225,225,232);font-size:13px;line-height:19px;overflow:auto;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background-color:rgb(247,247,249);"></pre><ol class="linenums" style="color:rgb(30,52,123);"><li class="L0" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">private</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">void</span><span class="pln" style="color:rgb(72,72,76);"> loadMonitoring</span><span class="pun" style="color:rgb(147,161,161);">()</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L1" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">       </span><span class="pun" style="color:rgb(147,161,161);">...</span></code></li><li class="L2" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      monitorServer</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">configure</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="pln" style="color:rgb(72,72,76);">context</span><span class="pun" style="color:rgb(147,161,161);">);来加载监控服务的配置信息；</span></code></li><li class="L3" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      monitorServer</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">start</span><span class="pun" style="color:rgb(147,161,161);">();启动监控服务</span></code></li><li class="L4" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">       </span><span class="pun" style="color:rgb(147,161,161);">...</span></code></li><li class="L5" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pun" style="color:rgb(147,161,161);">}</span></code></li></ol>
<p style="font-size:15px;font-family:Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height:24px;">
查看该start 方法的具体实现： <br></p>
<p style="font-size:15px;font-family:Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height:24px;">
monitorServer有两种，GangliaServer和HTTPMetricsServer，都实现了MonitorService接口。</p>
<pre class="prettyprint linenums prettyprinted" style="border:1px solid rgb(225,225,232);font-size:13px;line-height:19px;overflow:auto;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background-color:rgb(247,247,249);"></pre><ol class="linenums" style="color:rgb(30,52,123);"><li class="L0" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">/**</span></code></li><li class="L1" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">   * Start this server, causing it to poll JMX at the configured frequency.</span></code></li><li class="L2" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">   */</span></code></li><li class="L3" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">  </span><span class="lit" style="color:rgb(25,95,145);">@Override</span></code></li><li class="L4" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">  </span><span class="kwd" style="color:rgb(30,52,123);">public</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">void</span><span class="pln" style="color:rgb(72,72,76);"> start</span><span class="pun" style="color:rgb(147,161,161);">()</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L5" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="kwd" style="color:rgb(30,52,123);">try</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L6" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      socket </span><span class="pun" style="color:rgb(147,161,161);">=</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">new</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">DatagramSocket</span><span class="pun" style="color:rgb(147,161,161);">();</span></code></li><li class="L7" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      hostname </span><span class="pun" style="color:rgb(147,161,161);">=</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">InetAddress</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">getLocalHost</span><span class="pun" style="color:rgb(147,161,161);">().</span><span class="pln" style="color:rgb(72,72,76);">getHostName</span><span class="pun" style="color:rgb(147,161,161);">();</span></code></li><li class="L8" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="pun" style="color:rgb(147,161,161);">}</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">catch</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="typ" style="color:#008080;">SocketException</span><span class="pln" style="color:rgb(72,72,76);"> ex</span><span class="pun" style="color:rgb(147,161,161);">)</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L9" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      logger</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">error</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="str" style="color:rgb(221,17,68);">"Could not create socket for metrics collection."</span><span class="pun" style="color:rgb(147,161,161);">);</span></code></li><li class="L0" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      </span><span class="kwd" style="color:rgb(30,52,123);">throw</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">new</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">FlumeException</span><span class="pun" style="color:rgb(147,161,161);">(</span></code></li><li class="L1" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">              </span><span class="str" style="color:rgb(221,17,68);">"Could not create socket for metrics collection."</span><span class="pun" style="color:rgb(147,161,161);">,</span><span class="pln" style="color:rgb(72,72,76);"> ex</span><span class="pun" style="color:rgb(147,161,161);">);</span></code></li><li class="L2" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="pun" style="color:rgb(147,161,161);">}</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">catch</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="typ" style="color:#008080;">Exception</span><span class="pln" style="color:rgb(72,72,76);"> ex2</span><span class="pun" style="color:rgb(147,161,161);">)</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L3" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      logger</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">warn</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="str" style="color:rgb(221,17,68);">"Unknown error occured"</span><span class="pun" style="color:rgb(147,161,161);">,</span><span class="pln" style="color:rgb(72,72,76);"> ex2</span><span class="pun" style="color:rgb(147,161,161);">);</span></code></li><li class="L4" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="pun" style="color:rgb(147,161,161);">}</span></code></li><li class="L5" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="kwd" style="color:rgb(30,52,123);">for</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="typ" style="color:#008080;">HostInfo</span><span class="pln" style="color:rgb(72,72,76);"> host </span><span class="pun" style="color:rgb(147,161,161);">:</span><span class="pln" style="color:rgb(72,72,76);"> hosts</span><span class="pun" style="color:rgb(147,161,161);">)</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L6" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      addresses</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">add</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="kwd" style="color:rgb(30,52,123);">new</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">InetSocketAddress</span><span class="pun" style="color:rgb(147,161,161);">(</span></code></li><li class="L7" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">              host</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">getHostName</span><span class="pun" style="color:rgb(147,161,161);">(),</span><span class="pln" style="color:rgb(72,72,76);"> host</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">getPortNumber</span><span class="pun" style="color:rgb(147,161,161);">()));</span></code></li><li class="L8" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="pun" style="color:rgb(147,161,161);">}</span></code></li><li class="L9" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    collectorRunnable</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">server </span><span class="pun" style="color:rgb(147,161,161);">=</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">this</span><span class="pun" style="color:rgb(147,161,161);">;</span></code></li><li class="L0" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="kwd" style="color:rgb(30,52,123);">if</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="pln" style="color:rgb(72,72,76);">service</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">isShutdown</span><span class="pun" style="color:rgb(147,161,161);">()</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">||</span><span class="pln" style="color:rgb(72,72,76);"> service</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">isTerminated</span><span class="pun" style="color:rgb(147,161,161);">())</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L1" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      </span><span class="com" style="color:rgb(147,161,161);">/*</span></code></li><li class="L2" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">       * 创建一个单线程执行程序，它可安排在给定延迟后运行命令或者定期地执行。</span></code></li><li class="L3" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">       * （注意，如果因为在关闭前的执行期间出现失败而终止了此单个线程，那么如果需要，</span></code></li><li class="L4" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">       * 一个新线程会代替它执行后续的任务）。可保证顺序地执行各个任务，并且在任意给定</span></code></li><li class="L5" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">       * 的时间不会有多个线程是活动的。与其他等效的 newScheduledThreadPool(1) 不同，</span></code></li><li class="L6" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">       * 可保证无需重新配置此方法所返回的执行程序即可使用其他的线程</span></code></li><li class="L7" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">       *</span></code></li><li class="L8" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">       */</span></code></li><li class="L9" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      service </span><span class="pun" style="color:rgb(147,161,161);">=</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">Executors</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">newSingleThreadScheduledExecutor</span><span class="pun" style="color:rgb(147,161,161);">();</span></code></li><li class="L0" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="pun" style="color:rgb(147,161,161);">}</span></code></li><li class="L1" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="com" style="color:rgb(147,161,161);">/* scheduleWithFixedDelay(Runnable command, 要执行的任务  </span></code></li><li class="L2" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">     *                        long initialDelay, 首次执行的延迟时间</span></code></li><li class="L3" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">     *                        long delay,   一次执行终止和下一次执行开始之间的延迟</span></code></li><li class="L4" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">     *                        TimeUnit unit)  initialDelay 和 delay 参数的时间单位</span></code></li><li class="L5" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">     * 创建并执行一个在给定初始延迟后首次启用的定期操作，随后，在每一次执行终止和下一次</span></code></li><li class="L6" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">     * 执行开始之间都存在给定的延迟。如果任务的任一执行遇到异常，就会取消后续执行。否则，</span></code></li><li class="L7" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">     * 只能通过执行程序的取消或终止方法来终止该任务。</span></code></li><li class="L8" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">     */</span></code></li><li class="L9" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    service</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">scheduleWithFixedDelay</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="pln" style="color:rgb(72,72,76);">collectorRunnable</span><span class="pun" style="color:rgb(147,161,161);">,</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="lit" style="color:rgb(25,95,145);">0</span><span class="pun" style="color:rgb(147,161,161);">,</span></code></li><li class="L0" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">            pollFrequency</span><span class="pun" style="color:rgb(147,161,161);">,</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">TimeUnit</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">SECONDS</span><span class="pun" style="color:rgb(147,161,161);">);</span></code></li><li class="L1" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">  </span><span class="pun" style="color:rgb(147,161,161);">}</span></code></li></ol>
<p style="font-size:15px;font-family:Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height:24px;">
start()方法中会调用collectorRunnable（一个实现了Runnable的类GangliaCollector ）</p>
<pre class="prettyprint linenums prettyprinted" style="border:1px solid rgb(225,225,232);font-size:13px;line-height:19px;overflow:auto;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background-color:rgb(247,247,249);"></pre><ol class="linenums" style="color:rgb(30,52,123);"><li class="L0" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">/**GangliaServer.java</span></code></li><li class="L1" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">   * Worker which polls JMX for all mbeans with</span></code></li><li class="L2" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">   * {@link javax.management.ObjectName} within the flume namespace:</span></code></li><li class="L3" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">   * org.apache.flume. All attributes of such beans are sent to the all hosts</span></code></li><li class="L4" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">   * specified by the server that owns it's instance.</span></code></li><li class="L5" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">   * 这些bean的所有属性都发送到拥有它的实例的服务器指定的所有主机</span></code></li><li class="L6" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">   */</span></code></li><li class="L7" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">  </span><span class="kwd" style="color:rgb(30,52,123);">protected</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">class</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">GangliaCollector</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">implements</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">Runnable</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L8" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="kwd" style="color:rgb(30,52,123);">private</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">GangliaServer</span><span class="pln" style="color:rgb(72,72,76);"> server</span><span class="pun" style="color:rgb(147,161,161);">;</span></code></li><li class="L9" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="lit" style="color:rgb(25,95,145);">@Override</span></code></li><li class="L0" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="kwd" style="color:rgb(30,52,123);">public</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">void</span><span class="pln" style="color:rgb(72,72,76);"> run</span><span class="pun" style="color:rgb(147,161,161);">()</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L1" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      </span><span class="kwd" style="color:rgb(30,52,123);">try</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L2" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        </span><span class="typ" style="color:#008080;">Map</span><span class="pun" style="color:rgb(147,161,161);">&lt;</span><span class="typ" style="color:#008080;">String</span><span class="pun" style="color:rgb(147,161,161);">,</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">Map</span><span class="pun" style="color:rgb(147,161,161);">&lt;</span><span class="typ" style="color:#008080;">String</span><span class="pun" style="color:rgb(147,161,161);">,</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">String</span><span class="pun" style="color:rgb(147,161,161);">&gt;&gt;</span><span class="pln" style="color:rgb(72,72,76);"> metricsMap </span><span class="pun" style="color:rgb(147,161,161);">=</span></code></li><li class="L3" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">                </span><span class="typ" style="color:#008080;">JMXPollUtil</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">getAllMBeans</span><span class="pun" style="color:rgb(147,161,161);">();</span><span class="pln" style="color:rgb(72,72,76);">   </span><span class="com" style="color:rgb(147,161,161);">//具体的监控数据从这获得，通过JMX方式得到</span></code></li><li class="L4" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        </span><span class="kwd" style="color:rgb(30,52,123);">for</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="typ" style="color:#008080;">String</span><span class="pln" style="color:rgb(72,72,76);"> component </span><span class="pun" style="color:rgb(147,161,161);">:</span><span class="pln" style="color:rgb(72,72,76);"> metricsMap</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">keySet</span><span class="pun" style="color:rgb(147,161,161);">())</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L5" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">          </span><span class="typ" style="color:#008080;">Map</span><span class="pun" style="color:rgb(147,161,161);">&lt;</span><span class="typ" style="color:#008080;">String</span><span class="pun" style="color:rgb(147,161,161);">,</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">String</span><span class="pun" style="color:rgb(147,161,161);">&gt;</span><span class="pln" style="color:rgb(72,72,76);"> attributeMap </span><span class="pun" style="color:rgb(147,161,161);">=</span><span class="pln" style="color:rgb(72,72,76);"> metricsMap</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="kwd" style="color:rgb(30,52,123);">get</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="pln" style="color:rgb(72,72,76);">component</span><span class="pun" style="color:rgb(147,161,161);">);</span></code></li><li class="L6" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">          </span><span class="kwd" style="color:rgb(30,52,123);">for</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="typ" style="color:#008080;">String</span><span class="pln" style="color:rgb(72,72,76);"> attribute </span><span class="pun" style="color:rgb(147,161,161);">:</span><span class="pln" style="color:rgb(72,72,76);"> attributeMap</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">keySet</span><span class="pun" style="color:rgb(147,161,161);">())</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L7" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">            </span><span class="kwd" style="color:rgb(30,52,123);">if</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="pln" style="color:rgb(72,72,76);">isGanglia3</span><span class="pun" style="color:rgb(147,161,161);">)</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L8" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">              server</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">createGangliaMessage</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="pln" style="color:rgb(72,72,76);">GANGLIA_CONTEXT </span><span class="pun" style="color:rgb(147,161,161);">+</span><span class="pln" style="color:rgb(72,72,76);"> component </span><span class="pun" style="color:rgb(147,161,161);">+</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="str" style="color:rgb(221,17,68);">"."</span></code></li><li class="L9" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">                      </span><span class="pun" style="color:rgb(147,161,161);">+</span><span class="pln" style="color:rgb(72,72,76);"> attribute</span><span class="pun" style="color:rgb(147,161,161);">,</span></code></li><li class="L0" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">                      attributeMap</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="kwd" style="color:rgb(30,52,123);">get</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="pln" style="color:rgb(72,72,76);">attribute</span><span class="pun" style="color:rgb(147,161,161);">));</span></code></li><li class="L1" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">            </span><span class="pun" style="color:rgb(147,161,161);">}</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">else</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L2" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">              server</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">createGangliaMessage31</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="pln" style="color:rgb(72,72,76);">GANGLIA_CONTEXT </span><span class="pun" style="color:rgb(147,161,161);">+</span><span class="pln" style="color:rgb(72,72,76);"> component </span><span class="pun" style="color:rgb(147,161,161);">+</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="str" style="color:rgb(221,17,68);">"."</span></code></li><li class="L3" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">                      </span><span class="pun" style="color:rgb(147,161,161);">+</span><span class="pln" style="color:rgb(72,72,76);"> attribute</span><span class="pun" style="color:rgb(147,161,161);">,</span></code></li><li class="L4" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">                      attributeMap</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="kwd" style="color:rgb(30,52,123);">get</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="pln" style="color:rgb(72,72,76);">attribute</span><span class="pun" style="color:rgb(147,161,161);">));</span></code></li><li class="L5" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">            </span><span class="pun" style="color:rgb(147,161,161);">}</span></code></li><li class="L6" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">            server</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">sendToGangliaNodes</span><span class="pun" style="color:rgb(147,161,161);">();</span><span class="pln" style="color:rgb(72,72,76);">  </span><span class="com" style="color:rgb(147,161,161);">//发送metrics数据到ganglia节点</span></code></li><li class="L7" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">          </span><span class="pun" style="color:rgb(147,161,161);">}</span></code></li><li class="L8" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        </span><span class="pun" style="color:rgb(147,161,161);">}</span></code></li><li class="L9" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      </span><span class="pun" style="color:rgb(147,161,161);">}</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">catch</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="typ" style="color:#008080;">Throwable</span><span class="pln" style="color:rgb(72,72,76);"> t</span><span class="pun" style="color:rgb(147,161,161);">)</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L0" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        logger</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">error</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="str" style="color:rgb(221,17,68);">"Unexpected error"</span><span class="pun" style="color:rgb(147,161,161);">,</span><span class="pln" style="color:rgb(72,72,76);"> t</span><span class="pun" style="color:rgb(147,161,161);">);</span></code></li><li class="L1" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      </span><span class="pun" style="color:rgb(147,161,161);">}</span></code></li><li class="L2" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="pun" style="color:rgb(147,161,161);">}</span></code></li><li class="L3" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">  </span><span class="pun" style="color:rgb(147,161,161);">}</span></code></li></ol>
<p style="font-size:15px;font-family:Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height:24px;">
监控数据主要是通过类JMXPollUtil的getAllMBean方法中获取的，这个类是flume监控的核心代码，通过Java JMX（java管理扩展，是Java平台上为应用程序、设备、系统等植入管理功能的框架）实现。首先会从MBeanServer服务器获取已注册的 MBean 对象名及其类名，然后将对应的component和属性信息放入Map对象中返回：</p>
<pre class="prettyprint linenums prettyprinted" style="border:1px solid rgb(225,225,232);font-size:13px;line-height:19px;overflow:auto;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background-color:rgb(247,247,249);"></pre><ol class="linenums" style="color:rgb(30,52,123);"><li class="L0" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="kwd" style="color:rgb(30,52,123);">public</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">class</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">JMXPollUtil</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L1" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">  </span><span class="kwd" style="color:rgb(30,52,123);">private</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">static</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">Logger</span><span class="pln" style="color:rgb(72,72,76);"> LOG </span><span class="pun" style="color:rgb(147,161,161);">=</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">LoggerFactory</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">getLogger</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="typ" style="color:#008080;">JMXPollUtil</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="kwd" style="color:rgb(30,52,123);">class</span><span class="pun" style="color:rgb(147,161,161);">);</span></code></li><li class="L2" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">  </span><span class="kwd" style="color:rgb(30,52,123);">private</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">static</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">MBeanServer</span><span class="pln" style="color:rgb(72,72,76);"> mbeanServer </span><span class="pun" style="color:rgb(147,161,161);">=</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">ManagementFactory</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">getPlatformMBeanServer</span><span class="pun" style="color:rgb(147,161,161);">();</span></code></li><li class="L3" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">  </span><span class="com" style="color:rgb(147,161,161);">/*</span></code></li><li class="L4" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">   * getAllMBeans()获取所有组件注册的MBean构成的Map&lt;String,Map&lt;String,String&gt;&gt; mbeanMap</span></code></li><li class="L5" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">   * 将组件信息和对应的监控项信息put至集合mbeanMap中并返回</span></code></li><li class="L6" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">   */</span></code></li><li class="L7" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">  </span><span class="kwd" style="color:rgb(30,52,123);">public</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">static</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">Map</span><span class="pun" style="color:rgb(147,161,161);">&lt;</span><span class="typ" style="color:#008080;">String</span><span class="pun" style="color:rgb(147,161,161);">,</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">Map</span><span class="pun" style="color:rgb(147,161,161);">&lt;</span><span class="typ" style="color:#008080;">String</span><span class="pun" style="color:rgb(147,161,161);">,</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">String</span><span class="pun" style="color:rgb(147,161,161);">&gt;&gt;</span><span class="pln" style="color:rgb(72,72,76);"> getAllMBeans</span><span class="pun" style="color:rgb(147,161,161);">()</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L8" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="com" style="color:rgb(147,161,161);">//newHashMap方法内部只是创建了一个空的HashMap&lt;K,V&gt;实例</span></code></li><li class="L9" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="typ" style="color:#008080;">Map</span><span class="pun" style="color:rgb(147,161,161);">&lt;</span><span class="typ" style="color:#008080;">String</span><span class="pun" style="color:rgb(147,161,161);">,</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">Map</span><span class="pun" style="color:rgb(147,161,161);">&lt;</span><span class="typ" style="color:#008080;">String</span><span class="pun" style="color:rgb(147,161,161);">,</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">String</span><span class="pun" style="color:rgb(147,161,161);">&gt;&gt;</span><span class="pln" style="color:rgb(72,72,76);"> mbeanMap </span><span class="pun" style="color:rgb(147,161,161);">=</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">Maps</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">newHashMap</span><span class="pun" style="color:rgb(147,161,161);">();</span></code></li><li class="L0" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="typ" style="color:#008080;">Set</span><span class="pun" style="color:rgb(147,161,161);">&lt;</span><span class="typ" style="color:#008080;">ObjectInstance</span><span class="pun" style="color:rgb(147,161,161);">&gt;</span><span class="pln" style="color:rgb(72,72,76);"> queryMBeans </span><span class="pun" style="color:rgb(147,161,161);">=</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">null</span><span class="pun" style="color:rgb(147,161,161);">;</span></code></li><li class="L1" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="kwd" style="color:rgb(30,52,123);">try</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L2" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      </span><span class="com" style="color:rgb(147,161,161);">/* queryMBeans获取该MBean服务器所控制的MBean</span></code></li><li class="L3" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">       * name - 对象名模式，标识要检索的 MBean。如果为 null 或未指定域和键属性，则检索所有已注册的 MBean。</span></code></li><li class="L4" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">       * query - 应用到所选 MBean 的查询表达式。如果为 null，则不对所选的 MBean 应用查询表达式</span></code></li><li class="L5" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">       */</span></code></li><li class="L6" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      queryMBeans </span><span class="pun" style="color:rgb(147,161,161);">=</span><span class="pln" style="color:rgb(72,72,76);"> mbeanServer</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">queryMBeans</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="kwd" style="color:rgb(30,52,123);">null</span><span class="pun" style="color:rgb(147,161,161);">,</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">null</span><span class="pun" style="color:rgb(147,161,161);">);</span></code></li><li class="L7" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="pun" style="color:rgb(147,161,161);">}</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">catch</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="typ" style="color:#008080;">Exception</span><span class="pln" style="color:rgb(72,72,76);"> ex</span><span class="pun" style="color:rgb(147,161,161);">)</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L8" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      LOG</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">error</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="str" style="color:rgb(221,17,68);">"Could not get Mbeans for monitoring"</span><span class="pun" style="color:rgb(147,161,161);">,</span><span class="pln" style="color:rgb(72,72,76);"> ex</span><span class="pun" style="color:rgb(147,161,161);">);</span></code></li><li class="L9" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      </span><span class="typ" style="color:#008080;">Throwables</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">propagate</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="pln" style="color:rgb(72,72,76);">ex</span><span class="pun" style="color:rgb(147,161,161);">);</span></code></li><li class="L0" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="pun" style="color:rgb(147,161,161);">}</span></code></li><li class="L1" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="com" style="color:rgb(147,161,161);">/* 类ObjectInstance用于表示 MBean 对象名及其类名</span></code></li><li class="L2" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">     * getObjectName()方法用于返回对象名部分，类型为ObjectName</span></code></li><li class="L3" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="com" style="color:rgb(147,161,161);">     */</span></code></li><li class="L4" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="kwd" style="color:rgb(30,52,123);">for</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="typ" style="color:#008080;">ObjectInstance</span><span class="pln" style="color:rgb(72,72,76);"> obj </span><span class="pun" style="color:rgb(147,161,161);">:</span><span class="pln" style="color:rgb(72,72,76);"> queryMBeans</span><span class="pun" style="color:rgb(147,161,161);">)</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L5" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      </span><span class="kwd" style="color:rgb(30,52,123);">try</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="com" style="color:rgb(147,161,161);">//ObjectName类中有重写toString方法 </span></code></li><li class="L6" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        </span><span class="kwd" style="color:rgb(30,52,123);">if</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">(!</span><span class="pln" style="color:rgb(72,72,76);">obj</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">getObjectName</span><span class="pun" style="color:rgb(147,161,161);">().</span><span class="pln" style="color:rgb(72,72,76);">toString</span><span class="pun" style="color:rgb(147,161,161);">().</span><span class="pln" style="color:rgb(72,72,76);">startsWith</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="str" style="color:rgb(221,17,68);">"org.apache.flume"</span><span class="pun" style="color:rgb(147,161,161);">))</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L7" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">          </span><span class="kwd" style="color:rgb(30,52,123);">continue</span><span class="pun" style="color:rgb(147,161,161);">;</span></code></li><li class="L8" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        </span><span class="pun" style="color:rgb(147,161,161);">}</span></code></li><li class="L9" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        </span><span class="com" style="color:rgb(147,161,161);">//getMBeanInfo方法发现了 MBean 为管理而公开的属性和操作</span></code></li><li class="L0" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        </span><span class="com" style="color:rgb(147,161,161);">//getAttributes返回为了便于管理而公开的属性的列表。</span></code></li><li class="L1" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        </span><span class="typ" style="color:#008080;">MBeanAttributeInfo</span><span class="pun" style="color:rgb(147,161,161);">[]</span><span class="pln" style="color:rgb(72,72,76);"> attrs </span><span class="pun" style="color:rgb(147,161,161);">=</span><span class="pln" style="color:rgb(72,72,76);"> mbeanServer</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">getMBeanInfo</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="pln" style="color:rgb(72,72,76);">obj</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">getObjectName</span><span class="pun" style="color:rgb(147,161,161);">()).</span><span class="pln" style="color:rgb(72,72,76);">getAttributes</span><span class="pun" style="color:rgb(147,161,161);">();</span></code></li><li class="L2" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        </span><span class="typ" style="color:#008080;">String</span><span class="pun" style="color:rgb(147,161,161);">[]</span><span class="pln" style="color:rgb(72,72,76);"> strAtts </span><span class="pun" style="color:rgb(147,161,161);">=</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">new</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">String</span><span class="pun" style="color:rgb(147,161,161);">[</span><span class="pln" style="color:rgb(72,72,76);">attrs</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">length</span><span class="pun" style="color:rgb(147,161,161);">];</span></code></li><li class="L3" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        </span><span class="kwd" style="color:rgb(30,52,123);">for</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="kwd" style="color:rgb(30,52,123);">int</span><span class="pln" style="color:rgb(72,72,76);"> i </span><span class="pun" style="color:rgb(147,161,161);">=</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="lit" style="color:rgb(25,95,145);">0</span><span class="pun" style="color:rgb(147,161,161);">;</span><span class="pln" style="color:rgb(72,72,76);"> i </span><span class="pun" style="color:rgb(147,161,161);">&lt;</span><span class="pln" style="color:rgb(72,72,76);"> strAtts</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">length</span><span class="pun" style="color:rgb(147,161,161);">;</span><span class="pln" style="color:rgb(72,72,76);"> i</span><span class="pun" style="color:rgb(147,161,161);">++)</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L4" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">          strAtts</span><span class="pun" style="color:rgb(147,161,161);">[</span><span class="pln" style="color:rgb(72,72,76);">i</span><span class="pun" style="color:rgb(147,161,161);">]</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">=</span><span class="pln" style="color:rgb(72,72,76);"> attrs</span><span class="pun" style="color:rgb(147,161,161);">[</span><span class="pln" style="color:rgb(72,72,76);">i</span><span class="pun" style="color:rgb(147,161,161);">].</span><span class="pln" style="color:rgb(72,72,76);">getName</span><span class="pun" style="color:rgb(147,161,161);">();</span></code></li><li class="L5" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        </span><span class="pun" style="color:rgb(147,161,161);">}</span></code></li><li class="L6" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        </span><span class="com" style="color:rgb(147,161,161);">//mbeanServer.getAttributes获得指定 MBean 的多个属性值</span></code></li><li class="L7" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        </span><span class="typ" style="color:#008080;">AttributeList</span><span class="pln" style="color:rgb(72,72,76);"> attrList </span><span class="pun" style="color:rgb(147,161,161);">=</span><span class="pln" style="color:rgb(72,72,76);"> mbeanServer</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">getAttributes</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="pln" style="color:rgb(72,72,76);">obj</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">getObjectName</span><span class="pun" style="color:rgb(147,161,161);">(),</span><span class="pln" style="color:rgb(72,72,76);"> strAtts</span><span class="pun" style="color:rgb(147,161,161);">);</span></code></li><li class="L8" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        </span><span class="com" style="color:rgb(147,161,161);">//获取组件名</span></code></li><li class="L9" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        </span><span class="typ" style="color:#008080;">String</span><span class="pln" style="color:rgb(72,72,76);"> component </span><span class="pun" style="color:rgb(147,161,161);">=</span><span class="pln" style="color:rgb(72,72,76);"> obj</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">getObjectName</span><span class="pun" style="color:rgb(147,161,161);">().</span><span class="pln" style="color:rgb(72,72,76);">toString</span><span class="pun" style="color:rgb(147,161,161);">().</span><span class="pln" style="color:rgb(72,72,76);">substring</span><span class="pun" style="color:rgb(147,161,161);">(</span></code></li><li class="L0" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">            obj</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">getObjectName</span><span class="pun" style="color:rgb(147,161,161);">().</span><span class="pln" style="color:rgb(72,72,76);">toString</span><span class="pun" style="color:rgb(147,161,161);">().</span><span class="pln" style="color:rgb(72,72,76);">indexOf</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="str" style="color:rgb(221,17,68);">'='</span><span class="pun" style="color:rgb(147,161,161);">)</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">+</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="lit" style="color:rgb(25,95,145);">1</span><span class="pun" style="color:rgb(147,161,161);">);</span></code></li><li class="L1" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"></code></li><li class="L2" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        </span><span class="com" style="color:rgb(147,161,161);">//创建存储属性键值对的HashMap集合</span></code></li><li class="L3" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        </span><span class="typ" style="color:#008080;">Map</span><span class="pun" style="color:rgb(147,161,161);">&lt;</span><span class="typ" style="color:#008080;">String</span><span class="pun" style="color:rgb(147,161,161);">,</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">String</span><span class="pun" style="color:rgb(147,161,161);">&gt;</span><span class="pln" style="color:rgb(72,72,76);"> attrMap </span><span class="pun" style="color:rgb(147,161,161);">=</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">Maps</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">newHashMap</span><span class="pun" style="color:rgb(147,161,161);">();</span></code></li><li class="L4" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"></code></li><li class="L5" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        </span><span class="kwd" style="color:rgb(30,52,123);">for</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="typ" style="color:#008080;">Object</span><span class="pln" style="color:rgb(72,72,76);"> attr </span><span class="pun" style="color:rgb(147,161,161);">:</span><span class="pln" style="color:rgb(72,72,76);"> attrList</span><span class="pun" style="color:rgb(147,161,161);">)</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L6" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">          </span><span class="typ" style="color:#008080;">Attribute</span><span class="pln" style="color:rgb(72,72,76);"> localAttr </span><span class="pun" style="color:rgb(147,161,161);">=</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="typ" style="color:#008080;">Attribute</span><span class="pun" style="color:rgb(147,161,161);">)</span><span class="pln" style="color:rgb(72,72,76);"> attr</span><span class="pun" style="color:rgb(147,161,161);">;</span></code></li><li class="L7" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">          </span><span class="kwd" style="color:rgb(30,52,123);">if</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="pln" style="color:rgb(72,72,76);">localAttr</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">getName</span><span class="pun" style="color:rgb(147,161,161);">().</span><span class="pln" style="color:rgb(72,72,76);">equalsIgnoreCase</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="str" style="color:rgb(221,17,68);">"type"</span><span class="pun" style="color:rgb(147,161,161);">))</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L8" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">            component </span><span class="pun" style="color:rgb(147,161,161);">=</span><span class="pln" style="color:rgb(72,72,76);"> localAttr</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">getValue</span><span class="pun" style="color:rgb(147,161,161);">()</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">+</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="str" style="color:rgb(221,17,68);">"."</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">+</span><span class="pln" style="color:rgb(72,72,76);"> component</span><span class="pun" style="color:rgb(147,161,161);">;</span></code></li><li class="L9" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">          </span><span class="pun" style="color:rgb(147,161,161);">}</span></code></li><li class="L0" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">          attrMap</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">put</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="pln" style="color:rgb(72,72,76);">localAttr</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">getName</span><span class="pun" style="color:rgb(147,161,161);">(),</span><span class="pln" style="color:rgb(72,72,76);"> localAttr</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">getValue</span><span class="pun" style="color:rgb(147,161,161);">().</span><span class="pln" style="color:rgb(72,72,76);">toString</span><span class="pun" style="color:rgb(147,161,161);">());</span></code></li><li class="L1" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        </span><span class="pun" style="color:rgb(147,161,161);">}</span></code></li><li class="L2" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        mbeanMap</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">put</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="pln" style="color:rgb(72,72,76);">component</span><span class="pun" style="color:rgb(147,161,161);">,</span><span class="pln" style="color:rgb(72,72,76);"> attrMap</span><span class="pun" style="color:rgb(147,161,161);">);</span></code></li><li class="L3" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      </span><span class="pun" style="color:rgb(147,161,161);">}</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">catch</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="typ" style="color:#008080;">Exception</span><span class="pln" style="color:rgb(72,72,76);"> e</span><span class="pun" style="color:rgb(147,161,161);">)</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L4" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">        LOG</span><span class="pun" style="color:rgb(147,161,161);">.</span><span class="pln" style="color:rgb(72,72,76);">error</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="str" style="color:rgb(221,17,68);">"Unable to poll JMX for metrics."</span><span class="pun" style="color:rgb(147,161,161);">,</span><span class="pln" style="color:rgb(72,72,76);"> e</span><span class="pun" style="color:rgb(147,161,161);">);</span></code></li><li class="L5" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      </span><span class="pun" style="color:rgb(147,161,161);">}</span></code></li><li class="L6" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="pun" style="color:rgb(147,161,161);">}</span></code></li><li class="L7" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="kwd" style="color:rgb(30,52,123);">return</span><span class="pln" style="color:rgb(72,72,76);"> mbeanMap</span><span class="pun" style="color:rgb(147,161,161);">;</span></code></li><li class="L8" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">  </span><span class="pun" style="color:rgb(147,161,161);">}</span></code></li><li class="L9" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pun" style="color:rgb(147,161,161);">}</span></code></li></ol>
<h3 id="wiz_toc_1" style="font-size:18px;font-family:Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;">
Sink组件</h3>
<p style="font-size:15px;font-family:Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height:24px;">
各个具体监控组件的私有指标信息都是在各个组件自己实现定义，这些源码都是在flume-ng-core中的org.apache.flume.instrumentation包下面，所有的监控组件都会继承MonitoredCounterGroup实现xxxCounterMBean接口，MonitoredCounterGroup中定义了一些基本公有的监控属性（启动时间、停止时间等），提供了注册至MBeanServer的方法registerMBean，在具体的组件调用时会进行注册，xxxCounterMBean 则定义了获取监控元素的方法接口，具体实现还是在监控组件中实现。这里就拿
 Sink组件来大致看下。 <br>
SinkCounter 类继承 MonitoredCounterGroup抽象类，并实现了 SinkCounterMBean 接口：</p>
<pre class="prettyprint linenums prettyprinted" style="border:1px solid rgb(225,225,232);font-size:13px;line-height:19px;overflow:auto;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background-color:rgb(247,247,249);"></pre><ol class="linenums" style="color:rgb(30,52,123);"><li class="L0" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="kwd" style="color:rgb(30,52,123);">public</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">class</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">SinkCounter</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">extends</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">MonitoredCounterGroup</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">implements</span></code></li><li class="L1" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="typ" style="color:#008080;">SinkCounterMBean</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L2" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="kwd" style="color:rgb(30,52,123);">private</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">static</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">final</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">String</span><span class="pln" style="color:rgb(72,72,76);"> COUNTER_EVENT_DRAIN_ATTEMPT </span><span class="pun" style="color:rgb(147,161,161);">=</span></code></li><li class="L3" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      </span><span class="str" style="color:rgb(221,17,68);">"sink.event.drain.attempt"</span><span class="pun" style="color:rgb(147,161,161);">;</span></code></li><li class="L4" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"></code></li><li class="L5" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">  </span><span class="kwd" style="color:rgb(30,52,123);">private</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">static</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">final</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">String</span><span class="pln" style="color:rgb(72,72,76);"> COUNTER_EVENT_DRAIN_SUCCESS </span><span class="pun" style="color:rgb(147,161,161);">=</span></code></li><li class="L6" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">      </span><span class="str" style="color:rgb(221,17,68);">"sink.event.drain.sucess"</span><span class="pun" style="color:rgb(147,161,161);">;</span></code></li><li class="L7" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"></code></li><li class="L8" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">  </span><span class="kwd" style="color:rgb(30,52,123);">private</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">static</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">final</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">String</span><span class="pun" style="color:rgb(147,161,161);">[]</span><span class="pln" style="color:rgb(72,72,76);"> ATTRIBUTES </span><span class="pun" style="color:rgb(147,161,161);">=</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span><span class="pln" style="color:rgb(72,72,76);">  </span><span class="com" style="color:rgb(147,161,161);">//组件的监控指标属性信息</span></code></li><li class="L9" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    COUNTER_CONNECTION_CREATED</span><span class="pun" style="color:rgb(147,161,161);">,</span><span class="pln" style="color:rgb(72,72,76);"> COUNTER_CONNECTION_CLOSED</span><span class="pun" style="color:rgb(147,161,161);">,</span></code></li><li class="L0" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    COUNTER_CONNECTION_FAILED</span><span class="pun" style="color:rgb(147,161,161);">,</span><span class="pln" style="color:rgb(72,72,76);"> COUNTER_BATCH_EMPTY</span><span class="pun" style="color:rgb(147,161,161);">,</span></code></li><li class="L1" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    COUNTER_BATCH_UNDERFLOW</span><span class="pun" style="color:rgb(147,161,161);">,</span><span class="pln" style="color:rgb(72,72,76);"> COUNTER_BATCH_COMPLETE</span><span class="pun" style="color:rgb(147,161,161);">,</span></code></li><li class="L2" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    COUNTER_EVENT_DRAIN_ATTEMPT</span><span class="pun" style="color:rgb(147,161,161);">,</span><span class="pln" style="color:rgb(72,72,76);"> COUNTER_EVENT_DRAIN_SUCCESS</span></code></li><li class="L3" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">  </span><span class="pun" style="color:rgb(147,161,161);">};</span></code></li><li class="L4" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="lit" style="color:rgb(25,95,145);">@Override</span></code></li><li class="L5" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">  </span><span class="kwd" style="color:rgb(30,52,123);">public</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">long</span><span class="pln" style="color:rgb(72,72,76);"> getConnectionCreatedCount</span><span class="pun" style="color:rgb(147,161,161);">()</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span><span class="pln" style="color:rgb(72,72,76);">  </span><span class="com" style="color:rgb(147,161,161);">//具体指标的获取方法</span></code></li><li class="L6" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="kwd" style="color:rgb(30,52,123);">return</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">get</span><span class="pun" style="color:rgb(147,161,161);">(</span><span class="pln" style="color:rgb(72,72,76);">COUNTER_CONNECTION_CREATED</span><span class="pun" style="color:rgb(147,161,161);">);</span></code></li><li class="L7" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">  </span><span class="pun" style="color:rgb(147,161,161);">}</span></code></li><li class="L8" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">    </span><span class="pun" style="color:rgb(147,161,161);">......</span></code></li></ol>
<p style="font-size:15px;font-family:Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height:24px;">
SinkCounterMBean接口主要就是声明了一个属性的获取方法：</p>
<pre class="prettyprint linenums prettyprinted" style="border:1px solid rgb(225,225,232);font-size:13px;line-height:19px;overflow:auto;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background-color:rgb(247,247,249);"></pre><ol class="linenums" style="color:rgb(30,52,123);"><li class="L0" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="kwd" style="color:rgb(30,52,123);">public</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="kwd" style="color:rgb(30,52,123);">interface</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="typ" style="color:#008080;">SinkCounterMBean</span><span class="pln" style="color:rgb(72,72,76);"> </span><span class="pun" style="color:rgb(147,161,161);">{</span></code></li><li class="L1" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">  </span><span class="kwd" style="color:rgb(30,52,123);">long</span><span class="pln" style="color:rgb(72,72,76);"> getConnectionCreatedCount</span><span class="pun" style="color:rgb(147,161,161);">();</span></code></li><li class="L2" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">       </span><span class="pun" style="color:rgb(147,161,161);">......</span></code></li><li class="L3" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">  </span><span class="kwd" style="color:rgb(30,52,123);">long</span><span class="pln" style="color:rgb(72,72,76);"> getEventDrainSuccessCount</span><span class="pun" style="color:rgb(147,161,161);">();</span></code></li><li class="L4" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">  </span><span class="kwd" style="color:rgb(30,52,123);">long</span><span class="pln" style="color:rgb(72,72,76);"> getStartTime</span><span class="pun" style="color:rgb(147,161,161);">();</span></code></li><li class="L5" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pln" style="color:rgb(72,72,76);">  </span><span class="kwd" style="color:rgb(30,52,123);">long</span><span class="pln" style="color:rgb(72,72,76);"> getStopTime</span><span class="pun" style="color:rgb(147,161,161);">();</span></code></li><li class="L6" style="color:rgb(190,190,197);line-height:18px;list-style-type:decimal !important;"><code style="border:none;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace;background:transparent;"><span class="pun" style="color:rgb(147,161,161);">}</span></code></li></ol>
<p style="font-size:15px;font-family:Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;line-height:24px;">
上边这就是flume监控的一个大致框架，你可能会发现上边的类或者接口的名字都有点相似，其实这不是偶然的，它是 JMX 中的统一规范。</p>
            </div>
                </div>