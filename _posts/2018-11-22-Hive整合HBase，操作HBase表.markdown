---
layout:     post
title:      Hive整合HBase，操作HBase表
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<p><br></p>
<p>转自 <a title="" href="http://lxw1234.com" rel="nofollow">lxw的大数据田地</a> » <a title="" href="http://lxw1234.com/archives/2015/06/319.htm" rel="nofollow">
[一起学Hive]之十三-Hive整合HBase，操作HBase表</a><br></p>
<p></p>
<h1>十二、Hive整合HBase，操作HBase表</h1>
<p></p>
<p>HBase是被设计用来做k-v查询的，但有时候，也会遇到基于HBase表的复杂统计，写MR很不方便。Hive考虑到了这点，提供了操作HBase表的接口。</p>
<p>关于Hive操作HBase表的原理，请参考我之前的博文：</p>
<p><a title="" href="http://lxw1234.com/archives/2015/04/101.htm" rel="nofollow">         http://lxw1234.com/archives/2015/04/101.htm</a></p>
<p>值得商榷的是，使用Hive操作HBase中的表，只是提供了便捷性，对于性能上，较MapReduce并不会提升太多，请大家酌情使用。</p>
<p>下面来看使用方法（基于Hive0.13和HBase0.96）：</p>
<h2>12.1 HBase中的表</h2>
<p>先在HBase中创建表：</p>
<pre class="prettyprint linenums"></pre><ol class="linenums"><li class="L0"><span class="pln">create </span><span class="str">'lxw1234'</span><span class="pun">,{</span><span class="pln">NAME </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="str">'f1'</span><span class="pun">,</span><span class="pln">VERSIONS </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">},{</span><span class="pln">NAME </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="str">'f2'</span><span class="pun">,</span><span class="pln">VERSIONS </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">},</span></li><li class="L1"><span class="pun">{</span><span class="pln">NAME </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="str">'f3'</span><span class="pun">,</span><span class="pln">VERSIONS </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">}</span></li></ol>
<p>表’lxw1234’有三个列族f1,f2,f3</p>
<p>向HBase表中插入数据：</p>
<pre class="prettyprint linenums"></pre><ol class="linenums"><li class="L0"><span class="pln">put </span><span class="str">'lxw1234'</span><span class="pun">,</span><span class="str">'lxw1234.com'</span><span class="pun">,</span><span class="str">'f1:c1'</span><span class="pun">,</span><span class="str">'name1'</span></li><li class="L1"><span class="pln">put </span><span class="str">'lxw1234'</span><span class="pun">,</span><span class="str">'lxw1234.com'</span><span class="pun">,</span><span class="str">'f1:c2'</span><span class="pun">,</span><span class="str">'name2'</span></li><li class="L2"><span class="pln">put </span><span class="str">'lxw1234'</span><span class="pun">,</span><span class="str">'lxw1234.com'</span><span class="pun">,</span><span class="str">'f2:c1'</span><span class="pun">,</span><span class="str">'age1'</span></li><li class="L3"><span class="pln">put </span><span class="str">'lxw1234'</span><span class="pun">,</span><span class="str">'lxw1234.com'</span><span class="pun">,</span><span class="str">'f2:c2'</span><span class="pun">,</span><span class="str">'age2'</span></li><li class="L4"><span class="pln">put </span><span class="str">'lxw1234'</span><span class="pun">,</span><span class="str">'lxw1234.com'</span><span class="pun">,</span><span class="str">'f3:c1'</span><span class="pun">,</span><span class="str">'job1'</span></li><li class="L5"><span class="pln">put </span><span class="str">'lxw1234'</span><span class="pun">,</span><span class="str">'lxw1234.com'</span><span class="pun">,</span><span class="str">'f3:c2'</span><span class="pun">,</span><span class="str">'job2'</span></li><li class="L6"><span class="pln">put </span><span class="str">'lxw1234'</span><span class="pun">,</span><span class="str">'lxw1234.com'</span><span class="pun">,</span><span class="str">'f3:c3'</span><span class="pun">,</span><span class="str">'job3'</span></li></ol>
<p>完成后数据如下：</p>
<pre class="prettyprint linenums"></pre><ol class="linenums"><li class="L0"><span class="pln">hbase</span><span class="pun">(</span><span class="pln">main</span><span class="pun">):</span><span class="lit">025</span><span class="pun">:</span><span class="lit">0</span><span class="pun">*</span><span class="pln"> scan </span><span class="str">'lxw1234'</span></li><li class="L1"><span class="pln">ROW               COLUMN</span><span class="pun">+</span><span class="pln">CELL                                                                                                </span></li><li class="L2"><span class="pln"> lxw1234</span><span class="pun">.</span><span class="pln">com   column</span><span class="pun">=</span><span class="pln">f1</span><span class="pun">:</span><span class="pln">c1</span><span class="pun">,</span><span class="pln"> timestamp</span><span class="pun">=</span><span class="lit">1435624625198</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="pln">name1                                                         </span></li><li class="L3"><span class="pln"> lxw1234</span><span class="pun">.</span><span class="pln">com   column</span><span class="pun">=</span><span class="pln">f1</span><span class="pun">:</span><span class="pln">c2</span><span class="pun">,</span><span class="pln"> timestamp</span><span class="pun">=</span><span class="lit">1435624591717</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="pln">name2                                                         </span></li><li class="L4"><span class="pln"> lxw1234</span><span class="pun">.</span><span class="pln">com   column</span><span class="pun">=</span><span class="pln">f2</span><span class="pun">:</span><span class="pln">c1</span><span class="pun">,</span><span class="pln"> timestamp</span><span class="pun">=</span><span class="lit">1435624608759</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="pln">age1                                                          </span></li><li class="L5"><span class="pln"> lxw1234</span><span class="pun">.</span><span class="pln">com   column</span><span class="pun">=</span><span class="pln">f2</span><span class="pun">:</span><span class="pln">c2</span><span class="pun">,</span><span class="pln"> timestamp</span><span class="pun">=</span><span class="lit">1435624635261</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="pln">age2                                                          </span></li><li class="L6"><span class="pln"> lxw1234</span><span class="pun">.</span><span class="pln">com   column</span><span class="pun">=</span><span class="pln">f3</span><span class="pun">:</span><span class="pln">c1</span><span class="pun">,</span><span class="pln"> timestamp</span><span class="pun">=</span><span class="lit">1435624662282</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="pln">job1                                                          </span></li><li class="L7"><span class="pln"> lxw1234</span><span class="pun">.</span><span class="pln">com   column</span><span class="pun">=</span><span class="pln">f3</span><span class="pun">:</span><span class="pln">c2</span><span class="pun">,</span><span class="pln"> timestamp</span><span class="pun">=</span><span class="lit">1435624697028</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="pln">job2                                                          </span></li><li class="L8"><span class="pln"> lxw1234</span><span class="pun">.</span><span class="pln">com   column</span><span class="pun">=</span><span class="pln">f3</span><span class="pun">:</span><span class="pln">c3</span><span class="pun">,</span><span class="pln"> timestamp</span><span class="pun">=</span><span class="lit">1435624697065</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="pln">job3                                                          </span></li><li class="L9"><span class="lit">1</span><span class="pln"> row</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0.0350</span><span class="pln"> seconds</span></li></ol>
<h2>12.2 Hive中创建基于HBase的表</h2>
<p>在Hive中使用如下语句建表：</p>
<pre class="prettyprint linenums"></pre><ol class="linenums"><li class="L0"><span class="pln">SET hbase</span><span class="pun">.</span><span class="pln">zookeeper</span><span class="pun">.</span><span class="pln">quorum</span><span class="pun">=</span><span class="pln">zkNode1</span><span class="pun">,</span><span class="pln">zkNode2</span><span class="pun">,</span><span class="pln">zkNode3</span><span class="pun">;</span><span class="pln"> </span></li><li class="L1"><span class="pln">SET zookeeper</span><span class="pun">.</span><span class="pln">znode</span><span class="pun">.</span><span class="pln">parent</span><span class="pun">=</span><span class="str">/hbase;</span></li><li class="L2"><span class="str">ADD jar /</span><span class="pln">usr</span><span class="pun">/</span><span class="kwd">local</span><span class="pun">/</span><span class="pln">apache</span><span class="pun">-</span><span class="pln">hive</span><span class="pun">-</span><span class="lit">0.13</span><span class="pun">.</span><span class="lit">1</span><span class="pun">-</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">hive</span><span class="pun">-</span><span class="pln">hbase</span><span class="pun">-</span><span class="pln">handler</span><span class="pun">-</span><span class="lit">0.13</span><span class="pun">.</span><span class="lit">1.jar</span><span class="pun">;</span></li><li class="L3"><span class="pln"> </span></li><li class="L4"><span class="pln">CREATE EXTERNAL TABLE lxw1234 </span><span class="pun">(</span></li><li class="L5"><span class="pln">rowkey </span><span class="kwd">string</span><span class="pun">,</span></li><li class="L6"><span class="pln">f1 map</span><span class="pun">&lt;</span><span class="pln">STRING</span><span class="pun">,</span><span class="pln">STRING</span><span class="pun">&gt;,</span></li><li class="L7"><span class="pln">f2 map</span><span class="pun">&lt;</span><span class="pln">STRING</span><span class="pun">,</span><span class="pln">STRING</span><span class="pun">&gt;,</span></li><li class="L8"><span class="pln">f3 map</span><span class="pun">&lt;</span><span class="pln">STRING</span><span class="pun">,</span><span class="pln">STRING</span><span class="pun">&gt;</span></li><li class="L9"><span class="pun">)</span><span class="pln"> STORED BY </span><span class="str">'org.apache.hadoop.hive.hbase.HBaseStorageHandler'</span></li><li class="L0"><span class="pln">WITH SERDEPROPERTIES </span><span class="pun">(</span><span class="str">"hbase.columns.mapping"</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">":key,f1:,f2:,f3:"</span><span class="pun">)</span></li><li class="L1"><span class="pln">TBLPROPERTIES </span><span class="pun">(</span><span class="str">"hbase.table.name"</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"lxw1234"</span><span class="pun">);</span></li></ol>
<p>这里使用外部表映射到HBase中的表，这样，在Hive中删除表，并不会删除HBase中的表，否则，就会删除。</p>
<p>另外，除了rowkey，其他三个字段使用Map结构来保存HBase中的每一个列族。</p>
<p>其中，参数解释如下：</p>
<ul><li>hbase.zookeeper.quorum：</li></ul><p>指定HBase使用的zookeeper集群，默认端口是2181，可以不指定，如果指定，格式为zkNode1:2222,zkNode2:2222,zkNode3:2222</p>
<ul><li>zookeeper.znode.parent</li></ul><p>指定HBase在zookeeper中使用的根目录</p>
<ul><li>hbase.columns.mapping</li></ul><p>Hive表和HBase表的字段映射关系，分别为：Hive表中第一个字段映射:key(rowkey)，第二个字段映射列族f1，第三个字段映射列族f2,第四个字段映射列族f3</p>
<ul><li>hbase.table.name</li></ul><p>HBase中表的名字</p>
<p>         <span style="color:#ff0000;"><strong>也可以直接在Hive中创建表的同时，完成在HBase中创建表</strong>。</span></p>
<p>加入之前没有在HBase中创建表lxw1234,那么使用上面的语句在Hive创建表的时候，会同时在HBase中创建。</p>
<h2>12.3 Hive中查询HBase表</h2>
<p>上面在Hive中创建好表之后，直接查询：</p>
<pre class="prettyprint linenums"></pre><ol class="linenums"><li class="L0"><span class="pln">hive</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">select</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> lxw1234</span><span class="pun">;</span></li><li class="L1"><span class="pln">OK</span></li><li class="L2"><span class="pln">lxw1234</span><span class="pun">.</span><span class="pln">com     </span><span class="pun">{</span><span class="str">"c1"</span><span class="pun">:</span><span class="str">"name1"</span><span class="pun">,</span><span class="str">"c2"</span><span class="pun">:</span><span class="str">"name2"</span><span class="pun">}</span><span class="pln">     </span><span class="pun">{</span><span class="str">"c1"</span><span class="pun">:</span><span class="str">"age1"</span><span class="pun">,</span><span class="str">"c2"</span><span class="pun">:</span><span class="str">"age2"</span><span class="pun">}</span><span class="pln">       </span><span class="pun">{</span><span class="str">"c1"</span><span class="pun">:</span><span class="str">"job1"</span><span class="pun">,</span><span class="str">"c2"</span><span class="pun">:</span><span class="str">"job2"</span><span class="pun">,</span><span class="str">"c3"</span><span class="pun">:</span><span class="str">"job3"</span><span class="pun">}</span></li></ol>
<p> </p>
<p>可以看到，Hive中只有一行数据，因为只有一个rowkey，每一个列族的列和值，分别被存储到Map结构中。</p>
<h2>12.4 Hive中插入数据到HBase表</h2>
<p>可以在Hive表中通过Insert语句，完成对HBase表数据的插入。</p>
<p>比如，执行下面的语句：</p>
<pre class="prettyprint linenums"></pre><ol class="linenums"><li class="L0"><span class="pln">INSERT INTO TABLE lxw1234 </span></li><li class="L1"><span class="pln">SELECT </span><span class="str">'row1'</span><span class="pln"> AS rowkey</span><span class="pun">,</span></li><li class="L2"><span class="pln">map</span><span class="pun">(</span><span class="str">'c3'</span><span class="pun">,</span><span class="str">'name3'</span><span class="pun">)</span><span class="pln"> AS f1</span><span class="pun">,</span></li><li class="L3"><span class="pln">map</span><span class="pun">(</span><span class="str">'c3'</span><span class="pun">,</span><span class="str">'age3'</span><span class="pun">)</span><span class="pln"> AS f2</span><span class="pun">,</span></li><li class="L4"><span class="pln">map</span><span class="pun">(</span><span class="str">'c4'</span><span class="pun">,</span><span class="str">'job3'</span><span class="pun">)</span><span class="pln"> AS f3 </span></li><li class="L5"><span class="pln">FROM DUAL </span></li><li class="L6"><span class="pln">limit </span><span class="lit">1</span><span class="pun">;</span></li></ol>
<p>在HBase中查看数据：</p>
<pre class="prettyprint linenums"></pre><ol class="linenums"><li class="L0"><span class="pln">hbase</span><span class="pun">(</span><span class="pln">main</span><span class="pun">):</span><span class="lit">028</span><span class="pun">:</span><span class="lit">0</span><span class="pun">*</span><span class="pln"> scan </span><span class="str">'lxw1234'</span></li><li class="L1"><span class="pln">ROW            COLUMN</span><span class="pun">+</span><span class="pln">CELL                                                                                                </span></li><li class="L2"><span class="pln"> lxw1234</span><span class="pun">.</span><span class="pln">com   column</span><span class="pun">=</span><span class="pln">f1</span><span class="pun">:</span><span class="pln">c1</span><span class="pun">,</span><span class="pln"> timestamp</span><span class="pun">=</span><span class="lit">1435624625198</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="pln">name1                                                         </span></li><li class="L3"><span class="pln"> lxw1234</span><span class="pun">.</span><span class="pln">com   column</span><span class="pun">=</span><span class="pln">f1</span><span class="pun">:</span><span class="pln">c2</span><span class="pun">,</span><span class="pln"> timestamp</span><span class="pun">=</span><span class="lit">1435624591717</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="pln">name2                                                         </span></li><li class="L4"><span class="pln"> lxw1234</span><span class="pun">.</span><span class="pln">com   column</span><span class="pun">=</span><span class="pln">f2</span><span class="pun">:</span><span class="pln">c1</span><span class="pun">,</span><span class="pln"> timestamp</span><span class="pun">=</span><span class="lit">1435624608759</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="pln">age1                                                          </span></li><li class="L5"><span class="pln"> lxw1234</span><span class="pun">.</span><span class="pln">com   column</span><span class="pun">=</span><span class="pln">f2</span><span class="pun">:</span><span class="pln">c2</span><span class="pun">,</span><span class="pln"> timestamp</span><span class="pun">=</span><span class="lit">1435624635261</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="pln">age2                                                          </span></li><li class="L6"><span class="pln"> lxw1234</span><span class="pun">.</span><span class="pln">com   column</span><span class="pun">=</span><span class="pln">f3</span><span class="pun">:</span><span class="pln">c1</span><span class="pun">,</span><span class="pln"> timestamp</span><span class="pun">=</span><span class="lit">1435624662282</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="pln">job1                                                          </span></li><li class="L7"><span class="pln"> lxw1234</span><span class="pun">.</span><span class="pln">com   column</span><span class="pun">=</span><span class="pln">f3</span><span class="pun">:</span><span class="pln">c2</span><span class="pun">,</span><span class="pln"> timestamp</span><span class="pun">=</span><span class="lit">1435624697028</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="pln">job2                                                          </span></li><li class="L8"><span class="pln"> lxw1234</span><span class="pun">.</span><span class="pln">com   column</span><span class="pun">=</span><span class="pln">f3</span><span class="pun">:</span><span class="pln">c3</span><span class="pun">,</span><span class="pln"> timestamp</span><span class="pun">=</span><span class="lit">1435624697065</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="pln">job3                                                          </span></li><li class="L9"><span class="pln"> row1          column</span><span class="pun">=</span><span class="pln">f1</span><span class="pun">:</span><span class="pln">c3</span><span class="pun">,</span><span class="pln"> timestamp</span><span class="pun">=</span><span class="lit">1435625971410</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="pln">name3                                                         </span></li><li class="L0"><span class="pln"> row1          column</span><span class="pun">=</span><span class="pln">f2</span><span class="pun">:</span><span class="pln">c3</span><span class="pun">,</span><span class="pln"> timestamp</span><span class="pun">=</span><span class="lit">1435625971410</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="pln">age3                                                          </span></li><li class="L1"><span class="pln"> row1          column</span><span class="pun">=</span><span class="pln">f3</span><span class="pun">:</span><span class="pln">c4</span><span class="pun">,</span><span class="pln"> timestamp</span><span class="pun">=</span><span class="lit">1435625971410</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="pln">job3                                                          </span></li><li class="L2"><span class="lit">2</span><span class="pln"> row</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0.0420</span><span class="pln"> seconds</span></li></ol>
<p>Hive中的外部表lxw1234，就和其他外部表一样，只有一份元数据，真正的数据是在HBase表中，Hive通过hive-hbase-handler来操作HBase中的表。</p>
<p> </p>
<h3><a title="" href="http://lxw1234.com" rel="nofollow">Hive相关文章（持续更新）</a>：</h3>
<p><a title="" href="http://lxw1234.com/archives/tag/learn-hive" rel="nofollow">一起学Hive系列</a></p>
<p>—-<a title="" href="http://lxw1234.com/archives/2015/06/238.htm" rel="nofollow">Hive概述，Hive是什么</a></p>
<p>—-<a title="" href="http://lxw1234.com/archives/2015/06/251.htm" rel="nofollow">Hive函数大全-完整版</a></p>
<p>—-<a title="" href="http://lxw1234.com/archives/2015/06/265.htm" rel="nofollow">Hive中的数据库(Database)和表(Table)</a></p>
<p>—-<a title="" href="http://lxw1234.com/archives/2015/06/269.htm" rel="nofollow">Hive的安装配置</a></p>
<p>—-<a title="" href="http://lxw1234.com/archives/2015/06/284.htm" rel="nofollow">Hive的视图和分区</a></p>
<p>—-<a title="" href="http://lxw1234.com/archives/2015/06/286.htm" rel="nofollow">Hive的动态分区</a></p>
<p>—-<a title="" href="http://lxw1234.com/archives/2015/06/290.htm" rel="nofollow">向Hive表中加载数据</a></p>
<p>—-<a title="" href="http://lxw1234.com/archives/2015/06/292.htm" rel="nofollow">使用Hive命令行</a></p>
<p>—-<a title="" href="http://lxw1234.com/archives/2015/06/307.htm" rel="nofollow">Hive的查询语句SELECT</a></p>
<p>—-<a title="" href="http://lxw1234.com/archives/2015/06/313.htm" rel="nofollow">Hive中Join的原理和机制</a></p>
<p>—-<a title="" href="http://lxw1234.com/archives/2015/06/315.htm" rel="nofollow">Hive中Join的类型和用法</a></p>
<p>—-<a title="" href="http://lxw1234.com/archives/2015/06/317.htm" rel="nofollow">Hive SQL的优化</a></p>
<p><a title="" href="http://lxw1234.com/archives/tag/hive-window-functions" rel="nofollow">Hive分析函数系列</a></p>
<p><a title="" href="http://lxw1234.com/archives/2015/05/207.htm" rel="nofollow">Hive索引</a></p>
<p><a title="" href="http://lxw1234.com/archives/2015/04/15.htm" rel="nofollow">hive优化之——控制hive任务中的map数和reduce数</a></p>
<br>            </div>
                </div>