---
layout:     post
title:      hive基础学习文档和入门教程
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<div style="border:0px; font-family:Arial,sans-serif; font-size:15px; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(55,55,55); line-height:23px; background-color:rgb(247,247,247); text-indent:2em">
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<span class="link_title" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">原文：<a href="http://blog.csdn.net/haojun186/article/details/7977565" rel="nofollow" target="_blank" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">HIVE学习笔记</a></span></h3>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<span class="link_title" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">原文地址：HTTP://BLOG.CSDN.NET/HAOJUN186/ARTICLE/DETAILS/7977565<a href="http://blog.csdn.net/haojun186/article/details/7977565" rel="nofollow" target="_blank" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial"><br>
</a></span></h3>
<div style="border:1px solid rgb(204,204,204); font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:4px 10px; vertical-align:baseline; background-color:rgb(238,238,238); float:left; min-width:200px">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:0px; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline; text-align:right">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; float:left">目录<a title="系统根据文章中H1到H6标签自动生成文章目录" href="http://blog.didu.me/article/518#" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">(?)</a></span><a title="收起" href="http://blog.didu.me/article/518#" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">[-]</a></p>
<ol style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 1.625em 14px; outline:0px; padding:0px 0px 0px 14px; vertical-align:baseline; list-style-position:initial; line-height:24px">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t0" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">HIVE结构</a>
<ol style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:upper-alpha">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t1" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">HIVE架构</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t2" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">Hive<br>
和Hadoop 关系</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t3" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">Hive<br>
和普通关系数据库的异同</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t4" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">HIVE元数据库</a>
<ol style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:lower-roman">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t5" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">DERBY</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t6" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">Mysql</a></li></ol>
</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t7" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">HIVE的数据存储</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t8" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">其它HIVE操作</a></li></ol>
</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t9" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">HIVE 基本操作</a>
<ol style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:upper-alpha">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t10" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">createtable</a>
<ol style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:lower-roman">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t11" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">总述</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t12" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">语法</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t13" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">基本例子</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t14" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">创建分区</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t15" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">其它例子</a></li></ol>
</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t16" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">AlterTable</a>
<ol style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:lower-roman">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t17" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">AddPartitions</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t18" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">DropPartitions</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t19" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">RenameTable</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t20" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">ChangeColumn</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t21" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">AddReplaceColumns</a></li></ol>
</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t22" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">CreateView</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t23" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">Show</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t24" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">Load</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t25" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">Insert</a>
<ol style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:lower-roman">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t26" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">Inserting data into HiveTables from queries</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t27" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">Writing data intofilesystem from queries</a></li></ol>
</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t28" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">Cli王黎3 </a>
<ol style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:lower-roman">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t29" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">HiveCommand line Options</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t30" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">Hiveinteractive Shell Command</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t31" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">Hive Resources</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t32" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">调用pythonshell等语言</a></li></ol>
</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t33" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">DROP</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t34" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">其它</a>
<ol style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:lower-roman">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t35" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">Limit</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t36" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">Top k</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t37" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">REGEX Column Specification</a></li></ol>
</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t38" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">Hive Select</a>
<ol style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:lower-roman">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t39" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">GroupBy</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t40" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">OrderSort By</a></li></ol>
</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t41" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">Hive Join</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t42" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">HIVE参数设置</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t43" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">HIVE UDF</a>
<ol style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:lower-roman">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t44" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">基本函数</a>
<ol style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:lower-alpha">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t45" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">关系操作符</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t46" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">代数操作符</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t47" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">逻辑操作符</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t48" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">复杂类型操作符</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t49" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">内建函数</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t50" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">数学函数</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t51" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">集合函数</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t52" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">类型转换</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t53" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">日期函数</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t54" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">条件函数<br>
</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t55" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">字符串函数<br>
</a></li></ol>
</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t56" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">UDTF</a>
<ol style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:lower-alpha">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t57" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">Explode</a></li></ol>
</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t58" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">HIVE 的MAPREDUCE</a>
<ol style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:lower-alpha">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t59" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">JOIN</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t60" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">GROUPBY</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t61" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">DISTINCT</a></li></ol>
</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t62" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">使用HIVE注意点</a>
<ol style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:lower-alpha">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t63" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">字符集</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t64" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">压缩</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t65" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">countdistinct</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t66" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">JOIN</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t67" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">DML操作</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t68" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">HAVING</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t69" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">子查询</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t70" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">Join中处理null值的语义区别</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t71" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">分号字符</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t72" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">Insert</a>
<ol style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:lower-alpha">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t73" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">新增数据</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t74" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">插入次序</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t75" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">初始值</a></li></ol>
</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t76" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">优化</a>
<ol style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:lower-alpha">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t77" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">HADOOP计算框架特性</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t78" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">优化的常用手段</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t79" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">全排序</a>
<ol style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:lower-alpha">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t80" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">例1</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t81" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">例2</a></li></ol>
</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t82" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">怎样做笛卡尔积</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t83" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">怎样写existin子句</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t84" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">怎样决定reducer个数</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t85" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">合并MapReduce操作</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t86" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">Bucket<br>
与sampling</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t87" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">Partition</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t88" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">JOIN</a>
<ol style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:lower-alpha">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t89" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">JOIN原则</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t90" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">Map Join<br>
</a></li></ol>
</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t91" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">数据倾斜</a>
<ol style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:lower-alpha">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t92" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">空值数据倾斜</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t93" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">不同数据类型关联产生数据倾斜</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t94" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">大表Join的数据偏斜</a></li></ol>
</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t95" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">合并小文件</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t96" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">GroupBy<br>
</a></li></ol>
</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t97" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">HIVE FAQ</a></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<a href="http://blog.didu.me/article/518#t98" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">常用参考资料路径</a></li></ol>
</li></ol>
</li></ol>
</li></ol>
</div>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both">
</div>
<div id="article_content" class="article_content" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<h1 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t0" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280790998" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>1.  HIVE结构</h1>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Hive 是建立在 Hadoop 上的数据仓库基础构架。它提供了一系列的工具，可以用来进行数据提取转化加载（ETL），这是一种可以存储、查询和分析存储在 Hadoop 中的大规模数据的机制。Hive 定义了简单的类 SQL 查询语言，称为 QL，它允许熟悉 SQL 的用户查询数据。同时，这个语言也允许熟悉 MapReduce 开发者的开发自定义的 mapper 和 reducer 来处理内建的 mapper 和 reducer 无法完成的复杂的分析工作。</p>
<h2 align="left" style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t1" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280790999" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">1.1 </span>HIVE架构</h2>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Hive 的结构可以分为以下几部分：</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
·        用户接口：包括 CLI, Client, WUI</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
·        元数据存储。通常是存储在关系数据库如 mysql, derby 中</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
·        解释器、编译器、优化器、执行器</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
·        Hadoop：用 HDFS 进行存储，利用MapReduce 进行计算</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1、 用户接口主要有三个：CLI，Client和 WUI。其中最常用的是 CLI，Cli 启动的时候，会同时启动一个 Hive 副本。Client 是 Hive 的客户端，用户连接至 Hive Server。在启动 Client 模式的时候，需要指出 Hive Server 所在节点，并且在该节点启动 Hive Server。 WUI 是通过浏览器访问 Hive。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
2、 Hive 将元数据存储在数据库中，如 mysql、derby。Hive 中的元数据包括表的名字，表的列和分区及其属性，表的属性（是否为外部表等），表的数据所在目录等。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
3、 解释器、编译器、优化器完成 HQL 查询语句从词法分析、语法分析、编译、优化以及查询计划的生成。生成的查询计划存储在 HDFS 中，并在随后有 MapReduce 调用执行。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
4、Hive 的数据存储在 HDFS 中，大部分的查询由 MapReduce 完成（包含 * 的查询，比如 select * from tbl 不会生成 MapRedcue 任务）。</p>
<h2 align="left" style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t2" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791000" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">1.2 </span>Hive<br>
和Hadoop 关系</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Hive构建在 Hadoop 之上，</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
·        HQL 中对查询语句的解释、优化、生成查询计划是由 Hive 完成的</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
·        所有的数据都是存储在 Hadoop 中</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
·        查询计划被转化为 MapReduce 任务，在 Hadoop 中执行（有些查询没有 MR 任务，如：select * from table）</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
·        Hadoop和Hive都是用UTF-8编码的</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h2 align="left" style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t3" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791001" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">1.3 </span>Hive<br>
和普通关系数据库的异同</h2>
<table class="alignleft" border="1" cellspacing="0" cellpadding="0" style="border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 1.625em; outline:0px; padding:0px; vertical-align:baseline; border-spacing:0px; display:inline; float:left; width:688px">
<tbody style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline; background-color:rgb(60,179,113)">
 </td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline; background-color:rgb(60,179,113)">
Hive</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline; background-color:rgb(60,179,113)">
RDBMS</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline; background-color:rgb(60,179,113)">
查询语言</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline; background-color:rgb(240,255,240)">
HQL</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline; background-color:rgb(240,255,240)">
SQL</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline; background-color:rgb(60,179,113)">
数据存储</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline; background-color:rgb(245,245,245)">
HDFS</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline; background-color:rgb(245,245,245)">
Raw Device or Local FS</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline; background-color:rgb(60,179,113)">
索引</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline; background-color:rgb(240,255,240)">
无</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline; background-color:rgb(240,255,240)">
有</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline; background-color:rgb(60,179,113)">
执行</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline; background-color:rgb(245,245,245)">
MapReduce</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline; background-color:rgb(245,245,245)">
Excutor</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline; background-color:rgb(60,179,113)">
执行延迟</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline; background-color:rgb(240,255,240)">
高</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline; background-color:rgb(240,255,240)">
低</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline; background-color:rgb(60,179,113)">
处理数据规模</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline; background-color:rgb(245,245,245)">
大</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline; background-color:rgb(245,245,245)">
小</td>
</tr>
</tbody>
</table>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.  查询语言。由于 SQL 被广泛的应用在数据仓库中，因此，专门针对 Hive 的特性设计了类 SQL 的查询语言 HQL。熟悉 SQL 开发的开发者可以很方便的使用 Hive 进行开发。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
2.  数据存储位置。Hive 是建立在Hadoop 之上的，所有 Hive 的数据都是存储在HDFS 中的。而数据库则可以将数据保存在块设备或者本地文件系统中。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
3.  数据格式。Hive 中没有定义专门的数据格式，数据格式可以由用户指定，用户定义数据格式需要指定三个属性：列分隔符（通常为空格、”\t”、”\x001″）、行分隔符（”\n”）以及读取文件数据的方法（Hive 中默认有三个文件格式 TextFile，SequenceFile 以及 RCFile）。由于在加载数据的过程中，不需要从用户数据格式到 Hive 定义的数据格式的转换，因此，Hive 在加载的过程中不会对数据本身进行任何修改，而只是将数据内容复制或者移动到相应的 HDFS<br>
目录中。而在数据库中，不同的数据库有不同的存储引擎，定义了自己的数据格式。所有数据都会按照一定的组织存储，因此，数据库加载数据的过程会比较耗时。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
4.  数据更新。由于 Hive 是针对数据仓库应用设计的，而数据仓库的内容是读多写少的。因此，Hive 中不支持对数据的改写和添加，所有的数据都是在加载的时候中确定好的。而数据库中的数据通常是需要经常进行修改的，因此可以使用 INSERT INTO …  VALUES 添加数据，使用 UPDATE… SET 修改数据。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
5.  索引。之前已经说过，Hive 在加载数据的过程中不会对数据进行任何处理，甚至不会对数据进行扫描，因此也没有对数据中的某些 Key 建立索引。Hive 要访问数据中满足条件的特定值时，需要暴力扫描整个数据，因此访问延迟较高。由于 MapReduce 的引入， Hive 可以并行访问数据，因此即使没有索引，对于大数据量的访问，Hive 仍然可以体现出优势。数据库中，通常会针对一个或者几个列建立索引，因此对于少量的特定条件的数据的访问，数据库可以有很高的效率，较低的延迟。由于数据的访问延迟较高，决定了<br>
Hive 不适合在线数据查询。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
6.  执行。Hive 中大多数查询的执行是通过 Hadoop 提供的 MapReduce 来实现的（类似 select * from tbl 的查询不需要 MapReduce）。而数据库通常有自己的执行引擎。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
7.  执行延迟。之前提到，Hive 在查询数据的时候，由于没有索引，需要扫描整个表，因此延迟较高。另外一个导致 Hive 执行延迟高的因素是 MapReduce 框架。由于 MapReduce 本身具有较高的延迟，因此在利用 MapReduce 执行 Hive 查询时，也会有较高的延迟。相对的，数据库的执行延迟较低。当然，这个低是有条件的，即数据规模较小，当数据规模大到超过数据库的处理能力的时候，Hive 的并行计算显然能体现出优势。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
8.  可扩展性。由于 Hive 是建立在 Hadoop 之上的，因此 Hive 的可扩展性是和 Hadoop 的可扩展性是一致的（世界上最大的 Hadoop 集群在 Yahoo!，2009年的规模在4000 台节点左右）。而数据库由于 ACID 语义的严格限制，扩展行非常有限。目前最先进的并行数据库 Oracle 在理论上的扩展能力也只有 100 台左右。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
9. 数据规模。由于 Hive 建立在集群上并可以利用 MapReduce 进行并行计算，因此可以支持很大规模的数据；对应的，数据库可以支持的数据规模较小。</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t4" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791002" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">1.4 </span>HIVE元数据库</h2>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Hive 将元数据存储在 RDBMS 中,一般常用的有MYSQL和DERBY。</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t5" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791003" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>1.4.1     DERBY</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
启动HIVE的元数据库</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
进入到hive的安装目录</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Eg:</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1、启动derby数据库</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
/home/admin/caona/hive/build/dist/</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
运行startNetworkServer -h 0.0.0.0</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
2、连接Derby数据库进行测试</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
查看/home/admin/caona/hive/build/dist/conf/hive-default.xml。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
找到&lt;property&gt;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
&lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
&lt;value&gt;jdbc:derby://hadoop1:1527/metastore_db;create=true&lt;/value&gt;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
&lt;description&gt;JDBC connect string for a JDBCmetastore&lt;/description&gt;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
&lt;/property&gt;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
进入derby安装目录</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
/home/admin/caona/hive/build/dist/db-derby-10.4.1.3-bin/bin</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
输入./ij</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Connect’jdbc:derby://hadoop1:1527/metastore_db;create=true’;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
3、元数据库数据字典</p>
<table class="alignleft " border="0" cellspacing="0" cellpadding="0" style="border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 1.625em; outline:0px; padding:0px; vertical-align:baseline; border-spacing:0px; display:inline; float:left; width:688px">
<tbody style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">表名</span></p>
</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">说明</span></p>
</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">关联键</span></p>
</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">BUCKETING_COLS        </span></p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
 </td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
 </td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">    </span>COLUMNS</p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Hive</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">表字段信息(</span>字段注释，字段名，字段类型，字段序号)</p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">SD_ID</span></p>
</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">DBS</span></p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">　元数据库信息，存放HDFS</span>路径信息</p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">DB_ID</span></p>
</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">PARTITION_KEYS        </span></p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Hive</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">分区表分区键</span></p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">PART_ID</span></p>
</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">SDS                   </span></p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">所有hive</span>表、表分区所对应的hdfs数据目录和数据格式。</p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">SD_ID,SERDE_ID</span></p>
</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">SD_PARAMS             </span></p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">序列化反序列化信息，如行分隔符、列分隔符、NULL</span>的表示字符等</p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">SERDE_ID</span></p>
</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">SEQUENCE_TABLE        </span></p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">SEQUENCE_TABLE</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">表保存了hive</span>对象的下一个可用ID，如’org.apache.hadoop.hive.metastore.model.MTable’,
 21，则下一个新创建的hive表其TBL_ID就是21，同时SEQUENCE_TABLE表中271786被更新为26(这里每次都是+5?)。同样，COLUMN，PARTITION等都有相应的记录</p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
 </td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">SERDES                </span></p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
 </td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
 </td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">SERDE_PARAMS          </span></p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
 </td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
 </td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">SORT_COLS             </span></p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
 </td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
 </td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">TABLE_PARAMS          </span></p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">表级属性，如是否外部表，表注释等</span></p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">TBL_ID</span></p>
</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">TBLS                  </span></p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">所有hive</span>表的基本信息</p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">TBL_ID,SD_ID</span></p>
</td>
</tr>
</tbody>
</table>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
从上面几张表的内容来看，hive整个创建表的过程已经比较清楚了</p>
<ol type="1" start="1" style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 1.625em 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style-position:initial">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
解析用户提交hive语句，对其进行解析，分解为表、字段、分区等hive对象</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
根据解析到的信息构建对应的表、字段、分区等对象，从SEQUENCE_TABLE中获取构建对象的最新ID，与构建对象信息(名称，类型等)一同通过DAO方法写入到元数据表中去，成功后将SEQUENCE_TABLE中对应的最新ID+5。</li></ol>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
实际上我们常见的RDBMS都是通过这种方法进行组织的，典型的如postgresql，其系统表中和hive元数据一样裸露了这些id信息(oid,cid等),而Oracle等商业化的系统则隐藏了这些具体的ID。通过这些元数据我们可以很容易的读到数据诸如创建一个表的数据字典信息，比如导出建表语名等。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:yellow">导出建表语句的shell</span>脚本见<span style="border:0px; font-family:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">附一
 待完成</span></p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t6" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791004" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>1.4.2     MYSQL</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
将存放元数据的Derby数据库迁移到Mysql数据库</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
步骤：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h2 align="left" style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t7" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791005" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">1.5 </span>HIVE的数据存储</h2>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
    首先，Hive 没有专门的数据存储格式，也没有为数据建立索引，用户可以非常自由的组织 Hive 中的表，只需要在创建表的时候告诉 Hive 数据中的列分隔符和行分隔符，Hive 就可以解析数据。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
其次，Hive 中所有的数据都存储在 HDFS 中，Hive 中包含以下数据模型：Table，External Table，Partition，Bucket。</p>
<ol type="1" start="1" style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 1.625em 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style-position:initial">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
Hive 中的 Table 和数据库中的 Table 在概念上是类似的，每一个 Table 在 Hive 中都有一个相应的目录存储数据。例如，一个表 xiaojun，它在 HDFS 中的路径为：/ warehouse /xiaojun，其中，wh 是在 hive-site.xml 中由 ${hive.metastore.warehouse.dir} 指定的数据仓库的目录，所有的 Table 数据（不包括 External Table）都保存在这个目录中。</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
Partition 对应于数据库中的 Partition 列的密集索引，但是 Hive 中 Partition 的组织方式和数据库中的很不相同。在 Hive 中，表中的一个 Partition 对应于表下的一个目录，所有的 Partition 的数据都存储在对应的目录中。例如：xiaojun 表中包含 dt 和 city 两个 Partition，则对应于 dt = 20100801, ctry = US 的 HDFS 子目录为：/ warehouse /xiaojun/dt=20100801/ctry=US；对应于<br>
dt = 20100801, ctry = CA 的 HDFS 子目录为；/ warehouse /xiaojun/dt=20100801/ctry=CA</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
Buckets 对指定列计算 hash，根据 hash 值切分数据，目的是为了并行，每一个 Bucket 对应一个文件。将 user 列分散至 32 个 bucket，首先对 user 列的值计算 hash，对应 hash 值为 0 的 HDFS 目录为：/ warehouse /xiaojun/dt =20100801/ctry=US/part-00000；hash 值为 20 的 HDFS 目录为：/ warehouse /xiaojun/dt =20100801/ctry=US/part-00020</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
External Table 指向已经在 HDFS 中存在的数据，可以创建 Partition。它和 Table 在元数据的组织上是相同的，而实际数据的存储则有较大的差异。</li></ol>
<ul type="disc" style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 1.625em 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:square">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
Table 的创建过程和数据加载过程（这两个过程可以在同一个语句中完成），在加载数据的过程中，实际数据会被移动到数据仓库目录中；之后对数据对访问将会直接在数据仓库目录中完成。删除表时，表中的数据和元数据将会被同时删除。</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
External Table 只有一个过程，加载数据和创建表同时完成（CREATE EXTERNAL TABLE ……LOCATION），实际数据是存储在 LOCATION 后面指定的 HDFS 路径中，并不会移动到数据仓库目录中。当删除一个 External Table 时，仅删除</li></ul>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h2 align="left" style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t8" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791006" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">1.6 </span>其它HIVE操作</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1、 启动HIVE的WEB的界面</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(51,51,51)">sh $HIVE_HOME/bin/hive –service hwi</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(51,51,51)"> </span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
2、查看HDFS上的文件数据</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
hadoopfs -text /user/admin/daiqf/createspu_fp/input/cateinfo |head</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h1 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t9" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791007" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>2.  HIVE
 基本操作</h1>
<h2 align="left" style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t10" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791008" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">2.1 </span>createtable</h2>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t11" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791009" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>2.1.1   
 总述</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
l  CREATETABLE 创建一个指定名字的表。如果相同名字的表已经存在，则抛出异常；用户可以用 IF NOT EXIST 选项来忽略这个异常。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
l  EXTERNAL关键字可以让用户<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:red">创建一个外部表，在建表的同时指定一个指向实际数据的路径（LOCATION</span>），Hive<br>
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:red">创建内部表时，会将数据移动到数据仓库指向的路径；若创建外部表，仅记录数据所在的路径，不对数据的位置做任何改变。在删除表的时候，内部表的元数据和数据会被一起删除，而外部表只删除元数据，不删除数据。</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
l  LIKE 允许用户复制现有的表结构，但是不复制数据。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
l  用户在建表的时候可以自定义 SerDe 或者使用自带的 SerDe。如果没有指定 ROW FORMAT 或者 ROW FORMAT DELIMITED，将会使用自带的 SerDe。在建表的时候，用户还需要为表指定列，用户在指定表的列的同时也会指定自定义的SerDe，Hive 通过 SerDe 确定表的具体的列的数据。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
l  如果文件数据是纯文本，可以使用 STORED AS TEXTFILE。如果数据需要压缩，使用 STORED ASSEQUENCE 。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
l  有分区的表可以在创建的时候使用 PARTITIONED BY 语句。一个表可以拥有一个或者多个分区，每一个分区单独存在一个目录下。而且，表和分区都可以对某个列进行 CLUSTERED BY 操作，将若干个列放入一个桶（bucket）中。也可以利用SORT BY 对数据进行排序。这样可以为特定应用提高性能。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
l  表名和列名不区分大小写，SerDe 和属性名区分大小写。表和列的注释是字符串。</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t12" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791010" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>2.1.2   
 语法</h3>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">CREATE [EXTERNAL] TABLE [IF NOT EXISTS] table_name</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>[(col_namedata_type [COMMENT col_comment], …)]</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>[COMMENTtable_comment]</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>[PARTITIONED BY(col_name data_type [COMMENT col_comment], …)]</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>[CLUSTERED BY(col_name, col_name, ...) [SORTED BY (col_name [ASC|DESC], …)] INTOnum_buckets BUCKETS]</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>[</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">   </span>[ROW FORMATrow_format] [STORED AS file_format]</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">   </span>| STORED BY’storage.handler.class.name’ [ WITH SERDEPROPERTIES (...) ]  (Note: only available starting with
 0.6.0)</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>]</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>[LOCATIONhdfs_path]</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>[TBLPROPERTIES(property_name=property_value, ...)] (Note:  only available startingwith 0.6.0)</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>[ASselect_statement]  (Note: this feature isonly available starting with 0.5.0.)</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">CREATE [EXTERNAL] TABLE [IF NOT EXISTS] table_name</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>LIKEexisting_table_name</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>[LOCATIONhdfs_path]</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">data_type</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>: primitive_type</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>| array_type</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>| map_type</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>| struct_type</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">primitive_type</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>: TINYINT</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>| SMALLINT</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>| INT</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>| BIGINT</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>| BOOLEAN</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>| FLOAT</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>| DOUBLE</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>| STRING</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">array_type</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>: ARRAY &lt;data_type &gt;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">map_type</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>: MAP &lt;primitive_type, data_type &gt;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">struct_type</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>: STRUCT &lt;col_name : data_type [COMMENT col_comment], …&gt;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">row_format</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>: DELIMITED[FIELDS TERMINATED BY char] [COLLECTION ITEMS TERMINATED BY char]</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">        </span><br>
[MAP KEYSTERMINATED BY char] [LINES TERMINATED BY char]</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>| SERDEserde_name [WITH SERDEPROPERTIES (property_name=property_value,property_name=property_value, ...)]</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">file_format:</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>: SEQUENCEFILE</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>| TEXTFILE</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>| RCFILE     (Note: only available starting with 0.6.0)</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>| INPUTFORMATinput_format_classname OUTPUTFORMAT output_format_classname<a name="_Toc280791011" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
目前在hive中常用的数据类型有:</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
BIGINT – 主要用于状态,类别,数量的字段, 如status/option/type/quantity</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
DOUBLE – 主要用于金额的字段, 如fee/price/bid</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
STRING – 除上述之外的字段基本都使用String, 尤其是id和日期时间这样的字段</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t13" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>2.1.3     基本例子</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1、如果一个表已经存在，可以使用if not exists</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
2、 create table xiaojun(id int,cont string) row format delimitedfields terminated by ‘\005′ stored as textfile;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
terminated by：关于来源的文本数据的字段间隔符</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
如果要将自定义间隔符的文件读入一个表，需要通过创建表的语句来指明输入文件间隔符，然后load data到这个表。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
4、Alibaba数据库常用间隔符的读取</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
我们的常用间隔符一般是Ascii码5，Ascii码7等。在hive中Ascii码5用’\005’表示， Ascii码7用’\007’表示，依此类推。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
5、装载数据</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
查看一下：Hadoop fs -ls</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
LOAD DATA INPATH’/user/admin/xiaojun/a.txt’ OVERWRITE INTO TABLE xiaojun;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
6、如果使用external建表和普通建表区别</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
A、指定一个位置，而不使用默认的位置。如：</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
create  EXTERNAL table xiaojun(id int,cont string) row format delimited fields terminatedby ‘\005′ stored as textfile location ‘/user/admin/xiaojun/’;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
————–check结果</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
ij&gt; selectLOCATION from tbls a,sds b where a.sd_id=b.sd_id and tbl_name=’xiaojun’;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
—–</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
LOCATION</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
——————————————————————————————————————————–</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
hdfs://hadoop1:7000/user/admin/xiaojun</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
ij&gt; selectLOCATION from tbls a,sds b where a.sd_id=b.sd_id and tbl_name=’c';</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
—-</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
LOCATION</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
——————————————————————————————————————————–</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
hdfs://hadoop1:7000/user/hive/warehouse/c</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
B、对于使用create table external建表完成后，再drop掉表，表中的数据还在文件系统中。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
如：</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
hive&gt;create  EXTERNAL  table xiaojun(id int,cont string) row formatdelimited fields terminated by ‘\005′ stored as textfile;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
—-</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
OK</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
hive&gt; LOADDATA INPATH ‘/user/admin/xiaojun’ OVERWRITE INTO TABLE xiaojun;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
————————————————–</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Loading data totable xiaojun</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
OK</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
hive&gt; droptable xiaojun;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
—-</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
OK</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
[admin@hadoop1bin]$ ./hadoop fs -ls hdfs://hadoop1:7000/user/hive/warehouse/xiaojun</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Found 1 items</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
使用普通的建表DROP后则找不到</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t14" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791012" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>2.1.4   
 创建分区</h3>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
   HIVE的分区通过在创建表时启用partitionby实现，用来partition的维度并不是实际数据的某一列，具体分区的标志是由插入内容时给定的。当要查询某一分区的内容时可以采用where语句，形似where tablename.partition_key &gt;a来实现。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
创建含分区的表。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
命令原型：</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">CREATE TABLE page_view(viewTime INT, userid BIGINT,</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">     </span><br>
page_urlSTRING, referrer_url STRING,</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">     </span><br>
ip STRINGCOMMENT ‘IP Address of the User’)</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span>COMMENT ‘This isthe page view table’</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span>PARTITIONED BY(dtSTRING, country STRING)</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span>CLUSTEREDBY(userid) SORTED BY(viewTime) INTO 32 BUCKETS</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span>ROW FORMATDELIMITED</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">   </span>FIELDSTERMINATED BY ‘\001′</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">   </span>COLLECTION ITEMSTERMINATED BY ‘\002′</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">   </span>MAP KEYSTERMINATED BY ‘\003′</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span>STORED ASSEQUENCEFILE;</p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Eg:</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
建表：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
CREATE TABLE c02_clickstat_fatdt1</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
(yyyymmdd  string,</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
id              INT,</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
ip               string,</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
country          string,</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
cookie_id        string,</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
page_id          string  ,</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
clickstat_url_id int,</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
query_string     string,</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
refer            string</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
)PARTITIONED BY(dt STRING)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
row format delimited fields terminated by ‘\005′ stored astextfile;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
装载数据：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
LOAD DATA INPATH’/user/admin/SqlldrDat/CnClickstat/20101101/19/clickstat_gp_fatdt0/0′ OVERWRITEINTO TABLE c02_clickstat_fatdt1</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
PARTITION(dt=’20101101′);</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
访问某一个分区</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT count(*)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
FROMc02_clickstat_fatdt1 a</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
WHERE a.dt &gt;=’20101101′ AND a.dt &lt; ’20101102′;</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t15" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791013" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>2.1.5   
 其它例子</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1、指定LOCATION位置</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">CREATE EXTERNAL TABLE page_view(viewTime INT, useridBIGINT,</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">     </span><br>
page_urlSTRING, referrer_url STRING,</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">     </span><br>
ip STRING COMMENT’IP Address of the User’,</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">     </span><br>
country STRINGCOMMENT ‘country of origination’)</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span>COMMENT ‘This isthe staging page view table’</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span>ROW FORMATDELIMITED FIELDS TERMINATED BY ‘\054′</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span>STORED AS TEXTFILE</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span>LOCATION’&lt;hdfs_location&gt;’;</p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
2、 复制一个空表</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">CREATE TABLE empty_key_value_store</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">LIKE key_value_store;</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h2 align="left" style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t16" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791014" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">2.2 </span>AlterTable</h2>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t17" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791015" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>2.2.1   
 ADDPARTITIONS</h3>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">ALTER TABLE table_name ADD [IF NOT EXISTS] partition_spec[ LOCATION 'location1' ] partition_spec [ LOCATION 'location2'
 ] …</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">partition_spec:</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>: PARTITION(partition_col = partition_col_value, partition_col = partiton_col_value, …)</p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Eg:</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
ALTER TABLE c02_clickstat_fatdt1 ADD</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
PARTITION (dt=’20101202′) location’/user/hive/warehouse/c02_clickstat_fatdt1/part20101202′</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
PARTITION (dt=’20101203′) location’/user/hive/warehouse/c02_clickstat_fatdt1/part20101203′;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t18" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791016" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>2.2.2   
 DROPPARTITIONS</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">ALTER TABLE table_name DROP partition_spec, partition_spec,…</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
ALTER TABLE c02_clickstat_fatdt1 DROP PARTITION(dt=’20101202′);</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t19" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791017" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>2.2.3   
 RENAMETABLE</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">ALTER TABLE table_name RENAME TO new_table_name</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
这个命令可以让用户为表更名。数据所在的位置和分区名并不改变。换而言之，老的表名并未“释放”，对老表的更改会改变新表的数据。</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t20" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791018" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>2.2.4   
 CHANGECOLUMN</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">ALTER TABLE table_name CHANGE [COLUMN] col_old_name col_new_namecolumn_type [COMMENT col_comment] [FIRST|AFTER column_name]</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
这个命令可以允许改变列名、数据类型、注释、列位置或者它们的任意组合</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Eg:</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t21" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791019" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>2.2.5   
 ADD/REPLACECOLUMNS</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">ALTER TABLE table_name ADD|REPLACE COLUMNS (col_name data_type[COMMENT col_comment], …)</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
ADD是代表新增一字段，字段位置在所有列后面(partition列前);REPLACE则是表示替换表中所有字段。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Eg:</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
hive&gt; desc xi;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
OK</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
id      int</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
cont    string</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
dw_ins_date     string</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Time taken: 0.061 seconds</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
hive&gt; create table xibak like xi;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
OK</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Time taken: 0.157 seconds</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
hive&gt; alter table xibak replace columns (ins_datestring);</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
OK</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Time taken: 0.109 seconds</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
hive&gt; desc xibak;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
OK</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
ins_date        string</p>
<h2 align="left" style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t22" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791020" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">2.3 </span>CreateView</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">CREATE VIEW [IF NOT EXISTS] view_name [ (column_name [COMMENTcolumn_comment], …) ]</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">[COMMENT view_comment]</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">[TBLPROPERTIES (property_name = property_value, ...)]</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">AS SELECT …</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h2 align="left" style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t23" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791021" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">2.4 </span>Show</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
查看表名</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">SHOWTABLES;</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
查看表名，部分匹配</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">SHOWTABLES ‘page.*’;</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">SHOWTABLES ‘.*view’;</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
查看某表的所有Partition，如果没有就报错：</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">SHOWPARTITIONS page_view;</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
查看某表结构：</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">DESCRIBE <span style="border:0px; font-family:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">invites</span>;</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
查看分区内容</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">SELECTa.foo FROM invites a WHERE a.<a style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)">ds</a></span><a id="_anchor_1" name="_msoanchor_1" href="http://blog.didu.me/article/518#_msocom_1" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial"></a><span style="border:0px; font-family:宋体; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">[王黎1]</span> <span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">=’2008-08-15′;</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
查看有限行内容，同Greenplum，用limit关键词</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">SELECTa.foo FROM invites a limit 3;</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
查看表分区定义</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">DESCRIBE <a style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"><br>
EXTENDED</a></span><a id="_anchor_2" name="_msoanchor_2" href="http://blog.didu.me/article/518#_msocom_2" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial"></a><span style="border:0px; font-family:宋体; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">[王黎2]</span> <span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> page_view
 PARTITION (ds=’2008-08-08′);</span></p>
</div>
<h2 align="left" style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t24" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791022" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">2.5 </span>Load</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
HIVE装载数据没有做任何转换加载到表中的数据只是进入相应的配置单元表的位置移动数据文件。纯加载操作复制/移动操作。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
3.1 语法</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">LOAD DATA [LOCAL] INPATH ‘filepath’ [OVERWRITE] INTOTABLE tablename [PARTITION (partcol1=val1, partcol2=val2 ...)]</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Load 操作只是单纯的复制/移动操作，将数据文件移动到 Hive 表对应的位置。</p>
<ul type="disc" style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 1.625em 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:square">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
filepath 可以是：
<ul type="circle" style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:square">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
相对路径，例如：project/data1</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
绝对路径，例如： /user/hive/project/data1</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
包含模式的完整 URI，例如：hdfs://namenode:9000/user/hive/project/data1</li></ul>
</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
加载的目标可以是一个表或者分区。如果表包含分区，必须指定每一个分区的分区名。</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
filepath 可以引用一个文件（这种情况下，Hive 会将文件移动到表所对应的目录中）或者是一个目录（在这种情况下，Hive 会将目录中的所有文件移动至表所对应的目录中）。</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
如果指定了 LOCAL，那么：
<ul type="circle" style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:square">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
load 命令会去查找本地文件系统中的 filepath。如果发现是相对路径，则路径会被解释为相对于当前用户的当前路径。用户也可以为本地文件指定一个完整的 URI，比如：file:///user/hive/project/data1.</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
load 命令会将 filepath 中的文件复制到目标文件系统中。目标文件系统由表的位置属性决定。被复制的数据文件移动到表的数据对应的位置。</li></ul>
</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
如果没有指定 LOCAL 关键字，如果 filepath 指向的是一个完整的 URI，hive 会直接使用这个 URI。 否则：
<ul type="circle" style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:square">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
如果没有指定 schema 或者 authority，Hive 会使用在 hadoop 配置文件中定义的 schema 和 authority，fs.default.name 指定了 Namenode 的 URI。</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
如果路径不是绝对的，Hive 相对于 /user/ 进行解释。</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
Hive 会将 filepath 中指定的文件内容移动到 table （或者 partition）所指定的路径中。</li></ul>
</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
如果使用了 OVERWRITE 关键字，则目标表（或者分区）中的内容（如果有）会被删除，然后再将 filepath 指向的文件/目录中的内容添加到表/分区中。</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
如果目标表（分区）已经有一个文件，并且文件名和 filepath 中的文件名冲突，那么现有的文件会被新文件所替代。</li></ul>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
从本地导入数据到表格并追加原表</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">LOAD DATALOCAL INPATH <code style="border:0px; font-family:Monaco,Consolas,'Andale Mono','DejaVu Sans Mono',monospace; font-size:13px; margin:0px; outline:0px; padding:0px; vertical-align:baseline; line-height:normal">/tmp/pv_2008-06-08_us.txt</code> INTO
 TABLE c02PARTITION(date=’2008-06-08′, country=’US’)</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
从本地导入数据到表格并追加记录</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">LOAD DATALOCAL INPATH ‘./examples/files/kv1.txt’ INTO TABLE pokes;<br>
</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
从hdfs导入数据到表格并覆盖原表</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">LOAD DATAINPATH ‘/user/admin/SqlldrDat/CnClickstat/20101101/18/clickstat_gp_fatdt0/0′INTO table c02_clickstat_fatdt1
 OVERWRITE PARTITION (dt=’20101201′);</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
关于来源的文本数据的字段间隔符</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
如果要将自定义间隔符的文件读入一个表，需要通过创建表的语句来指明输入文件间隔符，然后load data到这个表就ok了。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h2 align="left" style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t25" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791023" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">2.6 </span>Insert</h2>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t26" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791024" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">2.6.1   </span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">INSERTING
 DATA INTO HIVETABLES FROM QUERIES</span></h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">Standard syntax:</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">INSERT OVERWRITE TABLE tablename1 [PARTITION (partcol1=val1,partcol2=val2 ...)] select_statement1 FROM from_statement<br>
</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">Hive extension (multiple inserts):</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">FROM from_statement</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">INSERT OVERWRITE TABLE tablename1 [PARTITION(partcol1=val1, partcol2=val2 ...)] select_statement1</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">[INSERT OVERWRITE TABLE tablename2 [PARTITION ...]select_statement2] …</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">Hive extension (dynamic partition inserts):</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">INSERT OVERWRITE TABLE tablename PARTITION(partcol1[=val1], partcol2[=val2] …) select_statement FROM from_statement<br>
</span></p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Insert时，from子句既可以放在select子句后，也可以放在insert子句前，下面两句是等价的</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">hive&gt; FROM invites a INSERT OVERWRITE TABLEevents SELECT a.bar, count(*) WHERE a.foo &gt; 0 GROUP BY a.bar;</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>hive&gt; INSERT OVERWRITE TABLE events SELECTa.bar, count(*) FROM invites a WHERE a.foo &gt; 0 GROUP BY a.bar;</p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
hive没有直接插入一条数据的sql，不过可以通过其他方法实现：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
假设有一张表B至少有一条数据，我们想向表A（int，string）中插入一条数据，可以用下面的方法实现：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
from B</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
insert table A select  1，‘abc’ limit 1；</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
我觉得hive好像不能够插入一个记录，因为每次你写insert语句的时候都是要将整个表的值overwrite。我想这个应该是与hive的storage layer是有关系的，因为它的存储层是HDFS，插入一个数据要全表扫描，还不如用整个表的替换来的快些。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Hive不支持一条一条的用insert语句进行插入操作，也不支持update的操作。数据是以load的方式，加载到建立好的表中。数据一旦导入，则不可修改。要么drop掉整个表，要么建立新的表，导入新的数据。</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t27" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791025" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">2.6.2   </span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">WRITING
 DATA INTOFILESYSTEM FROM QUERIES</span></h3>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">Standard syntax:</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">INSERT OVERWRITE [LOCAL] DIRECTORY directory1 SELECT …FROM …</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">Hive extension (multiple inserts):</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">FROM from_statement</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">INSERT OVERWRITE [LOCAL] DIRECTORY directory1select_statement1</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">[INSERT OVERWRITE [LOCAL] DIRECTORY directory2select_statement2] …</span></p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
导出文件到本地</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">INSERTOVERWRITE LOCAL DIRECTORY ‘/tmp/local_out’ SELECT a.* FROM pokes a;</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
导出文件到HDFS</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">INSERTOVERWRITE DIRECTORY’/user/admin/SqlldrDat/CnClickstat/20101101/19/clickstat_gp_fatdt0/0′ SELECTa.* FROM c02_clickstat_fatdt1
 a WHERE dt=’20101201’;</span></p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
一个源可以同时插入到多个目标表或目标文件，多目标insert可以用一句话来完成</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">FROM src</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>INSERT OVERWRITE TABLE dest1 SELECT src.*WHERE src.key &lt; 100</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>INSERT OVERWRITE TABLE dest2 SELECT src.key,src.value WHERE src.key &gt;= 100 and src.key &lt; 200</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>INSERT OVERWRITE TABLE dest3PARTITION(ds=’2008-04-08′, hr=’12′) SELECT src.key WHERE src.key &gt;= 200 andsrc.key
 &lt; 300</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>INSERT OVERWRITE LOCAL DIRECTORY’/tmp/dest4.out’ SELECT src.value WHERE src.key &gt;= 300;</p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Eg:</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
from xi</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
insert overwrite table test2 select  ’1,2,3′ limit1</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
insert overwrite table d select  ’4,5,6′ limit 1;</p>
<h2 align="left" style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t28" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791026" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">2.7</span>Cli</a><a id="_anchor_3" name="_msoanchor_3" href="http://blog.didu.me/article/518#_msocom_3" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial"></a><span style="border:0px; font-family:宋体; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">[王黎3]</span></h2>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t29" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791027" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>2.7.1   
 HIVECOMMAND LINE OPTIONS</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">$HIVE_HOME/bin/hive</span>是一个shell工具，它可以用来运行于交互或批处理方式配置单元查询。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
语法：</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>Usage: hive[-hiveconf x=y]* [&lt;-i filename&gt;]* [&lt;-f filename&gt;|&lt;-equery-string&gt;] [-S]</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>-i&lt;filename&gt;            Initialization Sql from file (executed automatically and silently beforeany other
 commands)</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>-e ‘quoted querystring’  Sql from command line</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>-f&lt;filename&gt;             Sql fromfile</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>-S                        Silent mode ininteractive shell where only data is emitted</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>-hiveconfx=y             Use this to sethive/hadoop configuration variables.</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">   </span>-e and -f cannotbe specified together. In the absence of these options, interactive shell isstarted.</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">   </span>However, -i canbe used with any other options.  Multipleinstances of -i can be used to execute multiple init
 scripts.</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">   </span>To see thisusage help, run hive -h</p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
运行一个查询：</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">$HIVE_HOME/bin/</span> hive -e ‘select count(*) fromc02_clickstat_fatdt1′</p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">Example of setting hive configurationvariables<br>
</span></p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">$HIVE_HOME/bin/hive -e ‘select a.col from tab1 a’-hiveconf<br>
<a style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)">hive.exec.scratchdir=/home/my/hive_scratch  </a></span>-hiveconf mapred.reduce.tasks=32<a id="_anchor_4" name="_msoanchor_4" href="http://blog.didu.me/article/518#_msocom_4" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial"></a><span style="border:0px; font-family:宋体; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">[王黎4]</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">将查询结果导出到一个文件</span></p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">HIVE_HOME/bin/hive -S -e ‘</span><br>
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">select count(*) from c02_clickstat_fatdt1′&gt; a.txt</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">运行一个脚本</span></p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">HIVE_HOME/bin/hive -f /home/my/hive-script.sql</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">Example of running an initialization scriptbefore entering interactive mode<br>
</span></p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">HIVE_HOME/bin/hive -i /home/my/hive-init.sql</span></p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t30" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791028" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>2.7.2   
 HIVEINTERACTIVE SHELL COMMAND</h3>
<table class="alignleft " border="0" cellspacing="0" cellpadding="0" style="border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 1.625em; outline:0px; padding:0px; vertical-align:baseline; border-spacing:0px; display:inline; float:left; width:688px">
<tbody style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Command</span></p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Description</span></p>
</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
quit</p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
使用 quit or exit 退出</p>
</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
set &lt;key&gt;=&lt;value&gt;</p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
使用这个方式来设置特定的配置变量的值。有一点需要注意的是，如果你拼错了变量名，CLI将不会显示错误。</p>
</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
set</p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
这将打印的配置变量，如果没有指定变量则由显示HIVE和用户变量。如set I 则显示i的值,set则显示hive内部变量值</p>
</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
set -v</p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
This will give all possible hadoop/hive configuration variables.</p>
</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
add FILE &lt;value&gt; &lt;value&gt;*</p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Adds a file to the list of resources.</p>
</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
list FILE</p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
list all the resources already added</p>
</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
list FILE &lt;value&gt;*</p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Check given resources are already added or not.</p>
</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
! &lt;cmd&gt;</p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
execute a shell command from hive shell</p>
</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
dfs &lt;dfs command&gt;</p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
execute dfs command command from hive shell</p>
</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
&lt;query string&gt;</p>
</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
executes hive query and prints results to stdout</p>
</td>
</tr>
</tbody>
</table>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Eg:</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>hive&gt; set  i=32;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>hive&gt; set i;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>hive&gt; selecta.* from xiaojun a;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>hive&gt; !ls;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>hive&gt; dfs -ls;</p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
还可以这样用</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
hive&gt; set $i=’121.61.99.14.128160791368.5′;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
hive&gt; select count(*) from c02_clickstat_fatdt1 wherecookie_id=$i;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
11</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t31" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791029" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)">2.7.3   HIVE
 RESOURCES</a></h3>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">Hive can manage theaddition of resources to a session where those resources need to be made availableat query execution
 time. Any locally accessible file can be added to thesession. Once a file is added to a session,<br>
hive query can refer to this fileby its name (in <a style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)">map/reduce/transformclauses</a></span><a id="_anchor_5" name="_msoanchor_5" href="http://blog.didu.me/article/518#_msocom_5" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial"></a><span style="border:0px; font-family:宋体; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">[王黎5]</span> <span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">)
 and this file is available locally at<br>
execution time on the entirehadoop cluster. Hive uses Hadoop’s Distributed Cache to distribute the addedfiles to all the machines in the cluster at query execution time.<br>
</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">Usage:</span></p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">·        </span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">   </span>ADD
 { FILE[S] | JAR[S] |ARCHIVE[S] } &lt;filepath1&gt; [&lt;filepath2&gt;]*</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">·        </span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">   </span>LIST
 { FILE[S] | JAR[S] |ARCHIVE[S] } [&lt;filepath1&gt; &lt;filepath2&gt; ..]</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">·        </span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">   </span>DELETE
 { FILE[S] | JAR[S] |ARCHIVE[S] } [&lt;filepath1&gt; &lt;filepath2&gt; ..]</p>
</div>
<ul type="disc" style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 1.625em 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:square">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">
FILE resources are just added to the distributed cache. Typically, this might be something like a transform script to be executed.</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">
JAR resources are also added to the Java classpath. This is required in order to reference objects they contain such as UDF’s.</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">
ARCHIVE resources are automatically unarchived as part of distributing them.</li></ul>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">Example:</span></p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">·        </span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>hive&gt;
 add FILE /tmp/tt.py;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">·        </span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>hive&gt;
 list FILES;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">·        </span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>/tmp/tt.py</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">·        </span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>hive&gt;
 from networks a  MAP a.networkid USING ‘python tt.py’ as nnwhere a.ds = ’2009-01-04′ limit  10;</p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">It is not neccessary to addfiles to the session if the files used in a transform script are alreadyavailable on all
 machines in the hadoop cluster using the same path name. Forexample:<br>
</span></p>
<ul type="disc" style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 1.625em 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:square">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">
… MAP a.networkid USING ‘wc -l’ …: here wc is an executable available on all machines</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">
… MAP a.networkid USING ‘/home/nfsserv1/hadoopscripts/tt.py’ …: here tt.py may be accessible via a nfs mount point that’s configured identically on all the cluster nodes</li></ul>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<a id="_anchor_6" name="_msoanchor_6" href="http://blog.didu.me/article/518#_msocom_6" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial"></a><span style="border:0px; font-family:宋体; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">[王黎6]</span></p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t32" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791030" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>2.7.4   
 调用PYTHON、SHELL等语言</h3>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
如下面这句sql就是借用了<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">weekday_mapper.py</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">对数据进行了处理</span></p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">CREATETABLE u_data_new (</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>userid INT,</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>movieid INT,</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>rating INT,</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>weekday INT)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">ROWFORMAT DELIMITED</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">FIELDSTERMINATED BY ‘\t’;</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">add FILEweekday_mapper.py;</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">INSERTOVERWRITE TABLE u_data_new</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(224,106,9)">SELECT</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(224,106,9)">  </span><a style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)">TRANSFORM </a><br>
<a id="_anchor_7" name="_msoanchor_7" href="http://blog.didu.me/article/518#_msocom_7" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial"></a><span style="border:0px; font-family:宋体; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">[王黎7]</span> <span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(224,106,9)">(userid,movieid,
 rating, unixtime)</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(224,106,9)">  </span>USING ‘python weekday_mapper.py’</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(224,106,9)">  </span>AS (userid, movieid, rating, weekday)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">FROMu_data;</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<a style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">，其中weekday_mapper.py</span>内容如下</a></p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">import sys</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">import datetime</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">for line in sys.stdin:</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>line =line.strip()</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>userid,movieid, rating, unixtime = line.split(‘\t’)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>weekday= datetime.datetime.fromtimestamp(float(unixtime)).isoweekday()</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>print’\t’.join([userid, movieid, rating, str(weekday)])</p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
如下面的例子则是使用了shell的cat命令来处理数据</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">FROM invites a INSERT OVERWRITE TABLE events<br>
</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(224,106,9)">SELECT TRANSFORM(a.foo, a.bar) AS (oof, rab)USING ‘/bin/cat’</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> WHEREa.ds
 &gt; ’2008-08-09′;</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<a id="_anchor_8" name="_msoanchor_8" href="http://blog.didu.me/article/518#_msocom_8" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial"></a><span style="border:0px; font-family:宋体; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">[王黎8]</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t33" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791031" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">2.8 </span>DROP</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
删除一个内部表的同时会同时删除表的元数据和数据。删除一个外部表，只删除元数据而保留数据。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t34" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791032" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">2.9 </span>其它</h2>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t35" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791033" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>2.9.1   
 LIMIT</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Limit可以限制查询的记录数。查询的结果是随机选择的。下面的查询语句从 t1 表中随机查询5条记录：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT* FROM t1 LIMIT 5</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t36" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791034" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>2.9.2   
 TOP K</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
下面的查询语句查询销售记录最大的 5 个销售代表。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SETmapred.reduce.tasks = 1</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT * FROM sales SORT BY amount DESC LIMIT5</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t37" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791035" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)">2.9.3   <span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">REGEX
 COLUMN SPECIFICATION</span></a></h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT 语句可以使用正则表达式做列选择，下面的语句查询除了 ds 和 hr 之外的所有列：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT <code style="border:0px; font-family:Monaco,Consolas,'Andale Mono','DejaVu Sans Mono',monospace; font-size:13px; margin:0px; outline:0px; padding:0px; vertical-align:baseline; line-height:normal">(ds|hr)?+.+</code>FROM sales</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<a id="_anchor_9" name="_msoanchor_9" href="http://blog.didu.me/article/518#_msocom_9" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial"></a><span style="border:0px; font-family:宋体; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">[王黎9]</span></p>
<h1 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t38" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791036" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>3.  Hive
 Select</h1>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
语法：</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">SELECT [ALL | DISTINCT] select_expr, select_expr, …</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">FROM table_reference</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">[WHERE where_condition]<br>
</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">[GROUP BY col_list]</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">[   </span>CLUSTER BYcol_list</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>| [DISTRIBUTE BYcol_list] [SORT BY col_list]</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">]</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">[LIMIT number]</span></p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t39" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791037" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">3.1 </span>GroupBy</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
基本语法：</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">groupByClause: GROUP BY groupByExpression (,groupByExpression)*</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">groupByExpression: expression</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">groupByQuery: SELECT expression (, expression)* FROM srcgroupByClause?</span></p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
高级特性：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
l  聚合可进一步分为多个表，甚至发送到Hadoop的DFS的文件（可以进行操作，然后使用HDFS的utilitites）。例如我们可以根据性别划分，需要找到独特的页面浏览量按年龄划分。如下面的例子：</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>FROM pv_users</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>INSERT OVERWRITETABLE pv_gender_sum</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">    </span>SELECTpv_users.gender, count(DISTINCT pv_users.userid)</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">    </span>GROUP BYpv_users.gender</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>INSERT OVERWRITEDIRECTORY ‘/user/facebook/tmp/pv_age_sum’</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">    </span>SELECTpv_users.age, count(DISTINCT pv_users.userid)</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">    </span>GROUP BYpv_users.age;</p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
l  hive.map.aggr可以控制怎么进行汇总。默认为为true，配置单元会做的第一级聚合直接在MAP上的任务。这通常提供更好的效率，但可能需要更多的内存来运行成功。</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span>sethive.map.aggr=true;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">SELECT COUNT(*) FROM table2;</span></p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
PS:在要特定的场合使用可能会加效率。不过我试了一下，比直接使用False慢很多。</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t40" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791038" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">3.2 </span>Order/Sort
 By</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Order by 语法：</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">colOrder: ( ASC | DESC )</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">orderBy: ORDER BY colName colOrder? (‘,’ colNamecolOrder?)*</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">query: SELECT expression (‘,’ expression)* FROM srcorderBy</span></p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Sort By 语法：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Sort顺序将根据列类型而定。如果数字类型的列，则排序顺序也以数字顺序。如果字符串类型的列，则排序顺序将字典顺序。</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">colOrder: ( ASC | DESC )</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">sortBy: SORT BY colName colOrder? (‘,’ colNamecolOrder?)*</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">query: SELECT expression (‘,’ expression)* FROM srcsortBy</span></p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h1 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t41" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791039" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>4.  Hive
 Join</h1>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
语法</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">join_table:</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">    </span>table_referenceJOIN table_factor [join_condition]</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>| table_reference{LEFT|RIGHT|FULL} [OUTER] JOIN table_reference join_condition</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>| table_reference<a style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)">LEFT
 SEMIJOIN</a><a id="_anchor_10" name="_msoanchor_10" href="http://blog.didu.me/article/518#_msocom_10" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial"></a><span style="border:0px; font-family:宋体; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">[王黎10]</span> <span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> table_reference<br>
join_condition</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">table_reference:</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">    </span>table_factor</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>| join_table</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">table_factor:</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">    </span>tbl_name[alias]</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>| table_subqueryalias</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">  </span>| (table_references )</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">join_condition:</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">    </span>ONequality_expression ( AND equality_expression )*</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">equality_expression:</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">    </span>expression =expression</p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Hive 只支持等值连接（equality joins）、外连接（outer joins）和（left/right joins）。Hive 不支持所有非等值的连接，因为非等值连接非常难转化到 map/reduce 任务。另外，Hive 支持多于 2 个表的连接。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
写 join 查询时，需要注意几个关键点：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1、只支持等值join</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
例如：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT a.* FROMa JOIN b ON (a.id = b.id)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT a.* FROM a JOIN b</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
ON (a.id = b.id AND a.department =b.department)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
是正确的，然而:</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT a.* FROM a JOIN b ON (a.id  b.id)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
是错误的。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1. 可以 join 多于 2 个表。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
例如</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT a.val,b.val, c.val FROM a JOIN b</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
ON (a.key =b.key1) JOIN c ON (c.key = b.key2)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
如果join中多个表的join key 是同一个，则 join 会被转化为单个map/reduce 任务，例如：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT a.val,b.val, c.val FROM a JOIN b</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
ON (a.key =b.key1) JOIN c</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
ON (c.key =b.key1)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
被转化为单个 map/reduce 任务，因为 join 中只使用了 b.key1 作为 join key。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT a.val, b.val, c.val FROM a JOIN b ON (a.key =b.key1)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
JOIN c ON(c.key = b.key2)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
而这一 join 被转化为2 个 map/reduce 任务。因为 b.key1 用于第一次 join 条件，而 b.key2 用于第二次 join。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<a style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)">  </a></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
3．join 时，每次map/reduce 任务的逻辑：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
reducer 会缓存 join 序列中除了最后一个表的所有表的记录，再通过最后一个表将结果序列化到文件系统。这一实现有助于在 reduce 端减少内存的使用量。实践中，应该把最大的那个表写在最后（否则会因为缓存浪费大量内存）。例如：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT a.val, b.val, c.val FROM a</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
JOIN b ON (a.key = b.key1)JOIN c ON (c.key = b.key1)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
所有表都使用同一个 join key（使用 1 次map/reduce 任务计算）。Reduce 端会缓存 a 表和 b 表的记录，然后每次取得一个 c 表的记录就计算一次 join 结果，类似的还有：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT a.val, b.val, c.val FROMa</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
JOIN b ON (a.key = b.key1)JOIN c ON (c.key = b.key2)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
这里用了 2 次 map/reduce 任务。第一次缓存 a 表，用 b 表<a style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)">序列化</a><a id="_anchor_11" name="_msoanchor_11" href="http://blog.didu.me/article/518#_msocom_11" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial"></a><span style="border:0px; font-family:宋体; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">[王黎11]</span> ；第二次缓存第一次
 map/reduce 任务的结果，然后用 c 表序列化。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<a id="_anchor_12" name="_msoanchor_12" href="http://blog.didu.me/article/518#_msocom_12" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial"></a><span style="border:0px; font-family:宋体; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">[王黎12]</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
4．LEFT，RIGHT 和 FULLOUTER 关键字用于处理 join 中空记录的情况。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
例如：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT a.val,b.val FROM a LEFT OUTER</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
JOIN b ON(a.key=b.key)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
对应所有 a 表中的记录都有一条记录输出。输出的结果应该是 a.val, b.val，当 a.key=b.key 时，而当 b.key 中找不到等值的 a.key 记录时也会输出 a.val, NULL。“FROM a LEFT OUTER JOIN b”这句一定要写在同一行——意思是 a 表在 b 表的<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">左边</span>，所以
 a 表中的所有记录都被保留了；“a RIGHT OUTER JOIN b”会保留所有 b 表的记录。OUTER JOIN 语义应该是遵循标准 SQL spec的。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Join 发生在 WHERE 子句<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">之前</span>。如果你想限制 join 的输出，应该在 WHERE 子句中写过滤条件——或是在join 子句中写。这里面一个容易混淆的问题是表分区的情况：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT a.val,b.val FROM a</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
LEFT OUTER JOINb ON (a.key=b.key)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
WHEREa.ds=’2009-07-07′ AND b.ds=’2009-07-07′</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
会 join a 表到 b 表（OUTER JOIN），列出 a.val 和 b.val 的记录。WHERE 从句中可以使用其他列作为过滤条件。但是，如前所述，如果 b 表中找不到对应 a 表的记录，b 表的所有列都会列出 NULL，<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">包括 ds 列</span>。也就是说，join
 会过滤 b 表中不能找到匹配a 表 join key 的所有记录。这样的话，LEFTOUTER 就使得查询结果与 WHERE 子句无关了。解决的办法是在 OUTER JOIN 时使用以下语法：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT a.val,b.val FROM a LEFT OUTER JOIN b</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
ON (a.key=b.keyAND</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
b.ds=’2009-07-07′ AND</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
a.ds=’2009-07-07′)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
这一查询的结果是预先在 join 阶段过滤过的，所以不会存在上述问题。这一逻辑也可以应用于 RIGHT 和 FULL 类型的join 中。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Join 是不能交换位置的。无论是 LEFT 还是 RIGHT join，都是左连接的。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT a.val1,a.val2, b.val, c.val</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
FROM a</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
JOIN b ON(a.key = b.key)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
LEFT OUTER JOINc ON (a.key = c.key)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
先 join a 表到 b 表，丢弃掉所有 join key 中不匹配的记录，然后用这一中间结果和 c 表做 join。这一表述有一个不太明显的问题，就是当一个 key 在 a 表和 c 表都存在，但是 b 表中不存在的时候：整个记录在第一次 join，即 a JOIN b 的时候都被丢掉了（包括a.val1，a.val2和a.key），然后我们再和 c 表 join 的时候，如果c.key 与 a.key 或 b.key 相等，就会得到这样的结果：NULL, NULL, NULL, c.val。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
5．<a style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)">LEFT SEMI JOIN</a><a id="_anchor_13" name="_msoanchor_13" href="http://blog.didu.me/article/518#_msocom_13" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial"></a><span style="border:0px; font-family:宋体; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">[王黎13]</span> 
 是 IN/EXISTS 子查询的一种更高效的实现。Hive 当前没有实现 IN/EXISTS 子查询，所以你可以用 LEFT SEMI JOIN 重写你的子查询语句。LEFT SEMI JOIN 的限制是， JOIN 子句中右边的表只能在 ON 子句中设置过滤条件，在<br>
WHERE 子句、SELECT 子句或其他地方过滤都不行。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT a.key,a.value</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
FROM a</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
WHERE a.key in</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
(SELECT b.key</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
FROM B);</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
可以被重写为：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT a.key,a.val</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
FROM a LEFTSEMI JOIN b on (a.key = b.key)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h1 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t42" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791040" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>5.  HIVE参数设置</h1>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
    开发Hive应用时，不可避免地需要设定Hive的参数。设定Hive的参数可以调优HQL代码的执行效率，或帮助定位问题。然而实践中经常遇到的一个问题是，为什么设定的参数没有起作用？</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
这通常是错误的设定方式导致的。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline"><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(192,0,0)">对于一般参数，有以下三种设定方式：</span></span></p>
<ul type="disc" style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 1.625em 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:square">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(192,0,0)">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">配置文件</span></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(192,0,0)">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">命令行参数</span></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(192,0,0)">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">参数声明</span></li></ul>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">配置文件</span>：Hive的配置文件包括</p>
<ul type="disc" style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 1.625em 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:square">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
用户自定义配置文件：$HIVE_CONF_DIR/hive-site.xml</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
默认配置文件：$HIVE_CONF_DIR/hive-default.xml</li></ul>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
用户自定义配置会覆盖默认配置。另外，Hive也会读入Hadoop的配置，因为Hive是作为Hadoop的客户端启动的，Hadoop的配置文件包括</p>
<ul type="disc" style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 1.625em 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:square">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
$HADOOP_CONF_DIR/hive-site.xml</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
$HADOOP_CONF_DIR/hive-default.xml</li></ul>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Hive的配置会覆盖Hadoop的配置。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
配置文件的设定对本机启动的所有Hive进程都有效。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">命令行参数</span>：启动Hive（客户端或Server方式）时，可以在命令行添加-hiveconf param=value来设定参数，例如：</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
bin/hive -hiveconf hive.root.logger=INFO,console</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
这一设定对本次启动的Session（对于Server方式启动，则是所有请求的Sessions）有效。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">参数声明</span>：可以在HQL中使用SET关键字设定参数，例如：</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
set mapred.reduce.tasks=100;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
这一设定的作用域也是Session级的。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
上述三种设定方式的优先级依次递增。即参数声明覆盖命令行参数，命令行参数覆盖配置文件设定。注意某些系统级的参数，例如log4j相关的设定，必须用前两种方式设定，因为那些参数的读取在Session建立以前已经完成了。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
另外，<a style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)">SerDe</a>参数<a id="_anchor_14" name="_msoanchor_14" href="http://blog.didu.me/article/518#_msocom_14" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial"></a><span style="border:0px; font-family:宋体; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">[王黎14]</span> 必须写在DDL（建表）语句中。例如：</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
create table if not exists t_dummy(</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
dummy     string</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
)</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
ROW FORMAT SERDE’org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe’</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
WITH SERDEPROPERTIES (</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
‘field.delim’='\t’,</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
‘escape.delim’='\\’,</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
‘serialization.null.format’=’ ‘</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
) STORED AS TEXTFILE;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
类似serialization.null.format这样的参数，必须和某个表或分区关联。在DDL外部声明将不起作用。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h1 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t43" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791041" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>6.  HIVE
 UDF</h1>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t44" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791042" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">6.1 </span>基本函数</h2>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">SHOW FUNCTIONS;</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">DESCRIBE FUNCTION &lt;function_name&gt;;</span></p>
</div>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t45" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791043" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>6.1.1     关系操作符</h3>
<table class="alignleft" border="1" cellspacing="0" cellpadding="0" style="border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 1.625em; outline:0px; padding:0px; vertical-align:baseline; border-spacing:0px; display:inline; float:left; width:688px">
<tbody style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Operator</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Operand types</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Description</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
A = B</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
All primitive types</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
TRUE if expression A is equal to expression B otherwise FALSE</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
A == B</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
None!</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
Fails because of invalid syntax. SQL uses =, not ==</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
A &lt;&gt; B</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
All primitive types</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
NULL if A or B is NULL, TRUE if expression A is NOT equal to expression B otherwise FALSE</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
A &lt; B</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
All primitive types</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
NULL if A or B is NULL, TRUE if expression A is less than expression B otherwise FALSE</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
A &lt;= B</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
All primitive types</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
NULL if A or B is NULL, TRUE if expression A is less than or equal to expression B otherwise FALSE</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
A &gt; B</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
All primitive types</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
NULL if A or B is NULL, TRUE if expression A is greater than expression B otherwise FALSE</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
A &gt;= B</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
All primitive types</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
NULL if A or B is NULL, TRUE if expression A is greater than or equal to expression B otherwise FALSE</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
A IS NULL</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
all types</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
TRUE if expression A evaluates to NULL otherwise FALSE</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
A IS NOT NULL</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
All types</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
TRUE if expression A evaluates to NULL otherwise FALSE</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
A LIKE B</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
strings</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
NULL if A or B is NULL, TRUE if string A matches the SQL simple regular expression B, otherwise FALSE. The comparison is done character by character. The _ character in B matches any character in A(similar to . in posix regular expressions) while the % character<br>
in B matches an arbitrary number of characters in A(similar to .* in posix regular expressions) e.g. ‘foobar’ like ‘foo’ evaluates to FALSE where as ‘foobar’ like ‘foo_ _ _’ evaluates to TRUE and so does ‘foobar’ like ‘foo%’</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
A RLIKE B</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
strings</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
NULL if A or B is NULL, TRUE if string A matches the Java regular expression B(See Java regular expressions syntax), otherwise FALSE e.g. ‘foobar’ rlike ‘foo’ evaluates to FALSE where as ‘foobar’ rlike ‘^f.*r$’ evaluates to TRUE</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
A REGEXP B</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
strings</td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
Same as RLIKE</td>
</tr>
</tbody>
</table>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t46" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791044" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>6.1.2     代数操作符</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">返回数字类型，如果任意一个操作符为</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">NULL</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">，则结果为</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">NULL</span></p>
<table class="alignleft" border="1" cellspacing="0" cellpadding="0" style="border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 1.625em; outline:0px; padding:0px; vertical-align:baseline; border-spacing:0px; display:inline; float:left; width:688px">
<tbody style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Operator</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Operand types</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Description</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">A + B</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">All number types</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Gives the result of adding A and B. The type of the result is the same as the common parent(in the type hierarchy) of the types
 of the operands. e.g. since every integer is a float, therefore float is a containing type of integer<br>
so the + operator on a float and an int will result in a float.</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">A – B</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">All number types</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Gives the result of subtracting B from A. The type of the result is the same as the common parent(in the type hierarchy) of the
 types of the operands.<br>
</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">A * B</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">All number types</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Gives the result of multiplying A and B. The type of the result is the same as the common parent(in the type hierarchy) of the types
 of the operands. Note that if the multiplication causing overflow, you will have to cast one of<br>
the operators to a type higher in the type hierarchy.</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">A / B</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">All number types</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Gives the result of dividing B from A. The result is a double type.<br>
</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">A % B</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">All number types</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Gives the reminder resulting from dividing A by B. The type of the result is the same as the common parent(in the type hierarchy)
 of the types of the operands.<br>
</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">A &amp; B</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">All number types</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Gives the result of bitwise AND of A and B. The type of the result is the same as the common parent(in the type hierarchy) of the
 types of the operands.<br>
</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">A | B</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">All number types</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Gives the result of bitwise OR of A and B. The type of the result is the same as the common parent(in the type hierarchy) of the
 types of the operands.<br>
</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">A ^ B</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">All number types</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Gives the result of bitwise XOR of A and B. The type of the result is the same as the common parent(in the type hierarchy) of the
 types of the operands.<br>
</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">~A</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">All number types</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Gives the result of bitwise NOT of A. The type of the result is the same as the type of A.<br>
</span></td>
</tr>
</tbody>
</table>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t47" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791045" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>6.1.3     逻辑操作符</h3>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t48" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791046" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>6.1.4     复杂类型操作符</h3>
<table class="alignleft" border="1" cellspacing="0" cellpadding="0" style="border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 1.625em; outline:0px; padding:0px; vertical-align:baseline; border-spacing:0px; display:inline; float:left; width:688px">
<tbody style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Constructor Function</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Operands</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Description</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Map</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">(key1, value1, key2, value2, …)</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Creates a map with the given key/value pairs</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Struct</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">(val1, val2, val3, …)</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Creates a struct with the given field values. Struct field names will be col1, col2, …</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Array</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">(val1, val2, …)</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Creates an array with the given elements</span></td>
</tr>
</tbody>
</table>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t49" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791047" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>6.1.5     内建函数</h3>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t50" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791048" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>6.1.6     数学函数</h3>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t51" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791049" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>6.1.7     集合函数</h3>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t52" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791050" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>6.1.8     类型转换</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t53" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791051" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>6.1.9     日期函数</h3>
<table class="alignleft" border="1" cellspacing="0" cellpadding="0" style="border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 1.625em; outline:0px; padding:0px; vertical-align:baseline; border-spacing:0px; display:inline; float:left; width:688px">
<tbody style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">返回值类型</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">名称</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">描述</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">string</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">from_unixtime(int unixtime)</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">将时间戳（</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">unix
 epoch</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">秒数）转换为日期时间字符串，例如</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">from_unixtime(0)=”1970-01-01
 00:00:00″<br>
</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">bigint</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">unix_timestamp()</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">获得当前时间戳</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">bigint</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">unix_timestamp(string date)</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">获得</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">date</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">表示的时间戳</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">bigint</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">to_date(string timestamp)</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">返回日期字符串，例如</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">to_date(“1970-01-01
 00:00:00″) = “1970-01-01″<br>
</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">string</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">year(string date)</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">返回年，例如</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">year(“1970-01-01
 00:00:00″) = 1970</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">，</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">year(“1970-01-01″)
 = 1970<br>
</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">int</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">month(string date)</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">int</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">day(string date) dayofmonth(date)</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">int</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">hour(string date)</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">int</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">minute(string date)</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">int</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">second(string date)</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">int</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">weekofyear(string date)</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">int</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">datediff(string enddate, string startdate)</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">返回</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">enddate</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">和</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">startdate</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">的天数的差，例如</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">datediff(’2009-03-01′,
 ’2009-02-27′)<br>
= 2</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">int</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">date_add(string startdate, int days)</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">加</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">days</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">天数到</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">startdate:
 date_add(’2008-12-31′, 1) = ’2009-01-01′<br>
</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">int</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">date_sub(string startdate, int days)</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">减</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">days</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">天数到</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">startdate:
 date_sub(’2008-12-31′, 1) = ’2008-12-30′<br>
</span></td>
</tr>
</tbody>
</table>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t54" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791052" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name=".E6.9D.A1.E4.BB.B6.E5.87.BD.E6.95.B0" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>6.1.10             条件函数</h3>
<table class="alignleft" border="1" cellspacing="0" cellpadding="0" style="border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 1.625em; outline:0px; padding:0px; vertical-align:baseline; border-spacing:0px; display:inline; float:left; width:688px">
<tbody style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">返回值类型</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">名称</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">描述</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">-</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">if(boolean testCondition, T valueTrue, T valueFalseOrNull)<br>
</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">当</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">testCondition</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">为真时返回</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">valueTrue</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">，</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">testCondition</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">为假或</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">NULL</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">时返回</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">valueFalseOrNull<br>
</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">-</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">COALESCE(T v1, T v2, …)</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">返回列表中的第一个非空元素，如果列表元素都为空则返回</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">NULL<br>
</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">-</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">CASE a WHEN b THEN c [WHEN d THEN e]* [ELSE f] END</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">a = b</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">，返回</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">c</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">；</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">a
 = d</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">，返回</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">e</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">；否则返回</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">f<br>
</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">-</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">CASE WHEN a THEN b [WHEN c THEN d]* [ELSE e] END</span></td>
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">a </span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">为真，返回</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">b</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">；</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">c</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">为真，返回</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">d</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">；否则</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">e<br>
</span></td>
</tr>
</tbody>
</table>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t55" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791053" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name=".E5.AD.97.E7.AC.A6.E4.B8.B2.E5.87.BD.E6." style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>6.1.11             字符串函数</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
The following are built-in String functionsare supported in hive:</p>
<table class="alignleft" border="1" cellspacing="0" cellpadding="0" style="border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 1.625em; outline:0px; padding:0px; vertical-align:baseline; border-spacing:0px; display:inline; float:left; width:688px">
<tbody style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
返回值类型</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
名称</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">描述</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
Int</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
length(string A)</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
返回字符串长度</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
String</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
reverse(string A)</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
反转字符串</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
String</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
concat(string A, string B…)</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
合并字符串，例如concat(‘foo’, ‘bar’)=’foobar’。注意这一函数可以接受任意个数的参数</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
String</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
substr(string A, int start) substring(string A, int start)</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
返回子串，例如substr(‘foobar’, 4)=’bar’</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
String</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
substr(string A, int start, int len) substring(string A, int start, int len)</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
返回限定长度的子串，例如substr(‘foobar’, 4, 1)=’b’</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
String</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
upper(string A) ucase(string A)</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
转换为大写</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
String</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
lower(string A) lcase(string A)</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
转换为小写</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
String</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
trim(string A)</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
 </td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
String</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
ltrim(string A)</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
 </td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
String</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
rtrim(string A)</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
 </td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
String</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
regexp_replace(string A, string B, string C)</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
Returns the string resulting from replacing all substrings in B that match the Java regular expression syntax(See Java regular expressions syntax) with C e.g. regexp_replace(“foobar”, “oo|ar”, “”) returns ‘fb.’ Note that some care is necessary in using predefined<br>
character classes: using ‘\s’ as the second argument will match the letter s; ‘\\s’ is necessary to match whitespace, etc.</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
String</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
regexp_extract(string subject, string pattern, int intex)</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
返回使用正则表达式提取的子字串。例如，regexp_extract(‘foothebar’, ‘foo(.*?)(bar)’, 2)=’bar’。注意使用特殊字符的规则：使用’\s’代表的是字符’s'；空白字符需要使用’\\s’，以此类推。</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td rowspan="9" valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
String</td>
<td rowspan="9" valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
parse_url(string urlString, string partToExtract)</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
解析URL字符串，partToExtract的可选项有：HOST, PATH, QUERY, REF, PROTOCOL, FILE, AUTHORITY, USERINFO。</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
例如，</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
parse_url(‘http://facebook.com/path/p1.php?query=1′, ‘HOST’)=’facebook.com’</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
parse_url(‘http://facebook.com/path/p1.php?query=1′, ‘PATH’)=’/path/p1.php’</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
parse_url(‘http://facebook.com/path/p1.php?query=1′, ‘QUERY’)=’query=1′，可以指定key来返回特定参数，key的格式是QUERY:&lt;KEY_NAME&gt;，例如QUERY:k1</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
parse_url(‘http://facebook.com/path/p1.php?query=1&amp;field=2′,’QUERY’,'query’)=’1′可以用来取出外部渲染参数key对应的value值</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
parse_url(‘http://facebook.com/path/p1.php?query=1&amp;field=2′,’QUERY’,'field’)=’2′</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
parse_url(‘http://facebook.com/path/p1.php?query=1#Ref’, ‘REF’)=’Ref’</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
parse_url(‘http://facebook.com/path/p1.php?query=1#Ref’, ‘PROTOCOL’)=’http’</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td rowspan="5" valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
String</td>
<td rowspan="5" valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
get_json_object(string json_string, string path)</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
解析json字符串。若源json字符串非法则返回NULL。path参数支持JSONPath的一个子集，包括以下标记：</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
$: Root object</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
[]: Subscript operator for array</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
&amp;: Wildcard for []</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
.: Child operator</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
String</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
space(int n)</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
返回一个包含n个空格的字符串</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
String</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
repeat(string str, int n)</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
重复str字符串n遍</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
String</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
ascii(string str)</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
返回str中第一个字符的ascii码</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
String</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
lpad(string str, int len, string pad)</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
左端补齐str到长度为len。补齐的字符串由pad指定。</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
String</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
rpad(string str, int len, string pad)</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
右端补齐str到长度为len。补齐的字符串由pad指定。</td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
Array</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:yellow">split(string str, string pat)</span></td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:yellow">返回使用</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:yellow">pat</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:yellow">作为正则表达式分割</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:yellow">str</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:yellow">字符串的列表。例如，</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:yellow">split(‘foobar’,<br>
‘o’)[2] = ‘bar’</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:yellow">。？不是很明白这个结果</span></td>
</tr>
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
Int</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
find_in_set(string str, string strList)</td>
<td valign="top" style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
Returns the first occurance of str in strList where strList is a comma-delimited string. Returns null if either argument is null. Returns 0 if the first argument contains any commas. e.g. find_in_set(‘ab’, ‘abc,b,ab,c,def’) returns 3</td>
</tr>
</tbody>
</table>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t56" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791054" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">6.2 </span><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">UDTF</span></h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">UDTF</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">即</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">Built-inTable-Generating
 Functions</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">使用这些</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">UDTF</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">函数有一些限制</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">:<br>
</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">1</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">、</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">SELECT</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">里面不能有其它字段</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">如：</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">SELECTpageid,
 explode(adid_list) AS myCol…<br>
</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">2</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">、不能嵌套</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">如：</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">SELECTexplode(explode(adid_list))
 AS myCol…</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">不支持</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">3</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">、不支持</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">GROUP
 BY / CLUSTER BY / DISTRIBUTE BY / SORTBY<br>
</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">如：</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">SELECTexplode(adid_list)
 AS myCol … GROUP BY myCol<br>
</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t57" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791055" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">6.2.1  </span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">EXPLODE</span></h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
将数组进行转置</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
例如：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1、create table test2(mycol array&lt;int&gt;);</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
2、insert OVERWRITE table test2 select * from (select array(1,2,3) froma union all select array(7,8,9)  fromd)c;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
3、hive&gt; select * from test2;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
OK</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
[1,2,3]</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
[7,8,9]</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
3、  hive&gt; SELECT explode(myCol) AS myNewCol FROM test2;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
OK</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
2</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
3</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
7</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
8</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
9</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h1 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t58" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791056" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>7.  HIVE
 的MAP/REDUCE</h1>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t59" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791057" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">7.1 </span>JOIN</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
对于 JOIN 操作：</p>
<table class="alignleft" border="1" cellspacing="0" cellpadding="0" style="border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 1.625em; outline:0px; padding:0px; vertical-align:baseline; border-spacing:0px; display:inline; float:left; width:688px; background-color:rgb(255,250,205)">
<tbody style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
INSERT OVERWRITE TABLE pv_users 
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT pv.pageid, u.age FROM page_view pv JOIN user u ON (pv.userid = u.userid);</p>
</td>
</tr>
</tbody>
</table>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
实现过程为：</p>
<ul type="disc" style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 1.625em 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:square">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
Map：
<ul type="circle" style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:square">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
以 JOIN ON 条件中的列作为 Key，如果有多个列，则 Key 是这些列的组合</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
以 JOIN 之后所关心的列作为 Value，当有多个列时，Value 是这些列的组合。在 Value 中还会包含表的 Tag 信息，用于标明此 Value 对应于哪个表。</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
按照 Key 进行排序。</li></ul>
</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
Shuffle：
<ul type="circle" style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:square">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
根据 Key 的值进行 Hash，并将 Key/Value 对按照 Hash 值推至不同对 Reduce 中。</li></ul>
</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
Reduce：
<ul type="circle" style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 0px 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:square">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
Reducer 根据 Key 值进行 Join 操作，并且通过 Tag 来识别不同的表中的数据。</li></ul>
</li></ul>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
具体实现过程如图：</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t60" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791058" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="GROUP_BY" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">7.2<br>
</span>GROUPBY</h2>
<table class="alignleft" border="1" cellspacing="0" cellpadding="0" style="border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 1.625em; outline:0px; padding:0px; vertical-align:baseline; border-spacing:0px; display:inline; float:left; width:688px; background-color:rgb(255,250,205)">
<tbody style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
SELECT pageid, age, count(1) FROM pv_users GROUP BY pageid, age;</td>
</tr>
</tbody>
</table>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
具体实现过程如图：</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t61" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791059" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="DISTINCT" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">7.3<br>
</span>DISTINCT</h2>
<table class="alignleft" border="1" cellspacing="0" cellpadding="0" style="border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 1.625em; outline:0px; padding:0px; vertical-align:baseline; border-spacing:0px; display:inline; float:left; width:688px; background-color:rgb(255,250,205)">
<tbody style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
SELECT age, count(distinct pageid) FROM pv_users GROUP BY age;</td>
</tr>
</tbody>
</table>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
实现过程如图：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h1 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t62" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791060" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>8.  使用HIVE注意点</h1>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t63" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791061" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">8.1 </span>字符集</h2>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">Hadoop</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">和Hive</span>都是用UTF-8编码的，所以, 所有中文必须是UTF-8编码, 才能正常使用</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
备注：中文数据load到表里面, 如果字符集不同，很有可能全是乱码需要做转码的, 但是hive本身没有函数来做这个</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t64" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791062" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">8.2 </span>压缩</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">hive.exec.compress.output </span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">这个参数, </span>默认是 false，但是很多时候貌似要单独显式设置一遍</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">否则会对结果做压缩的，如果你的这个文件后面还要在hadoop</span>下直接操作, 那么就不能压缩了</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t65" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791063" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">8.3 </span>count(distinct)</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
当前的 Hive 不支持在一条查询语句中有多 Distinct。如果要在 Hive 查询语句中实现多Distinct，需要使用至少n+1 条查询语句（n为distinct的数目），前n 条查询分 别对 n 个列去重，最后一条查询语句对 n 个去重之后的列做 Join 操作，得到最终结果。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t66" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791064" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">8.4 </span>JOIN</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
只支持等值连接</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t67" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791065" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">8.5 </span>DML操作</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
只支持INSERT/LOAD操作，无UPDATE和DELTE</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t68" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791066" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">8.6 </span>HAVING</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
不支持HAVING操作。如果需要这个功能要嵌套一个子查询用where限制</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t69" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791067" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">8.7 </span>子查询</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Hive不支持where子句中的子查询</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:red">子查询，只允许子查询在</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:red">from</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:red">中出现</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT station, year, AVG(max_temperature)FROM (SELECT station, year, MAX(temperature) AS max_temperature FROM records2WHERE temperature != 9999 AND (quality = 0 OR quality = 1 OR quality = 4 ORquality = 5 OR quality = 9) GROUP BY station, year) mt GROUP<br>
BY station, year;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t70" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791068" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">8.8 </span>Join中处理null值的语义区别</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SQL标准中，任何对null的操作（数值比较，字符串操作等）结果都为null。Hive对null值处理的逻辑和标准基本一致，除了Join时的特殊逻辑。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
这里的特殊逻辑指的是，Hive的Join中，作为Join key的字段比较，null=null是有意义的，且返回值为true。检查以下查询：</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
select u.uid, count(u.uid)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
from t_weblog l join t_user u on (l.uid = u.uid) group by u.uid;</p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
查询中，t_weblog表中uid为空的记录将和t_user表中uid为空的记录做连接，即l.uid =u.uid=null成立。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
如果需要与标准一致的语义，我们需要改写查询手动过滤null值的情况：</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
select u.uid, count(u.uid)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
from t_weblog l join t_user u</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
on (l.uid = u.uid and l.uid is not null and u.uid isnot null)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
group by u.uid;</p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
实践中，这一语义区别也是经常导致数据倾斜的原因之一。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t71" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">8.9 </span>分号字符</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
分号是SQL语句结束标记，在HiveQL中也是，但是在HiveQL中，对分号的识别没有那么智慧，例如：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
select concat(cookie_id,concat(‘;’,’zoo’))from c02_clickstat_fatdt1 limit 2;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
FAILED: Parse Error: line 0:-1 cannotrecognize input ‘&lt;EOF&gt;’ in function specification</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
可以推断，Hive解析语句的时候，只要遇到分号就认为语句结束，而无论是否用引号包含起来。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
解决的办法是，使用分号的八进制的ASCII码进行转义，那么上述语句应写成：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
selectconcat(cookie_id,concat(‘\073′,’zoo’)) from c02_clickstat_fatdt1 limit 2;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
为什么是八进制ASCII码？</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
我尝试用十六进制的ASCII码，但Hive会将其视为字符串处理并未转义，好像仅支持八进制，原因不详。这个规则也适用于其他非SELECT语句，如CREATE TABLE中需要定义分隔符，那么对不可见字符做分隔符就需要用八进制的ASCII码来转义。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t72" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">8.10        </span>Insert</h2>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t73" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>8.10.1             新增数据</h3>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
根据语法Insert必须加“OVERWRITE”关键字，也就是说每一次插入都是一次重写。那如何实现表中新增数据呢？</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
假设Hive中有表xiaojun1,</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
hive&gt; DESCRIBE xiaojun1;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
OK</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
id int</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
value int</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
hive&gt; SELECT * FROM xiaojun1;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
OK</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
3 4</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1 2</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
2 3</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
现增加一条记录:</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
hive&gt; INSERT OVERWRITE TABLE xiaojun1</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT id, value FROM (</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT id, value FROM xiaojun1</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
UNION ALL</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT 4 AS id, 5 AS value FROM xiaojun1 limit 1</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
) u;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
结果是:</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
hive&gt;SELECT * FROM p1;</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
OK</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
3 4</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
4 5</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
2 3</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1 2</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
其中的关键在于, 关键字UNION ALL的应用, 即将原有数据集和新增数据集进行结合, 然后重写表.</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t74" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>8.10.2             插入次序</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
INSERT OVERWRITE TABLE在插入数据时,是按照后面的SELECT语句中的字段顺序插入的. 也就说, 当id 和value 的位置互换, 那么value将被写入id, 同id被写入value.</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t75" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>8.10.3             初始值</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
INSERT OVERWRITE TABLE在插入数据时, 后面的字段的初始值应注意与表定义中的一致性. 例如, 当为一个STRING类型字段初始为NULL时:</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
NULL AS field_name // 这可能会被提示定义类型为STRING, 但这里是void</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
CAST(NULL AS STRING) AS field_name // 这样是正确的</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
又如, 为一个BIGINT类型的字段初始为0时:</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
CAST(0 AS BIGINT) AS field_name</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h1 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t76" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791069" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>9.  优化</h1>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t77" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">9.1 </span>HADOOP计算框架特性</h2>
<ul type="disc" style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 1.625em 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:square">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
数据量大不是问题，数据倾斜是个问题。</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
jobs数比较多的作业运行效率相对比较低，比如即使有几百行的表，如果多次关联多次汇总，产生十几个jobs，耗时很长。原因是map reduce作业初始化的时间是比较长的。</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
sum,count,max,min等UDAF，不怕数据倾斜问题,hadoop在map端的汇总合并优化，使数据倾斜不成问题。</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
count(distinct ),在数据量大的情况下，效率较低，如果是多count(distinct )效率更低，因为count(distinct)是按group by 字段分组，按distinct字段排序，一般这种分布方式是很倾斜的，比如男uv,女uv，淘宝一天30亿的pv，如果按性别分组，分配2个reduce,每个reduce处理15亿数据。</li></ul>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t78" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">9.2 </span>优化的常用手段</h2>
<ul type="disc" style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 1.625em 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:square">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
好的模型设计事半功倍。</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
解决数据倾斜问题。</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
减少job数。</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
设置合理的map reduce的task数，能有效提升性能。(比如，10w+级别的计算，用160个reduce，那是相当的浪费，1个足够)。</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
了解数据分布，自己动手解决数据倾斜问题是个不错的选择。set hive.groupby.skewindata=true;这是通用的算法优化，但算法优化有时不能适应特定业务背景，开发人员了解业务，了解数据，可以通过业务逻辑精确有效的解决数据倾斜问题。</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
数据量较大的情况下，慎用count(distinct)，count(distinct)容易产生倾斜问题。</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
对小文件进行合并，是行至有效的提高调度效率的方法，假如所有的作业设置合理的文件数，对云梯的整体调度效率也会产生积极的正向影响。</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
优化时把握整体，单个作业最优不如整体最优。</li></ul>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t79" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791070" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">9.3 </span>全排序</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<a style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)">Hive的排序关键字是SORT BY，它有意区别于传统数据库的ORDER BY也是为了强调两者的区别–SORT BY只能在单机范围内排序。</a><a id="_anchor_15" name="_msoanchor_15" href="http://blog.didu.me/article/518#_msocom_15" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial"></a><span style="border:0px; font-family:宋体; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">[王黎15]</span></p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t80" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791071" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>9.3.1     例1</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
set mapred.reduce.tasks=2;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
原值</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
select cookie_id,page_id,id fromc02_clickstat_fatdt1</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
where cookie_id IN(’1.193.131.218.1288611279693.0′,’1.193.148.164.1288609861509.2′)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.148.164.1288609861509.2  113181412886099008861288609901078194082403      684000005</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.148.164.1288609861509.2  127001128860563972141288609859828580660473      684000015</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.148.164.1288609861509.2   113181412886099165721288609915890452725326      684000018</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.131.218.1288611279693.0  01c183da6e4bc50712881288611540109914561053      684000114</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.131.218.1288611279693.0  01c183da6e4bc22412881288611414343558274174      684000118</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.131.218.1288611279693.0  01c183da6e4bc50712881288611511781996667988      684000121</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.131.218.1288611279693.0  01c183da6e4bc22412881288611523640691739999      684000126</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.131.218.1288611279693.0  01c183da6e4bc50712881288611540109914561053      684000128</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
hive&gt; select cookie_id,page_id,id fromc02_clickstat_fatdt1 where</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
cookie_idIN(’1.193.131.218.1288611279693.0′,’1.193.148.164.1288609861509.2′)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SORT BY COOKIE_ID,PAGE_ID;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SORT排序后的值</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.131.218.1288611279693.0           684000118       01c183da6e4bc22412881288611414343558274174      684000118</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.131.218.1288611279693.0           684000114      01c183da6e4bc50712881288611540109914561053      684000114</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.131.218.1288611279693.0           684000128      01c183da6e4bc50712881288611540109914561053      684000128</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.148.164.1288609861509.2           684000005      113181412886099008861288609901078194082403      684000005</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.148.164.1288609861509.2           684000018      113181412886099165721288609915890452725326      684000018</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.131.218.1288611279693.0           684000126      01c183da6e4bc22412881288611523640691739999      684000126</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.131.218.1288611279693.0           684000121      01c183da6e4bc50712881288611511781996667988      684000121</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.148.164.1288609861509.2           684000015      127001128860563972141288609859828580660473      684000015</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
select cookie_id,page_id,id fromc02_clickstat_fatdt1</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
where cookie_idIN(’1.193.131.218.1288611279693.0′,’1.193.148.164.1288609861509.2′)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
ORDER BY PAGE_ID,COOKIE_ID;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.131.218.1288611279693.0           684000118      01c183da6e4bc22412881288611414343558274174      684000118</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.131.218.1288611279693.0           684000126      01c183da6e4bc22412881288611523640691739999      684000126</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.131.218.1288611279693.0           684000121      01c183da6e4bc50712881288611511781996667988      684000121</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.131.218.1288611279693.0           684000114      01c183da6e4bc50712881288611540109914561053      684000114</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.131.218.1288611279693.0           684000128       01c183da6e4bc50712881288611540109914561053      684000128</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.148.164.1288609861509.2           684000005      113181412886099008861288609901078194082403      684000005</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.148.164.1288609861509.2           684000018      113181412886099165721288609915890452725326      684000018</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.148.164.1288609861509.2           684000015      127001128860563972141288609859828580660473      684000015</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
可以看到SORT和ORDER排序出来的值不一样。一开始我指定了2个reduce进行数据分发(各自进行排序)。结果不一样的主要原因是上述查询没有reduce key，hive会生成随机数作为reduce key。这样的话输入记录也随机地被分发到不同reducer机器上去了。为了保证reducer之间没有重复的cookie_id记录，可以使用DISTRIBUTE BY关键字指定分发key为cookie_id。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
select cookie_id,country,id,page_id,id fromc02_clickstat_fatdt1 where cookie_idIN(’1.193.131.218.1288611279693.0′,’1.193.148.164.1288609861509.2′)  distribute by cookie_id SORT BY COOKIE_ID,page_id;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.131.218.1288611279693.0           684000118      01c183da6e4bc22412881288611414343558274174      684000118</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.131.218.1288611279693.0           684000126      01c183da6e4bc22412881288611523640691739999      684000126</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.131.218.1288611279693.0           684000121      01c183da6e4bc50712881288611511781996667988      684000121</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.131.218.1288611279693.0           684000114      01c183da6e4bc50712881288611540109914561053      684000114</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.131.218.1288611279693.0           684000128      01c183da6e4bc50712881288611540109914561053      684000128</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.148.164.1288609861509.2           684000005      113181412886099008861288609901078194082403      684000005</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.148.164.1288609861509.2           684000018       113181412886099165721288609915890452725326      684000018</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.193.148.164.1288609861509.2           684000015      127001128860563972141288609859828580660473      684000015</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t81" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791072" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>9.3.2     例2</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
CREATE TABLE if not exists t_order(</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
id int, — 订单编号</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
sale_id int, — 销售ID</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
customer_id int, — 客户ID</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
product _id int, — 产品ID</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
amount int — 数量</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
) PARTITIONED BY (ds STRING);</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
在表中查询所有销售记录，并按照销售ID和数量排序：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
set mapred.reduce.tasks=2;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Select sale_id, amount from t_order</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Sort by sale_id, amount;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
这一查询可能得到非期望的排序。指定的2个reducer分发到的数据可能是（各自排序）：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Reducer1：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Sale_id | amount</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
0 | 100</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1 | 30</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1 | 50</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
2 | 20</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Reducer2：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Sale_id | amount</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
0 | 110</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
0 | 120</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
3 | 50</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
4 | 20</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
使用DISTRIBUTE BY关键字指定分发key为sale_id。改造后的HQL如下：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
set mapred.reduce.tasks=2;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Select sale_id, amount from t_order</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Distribute by sale_id</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Sort by sale_id, amount;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
这样能够保证查询的销售记录集合中，销售ID对应的数量是正确排序的，但是销售ID不能正确排序，原因是hive使用hadoop默认的HashPartitioner分发数据。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
这就涉及到一个全排序的问题。解决的办法无外乎两种：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1.) 不分发数据，使用单个reducer：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
set mapred.reduce.tasks=1;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
这一方法的缺陷在于reduce端成为了性能瓶颈，而且在数据量大的情况下一般都无法得到结果。但是实践中这仍然是最常用的方法，原因是通常排序的查询是为了得到排名靠前的若干结果，因此可以用limit子句大大减少数据量。使用limit n后，传输到reduce端（单机）的数据记录数就减少到n* （map个数）。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
2.) 修改Partitioner，这种方法可以做到全排序。这里可以使用Hadoop自带的TotalOrderPartitioner（来自于Yahoo!的TeraSort项目），这是一个为了支持跨reducer分发有序数据开发的Partitioner，它需要一个SequenceFile格式的文件指定分发的数据区间。如果我们已经生成了这一文件（存储在/tmp/range_key_list，分成100个reducer），可以将上述查询改写为</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
set mapred.reduce.tasks=100;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
sethive.mapred.partitioner=org.apache.hadoop.mapred.lib.TotalOrderPartitioner;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
settotal.order.partitioner.path=/tmp/ range_key_list;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Select sale_id, amount from t_order</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Cluster by sale_id</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Sort by amount;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
有很多种方法生成这一区间文件（例如hadoop自带的o.a.h.mapreduce.lib.partition.InputSampler工具）。这里介绍用Hive生成的方法，例如有一个按id有序的t_sale表：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
CREATE TABLE if not exists t_sale (</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
id int,</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
name string,</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
loc string</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
);</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
则生成按sale_id分发的区间文件的方法是：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
create external table range_keys(sale_idint)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
row format serde</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
‘org.apache.hadoop.hive.serde2.binarysortable.BinarySortableSerDe’</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
stored as</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
inputformat</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
‘org.apache.hadoop.mapred.TextInputFormat’</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
outputformat</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
‘org.apache.hadoop.hive.ql.io.HiveNullValueSequenceFileOutputFormat’</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
location ‘/tmp/range_key_list’;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
insert overwrite table range_keys</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
select distinct sale_id</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
from source t_salesampletable(BUCKET 100 OUT OF 100 ON rand()) s</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
sort by sale_id;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
生成的文件（/tmp/range_key_list目录下）可以让TotalOrderPartitioner按sale_id有序地分发reduce处理的数据。区间文件需要考虑的主要问题是数据分发的均衡性，这有赖于对数据深入的理解。</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t82" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791073" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">9.4 </span>怎样做笛卡尔积</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
当Hive设定为严格模式（hive.mapred.mode=strict）时，不允许在HQL语句中出现笛卡尔积，这实际说明了Hive对笛卡尔积支持较弱。因为找不到Join key，Hive只能使用1个reducer来完成笛卡尔积。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
当然也可以用上面说的limit的办法来减少某个表参与join的数据量，但对于需要笛卡尔积语义的需求来说，经常是一个大表和一个小表的Join操作，结果仍然很大（以至于无法用单机处理），这时MapJoin才是最好的解决办法。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
MapJoin，顾名思义，会在Map端完成Join操作。这需要将Join操作的一个或多个表完全读入内存。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
MapJoin的用法是在查询/子查询的SELECT关键字后面添加/*+ MAPJOIN(tablelist) */提示优化器转化为MapJoin（目前Hive的优化器不能自动优化MapJoin）。其中tablelist可以是一个表，或以逗号连接的表的列表。tablelist中的表将会读入内存，应该将小表写在这里。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
PS：有用户说MapJoin在子查询中可能出现未知BUG。在大表和小表做笛卡尔积时，规避笛卡尔积的方法是，给Join添加一个Join key，原理很简单：将小表扩充一列join key，并将小表的条目复制数倍，join key各不相同；将大表扩充一列join key为随机数。</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t83" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791074" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">9.5 </span>怎样写exist/in子句</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Hive不支持where子句中的子查询，SQL常用的exist in子句需要改写。这一改写相对简单。考虑以下SQL查询语句：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT a.key, a.value</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
FROM a</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
WHERE a.key in</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
(SELECT b.key</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
FROM B);</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
可以改写为</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT a.key, a.value</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
FROM a LEFT OUTER JOIN b ON (a.key =b.key)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
WHERE b.key &lt;&gt; NULL;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
一个更高效的实现是利用left semi join改写为：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT a.key, a.val</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
FROM a LEFT SEMI JOIN b on (a.key =b.key);</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
left semi join是0.5.0以上版本的特性。</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t84" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791075" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">9.6 </span>怎样决定reducer个数</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Hadoop MapReduce程序中，reducer个数的设定极大影响执行效率，这使得Hive怎样决定reducer个数成为一个关键问题。遗憾的是Hive的估计机制很弱，不指定reducer个数的情况下，Hive会猜测确定一个reducer个数，基于以下两个设定：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1. hive.exec.reducers.bytes.per.reducer（默认为1000^3）</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
2. hive.exec.reducers.max（默认为999）</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
计算reducer数的公式很简单：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
N=min(参数2，总输入数据量/参数1)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
通常情况下，有必要手动指定reducer个数。考虑到map阶段的输出数据量通常会比输入有大幅减少，因此即使不设定reducer个数，重设参数2还是必要的。依据Hadoop的经验，可以将参数2设定为0.95*(集群中TaskTracker个数)。</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t85" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791076" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">9.7 </span>合并MapReduce操作</h2>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Multi-group by</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Multi-group by是Hive的一个非常好的特性，它使得Hive中利用中间结果变得非常方便。例如，</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
FROM (SELECT a.status, b.school,b.gender</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
FROM status_updates a JOIN profilesb</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
ON (a.userid = b.userid and</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
a.ds=’2009-03-20′ )</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
) subq1</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
INSERT OVERWRITE TABLEgender_summary</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
PARTITION(ds=’2009-03-20′)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT subq1.gender, COUNT(1) GROUPBY subq1.gender</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
INSERT OVERWRITE TABLEschool_summary</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
PARTITION(ds=’2009-03-20′)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT subq1.school, COUNT(1) GROUPBY subq1.school</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
上述查询语句使用了Multi-group by特性连续group by了2次数据，使用不同的groupby key。这一特性可以减少一次MapReduce操作。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Multi-distinct</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Multi-distinct是淘宝开发的另一个multi-xxx特性，使用Multi-distinct可以在同一查询/子查询中使用多个distinct，这同样减少了多次MapReduce操作</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t86" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791077" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">9.8 </span><span style="border:0px; font-family:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">Bucket <br>
与sampling</span></h2>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Bucket是指将数据以指定列的值为key进行hash，hash到指定数目的桶中。这样就可以支持高效采样了。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
如下例就是以userid这一列为bucket的依据，共设置32个buckets</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">CREATETABLE page_view(viewTime INT, userid BIGINT,</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">                    </span><br>
page_url STRING,referrer_url STRING,</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">                    </span><br>
ip STRING COMMENT ‘IPAddress of the User’)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">    </span>COMMENT ‘This is the page view table’</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">    </span>PARTITIONED BY(dt STRING, country STRING)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">   </span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:red"> </span>CLUSTEREDBY(userid)
 SORTED BY(viewTime) INTO 32 BUCKETS</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">    </span>ROW FORMAT DELIMITED</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">            </span>FIELDS TERMINATED BY ’1′</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">            </span>COLLECTION ITEMS TERMINATED BY ’2′</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">            </span>MAP KEYS TERMINATED BY ’3′</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">    </span><a style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)">STORED
 AS SEQUENCEFILE;</a><a id="_anchor_16" name="_msoanchor_16" href="http://blog.didu.me/article/518#_msocom_16" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial"></a><span style="border:0px; font-family:宋体; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">[王黎16]</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Sampling可以在全体数据上进行采样，这样效率自然就低，它还是要去访问所有数据。而如果一个表已经对某一列制作了bucket，就可以采样所有桶中指定序号的某个桶，这就减少了访问量。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
如下例所示就是采样了page_view中32个桶中的第三个桶。</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">SELECT *FROM page_view </span><br>
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:red">TABLESAMPLE(BUCKET 3 OUT OF 32)</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">;</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t87" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791078" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">9.9 </span>Partition</h2>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Partition就是分区。分区通过在创建表时启用partition by实现，用来partition的维度并不是实际数据的某一列，具体分区的标志是由插入内容时给定的。当要查询某一分区的内容时可以采用where语句，形似where tablename.partition_key &gt;a来实现。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
创建含分区的表</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">    </span>CREATE TABLE page_view(viewTime INT, useridBIGINT,</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">          </span>          page_url STRING, referrer_url STRING,</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">                    </span><br>
ip STRING COMMENT ‘IPAddress of the User’)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">    </span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:red">PARTITIONED
 BY(date STRING, country STRING)</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">    </span>ROW FORMAT DELIMITED</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">            </span>FIELDS TERMINATED BY ’1′</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">    </span><a style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)">STORED
 AS TEXTFILE;</a><a id="_anchor_17" name="_msoanchor_17" href="http://blog.didu.me/article/518#_msocom_17" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial"></a><span style="border:0px; font-family:宋体; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">[王黎17]</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
载入内容，并指定分区标志</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">LOAD DATALOCAL INPATH <code style="border:0px; font-family:Monaco,Consolas,'Andale Mono','DejaVu Sans Mono',monospace; font-size:13px; margin:0px; outline:0px; padding:0px; vertical-align:baseline; line-height:normal">/tmp/pv_2008-06-08_us.txt</code> INTO
 TABLE page_view<br>
</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:red">PARTITION(date=’2008-06-08′,country=’US’)</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">;</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
查询指定标志的分区内容</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; background-color:rgb(243,245,247)">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">SELECTpage_views.*</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">    </span>FROM page_views</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">    </span>WHERE <span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:red"><br>
page_views.date &gt;=’2008-03-01′ AND page_views.date &lt;= ’2008-03-31′</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> AND page_views.referrer_urllike ‘%xyz.com’;</span></p>
</div>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black"> </span></p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t88" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791079" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">9.10        </span>JOIN</h2>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t89" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791080" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>9.10.1             JOIN原则</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
在使用写有 Join 操作的查询语句时有一条原则：应该将条目少的表/子查询放在 Join 操作符的左边。原因是在 Join 操作的 Reduce 阶段，位于 Join 操作符左边的表的内容会被加载进内存，将条目少的表放在左边，可以有效减少发生OOM 错误的几率。对于一条语句中有多个 Join 的情况，如果 Join 的条件相同，比如查询：</p>
<table class="alignleft" border="1" cellspacing="0" cellpadding="0" style="border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 1.625em; outline:0px; padding:0px; vertical-align:baseline; border-spacing:0px; display:inline; float:left; width:688px; background-color:rgb(255,250,205)">
<tbody style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
INSERT OVERWRITE TABLE pv_users 
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT pv.pageid, u.age FROM page_view p</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
JOIN user u ON (pv.userid = u.userid)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
JOIN newuser x ON (u.userid = x.userid);</p>
</td>
</tr>
</tbody>
</table>
<ul type="disc" style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 1.625em 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:square">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
如果 Join 的 key 相同，不管有多少个表，都会则会合并为一个 Map-Reduce</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
一个 Map-Reduce 任务，而不是 ‘n’ 个</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
在做 OUTER JOIN 的时候也是一样</li></ul>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
如果 Join 的条件不相同，比如：</p>
<table class="alignleft" border="1" cellspacing="0" cellpadding="0" style="border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 1.625em; outline:0px; padding:0px; vertical-align:baseline; border-spacing:0px; display:inline; float:left; width:688px; background-color:rgb(255,250,205)">
<tbody style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
INSERT OVERWRITE TABLE pv_users 
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT pv.pageid, u.age FROM page_view p</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
JOIN user u ON (pv.userid = u.userid)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
JOIN newuser x on (u.age = x.age);</p>
</td>
</tr>
</tbody>
</table>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Map-Reduce 的任务数目和Join 操作的数目是对应的，上述查询和以下查询是等价的：</p>
<table class="alignleft" border="1" cellspacing="0" cellpadding="0" style="border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 1.625em; outline:0px; padding:0px; vertical-align:baseline; border-spacing:0px; display:inline; float:left; width:688px; background-color:rgb(255,250,205)">
<tbody style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
INSERT OVERWRITE TABLE tmptable 
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT * FROM page_view p JOIN user u</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
ON (pv.userid = u.userid);</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
INSERT OVERWRITE TABLE pv_users</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT x.pageid, x.age FROM tmptable x</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
JOIN newuser y ON (x.age = y.age);</p>
</td>
</tr>
</tbody>
</table>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t90" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791081" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="Map_Join" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>9.10.2             MAP
 JOIN</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Join 操作在 Map 阶段完成，不再需要Reduce，前提条件是需要的数据在 Map 的过程中可以访问到。比如查询：</p>
<table class="alignleft" border="1" cellspacing="0" cellpadding="0" style="border-width:0px 0px 1px; border-bottom-style:solid; border-bottom-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 1.625em; outline:0px; padding:0px; vertical-align:baseline; border-spacing:0px; display:inline; float:left; width:688px; background-color:rgb(255,250,205)">
<tbody style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<tr style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<td style="border-width:1px 0px 0px; border-top-style:solid; border-top-color:rgb(221,221,221); font-family:inherit; font-size:15px; font-style:inherit; margin:0px; outline:0px; padding:6px 10px 6px 0px; vertical-align:baseline">
INSERT OVERWRITE TABLE pv_users 
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
SELECT /*+ MAPJOIN(pv) */ pv.pageid, u.age</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
FROM page_view pv</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
JOIN user u ON (pv.userid = u.userid);</p>
</td>
</tr>
</tbody>
</table>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
可以在 Map 阶段完成 Join，如图所示：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
相关的参数为：</p>
<ul type="disc" style="border:0px; font-family:inherit; font-style:inherit; margin:0px 0px 1.625em 2.5em; outline:0px; padding:0px; vertical-align:baseline; list-style:square">
<li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">hive.join.emit.interval = 1000</span> How many rows in the right-most join operand Hive should buffer before emitting the join result.</li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">hive.mapjoin.size.key = 10000</span></li><li style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">hive.mapjoin.cache.numrows = 10000</span></li></ul>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t91" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">9.11        </span>数据倾斜</h2>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t92" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>9.11.1             空值数据倾斜</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">场景：</span>如日志中，常会有信息丢失的问题，比如全网日志中的user_id，如果取其中的user_id和bmw_users关联，会碰到数据倾斜的问题。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">解决方法1：</span> user_id为空的不参与关联</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Select * From log a</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Join bmw_users b</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
On a.user_id is not null</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
And a.user_id = b.user_id</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Union all</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Select * from log a</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
where a.user_id is null;</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">解决方法2 ：</span>赋与空值分新的key值</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Select *</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
from log a</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
left outer join bmw_users b</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">on case when a.user_id is null thenconcat(‘dp_hive’,rand() ) else a.user_id end = b.user_id; </span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">结论：</span>方法2比方法效率更好，不但io少了，而且作业数也少了。方法1 log读取两次，jobs是2。方法2 job数是1 。这个优化适合无效id(比如-99,’’,null等)产生的倾斜问题。把空值的key变成一个字符串加上随机数，就能把倾斜的数据分到不同的reduce上
 ,解决数据倾斜问题。附上hadoop通用关联的实现方法（关联通过二次排序实现的，关联的列为parition key,关联的列c1和表的tag组成排序的group key,根据parition key分配reduce。同一reduce内根据group<br>
key排序）</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t93" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>9.11.2             不同数据类型关联产生数据倾斜</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">场景：</span>一张表s8的日志，每个商品一条记录，要和商品表关联。但关联却碰到倾斜的问题。s8的日志中有字符串商品id,也有数字的商品id,类型是string的，但商品中的数字id是bigint的。猜测问题的原因是把s8的商品id转成数字id做hash来分配reduce，所以字符串id的s8日志，都到一个reduce上了，解决的方法验证了这个猜测。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">解决方法：</span>把数字类型转换成字符串类型</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Select * from s8_log a</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Left outer join r_auction_auctions b</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
On a.auction_id = cast(b.auction_id asstring);</p>
<h3 style="border:0px; font-family:inherit; font-size:10px; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; clear:both; letter-spacing:0.1em; line-height:2.6em; text-transform:uppercase">
<a name="t94" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791082" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>9.11.3             大表JOIN的数据偏斜</h3>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
MapReduce编程模型下开发代码需要考虑数据偏斜的问题，Hive代码也是一样。数据偏斜的原因包括以下两点：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1. Map输出key数量极少，导致reduce端退化为单机作业。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
2. Map输出key分布不均，少量key对应大量value，导致reduce端单机瓶颈。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Hive中我们使用MapJoin解决数据偏斜的问题，即将其中的某个表（全量）分发到所有Map端进行Join，从而避免了reduce。这要求分发的表可以被全量载入内存。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
极限情况下，Join两边的表都是大表，就无法使用MapJoin。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
这种问题最为棘手，目前已知的解决思路有两种：</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1. 如果是上述情况1，考虑先对Join中的一个表去重，以此结果过滤无用信息。这样一般会将其中一个大表转化为小表，再使用MapJoin 。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
一个实例是广告投放效果分析，例如将广告投放者信息表i中的信息填充到广告曝光日志表w中，使用投放者id关联。因为实际广告投放者数量很少（但是投放者信息表i很大），因此可以考虑先在w表中去重查询所有实际广告投放者id列表，以此Join过滤表i，这一结果必然是一个小表，就可以使用MapJoin。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
2. 如果是上述情况2，考虑切分Join中的一个表为多片，以便将切片全部载入内存，然后采用多次MapJoin得到结果。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
一个实例是商品浏览日志分析，例如将商品信息表i中的信息填充到商品浏览日志表w中，使用商品id关联。但是某些热卖商品浏览量很大，造成数据偏斜。例如，以下语句实现了一个inner join逻辑，将商品信息表拆分成2个表：</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
select * from</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
(</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
select w.id, w.time, w.amount, i1.name, i1.loc, i1.cat</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
from w left outer join i sampletable(1 out of 2 on id) i1</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
union all</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
(</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
select w.id, w.time, w.amount, i2.name, i2.loc, i2.cat</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
from w left outer join i sampletable(1 out of 2 on id) i2</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
);</p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
以下语句实现了left outer join逻辑：</p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
select t1.id, t1.time, t1.amount,</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
coalease(t1.name,t2.name),</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
coalease(t1.loc, t2.loc),</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
coalease(t1.cat, t2.cat)</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
from (</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
select w.id, w.time,w.amount, i1.name, i1.loc, i1.cat</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
from w left outer join isampletable(1 out of 2 on id) i1</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
) t1 left outer join i sampletable(2 out of 2 on id)t2;</p>
</div>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
上述语句使用Hive的sample table特性对表做切分。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t95" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791083" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">9.12        </span>合并小文件</h2>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
文件数目过多，会给 HDFS 带来压力，并且会影响处理效率，可以通过合并 Map 和 Reduce 的结果文件来消除这样的影响：</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
hive.merge.mapfiles = true 是否和并 Map 输出文件，默认为 True</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
hive.merge.mapredfiles = false 是否合并 Reduce 输出文件，默认为 False</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
hive.merge.size.per.task = 256*1000*1000 合并文件的大小</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h2 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t96" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791084" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><span style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">9.13        </span>GroupBy</h2>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
·        Map 端部分聚合：</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
     并不是所有的聚合操作都需要在 Reduce 端完成，很多聚合操作都可以先在Map 端进行部分聚合，最后在 Reduce 端得出最终结果。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
      基于 Hash</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
      参数包括：</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
§  hive.map.aggr = true 是否在 Map 端进行聚合，默认为 True</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
§  hive.groupby.mapaggr.checkinterval= 100000 在 Map 端进行聚合操作的条目数目</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
·        有数据倾斜的时候进行负载均衡</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
      hive.groupby.skewindata= false</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
     当选项设定为 true，生成的查询计划会有两个 MR Job。第一个 MR Job 中，Map 的输出结果集合会随机分布到 Reduce 中，每个 Reduce 做部分聚合操作，并输出结果，这样处理的结果是相同的 Group By Key 有可能被分发到不同的Reduce 中，从而达到负载均衡的目的；第二个 MR Job再根据预处理的数据结果按照 Group By Key 分布到 Reduce 中（这个过程可以保证相同的Group By Key 被分布到同一个 Reduce<br>
中），最后完成最终的聚合操作。</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h1 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t97" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a><a name="_Toc280791085" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>10.        HIVE
 FAQ</h1>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
1、 [admin@hadoop1 ~]$ hive</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Cannot find hadoop installation: $HADOOP_HOME must be set orhadoop must be in the path</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
原因：HADOOP路径没有在环境变量中定义</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
解决方法：admin@hadoop1~]$ export HADOOP_HOME=$HOME/hadoop-0.19.2</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
2、FAILED: Execution Error, return code 1 fromorg.apache.hadoop.hive.ql.exec.DDLTask</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
解决方案：Hive的元数据库derby服务没有启动</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
进入到hive的安装目录</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
/home/admin/caona/hive/build/dist/db-derby-10.4.1.3-bin/bin</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
运行startNetworkServer -h 0.0.0.0</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
3、[admin@hadoop1 conf]$ hive</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Unable to createlog directory ${build.dir}/tmp</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
原因：存放日志文件的目录被人删除了。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
解决方法：进行到${build.dir}下面，创建一个tmp目录。</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
如：[admin@hadoop1build]$ pwd</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
/home/admin/caona/hive/build</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
[admin@hadoop1build]$ mkdir tmp</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
<h1 style="border:0px; font-family:inherit; font-size:15px; font-style:inherit; margin:0px 0px 0.8125em; outline:0px; padding:0px; vertical-align:baseline; clear:both; color:rgb(0,0,0)">
<a name="t98" style="border:0px; font-family:inherit; font-style:inherit; font-weight:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(25,130,209)"></a>11.        常用参考资料路径</h1>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Hive地址</p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<a title="阿里旺旺无法确定该链接的安全性" href="http://wiki.apache.org/hadoop/Hive" rel="nofollow" target="_blank" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">http://wiki.apache.org/hadoop/Hive</a></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">http://hive.apache.org/</span></p>
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
Velocity地址</p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<a title="阿里旺旺无法确定该链接的安全性" href="http://velocity.apache.org/engine/releases/velocity-1.7/user-guide.html" rel="nofollow" target="_blank" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">http://velocity.apache.org/engine/releases/velocity-1.7/user-guide.html</a></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">Hadoop</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">地址</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<a href="http://hadoop.apache.org/" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">http://hadoop.apache.org/</a></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<a href="http://www.cloudera.com/" rel="nofollow" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">http://www.cloudera.com/</a></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">Hadoop</span><span style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:black">中文文档地址</span></p>
<p align="left" style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
<a title="阿里旺旺无法确定该链接的安全性" href="http://hadoop.apache.org/common/docs/r0.18.2/cn/commands_manual.html" rel="nofollow" target="_blank" style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial">http://hadoop.apache.org/common/docs/r0.18.2/cn/commands_manual.html</a></p>
<div style="border:0px; font-family:inherit; font-style:inherit; margin:0px; outline:0px; padding:0px; vertical-align:baseline">
<hr align="left" size="1" width="33%" style="background-color:rgb(204,204,204); border:0px; height:1px; margin-bottom:1.625em">
<p style="border:0px; font-family:inherit; font-style:inherit; margin-top:0px; margin-bottom:1.625em; outline:0px; padding-top:0px; padding-bottom:0px; vertical-align:baseline">
</p>
</div>
</div>
</div>
<span style="color:rgb(55,55,55); font-family:Arial,sans-serif; font-size:15px; line-height:23px; background-color:rgb(247,247,247)">&lt;文/reader&gt; </span><br style="color:rgb(55,55,55); font-family:Arial,sans-serif; font-size:15px; line-height:23px; background-color:rgb(247,247,247)">
<span style="color:rgb(55,55,55); font-family:Arial,sans-serif; font-size:15px; line-height:23px; background-color:rgb(247,247,247)">除特殊注明，本站内容均为原创，转载请注明出处：</span><a href="http://blog.didu.me/article/518" rel="nofollow" style="border:0px; font-family:Arial,sans-serif; font-size:15px; margin:0px; outline:0px; padding:0px; vertical-align:baseline; color:rgb(17,89,143); text-decoration:initial; line-height:23px; background-color:rgb(247,247,247)">http://blog.didu.me/article/518</a><span style="color:rgb(55,55,55); font-family:Arial,sans-serif; font-size:15px; line-height:23px; background-color:rgb(247,247,247)"> </span>
            </div>
                </div>