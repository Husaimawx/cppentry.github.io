---
layout:     post
title:      flume入门配置
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<p></p>
<div style="text-align:left">一、什么是Flume?</div>
<div style="text-align:left">　　flume 作为 cloudera 开发的实时日志收集系统，受到了业界的认可与广泛应用。Flume 初始的发行版本目前被统称为 Flume OG（original generation），属于 cloudera。但随着 FLume 功能的扩展，Flume OG 代码工程臃肿、核心组件设计不合理、核心配置不标准等缺点暴露出来，尤其是在 Flume OG 的最后一个发行版本 0.94.0 中，日志传输不稳定的现象尤为严重，为了解决这些问题，2011 年
 10 月 22 号，cloudera 完成了 Flume-728，对 Flume 进行了里程碑式的改动：重构核心组件、核心配置以及代码架构，重构后的版本统称为 Flume NG（next generation）；改动的另一原因是将 Flume 纳入 apache 旗下，cloudera Flume 改名为 Apache Flume。</div>
<div style="text-align:left"> </div>
<div style="text-align:left">flume的特点：</div>
<div style="text-align:left">　　flume是一个分布式、可靠、和高可用的海量日志采集、聚合和传输的系统。支持在日志系统中定制各类数据发送方，用于收集数据;同时，Flume提供对数据进行简单处理，并写到各种数据接受方(比如文本、HDFS、Hbase等)的能力 。</div>
<div style="text-align:left">　　flume的数据流由事件(Event)贯穿始终。事件是Flume的基本数据单位，它携带日志数据(字节数组形式)并且携带有头信息，这些Event由Agent外部的Source生成，当Source捕获事件后会进行特定的格式化，然后Source会把事件推入(单个或多个)Channel中。你可以把Channel看作是一个缓冲区，它将保存事件直到Sink处理完该事件。Sink负责持久化日志或者把事件推向另一个Source。</div>
<div style="text-align:left"> </div>
<div style="text-align:left">flume的可靠性 </div>
<div style="text-align:left">　　当节点出现故障时，日志能够被传送到其他节点上而不会丢失。Flume提供了三种级别的可靠性保障，从强到弱依次分别为：end-to-end（收到数据agent首先将event写到磁盘上，当数据传送成功后，再删除；如果数据发送失败，可以重新发送。），Store on failure（这也是scribe采用的策略，当数据接收方crash时，将数据写到本地，待恢复后，继续发送），Besteffort（数据发送到接收方后，不会进行确认）。</div>
<div style="text-align:left"> </div>
<div style="text-align:left">flume的可恢复性：</div>
<div style="text-align:left">　　还是靠Channel。推荐使用FileChannel，事件持久化在本地文件系统里(性能较差)。 </div>
<div style="text-align:left"> </div>
<div style="text-align:left">　　flume的一些核心概念：</div>
<div style="text-align:left">Agent使用JVM 运行Flume。每台机器运行一个agent，但是可以在一个agent中包含多个sources和sinks。</div>
<div style="text-align:left">Client生产数据，运行在一个独立的线程。</div>
<div style="text-align:left">Source从Client收集数据，传递给Channel。</div>
<div style="text-align:left">Sink从Channel收集数据，运行在一个独立线程。</div>
<div style="text-align:left">Channel连接 sources 和 sinks ，这个有点像一个队列。</div>
<div style="text-align:left">Events可以是日志记录、 avro 对象等。</div>
<div style="text-align:left"> </div>
<div style="text-align:left">　　Flume以agent为最小的独立运行单位。一个agent就是一个JVM。单agent由Source、Sink和Channel三大组件构成，如下图：</div>
<p></p>
<p style="text-align:left"> <img src="https://img-blog.csdn.net/20160516154636130?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p style="text-align:left">　　值得注意的是，Flume提供了大量内置的Source、Channel和Sink类型。不同类型的Source,Channel和Sink可以自由组合。组合方式基于用户设置的配置文件，非常灵活。比如：Channel可以把事件暂存在内存里，也可以持久化到本地硬盘上。Sink可以把日志写入HDFS, HBase，甚至是另外一个Source等等。Flume支持用户建立多级流，也就是说，多个agent可以协同工作，并且支持Fan-in、Fan-out、Contextual
 Routing、Backup Routes，这也正是NB之处。如下图所示:</p>
<p style="text-align:left"> <img src="https://img-blog.csdn.net/20160516154704318?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<div id="f21ac82b21eeb7322631b6aa94e17f452krs0jm" class="imageplus-append" style="border-bottom:medium none; border-left:medium none; padding-bottom:0px; margin:0px 0px 0px 0pt; padding-left:0px; padding-right:0px; border-top:medium none; border-right:medium none; padding-top:0px">
</div>
<div style="text-align:left"><br>
</div>
<p style="text-align:left"></p>
<p></p>
<div style="text-align:left">　　二、flume的官方网站在哪里？</div>
<div style="text-align:left">　　<a target="_blank" href="http://flume.apache.org/" rel="nofollow">http://flume.apache.org/</a></div>
<p></p>
<p style="text-align:left">　　三、在哪里下载？</p>
<p style="text-align:left">　　<a target="_blank" href="http://www.apache.org/dyn/closer.cgi/flume/1.5.0/apache-flume-1.5.0-bin.tar.gz" rel="nofollow">http://www.apache.org/dyn/closer.cgi/flume/1.5.0/apache-flume-1.5.0-bin.tar.gz</a></p>
<p></p>
<div style="text-align:left">　　四、如何安装？</div>
<div style="text-align:left">　　　　1)将下载的flume包，解压到/home/hadoop目录中，你就已经完成了50%：）简单吧</div>
<p></p>
<p style="text-align:left">　　　　2)修改 flume-env.sh 配置文件,主要是JAVA_HOME变量设置 </p>
<p></p><pre><code class="language-plain">&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;root@m1:/home/hadoop/flume-1.5.0-bin# cp conf/flume-env.sh.template conf/flume-env.sh&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;root@m1:/home/hadoop/flume-1.5.0-bin# vi conf/flume-env.sh&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;# or more contributor license agreements. See the NOTICE file&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;# Licensed to the Apache Software Foundation (ASF) under one&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;# distributed with this work for additional information&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;# "License"); you may not use this file except in compliance&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;# regarding copyright ownership. The ASF licenses this file&lt;/span&gt;&lt;/div&gt;# to you under the Apache License, Version 2.0 (the
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;#&lt;/span&gt;&lt;/div&gt;# with the License. You may obtain a copy of the License at
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;# distributed under the License is distributed on an "AS IS" BASIS,&lt;/span&gt;&lt;/div&gt;#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;# Enviroment variables can be set here.&lt;/span&gt;&lt;/div&gt;# See the License for the specific language governing permissions and
# limitations under the License.
   
# If this file is placed at FLUME_CONF_DIR/flume-env.sh, it will be sourced
# during Flume startup.
   
   
JAVA_HOME=/usr/lib/jvm/java-7-oracle
   
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;#FLUME_CLASSPATH=""&lt;/span&gt;&lt;/div&gt;# Give Flume more memory and pre-allocate, enable remote monitoring via JMX
#JAVA_OPTS="-Xms100m -Xmx200m -Dcom.sun.management.jmxremote"
   
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;# Note that the Flume conf directory is always included in the classpath.&lt;/span&gt;&lt;/div&gt;</code></pre>
<div style="text-align:left"><br>
</div>
<div style="text-align:left"><br>
</div>
<p></p>
<p style="text-align:left"><br>
</p>
<p style="text-align:left">　　　3)验证是否安装成功 </p>
<p></p><pre><code class="language-plain">&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;root@m1:/home/hadoop# /home/hadoop/flume-1.5.0-bin/bin/flume-ng version&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;Flume 1.5.0&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;Source code repository: https://git-wip-us.apache.org/repos/asf/flume.git&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;Revision: 8633220df808c4cd0c13d1cf0320454a94f1ea97&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;From sourcewith checksum a01fe726e4380ba0c9f7a7d222db961f&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;Compiled by hshreedharan on Wed May 7 14:49:18 PDT 2014&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;root@m1:/home/hadoop#&lt;/span&gt;&lt;/div&gt;</code></pre>
<div style="text-align:left"><br>
</div>
<div style="text-align:left"><br>
</div>
<p></p>
<p style="text-align:left">　　　出现上面的信息，表示安装成功了</p>
<p></p>
<div style="text-align:left"> </div>
<div style="text-align:left"> </div>
<div style="text-align:left">　　五、flume的案例</div>
<div style="text-align:left">　　　　1)案例1：Avro</div>
<div style="text-align:left">　　　　Avro可以发送一个给定的文件给Flume，Avro 源使用AVRO RPC机制。</div>
<div style="text-align:left">　　　　　　a)创建agent配置文件 </div>
<p></p>
<p></p>
<div style="text-align:left"><span style="white-space:pre"></span></div>
<span style="white-space:pre"></span><pre><code class="language-plain">&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;root@m1:/home/hadoop#vi /home/hadoop/flume-1.5.0-bin/conf/avro.conf&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;   &lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources = r1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sinks = k1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.channels = c1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;   &lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources.r1.channels = c1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;# Describe/configure the source&lt;/span&gt;&lt;/div&gt;a1.sources.r1.type= avro
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;# Use a channel which buffers events in memory&lt;/span&gt;&lt;/div&gt;a1.sources.r1.bind = 0.0.0.0
a1.sources.r1.port = 4141
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sinks.k1.type= logger&lt;/span&gt;&lt;/div&gt;   
# Describe the sink
   
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;# Bind the source and sink to the channel&lt;/span&gt;&lt;/div&gt;a1.channels.c1.type= memory
a1.channels.c1.capacity = 1000
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.channels.c1.transactionCapacity = 100&lt;/span&gt;&lt;/div&gt;   
a1.sources.r1.channels = c1
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sinks.k1.channel = c1&lt;/span&gt;&lt;/div&gt;</code></pre>
<div style="text-align:left"><br>
</div>
<p></p>
<p style="text-align:left">　　b)启动flume agent a1</p>
<div class="jb51code">
<div id="highlighter_900051" class="syntaxhighlighter  bash ie">
<div class="toolbar">
<div style="text-align:left"><span style="white-space:pre"></span></div>
<span style="white-space:pre"></span><pre><code class="language-plain">root@m1:/home/hadoop# /home/hadoop/flume-1.5.0-bin/bin/flume-ng agent -c . -f /home/hadoop/flume-1.5.0-bin/conf/avro.conf -n a1 -Dflume.root.logger=INFO,console</code></pre>
<div style="text-align:left"><br>
</div>
<div style="text-align:left"> </div>
</div>
<div class="toolbar" style="text-align:left">　　c)创建指定文件</div>
</div>
</div>
<div class="jb51code">
<div id="highlighter_574612" class="syntaxhighlighter  bash ie">
<div class="toolbar"><pre><code class="language-plain">root@m1:/home/hadoop# echo "hello world" &gt; /home/hadoop/flume-1.5.0-bin/log.00</code></pre>
<div style="text-align:left"><br>
</div>
<div style="text-align:left"> </div>
</div>
<div class="toolbar" style="text-align:left">　　　　d)使用avro-client发送文件</div>
</div>
</div>
<div class="jb51code">
<div id="highlighter_133273" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><br>
</div>
<pre><code class="language-plain">root@m1:/home/hadoop# /home/hadoop/flume-1.5.0-bin/bin/flume-ng avro-client -c . -H m1 -p 4141 -F /home/hadoop/flume-1.5.0-bin/log.00</code></pre>
<div style="text-align:left"><br>
</div>
<div style="text-align:left"><br>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　f)在m1的控制台，可以看到以下信息，注意最后一行： </p>
<p style="text-align:left"><br>
</p>
<p></p>
<div style="text-align:left"><span style="white-space:pre"></span></div>
<span style="white-space:pre"></span><pre><code class="language-plain">&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;root@m1:/home/hadoop/flume-1.5.0-bin/conf# /home/hadoop/flume-1.5.0-bin/bin/flume-ng agent -c . -f /home/hadoop/flume-1.5.0-bin/conf/avro.conf -n a1 -Dflume.root.logger=INFO,console&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;Info: Sourcing environment configuration script/home/hadoop/flume-1.5.0-bin/conf/flume-env.sh&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;Info: Excluding /home/hadoop/hadoop-2.2.0/share/hadoop/common/lib/slf4j-api-1.7.5.jar from classpath&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;Info: Including Hadoop libraries found via (/home/hadoop/hadoop-2.2.0/bin/hadoop)for HDFS access&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;-08-10 10:43:25,112 (New I/Oworker #1) [INFO - org.apache.avro.ipc.NettyServer$NettyServerAvroHandler.handleUpstream(NettyServer.java:171)] [id: 0x92464c4f, /192.168.1.50:59850 :&gt; /192.168.1.50:4141] UNBOUND&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;Info: Excluding /home/hadoop/hadoop-2.2.0/share/hadoop/common/lib/slf4j-log4j12-1.7.5.jar from classpath&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;...&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;-08-10 10:43:25,112 (New I/Oworker #1) [INFO - org.apache.avro.ipc.NettyServer$NettyServerAvroHandler.handleUpstream(NettyServer.java:171)] [id: 0x92464c4f, /192.168.1.50:59850 :&gt; /192.168.1.50:4141] CLOSED&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;-08-10 10:43:25,112 (New I/Oworker #1) [INFO - org.apache.avro.ipc.NettyServer$NettyServerAvroHandler.channelClosed(NettyServer.java:209)] Connection to /192.168.1.50:59850 disconnected.&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;-08-10 10:43:26,718 (SinkRunner-PollingRunner-DefaultSinkProcessor) [INFO - org.apache.flume.sink.LoggerSink.process(LoggerSink.java:70)] Event: { headers:{} body: 68 65 6C 6C 6F 20 77 6F 72 6C 64        hello world }&lt;/span&gt;&lt;/div&gt;</code></pre>
<div style="text-align:left"><br>
</div>
<p></p>
<p style="text-align:left">　2)案例2：Spool</p>
<p></p>
<div style="text-align:left">　　　　Spool监测配置的目录下新增的文件，并将文件中的数据读取出来。需要注意两点：</div>
<div style="text-align:left">　　　　1) 拷贝到spool目录下的文件不可以再打开编辑。</div>
<div style="text-align:left">　　　　2) spool目录下不可包含相应的子目录</div>
<div style="text-align:left">　　　　　　a)创建agent配置文件 </div>
<p></p>
<p style="text-align:left"><br>
</p>
<p></p><pre><code class="language-plain">&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;root@m1:/home/hadoop# vi /home/hadoop/flume-1.5.0-bin/conf/spool.conf&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources = r1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sinks = k1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.channels = c1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources.r1.channels = c1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;# Describe/configure the source&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources.r1.type= spooldir&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources.r1.fileHeader =true&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources.r1.spoolDir =/home/hadoop/flume-1.5.0-bin/logs&lt;/span&gt;&lt;/div&gt;# Describe the sink
a1.sinks.k1.type= logger
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.channels.c1.transactionCapacity = 100&lt;/span&gt;&lt;/div&gt;# Use a channel which buffers events in memory
a1.channels.c1.type= memory
a1.channels.c1.capacity = 1000
# Bind the source and sink to the channel
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sinks.k1.channel = c1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources.r1.channels = c1&lt;/span&gt;&lt;/div&gt;</code></pre>
<div style="text-align:left"><br>
</div>
<div style="text-align:left"><br>
</div>
<p></p>
<p style="text-align:left">　　b)启动flume agent a1</p>
<div class="jb51code">
<div id="highlighter_32713" class="syntaxhighlighter  bash ie">
<div class="toolbar">
<div style="text-align:left"> </div>
<pre><code class="language-plain">root@m1:/home/hadoop# /home/hadoop/flume-1.5.0-bin/bin/flume-ng agent -c . -f /home/hadoop/flume-1.5.0-bin/conf/spool.conf -n a1 -Dflume.root.logger=INFO,console</code></pre>
<div style="text-align:left"><br>
</div>
<div style="text-align:left">　　　c)追加文件到/home/hadoop/flume-1.5.0-bin/logs目录</div>
</div>
</div>
</div>
<div class="jb51code">
<div id="highlighter_175878" class="syntaxhighlighter  bash ie">
<div class="toolbar">
<div style="text-align:left"><span style="white-space:pre"></span></div>
<span style="white-space:pre"></span><pre><code class="language-plain">root@m1:/home/hadoop# echo "spool test1" &gt; /home/hadoop/flume-1.5.0-bin/logs/spool_text.log</code></pre>
<div style="text-align:left"><br>
</div>
<div style="text-align:left"> </div>
</div>
<div class="toolbar" style="text-align:left">　　d)在m1的控制台，可以看到以下相关信息： </div>
<div class="toolbar" style="text-align:left"><br>
</div>
<div class="toolbar"><pre><code class="language-plain">&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;/08/10 11:37:13 INFO source.SpoolDirectorySource: Spooling Directory Source runner has shutdown.&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;/08/10 11:37:13 INFO source.SpoolDirectorySource: Spooling Directory Source runner has shutdown.&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;/08/10 11:37:14 INFO avro.ReliableSpoolingFileEventReader: Preparing to move file /home/hadoop/flume-1.5.0-bin/logs/spool_text.log to /home/hadoop/flume-1.5.0-bin/logs/spool_text.log.COMPLETED&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;/08/10 11:37:14 INFO source.SpoolDirectorySource: Spooling Directory Source runner has shutdown.&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;/08/10 11:37:14 INFO source.SpoolDirectorySource: Spooling Directory Source runner has shutdown.&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;/08/10 11:37:15 INFO source.SpoolDirectorySource: Spooling Directory Source runner has shutdown.&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;/08/10 11:37:14 INFO sink.LoggerSink: Event: { headers:{file=/home/hadoop/flume-1.5.0-bin/logs/spool_text.log} body: 73 70 6F 6F 6C 20 74 65 73 74 31        spool test1 }&lt;/span&gt;&lt;/div&gt;/08/10 11:37:15 INFO source.SpoolDirectorySource: Spooling Directory Source runner has shutdown.
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;/08/10 11:37:17 INFO source.SpoolDirectorySource: Spooling Directory Source runner has shutdown.&lt;/span&gt;&lt;/div&gt;/08/10 11:37:16 INFO source.SpoolDirectorySource: Spooling Directory Source runner has shutdown.
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;/08/10 11:37:16 INFO source.SpoolDirectorySource: Spooling Directory Source runner has shutdown.&lt;/span&gt;&lt;/div&gt;</code></pre>
<div style="text-align:left"><br>
</div>
<div style="text-align:left"><br>
</div>
</div>
<div class="toolbar" style="text-align:left"><br>
</div>
<div class="toolbar" style="text-align:left">　3)案例3：Exec</div>
</div>
</div>
<p></p>
<div style="text-align:left">　　　　EXEC执行一个给定的命令获得输出的源,如果要使用tail命令，必选使得file足够大才能看到输出内容</div>
<div style="text-align:left">　　　　　　a)创建agent配置文件 </div>
<p></p>
<p></p><pre><code class="language-plain">&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;root@m1:/home/hadoop# vi /home/hadoop/flume-1.5.0-bin/conf/exec_tail.conf&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources = r1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sinks = k1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.channels = c1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources.r1.channels = c1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;# Describe/configure the source&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources.r1.type= exec&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;# Describe the sink&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources.r1.command= tail -F /home/hadoop/flume-1.5.0-bin/log_exec_tail&lt;/span&gt;&lt;/div&gt;a1.sinks.k1.type= logger
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.channels.c1.transactionCapacity = 100&lt;/span&gt;&lt;/div&gt;# Use a channel which buffers events in memory
a1.channels.c1.type= memory
a1.channels.c1.capacity = 1000
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sinks.k1.channel = c1&lt;/span&gt;&lt;/div&gt;# Bind the source and sink to the channel
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources.r1.channels = c1&lt;/span&gt;&lt;/div&gt;</code></pre>
<div style="text-align:left"><br>
</div>
<div style="text-align:left"><br>
</div>
<p></p>
<p style="text-align:left"><br>
</p>
<p style="text-align:left">　b)启动flume agent a1</p>
<div class="jb51code">
<div id="highlighter_281892" class="syntaxhighlighter  bash ie">
<div class="toolbar"><pre><code class="language-plain">root@m1:/home/hadoop# /home/hadoop/flume-1.5.0-bin/bin/flume-ng agent -c . -f /home/hadoop/flume-1.5.0-bin/conf/exec_tail.conf -n a1 -Dflume.root.logger=INFO,console</code></pre>
<div style="text-align:left"><br>
</div>
<div style="text-align:left"><br>
</div>
</div>
<div class="toolbar" style="text-align:left"><br>
</div>
<div class="toolbar" style="text-align:left">　　　　　　c)生成足够多的内容在文件里 </div>
<div class="toolbar"><pre><code class="language-plain">root@m1:/home/hadoop# for i in {1..100};do echo "exec tail$i" &gt;&gt; /home/hadoop/flume-1.5.0-bin/log_exec_tail;echo $i;sleep 0.1;done</code></pre>
<div style="text-align:left"><br>
</div>
<div style="text-align:left"><br>
</div>
</div>
<div class="toolbar" style="text-align:left"><br>
</div>
<div class="toolbar" style="text-align:left">　e)在m1的控制台，可以看到以下信息： </div>
<div class="toolbar" style="text-align:left"><br>
</div>
<div class="toolbar"><pre><code class="language-plain">&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;-08-10 10:59:25,513 (SinkRunner-PollingRunner-DefaultSinkProcessor) [INFO - org.apache.flume.sink.LoggerSink.process(LoggerSink.java:70)] Event: { headers:{} body: 65 78 65 63 20 74 61 69 6C 20 74 65 73 74    exec tail test }&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;-08-10 10:59:34,535 (SinkRunner-PollingRunner-DefaultSinkProcessor) [INFO - org.apache.flume.sink.LoggerSink.process(LoggerSink.java:70)] Event: { headers:{} body: 65 78 65 63 20 74 61 69 6C 20 74 65 73 74    exec tail test }&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;-08-10 11:01:41,180 (SinkRunner-PollingRunner-DefaultSinkProcessor) [INFO - org.apache.flume.sink.LoggerSink.process(LoggerSink.java:70)] Event: { headers:{} body: 65 78 65 63 20 74 61 69 6C 32          exec tail2 }&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;-08-10 11:01:40,557 (SinkRunner-PollingRunner-DefaultSinkProcessor) [INFO - org.apache.flume.sink.LoggerSink.process(LoggerSink.java:70)] Event: { headers:{} body: 65 78 65 63 20 74 61 69 6C 31          exec tail1 }&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;-08-10 11:01:41,180 (SinkRunner-PollingRunner-DefaultSinkProcessor) [INFO - org.apache.flume.sink.LoggerSink.process(LoggerSink.java:70)] Event: { headers:{} body: 65 78 65 63 20 74 61 69 6C 33          exec tail3 }&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;-08-10 11:01:41,181 (SinkRunner-PollingRunner-DefaultSinkProcessor) [INFO - org.apache.flume.sink.LoggerSink.process(LoggerSink.java:70)] Event: { headers:{} body: 65 78 65 63 20 74 61 69 6C 36          exec tail6 }&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;-08-10 11:01:41,181 (SinkRunner-PollingRunner-DefaultSinkProcessor) [INFO - org.apache.flume.sink.LoggerSink.process(LoggerSink.java:70)] Event: { headers:{} body: 65 78 65 63 20 74 61 69 6C 34          exec tail4 }&lt;/span&gt;&lt;/div&gt;-08-10 11:01:41,181 (SinkRunner-PollingRunner-DefaultSinkProcessor) [INFO - org.apache.flume.sink.LoggerSink.process(LoggerSink.java:70)] Event: { headers:{} body: 65 78 65 63 20 74 61 69 6C 35          exec tail5 }
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;-08-10 11:01:51,551 (SinkRunner-PollingRunner-DefaultSinkProcessor) [INFO - org.apache.flume.sink.LoggerSink.process(LoggerSink.java:70)] Event: { headers:{} body: 65 78 65 63 20 74 61 69 6C 39 38        exec tail98 }&lt;/span&gt;&lt;/div&gt;....
....
....
&lt;div style="text-align: left;"&gt;&lt;/div&gt;-08-10 11:01:51,550 (SinkRunner-PollingRunner-DefaultSinkProcessor) [INFO - org.apache.flume.sink.LoggerSink.process(LoggerSink.java:70)] Event: { headers:{} body: 65 78 65 63 20 74 61 69 6C 39 36        exec tail96 }
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;-08-10 11:01:51,551 (SinkRunner-PollingRunner-DefaultSinkProcessor) [INFO - org.apache.flume.sink.LoggerSink.process(LoggerSink.java:70)] Event: { headers:{} body: 65 78 65 63 20 74 61 69 6C 39 39        exec tail99 }&lt;/span&gt;&lt;/div&gt;-08-10 11:01:51,550 (SinkRunner-PollingRunner-DefaultSinkProcessor) [INFO - org.apache.flume.sink.LoggerSink.process(LoggerSink.java:70)] Event: { headers:{} body: 65 78 65 63 20 74 61 69 6C 39 37        exec tail97 }
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;-08-10 11:01:51,551 (SinkRunner-PollingRunner-DefaultSinkProcessor) [INFO - org.apache.flume.sink.LoggerSink.process(LoggerSink.java:70)] Event: { headers:{} body: 65 78 65 63 20 74 61 69 6C 31 30 30       exec tail100 }&lt;/span&gt;&lt;/div&gt;</code></pre>
<div style="text-align:left"><br>
</div>
<div style="text-align:left"><br>
</div>
</div>
<div class="toolbar" style="text-align:left"><br>
</div>
<div class="toolbar" style="text-align:left">　4)案例4：Syslogtcp</div>
</div>
</div>
<p></p>
<div style="text-align:left">　　　　Syslogtcp监听TCP的端口做为数据源</div>
<div style="text-align:left">　　　　　　a)创建agent配置文件</div>
<p></p>
<div class="jb51code">
<div id="highlighter_240942" class="syntaxhighlighter  bash ie">
<div class="toolbar"><pre><code class="language-plain">&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;root@m1:/home/hadoop# vi /home/hadoop/flume-1.5.0-bin/conf/syslog_tcp.conf&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources = r1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sinks = k1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.channels = c1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources.r1.port = 5140&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;# Describe/configure the source&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources.r1.type= syslogtcp&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sinks.k1.type= logger&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources.r1.host = localhost&lt;/span&gt;&lt;/div&gt;a1.sources.r1.channels = c1
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.channels.c1.capacity = 1000&lt;/span&gt;&lt;/div&gt;# Describe the sink
# Use a channel which buffers events in memory
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.channels.c1.transactionCapacity = 100&lt;/span&gt;&lt;/div&gt;a1.channels.c1.type= memory
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sinks.k1.channel = c1&lt;/span&gt;&lt;/div&gt;# Bind the source and sink to the channel
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources.r1.channels = c1&lt;/span&gt;&lt;/div&gt;</code></pre>
<div style="text-align:left"><br>
</div>
<div style="text-align:left"> </div>
</div>
<div class="toolbar" style="text-align:left"><br>
</div>
<div class="toolbar" style="text-align:left">　　　b)启动flume agent a1 </div>
<div class="toolbar"><pre><code class="language-plain">root@m1:/home/hadoop# /home/hadoop/flume-1.5.0-bin/bin/flume-ng agent -c . -f /home/hadoop/flume-1.5.0-bin/conf/syslog_tcp.conf -n a1 -Dflume.root.logger=INFO,console</code></pre>
<div style="text-align:left"><br>
</div>
<div style="text-align:left">　　　　c)测试产生syslog </div>
</div>
<div class="toolbar" style="text-align:left"><br>
</div>
<div class="toolbar"><pre><code class="language-plain">root@m1:/home/hadoop# echo "hello idoall.org syslog" | nc localhost 5140
</code></pre>
<div style="text-align:left"><br>
</div>
<div style="text-align:left"><br>
</div>
</div>
<div class="toolbar" style="text-align:left">　　d)在m1的控制台，可以看到以下信息： </div>
<div class="toolbar" style="text-align:left"><br>
</div>
<div class="toolbar"><pre><code class="language-plain">&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;/08/10 11:41:45 INFO node.PollingPropertiesFileConfigurationProvider: Reloading configuration file:/home/hadoop/flume-1.5.0-bin/conf/syslog_tcp.conf&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;/08/10 11:41:45 INFO conf.FlumeConfiguration: Added sinks: k1 Agent: a1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;/08/10 11:41:45 INFO conf.FlumeConfiguration: Processing:k1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;/08/10 11:41:45 INFO conf.FlumeConfiguration: Post-validation flume configuration contains configuration for agents: [a1]&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;/08/10 11:41:45 INFO conf.FlumeConfiguration: Processing:k1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;/08/10 11:41:45 INFO node.AbstractConfigurationProvider: Creating channels&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;/08/10 11:41:45 INFO source.DefaultSourceFactory: Creating instance of source r1, type syslogtcp&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;/08/10 11:41:45 INFO channel.DefaultChannelFactory: Creating instance of channel c1 type memory&lt;/span&gt;&lt;/div&gt;/08/10 11:41:45 INFO node.AbstractConfigurationProvider: Created channel c1
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;/08/10 11:41:45 INFO node.Application: Starting new configuration:{ sourceRunners:{r1=EventDrivenSourceRunner: { source:org.apache.flume.source.SyslogTcpSource{name:r1,state:IDLE} }} sinkRunners:{k1=SinkRunner: { policy:org.apache.flume.sink.DefaultSinkProcessor@6538b14 counterGroup:{ name:null counters:{} } }} channels:{c1=org.apache.flume.channel.MemoryChannel{name: c1}} }&lt;/span&gt;&lt;/div&gt;/08/10 11:41:45 INFO sink.DefaultSinkFactory: Creating instance of sink: k1, type: logger
/08/10 11:41:45 INFO node.AbstractConfigurationProvider: Channel c1 connected to [r1, k1]
/08/10 11:41:45 INFO node.Application: Starting Channel c1
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;/08/10 11:41:45 INFO node.Application: Starting Sink k1&lt;/span&gt;&lt;/div&gt;/08/10 11:41:45 INFO instrumentation.MonitoredCounterGroup: Monitored counter group for type: CHANNEL, name: c1: Successfully registered new MBean.
/08/10 11:41:45 INFO instrumentation.MonitoredCounterGroup: Component type: CHANNEL, name: c1 started
/08/10 11:41:45 INFO node.Application: Starting Source r1
/08/10 11:41:45 INFO source.SyslogTcpSource: Syslog TCP Source starting...
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;/08/10 11:42:15 INFO sink.LoggerSink: Event: { headers:{Severity=0, flume.syslog.status=Invalid, Facility=0} body: 68 65 6C 6C 6F 20 69 64 6F 61 6C 6C 2E 6F 72 67 hello idoall.org }&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;/08/10 11:42:15 WARN source.SyslogUtils: Event created from Invalid Syslog data.&lt;/span&gt;&lt;/div&gt;</code></pre>
<div style="text-align:left"><br>
</div>
<div style="text-align:left"><br>
</div>
</div>
<div class="toolbar" style="text-align:left"><br>
</div>
<div class="toolbar" style="text-align:left">　　5)案例5：JSONHandler</div>
</div>
</div>
<p style="text-align:left">　　　　　　a)创建agent配置文件 </p>
<p></p><pre><code class="language-plain">&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;root@m1:/home/hadoop# vi /home/hadoop/flume-1.5.0-bin/conf/post_json.conf&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources = r1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sinks = k1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.channels = c1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources.r1.type= org.apache.flume.source.http.HTTPSource&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;# Describe/configure the source&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources.r1.port = 8888&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;# Use a channel which buffers events in memory&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources.r1.channels = c1&lt;/span&gt;&lt;/div&gt;# Describe the sink
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.channels.c1.transactionCapacity = 100&lt;/span&gt;&lt;/div&gt;a1.sinks.k1.type= logger
a1.channels.c1.type= memory
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.channels.c1.capacity = 1000&lt;/span&gt;&lt;/div&gt;# Bind the source and sink to the channel
&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sinks.k1.channel = c1&lt;/span&gt;&lt;/div&gt;&lt;div style="text-align: left;"&gt;&lt;span style="font-family: Arial, Helvetica, sans-serif;"&gt;a1.sources.r1.channels = c1&lt;/span&gt;&lt;/div&gt;</code></pre>
<div style="text-align:left"><br>
</div>
<div style="text-align:left"><br>
</div>
<p></p>
<p style="text-align:left"><br>
</p>
<p style="text-align:left">　b)启动flume agent a1 </p>
<p></p><pre><code class="language-plain">root@m1:/home/hadoop# /home/hadoop/flume-1.5.0-bin/bin/flume-ng agent -c . -f /home/hadoop/flume-1.5.0-bin/conf/post_json.conf -n a1 -Dflume.root.logger=INFO,console</code></pre>
<div style="text-align:left"><br>
</div>
<div style="text-align:left">　　　c)生成JSON 格式的POST request</div>
<p></p>
<div class="jb51code">
<div id="highlighter_926042" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"> </div>
<div class="toolbar"><pre><code class="language-plain">root@m1:/home/hadoop# curl -X POST -d '[{ "headers" :{"a" : "a1","b" : "b1"},"body" : "idoall.org_body"}]'http://localhost:8888</code></pre>
<div style="text-align:left"><br>
</div>
<div style="text-align:left"><br>
</div>
</div>
<div class="toolbar" style="text-align:left">　　　　d)在m1的控制台，可以看到以下信息：</div>
</div>
</div>
<p style="text-align:left">/</p>
<div class="jb51code">
<div>
<div id="highlighter_1579" class="syntaxhighlighter  plain ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">08/10 11:49:59 INFO node.Application: Starting Channel c1</code></div>
<div class="line number2 index1 alt1"><code class="plain plain">/08/10 11:49:59 INFO instrumentation.MonitoredCounterGroup: Monitored counter group for type: CHANNEL, name: c1: Successfully registered new MBean.</code></div>
<div class="line number3 index2 alt2"><code class="plain plain">/08/10 11:49:59 INFO instrumentation.MonitoredCounterGroup: Component type: CHANNEL, name: c1 started</code></div>
<div class="line number4 index3 alt1"><code class="plain plain">/08/10 11:49:59 INFO node.Application: Starting Sink k1</code></div>
<div class="line number5 index4 alt2"><code class="plain plain">/08/10 11:49:59 INFO node.Application: Starting Source r1</code></div>
<div class="line number6 index5 alt1"><code class="plain plain">/08/10 11:49:59 INFO mortbay.log: Logging to org.slf4j.impl.Log4jLoggerAdapter(org.mortbay.log) via org.mortbay.log.Slf4jLog</code></div>
<div class="line number7 index6 alt2"><code class="plain plain">/08/10 11:49:59 INFO mortbay.log: jetty-6.1.26</code></div>
<div class="line number8 index7 alt1"><code class="plain plain">/08/10 11:50:00 INFO mortbay.log: Started SelectChannelConnector@0.0.0.0:8888</code></div>
<div class="line number9 index8 alt2"><code class="plain plain">/08/10 11:50:00 INFO instrumentation.MonitoredCounterGroup: Monitored counter group for type: SOURCE, name: r1: Successfully registered new MBean.</code></div>
<div class="line number10 index9 alt1"><code class="plain plain">/08/10 11:50:00 INFO instrumentation.MonitoredCounterGroup: Component type: SOURCE, name: r1 started</code></div>
<div class="line number11 index10 alt2"><code class="plain plain">/08/10 12:14:32 INFO sink.LoggerSink: Event: { headers:{b=b1, a=a1} body: 69 64 6F 61 6C 6C 2E 6F 72 67 5F 62 6F 64 79  idoall.org_body }</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p></p>
<div style="text-align:left">　　　　6)案例6：Hadoop sink</div>
<div style="text-align:left">　　　　其中关于hadoop2.2.0部分的安装部署，请参考文章《ubuntu12.04+hadoop2.2.0+zookeeper3.4.5+hbase0.96.2+hive0.13.1分布式环境部署》</div>
<div style="text-align:left">　　　　　　a)创建agent配置文件</div>
<p></p>
<div class="jb51code">
<div>
<div id="highlighter_331293" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
<div class="line number18 index17 alt1">18</div>
<div class="line number19 index18 alt2">19</div>
<div class="line number20 index19 alt1">20</div>
<div class="line number21 index20 alt2">21</div>
<div class="line number22 index21 alt1">22</div>
<div class="line number23 index22 alt2">23</div>
<div class="line number24 index23 alt1">24</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># vi /home/hadoop/flume-1.5.0-bin/conf/hdfs_sink.conf</code></div>
<div class="line number2 index1 alt1"><code class="bash plain">a1.sources = r1 </code>
</div>
<div class="line number3 index2 alt2"><code class="bash plain">a1.sinks = k1 </code>
</div>
<div class="line number4 index3 alt1"><code class="bash plain">a1.channels = c1 </code>
</div>
<div class="line number5 index4 alt2"><code class="bash comments"># Describe/configure the source</code></div>
<div class="line number6 index5 alt1"><code class="bash plain">a1.sources.r1.</code><code class="bash functions">type</code><code class="bash plain">= syslogtcp
</code></div>
<div class="line number7 index6 alt2"><code class="bash plain">a1.sources.r1.port = 5140</code></div>
<div class="line number8 index7 alt1"><code class="bash plain">a1.sources.r1.host = localhost</code></div>
<div class="line number9 index8 alt2"><code class="bash plain">a1.sources.r1.channels = c1</code></div>
<div class="line number10 index9 alt1"><code class="bash comments"># Describe the sink</code></div>
<div class="line number11 index10 alt2"><code class="bash plain">a1.sinks.k1.</code><code class="bash functions">type</code><code class="bash plain">= hdfs
</code></div>
<div class="line number12 index11 alt1"><code class="bash plain">a1.sinks.k1.channel = c1</code></div>
<div class="line number13 index12 alt2"><code class="bash plain">a1.sinks.k1.hdfs.path = hdfs:</code><code class="bash plain">//m1</code><code class="bash plain">:9000</code><code class="bash plain">/user/flume/syslogtcp</code></div>
<div class="line number14 index13 alt1"><code class="bash plain">a1.sinks.k1.hdfs.filePrefix = Syslog</code></div>
<div class="line number15 index14 alt2"><code class="bash plain">a1.sinks.k1.hdfs.round =</code><code class="bash functions">true</code></div>
<div class="line number16 index15 alt1"><code class="bash plain">a1.sinks.k1.hdfs.roundValue = 10</code></div>
<div class="line number17 index16 alt2"><code class="bash plain">a1.sinks.k1.hdfs.roundUnit = minute</code></div>
<div class="line number18 index17 alt1"><code class="bash comments"># Use a channel which buffers events in memory</code></div>
<div class="line number19 index18 alt2"><code class="bash plain">a1.channels.c1.</code><code class="bash functions">type</code><code class="bash plain">= memory
</code></div>
<div class="line number20 index19 alt1"><code class="bash plain">a1.channels.c1.capacity = 1000</code></div>
<div class="line number21 index20 alt2"><code class="bash plain">a1.channels.c1.transactionCapacity = 100</code></div>
<div class="line number22 index21 alt1"><code class="bash comments"># Bind the source and sink to the channel</code></div>
<div class="line number23 index22 alt2"><code class="bash plain">a1.sources.r1.channels = c1</code></div>
<div class="line number24 index23 alt1"><code class="bash plain">a1.sinks.k1.channel = c1</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　b)启动flume agent a1<br>
</p>
<div class="jb51code">
<div>
<div id="highlighter_832077" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># /home/hadoop/flume-1.5.0-bin/bin/flume-ng agent -c . -f /home/hadoop/flume-1.5.0-bin/conf/hdfs_sink.conf
 -n a1 -Dflume.root.logger=INFO,console</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　c)测试产生syslog<br>
</p>
<div class="jb51code">
<div>
<div id="highlighter_345517" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># echo "hello idoall flume -&gt; hadoop testing one" | nc localhost 5140</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　d)在m1的控制台，可以看到以下信息：<br>
</p>
<div class="jb51code">
<div>
<div id="highlighter_231674" class="syntaxhighlighter  plain ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">/08/10 12:20:39 INFO instrumentation.MonitoredCounterGroup: Monitored counter group for type: CHANNEL, name: c1: Successfully registered new MBean.</code></div>
<div class="line number2 index1 alt1"><code class="plain plain">/08/10 12:20:39 INFO instrumentation.MonitoredCounterGroup: Component type: CHANNEL, name: c1 started</code></div>
<div class="line number3 index2 alt2"><code class="plain plain">/08/10 12:20:39 INFO node.Application: Starting Sink k1</code></div>
<div class="line number4 index3 alt1"><code class="plain plain">/08/10 12:20:39 INFO node.Application: Starting Source r1</code></div>
<div class="line number5 index4 alt2"><code class="plain plain">/08/10 12:20:39 INFO instrumentation.MonitoredCounterGroup: Monitored counter group for type: SINK, name: k1: Successfully registered new MBean.</code></div>
<div class="line number6 index5 alt1"><code class="plain plain">/08/10 12:20:39 INFO instrumentation.MonitoredCounterGroup: Component type: SINK, name: k1 started</code></div>
<div class="line number7 index6 alt2"><code class="plain plain">/08/10 12:20:39 INFO source.SyslogTcpSource: Syslog TCP Source starting...</code></div>
<div class="line number8 index7 alt1"><code class="plain plain">/08/10 12:21:46 WARN source.SyslogUtils: Event created from Invalid Syslog data.</code></div>
<div class="line number9 index8 alt2"><code class="plain plain">/08/10 12:21:49 INFO hdfs.HDFSSequenceFile: writeFormat = Writable, UseRawLocalFileSystem = false</code></div>
<div class="line number10 index9 alt1"><code class="plain plain">/08/10 12:21:49 INFO hdfs.BucketWriter: Creating<a target="_blank" href="" rel="nofollow">hdfs://m1:9000/user/flume/syslogtcp//Syslog.1407644509504.tmp</a></code></div>
<div class="line number11 index10 alt2"><code class="plain plain">/08/10 12:22:20 INFO hdfs.BucketWriter: Closing<a target="_blank" href="" rel="nofollow">hdfs://m1:9000/user/flume/syslogtcp//Syslog.1407644509504.tmp</a></code></div>
<div class="line number12 index11 alt1"><code class="plain plain">/08/10 12:22:20 INFO hdfs.BucketWriter: Close tries incremented</code></div>
<div class="line number13 index12 alt2"><code class="plain plain">/08/10 12:22:20 INFO hdfs.BucketWriter: Renaming<a target="_blank" href="" rel="nofollow">hdfs://m1:9000/user/flume/syslogtcp/Syslog.1407644509504.tmp</a> to<a target="_blank" href="" rel="nofollow">hdfs://m1:9000/user/flume/syslogtcp/Syslog.1407644509504</a></code></div>
<div class="line number14 index13 alt1"><code class="plain plain">/08/10 12:22:20 INFO hdfs.HDFSEventSink: Writer callback called.</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　e)在m1上再打开一个窗口，去hadoop上检查文件是否生成<br>
</p>
<div class="jb51code">
<div>
<div id="highlighter_923575" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># /home/hadoop/hadoop-2.2.0/bin/hadoop fs -ls /user/flume/syslogtcp</code></div>
<div class="line number2 index1 alt1"><code class="bash plain">Found 1 items </code>
</div>
<div class="line number3 index2 alt2"><code class="bash plain">-rw-r--r--  3 root supergroup    155 2014-08-10 12:22</code><code class="bash plain">/user/flume/syslogtcp/Syslog</code><code class="bash plain">.1407644509504</code></div>
<div class="line number4 index3 alt1"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># /home/hadoop/hadoop-2.2.0/bin/hadoop fs -cat /user/flume/syslogtcp/Syslog.1407644509504</code></div>
<div class="line number5 index4 alt2"><code class="bash plain">SEQ!org.apache.hadoop.io.LongWritable"org.apache.hadoop.io.BytesWritable^;&gt;Gv$hello idoall flume -&gt; hadoop testing one</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p></p>
<div style="text-align:left">　　　　7)案例7：File Roll Sink</div>
<div style="text-align:left">　　　　　　a)创建agent配置文件</div>
<p></p>
<div class="jb51code">
<div>
<div id="highlighter_143850" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
<div class="line number18 index17 alt1">18</div>
<div class="line number19 index18 alt2">19</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># vi /home/hadoop/flume-1.5.0-bin/conf/file_roll.conf</code></div>
<div class="line number2 index1 alt1"><code class="bash plain">a1.sources = r1 </code>
</div>
<div class="line number3 index2 alt2"><code class="bash plain">a1.sinks = k1 </code>
</div>
<div class="line number4 index3 alt1"><code class="bash plain">a1.channels = c1 </code>
</div>
<div class="line number5 index4 alt2"><code class="bash comments"># Describe/configure the source</code></div>
<div class="line number6 index5 alt1"><code class="bash plain">a1.sources.r1.</code><code class="bash functions">type</code><code class="bash plain">= syslogtcp
</code></div>
<div class="line number7 index6 alt2"><code class="bash plain">a1.sources.r1.port = 5555</code></div>
<div class="line number8 index7 alt1"><code class="bash plain">a1.sources.r1.host = localhost</code></div>
<div class="line number9 index8 alt2"><code class="bash plain">a1.sources.r1.channels = c1</code></div>
<div class="line number10 index9 alt1"><code class="bash comments"># Describe the sink</code></div>
<div class="line number11 index10 alt2"><code class="bash plain">a1.sinks.k1.</code><code class="bash functions">type</code><code class="bash plain">= file_roll
</code></div>
<div class="line number12 index11 alt1"><code class="bash plain">a1.sinks.k1.sink.directory =</code><code class="bash plain">/home/hadoop/flume-1</code><code class="bash plain">.5.0-bin</code><code class="bash plain">/logs</code></div>
<div class="line number13 index12 alt2"><code class="bash comments"># Use a channel which buffers events in memory</code></div>
<div class="line number14 index13 alt1"><code class="bash plain">a1.channels.c1.</code><code class="bash functions">type</code><code class="bash plain">= memory
</code></div>
<div class="line number15 index14 alt2"><code class="bash plain">a1.channels.c1.capacity = 1000</code></div>
<div class="line number16 index15 alt1"><code class="bash plain">a1.channels.c1.transactionCapacity = 100</code></div>
<div class="line number17 index16 alt2"><code class="bash comments"># Bind the source and sink to the channel</code></div>
<div class="line number18 index17 alt1"><code class="bash plain">a1.sources.r1.channels = c1</code></div>
<div class="line number19 index18 alt2"><code class="bash plain">a1.sinks.k1.channel = c1</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　b)启动flume agent a1<br>
</p>
<div class="jb51code">
<div>
<div id="highlighter_965883" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># /home/hadoop/flume-1.5.0-bin/bin/flume-ng agent -c . -f /home/hadoop/flume-1.5.0-bin/conf/file_roll.conf
 -n a1 -Dflume.root.logger=INFO,console</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　c)测试产生log<br>
</p>
<div class="jb51code">
<div>
<div id="highlighter_193382" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># echo "hello idoall.org syslog" | nc localhost 5555</code></div>
<div class="line number2 index1 alt1"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># echo "hello idoall.org syslog 2" | nc localhost 5555</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　d)查看/home/hadoop/flume-1.5.0-bin/logs下是否生成文件,默认每30秒生成一个新文件<br>
</p>
<div class="jb51code">
<div>
<div id="highlighter_832782" class="syntaxhighlighter  plain ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">root@m1:/home/hadoop# ll /home/hadoop/flume-1.5.0-bin/logs</code></div>
<div class="line number2 index1 alt1"><code class="plain plain">总用量 272 </code></div>
<div class="line number3 index2 alt2"><code class="plain plain">drwxr-xr-x 3 root root  4096 Aug 10 12:50 ./</code></div>
<div class="line number4 index3 alt1"><code class="plain plain">drwxr-xr-x 9 root root  4096 Aug 10 10:59 ../</code></div>
<div class="line number5 index4 alt2"><code class="plain plain">-rw-r--r-- 1 root root   50 Aug 10 12:49 1407646164782-1</code></div>
<div class="line number6 index5 alt1"><code class="plain plain">-rw-r--r-- 1 root root   0 Aug 10 12:49 1407646164782-2</code></div>
<div class="line number7 index6 alt2"><code class="plain plain">-rw-r--r-- 1 root root   0 Aug 10 12:50 1407646164782-3</code></div>
<div class="line number8 index7 alt1"><code class="plain plain">root@m1:/home/hadoop# cat /home/hadoop/flume-1.5.0-bin/logs/1407646164782-1 /home/hadoop/flume-1.5.0-bin/logs/1407646164782-2</code></div>
<div class="line number9 index8 alt2"><code class="plain plain">hello idoall.org syslog</code></div>
<div class="line number10 index9 alt1"><code class="plain plain">hello idoall.org syslog 2</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p></p>
<div style="text-align:left">　　　　8)案例8：Replicating Channel Selector</div>
<div style="text-align:left">　　　　Flume支持Fan out流从一个源到多个通道。有两种模式的Fan out，分别是复制和复用。在复制的情况下，流的事件被发送到所有的配置通道。在复用的情况下，事件被发送到可用的渠道中的一个子集。Fan out流需要指定源和Fan out通道的规则。</div>
<div style="text-align:left">　　　　这次我们需要用到m1,m2两台机器</div>
<div style="text-align:left">　　　　　　a)在m1创建replicating_Channel_Selector配置文件</div>
<p></p>
<div class="jb51code">
<div>
<div id="highlighter_365308" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
<div class="line number18 index17 alt1">18</div>
<div class="line number19 index18 alt2">19</div>
<div class="line number20 index19 alt1">20</div>
<div class="line number21 index20 alt2">21</div>
<div class="line number22 index21 alt1">22</div>
<div class="line number23 index22 alt2">23</div>
<div class="line number24 index23 alt1">24</div>
<div class="line number25 index24 alt2">25</div>
<div class="line number26 index25 alt1">26</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># vi /home/hadoop/flume-1.5.0-bin/conf/replicating_Channel_Selector.conf</code></div>
<div class="line number2 index1 alt1"><code class="bash plain">a1.sources = r1 </code>
</div>
<div class="line number3 index2 alt2"><code class="bash plain">a1.sinks = k1 k2 </code>
</div>
<div class="line number4 index3 alt1"><code class="bash plain">a1.channels = c1 c2</code></div>
<div class="line number5 index4 alt2"><code class="bash comments"># Describe/configure the source</code></div>
<div class="line number6 index5 alt1"><code class="bash plain">a1.sources.r1.</code><code class="bash functions">type</code><code class="bash plain">= syslogtcp
</code></div>
<div class="line number7 index6 alt2"><code class="bash plain">a1.sources.r1.port = 5140</code></div>
<div class="line number8 index7 alt1"><code class="bash plain">a1.sources.r1.host = localhost</code></div>
<div class="line number9 index8 alt2"><code class="bash plain">a1.sources.r1.channels = c1 c2</code></div>
<div class="line number10 index9 alt1"><code class="bash plain">a1.sources.r1.selector.</code><code class="bash functions">type</code><code class="bash plain">= replicating
</code></div>
<div class="line number11 index10 alt2"><code class="bash comments"># Describe the sink</code></div>
<div class="line number12 index11 alt1"><code class="bash plain">a1.sinks.k1.</code><code class="bash functions">type</code><code class="bash plain">= avro
</code></div>
<div class="line number13 index12 alt2"><code class="bash plain">a1.sinks.k1.channel = c1</code></div>
<div class="line number14 index13 alt1"><code class="bash plain">a1.sinks.k1.</code><code class="bash functions">hostname</code><code class="bash plain">= m1
</code></div>
<div class="line number15 index14 alt2"><code class="bash plain">a1.sinks.k1.port = 5555</code></div>
<div class="line number16 index15 alt1"><code class="bash plain">a1.sinks.k2.</code><code class="bash functions">type</code><code class="bash plain">= avro
</code></div>
<div class="line number17 index16 alt2"><code class="bash plain">a1.sinks.k2.channel = c2</code></div>
<div class="line number18 index17 alt1"><code class="bash plain">a1.sinks.k2.</code><code class="bash functions">hostname</code><code class="bash plain">= m2
</code></div>
<div class="line number19 index18 alt2"><code class="bash plain">a1.sinks.k2.port = 5555</code></div>
<div class="line number20 index19 alt1"><code class="bash comments"># Use a channel which buffers events in memory</code></div>
<div class="line number21 index20 alt2"><code class="bash plain">a1.channels.c1.</code><code class="bash functions">type</code><code class="bash plain">= memory
</code></div>
<div class="line number22 index21 alt1"><code class="bash plain">a1.channels.c1.capacity = 1000</code></div>
<div class="line number23 index22 alt2"><code class="bash plain">a1.channels.c1.transactionCapacity = 100</code></div>
<div class="line number24 index23 alt1"><code class="bash plain">a1.channels.c2.</code><code class="bash functions">type</code><code class="bash plain">= memory
</code></div>
<div class="line number25 index24 alt2"><code class="bash plain">a1.channels.c2.capacity = 1000</code></div>
<div class="line number26 index25 alt1"><code class="bash plain">a1.channels.c2.transactionCapacity = 100</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　b)在m1创建replicating_Channel_Selector_avro配置文件<br>
</p>
<div class="jb51code">
<div>
<div id="highlighter_268345" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
<div class="line number18 index17 alt1">18</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># vi /home/hadoop/flume-1.5.0-bin/conf/replicating_Channel_Selector_avro.conf</code></div>
<div class="line number2 index1 alt1"><code class="bash plain">a1.sources = r1 </code>
</div>
<div class="line number3 index2 alt2"><code class="bash plain">a1.sinks = k1 </code>
</div>
<div class="line number4 index3 alt1"><code class="bash plain">a1.channels = c1 </code>
</div>
<div class="line number5 index4 alt2"><code class="bash comments"># Describe/configure the source</code></div>
<div class="line number6 index5 alt1"><code class="bash plain">a1.sources.r1.</code><code class="bash functions">type</code><code class="bash plain">= avro
</code></div>
<div class="line number7 index6 alt2"><code class="bash plain">a1.sources.r1.channels = c1</code></div>
<div class="line number8 index7 alt1"><code class="bash plain">a1.sources.r1.bind = 0.0.0.0</code></div>
<div class="line number9 index8 alt2"><code class="bash plain">a1.sources.r1.port = 5555</code></div>
<div class="line number10 index9 alt1"><code class="bash comments"># Describe the sink</code></div>
<div class="line number11 index10 alt2"><code class="bash plain">a1.sinks.k1.</code><code class="bash functions">type</code><code class="bash plain">= logger
</code></div>
<div class="line number12 index11 alt1"><code class="bash comments"># Use a channel which buffers events in memory</code></div>
<div class="line number13 index12 alt2"><code class="bash plain">a1.channels.c1.</code><code class="bash functions">type</code><code class="bash plain">= memory
</code></div>
<div class="line number14 index13 alt1"><code class="bash plain">a1.channels.c1.capacity = 1000</code></div>
<div class="line number15 index14 alt2"><code class="bash plain">a1.channels.c1.transactionCapacity = 100</code></div>
<div class="line number16 index15 alt1"><code class="bash comments"># Bind the source and sink to the channel</code></div>
<div class="line number17 index16 alt2"><code class="bash plain">a1.sources.r1.channels = c1</code></div>
<div class="line number18 index17 alt1"><code class="bash plain">a1.sinks.k1.channel = c1</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　c)在m1上将2个配置文件复制到m2上一份<br>
</p>
<div class="jb51code">
<div>
<div id="highlighter_425852" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop/flume-1</code><code class="bash plain">.5.0-bin</code><code class="bash comments"># scp -r /home/hadoop/flume-1.5.0-bin/conf/replicating_Channel_Selector.conf
 root@m2:/home/hadoop/flume-1.5.0-bin/conf/replicating_Channel_Selector.conf </code>
</div>
<div class="line number2 index1 alt1"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop/flume-1</code><code class="bash plain">.5.0-bin</code><code class="bash comments"># scp -r /home/hadoop/flume-1.5.0-bin/conf/replicating_Channel_Selector_avro.conf
 root@m2:/home/hadoop/flume-1.5.0-bin/conf/replicating_Channel_Selector_avro.conf&lt;br&gt;</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　d)打开4个窗口，在m1和m2上同时启动两个flume agent<br>
</p>
<div class="jb51code">
<div>
<div id="highlighter_10248" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># /home/hadoop/flume-1.5.0-bin/bin/flume-ng agent -c . -f /home/hadoop/flume-1.5.0-bin/conf/replicating_Channel_Selector_avro.conf
 -n a1 -Dflume.root.logger=INFO,console </code></div>
<div class="line number2 index1 alt1"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># /home/hadoop/flume-1.5.0-bin/bin/flume-ng agent -c . -f /home/hadoop/flume-1.5.0-bin/conf/replicating_Channel_Selector.conf
 -n a1 -Dflume.root.logger=INFO,console</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　e)然后在m1或m2的任意一台机器上，测试产生syslog<br>
</p>
<div class="jb51code">
<div>
<div id="highlighter_795815" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># echo "hello idoall.org syslog" | nc localhost 5140</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　f)在m1和m2的sink窗口，分别可以看到以下信息,这说明信息得到了同步：<br>
</p>
<div class="jb51code">
<div>
<div id="highlighter_40250" class="syntaxhighlighter  plain ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">/08/10 14:08:18 INFO ipc.NettyServer: Connection to /192.168.1.51:46844 disconnected.</code></div>
<div class="line number2 index1 alt1"><code class="plain plain">/08/10 14:08:52 INFO ipc.NettyServer: [id: 0x90f8fe1f, /192.168.1.50:35873 =&gt; /192.168.1.50:5555] OPEN</code></div>
<div class="line number3 index2 alt2"><code class="plain plain">/08/10 14:08:52 INFO ipc.NettyServer: [id: 0x90f8fe1f, /192.168.1.50:35873 =&gt; /192.168.1.50:5555] BOUND: /192.168.1.50:5555</code></div>
<div class="line number4 index3 alt1"><code class="plain plain">/08/10 14:08:52 INFO ipc.NettyServer: [id: 0x90f8fe1f, /192.168.1.50:35873 =&gt; /192.168.1.50:5555] CONNECTED: /192.168.1.50:35873</code></div>
<div class="line number5 index4 alt2"><code class="plain plain">/08/10 14:08:59 INFO ipc.NettyServer: [id: 0xd6318635, /192.168.1.51:46858 =&gt; /192.168.1.50:5555] OPEN</code></div>
<div class="line number6 index5 alt1"><code class="plain plain">/08/10 14:08:59 INFO ipc.NettyServer: [id: 0xd6318635, /192.168.1.51:46858 =&gt; /192.168.1.50:5555] BOUND: /192.168.1.50:5555</code></div>
<div class="line number7 index6 alt2"><code class="plain plain">/08/10 14:08:59 INFO ipc.NettyServer: [id: 0xd6318635, /192.168.1.51:46858 =&gt; /192.168.1.50:5555] CONNECTED: /192.168.1.51:46858</code></div>
<div class="line number8 index7 alt1"><code class="plain plain">/08/10 14:09:20 INFO sink.LoggerSink: Event: { headers:{Severity=0, flume.syslog.status=Invalid, Facility=0} body: 68 65 6C 6C 6F 20 69 64 6F 61 6C 6C 2E 6F 72 67 hello idoall.org }</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p></p>
<div style="text-align:left">　　　　</div>
<div style="text-align:left">                 9)案例9：Multiplexing Channel Selector</div>
<div style="text-align:left">　　　　　　a)在m1创建Multiplexing_Channel_Selector配置文件</div>
<p></p>
<div class="jb51code">
<div>
<div id="highlighter_247153" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
<div class="line number18 index17 alt1">18</div>
<div class="line number19 index18 alt2">19</div>
<div class="line number20 index19 alt1">20</div>
<div class="line number21 index20 alt2">21</div>
<div class="line number22 index21 alt1">22</div>
<div class="line number23 index22 alt2">23</div>
<div class="line number24 index23 alt1">24</div>
<div class="line number25 index24 alt2">25</div>
<div class="line number26 index25 alt1">26</div>
<div class="line number27 index26 alt2">27</div>
<div class="line number28 index27 alt1">28</div>
<div class="line number29 index28 alt2">29</div>
<div class="line number30 index29 alt1">30</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># vi /home/hadoop/flume-1.5.0-bin/conf/Multiplexing_Channel_Selector.conf</code></div>
<div class="line number2 index1 alt1"><code class="bash plain">a1.sources = r1 </code>
</div>
<div class="line number3 index2 alt2"><code class="bash plain">a1.sinks = k1 k2 </code>
</div>
<div class="line number4 index3 alt1"><code class="bash plain">a1.channels = c1 c2</code></div>
<div class="line number5 index4 alt2"><code class="bash comments"># Describe/configure the source</code></div>
<div class="line number6 index5 alt1"><code class="bash plain">a1.sources.r1.</code><code class="bash functions">type</code><code class="bash plain">= org.apache.flume.</code><code class="bash functions">source</code><code class="bash plain">.http.HTTPSource</code></div>
<div class="line number7 index6 alt2"><code class="bash plain">a1.sources.r1.port = 5140</code></div>
<div class="line number8 index7 alt1"><code class="bash plain">a1.sources.r1.channels = c1 c2</code></div>
<div class="line number9 index8 alt2"><code class="bash plain">a1.sources.r1.selector.</code><code class="bash functions">type</code><code class="bash plain">= multiplexing
</code></div>
<div class="line number10 index9 alt1"><code class="bash plain">a1.sources.r1.selector.header =</code><code class="bash functions">type</code></div>
<div class="line number11 index10 alt2"><code class="bash comments">#映射允许每个值通道可以重叠。默认值可以包含任意数量的通道。</code></div>
<div class="line number12 index11 alt1"><code class="bash plain">a1.sources.r1.selector.mapping.baidu = c1</code></div>
<div class="line number13 index12 alt2"><code class="bash plain">a1.sources.r1.selector.mapping.ali = c2</code></div>
<div class="line number14 index13 alt1"><code class="bash plain">a1.sources.r1.selector.default = c1</code></div>
<div class="line number15 index14 alt2"><code class="bash comments"># Describe the sink</code></div>
<div class="line number16 index15 alt1"><code class="bash plain">a1.sinks.k1.</code><code class="bash functions">type</code><code class="bash plain">= avro
</code></div>
<div class="line number17 index16 alt2"><code class="bash plain">a1.sinks.k1.channel = c1</code></div>
<div class="line number18 index17 alt1"><code class="bash plain">a1.sinks.k1.</code><code class="bash functions">hostname</code><code class="bash plain">= m1
</code></div>
<div class="line number19 index18 alt2"><code class="bash plain">a1.sinks.k1.port = 5555</code></div>
<div class="line number20 index19 alt1"><code class="bash plain">a1.sinks.k2.</code><code class="bash functions">type</code><code class="bash plain">= avro
</code></div>
<div class="line number21 index20 alt2"><code class="bash plain">a1.sinks.k2.channel = c2</code></div>
<div class="line number22 index21 alt1"><code class="bash plain">a1.sinks.k2.</code><code class="bash functions">hostname</code><code class="bash plain">= m2
</code></div>
<div class="line number23 index22 alt2"><code class="bash plain">a1.sinks.k2.port = 5555</code></div>
<div class="line number24 index23 alt1"><code class="bash comments"># Use a channel which buffers events in memory</code></div>
<div class="line number25 index24 alt2"><code class="bash plain">a1.channels.c1.</code><code class="bash functions">type</code><code class="bash plain">= memory
</code></div>
<div class="line number26 index25 alt1"><code class="bash plain">a1.channels.c1.capacity = 1000</code></div>
<div class="line number27 index26 alt2"><code class="bash plain">a1.channels.c1.transactionCapacity = 100</code></div>
<div class="line number28 index27 alt1"><code class="bash plain">a1.channels.c2.</code><code class="bash functions">type</code><code class="bash plain">= memory
</code></div>
<div class="line number29 index28 alt2"><code class="bash plain">a1.channels.c2.capacity = 1000</code></div>
<div class="line number30 index29 alt1"><code class="bash plain">a1.channels.c2.transactionCapacity = 100</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　b)在m1创建Multiplexing_Channel_Selector_avro配置文件<br>
</p>
<div class="jb51code">
<div>
<div id="highlighter_398" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
<div class="line number18 index17 alt1">18</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># vi /home/hadoop/flume-1.5.0-bin/conf/Multiplexing_Channel_Selector_avro.conf</code></div>
<div class="line number2 index1 alt1"><code class="bash plain">a1.sources = r1 </code>
</div>
<div class="line number3 index2 alt2"><code class="bash plain">a1.sinks = k1 </code>
</div>
<div class="line number4 index3 alt1"><code class="bash plain">a1.channels = c1 </code>
</div>
<div class="line number5 index4 alt2"><code class="bash comments"># Describe/configure the source</code></div>
<div class="line number6 index5 alt1"><code class="bash plain">a1.sources.r1.</code><code class="bash functions">type</code><code class="bash plain">= avro
</code></div>
<div class="line number7 index6 alt2"><code class="bash plain">a1.sources.r1.channels = c1</code></div>
<div class="line number8 index7 alt1"><code class="bash plain">a1.sources.r1.bind = 0.0.0.0</code></div>
<div class="line number9 index8 alt2"><code class="bash plain">a1.sources.r1.port = 5555</code></div>
<div class="line number10 index9 alt1"><code class="bash comments"># Describe the sink</code></div>
<div class="line number11 index10 alt2"><code class="bash plain">a1.sinks.k1.</code><code class="bash functions">type</code><code class="bash plain">= logger
</code></div>
<div class="line number12 index11 alt1"><code class="bash comments"># Use a channel which buffers events in memory</code></div>
<div class="line number13 index12 alt2"><code class="bash plain">a1.channels.c1.</code><code class="bash functions">type</code><code class="bash plain">= memory
</code></div>
<div class="line number14 index13 alt1"><code class="bash plain">a1.channels.c1.capacity = 1000</code></div>
<div class="line number15 index14 alt2"><code class="bash plain">a1.channels.c1.transactionCapacity = 100</code></div>
<div class="line number16 index15 alt1"><code class="bash comments"># Bind the source and sink to the channel</code></div>
<div class="line number17 index16 alt2"><code class="bash plain">a1.sources.r1.channels = c1</code></div>
<div class="line number18 index17 alt1"><code class="bash plain">a1.sinks.k1.channel = c1</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　c)将2个配置文件复制到m2上一份<br>
</p>
<div class="jb51code">
<div>
<div id="highlighter_337117" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop/flume-1</code><code class="bash plain">.5.0-bin</code><code class="bash comments"># scp -r /home/hadoop/flume-1.5.0-bin/conf/Multiplexing_Channel_Selector.conf
 root@m2:/home/hadoop/flume-1.5.0-bin/conf/Multiplexing_Channel_Selector.conf </code>
</div>
<div class="line number2 index1 alt1"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop/flume-1</code><code class="bash plain">.5.0-bin</code><code class="bash comments"># scp -r /home/hadoop/flume-1.5.0-bin/conf/Multiplexing_Channel_Selector_avro.conf
 root@m2:/home/hadoop/flume-1.5.0-bin/conf/Multiplexing_Channel_Selector_avro.conf</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　d)打开4个窗口，在m1和m2上同时启动两个flume agent<br>
</p>
<div class="jb51code">
<div>
<div id="highlighter_29859" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># /home/hadoop/flume-1.5.0-bin/bin/flume-ng agent -c . -f /home/hadoop/flume-1.5.0-bin/conf/Multiplexing_Channel_Selector_avro.conf
 -n a1 -Dflume.root.logger=INFO,console </code></div>
<div class="line number2 index1 alt1"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># /home/hadoop/flume-1.5.0-bin/bin/flume-ng agent -c . -f /home/hadoop/flume-1.5.0-bin/conf/Multiplexing_Channel_Selector.conf
 -n a1 -Dflume.root.logger=INFO,console</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　e)然后在m1或m2的任意一台机器上，测试产生syslog</p>
<div class="jb51code">
<div>
<div id="highlighter_414431" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># curl -X POST -d '[{ "headers" :{"type" : "baidu"},"body" : "idoall_TEST1"}]'<a target="_blank" href="http://localhost:5140/" rel="nofollow">http://localhost:5140</a>
 &amp;&amp; curl -X POST -d '[{ "headers" :{"type" : "ali"},"body" : "idoall_TEST2"}]'<a target="_blank" href="http://localhost:5140/" rel="nofollow">http://localhost:5140</a> &amp;&amp; curl -X POST -d '[{ "headers" :{"type" : "qq"},"body" : "idoall_TEST3"}]'<a target="_blank" href="http://localhost:5140/" rel="nofollow">http://localhost:5140</a></code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　f)在m1的sink窗口，可以看到以下信息：</p>
<div class="jb51code">
<div>
<div id="highlighter_448554" class="syntaxhighlighter  plain ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">14/08/10 14:32:21 INFO node.Application: Starting Sink k1</code></div>
<div class="line number2 index1 alt1"><code class="plain plain">14/08/10 14:32:21 INFO node.Application: Starting Source r1</code></div>
<div class="line number3 index2 alt2"><code class="plain plain">14/08/10 14:32:21 INFO source.AvroSource: Starting Avro source r1: { bindAddress: 0.0.0.0, port: 5555 }...</code></div>
<div class="line number4 index3 alt1"><code class="plain plain">14/08/10 14:32:21 INFO instrumentation.MonitoredCounterGroup: Monitored counter group for type: SOURCE, name: r1: Successfully registered new MBean.</code></div>
<div class="line number5 index4 alt2"><code class="plain plain">14/08/10 14:32:21 INFO instrumentation.MonitoredCounterGroup: Component type: SOURCE, name: r1 started</code></div>
<div class="line number6 index5 alt1"><code class="plain plain">14/08/10 14:32:21 INFO source.AvroSource: Avro source r1 started.</code></div>
<div class="line number7 index6 alt2"><code class="plain plain">14/08/10 14:32:36 INFO ipc.NettyServer: [id: 0xcf00eea6, /192.168.1.50:35916 =&gt; /192.168.1.50:5555] OPEN</code></div>
<div class="line number8 index7 alt1"><code class="plain plain">14/08/10 14:32:36 INFO ipc.NettyServer: [id: 0xcf00eea6, /192.168.1.50:35916 =&gt; /192.168.1.50:5555] BOUND: /192.168.1.50:5555</code></div>
<div class="line number9 index8 alt2"><code class="plain plain">14/08/10 14:32:36 INFO ipc.NettyServer: [id: 0xcf00eea6, /192.168.1.50:35916 =&gt; /192.168.1.50:5555] CONNECTED: /192.168.1.50:35916</code></div>
<div class="line number10 index9 alt1"><code class="plain plain">14/08/10 14:32:44 INFO ipc.NettyServer: [id: 0x432f5468, /192.168.1.51:46945 =&gt; /192.168.1.50:5555] OPEN</code></div>
<div class="line number11 index10 alt2"><code class="plain plain">14/08/10 14:32:44 INFO ipc.NettyServer: [id: 0x432f5468, /192.168.1.51:46945 =&gt; /192.168.1.50:5555] BOUND: /192.168.1.50:5555</code></div>
<div class="line number12 index11 alt1"><code class="plain plain">14/08/10 14:32:44 INFO ipc.NettyServer: [id: 0x432f5468, /192.168.1.51:46945 =&gt; /192.168.1.50:5555] CONNECTED: /192.168.1.51:46945</code></div>
<div class="line number13 index12 alt2"><code class="plain plain">14/08/10 14:34:11 INFO sink.LoggerSink: Event: { headers:{type=baidu} body: 69 64 6F 61 6C 6C 5F 54 45 53 54 31       idoall_TEST1 }</code></div>
<div class="line number14 index13 alt1"><code class="plain plain">14/08/10 14:34:57 INFO sink.LoggerSink: Event: { headers:{type=qq} body: 69 64 6F 61 6C 6C 5F 54 45 53 54 33       idoall_TEST3 }</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　g)在m2的sink窗口，可以看到以下信息：</p>
<div class="jb51code">
<div>
<div id="highlighter_462473" class="syntaxhighlighter  plain ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">14/08/10 14:32:27 INFO node.Application: Starting Sink k1</code></div>
<div class="line number2 index1 alt1"><code class="plain plain">14/08/10 14:32:27 INFO node.Application: Starting Source r1</code></div>
<div class="line number3 index2 alt2"><code class="plain plain">14/08/10 14:32:27 INFO source.AvroSource: Starting Avro source r1: { bindAddress: 0.0.0.0, port: 5555 }...</code></div>
<div class="line number4 index3 alt1"><code class="plain plain">14/08/10 14:32:27 INFO instrumentation.MonitoredCounterGroup: Monitored counter group for type: SOURCE, name: r1: Successfully registered new MBean.</code></div>
<div class="line number5 index4 alt2"><code class="plain plain">14/08/10 14:32:27 INFO instrumentation.MonitoredCounterGroup: Component type: SOURCE, name: r1 started</code></div>
<div class="line number6 index5 alt1"><code class="plain plain">14/08/10 14:32:27 INFO source.AvroSource: Avro source r1 started.</code></div>
<div class="line number7 index6 alt2"><code class="plain plain">14/08/10 14:32:36 INFO ipc.NettyServer: [id: 0x7c2f0aec, /192.168.1.50:38104 =&gt; /192.168.1.51:5555] OPEN</code></div>
<div class="line number8 index7 alt1"><code class="plain plain">14/08/10 14:32:36 INFO ipc.NettyServer: [id: 0x7c2f0aec, /192.168.1.50:38104 =&gt; /192.168.1.51:5555] BOUND: /192.168.1.51:5555</code></div>
<div class="line number9 index8 alt2"><code class="plain plain">14/08/10 14:32:36 INFO ipc.NettyServer: [id: 0x7c2f0aec, /192.168.1.50:38104 =&gt; /192.168.1.51:5555] CONNECTED: /192.168.1.50:38104</code></div>
<div class="line number10 index9 alt1"><code class="plain plain">14/08/10 14:32:44 INFO ipc.NettyServer: [id: 0x3d36f553, /192.168.1.51:48599 =&gt; /192.168.1.51:5555] OPEN</code></div>
<div class="line number11 index10 alt2"><code class="plain plain">14/08/10 14:32:44 INFO ipc.NettyServer: [id: 0x3d36f553, /192.168.1.51:48599 =&gt; /192.168.1.51:5555] BOUND: /192.168.1.51:5555</code></div>
<div class="line number12 index11 alt1"><code class="plain plain">14/08/10 14:32:44 INFO ipc.NettyServer: [id: 0x3d36f553, /192.168.1.51:48599 =&gt; /192.168.1.51:5555] CONNECTED: /192.168.1.51:48599</code></div>
<div class="line number13 index12 alt2"><code class="plain plain">14/08/10 14:34:33 INFO sink.LoggerSink: Event: { headers:{type=ali} body: 69 64 6F 61 6C 6C 5F 54 45 53 54 32       idoall_TEST2 }</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p></p>
<div style="text-align:left">　　　　可以看到，根据header中不同的条件分布到不同的channel上</div>
<div style="text-align:left"> </div>
<div style="text-align:left">　　　　10)案例10：Flume Sink Processors</div>
<div style="text-align:left">　　　　failover的机器是一直发送给其中一个sink，当这个sink不可用的时候，自动发送到下一个sink。</div>
<div style="text-align:left"> </div>
<div style="text-align:left">　　　　　　a)在m1创建Flume_Sink_Processors配置文件</div>
<p></p>
<div class="jb51code">
<div>
<div id="highlighter_874379" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
<div class="line number18 index17 alt1">18</div>
<div class="line number19 index18 alt2">19</div>
<div class="line number20 index19 alt1">20</div>
<div class="line number21 index20 alt2">21</div>
<div class="line number22 index21 alt1">22</div>
<div class="line number23 index22 alt2">23</div>
<div class="line number24 index23 alt1">24</div>
<div class="line number25 index24 alt2">25</div>
<div class="line number26 index25 alt1">26</div>
<div class="line number27 index26 alt2">27</div>
<div class="line number28 index27 alt1">28</div>
<div class="line number29 index28 alt2">29</div>
<div class="line number30 index29 alt1">30</div>
<div class="line number31 index30 alt2">31</div>
<div class="line number32 index31 alt1">32</div>
<div class="line number33 index32 alt2">33</div>
<div class="line number34 index33 alt1">34</div>
<div class="line number35 index34 alt2">35</div>
<div class="line number36 index35 alt1">36</div>
<div class="line number37 index36 alt2">37</div>
<div class="line number38 index37 alt1">38</div>
<div class="line number39 index38 alt2">39</div>
<div class="line number40 index39 alt1">40</div>
<div class="line number41 index40 alt2">41</div>
<div class="line number42 index41 alt1">42</div>
<div class="line number43 index42 alt2">43</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># vi /home/hadoop/flume-1.5.0-bin/conf/Flume_Sink_Processors.conf</code></div>
<div class="line number2 index1 alt1"><code class="bash spaces">  </code> </div>
<div class="line number3 index2 alt2"><code class="bash plain">a1.sources = r1 </code>
</div>
<div class="line number4 index3 alt1"><code class="bash plain">a1.sinks = k1 k2 </code>
</div>
<div class="line number5 index4 alt2"><code class="bash plain">a1.channels = c1 c2</code></div>
<div class="line number6 index5 alt1"><code class="bash spaces">  </code> </div>
<div class="line number7 index6 alt2"><code class="bash comments">#这个是配置failover的关键，需要有一个sink group</code></div>
<div class="line number8 index7 alt1"><code class="bash plain">a1.sinkgroups = g1</code></div>
<div class="line number9 index8 alt2"><code class="bash plain">a1.sinkgroups.g1.sinks = k1 k2</code></div>
<div class="line number10 index9 alt1"><code class="bash comments">#处理的类型是failover</code></div>
<div class="line number11 index10 alt2"><code class="bash plain">a1.sinkgroups.g1.processor.</code><code class="bash functions">type</code><code class="bash plain">= failover
</code></div>
<div class="line number12 index11 alt1"><code class="bash comments">#优先级，数字越大优先级越高，每个sink的优先级必须不相同</code></div>
<div class="line number13 index12 alt2"><code class="bash plain">a1.sinkgroups.g1.processor.priority.k1 = 5</code></div>
<div class="line number14 index13 alt1"><code class="bash plain">a1.sinkgroups.g1.processor.priority.k2 = 10</code></div>
<div class="line number15 index14 alt2"><code class="bash comments">#设置为10秒，当然可以根据你的实际状况更改成更快或者很慢</code></div>
<div class="line number16 index15 alt1"><code class="bash plain">a1.sinkgroups.g1.processor.maxpenalty = 10000</code></div>
<div class="line number17 index16 alt2"><code class="bash spaces">  </code> </div>
<div class="line number18 index17 alt1"><code class="bash comments"># Describe/configure the source</code></div>
<div class="line number19 index18 alt2"><code class="bash plain">a1.sources.r1.</code><code class="bash functions">type</code><code class="bash plain">= syslogtcp
</code></div>
<div class="line number20 index19 alt1"><code class="bash plain">a1.sources.r1.port = 5140</code></div>
<div class="line number21 index20 alt2"><code class="bash plain">a1.sources.r1.channels = c1 c2</code></div>
<div class="line number22 index21 alt1"><code class="bash plain">a1.sources.r1.selector.</code><code class="bash functions">type</code><code class="bash plain">= replicating
</code></div>
<div class="line number23 index22 alt2"><code class="bash spaces">  </code> </div>
<div class="line number24 index23 alt1"><code class="bash spaces">  </code> </div>
<div class="line number25 index24 alt2"><code class="bash comments"># Describe the sink</code></div>
<div class="line number26 index25 alt1"><code class="bash plain">a1.sinks.k1.</code><code class="bash functions">type</code><code class="bash plain">= avro
</code></div>
<div class="line number27 index26 alt2"><code class="bash plain">a1.sinks.k1.channel = c1</code></div>
<div class="line number28 index27 alt1"><code class="bash plain">a1.sinks.k1.</code><code class="bash functions">hostname</code><code class="bash plain">= m1
</code></div>
<div class="line number29 index28 alt2"><code class="bash plain">a1.sinks.k1.port = 5555</code></div>
<div class="line number30 index29 alt1"><code class="bash spaces">  </code> </div>
<div class="line number31 index30 alt2"><code class="bash plain">a1.sinks.k2.</code><code class="bash functions">type</code><code class="bash plain">= avro
</code></div>
<div class="line number32 index31 alt1"><code class="bash plain">a1.sinks.k2.channel = c2</code></div>
<div class="line number33 index32 alt2"><code class="bash plain">a1.sinks.k2.</code><code class="bash functions">hostname</code><code class="bash plain">= m2
</code></div>
<div class="line number34 index33 alt1"><code class="bash plain">a1.sinks.k2.port = 5555</code></div>
<div class="line number35 index34 alt2"><code class="bash spaces">  </code> </div>
<div class="line number36 index35 alt1"><code class="bash comments"># Use a channel which buffers events in memory</code></div>
<div class="line number37 index36 alt2"><code class="bash plain">a1.channels.c1.</code><code class="bash functions">type</code><code class="bash plain">= memory
</code></div>
<div class="line number38 index37 alt1"><code class="bash plain">a1.channels.c1.capacity = 1000</code></div>
<div class="line number39 index38 alt2"><code class="bash plain">a1.channels.c1.transactionCapacity = 100</code></div>
<div class="line number40 index39 alt1"><code class="bash spaces">  </code> </div>
<div class="line number41 index40 alt2"><code class="bash plain">a1.channels.c2.</code><code class="bash functions">type</code><code class="bash plain">= memory
</code></div>
<div class="line number42 index41 alt1"><code class="bash plain">a1.channels.c2.capacity = 1000</code></div>
<div class="line number43 index42 alt2"><code class="bash plain">a1.channels.c2.transactionCapacity = 100</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　b)在m1创建Flume_Sink_Processors_avro配置文件</p>
<div class="jb51code">
<div>
<div id="highlighter_9571" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
<div class="line number18 index17 alt1">18</div>
<div class="line number19 index18 alt2">19</div>
<div class="line number20 index19 alt1">20</div>
<div class="line number21 index20 alt2">21</div>
<div class="line number22 index21 alt1">22</div>
<div class="line number23 index22 alt2">23</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># vi /home/hadoop/flume-1.5.0-bin/conf/Flume_Sink_Processors_avro.conf</code></div>
<div class="line number2 index1 alt1"><code class="bash spaces">  </code> </div>
<div class="line number3 index2 alt2"><code class="bash plain">a1.sources = r1 </code>
</div>
<div class="line number4 index3 alt1"><code class="bash plain">a1.sinks = k1 </code>
</div>
<div class="line number5 index4 alt2"><code class="bash plain">a1.channels = c1 </code>
</div>
<div class="line number6 index5 alt1"><code class="bash spaces">  </code> </div>
<div class="line number7 index6 alt2"><code class="bash comments"># Describe/configure the source</code></div>
<div class="line number8 index7 alt1"><code class="bash plain">a1.sources.r1.</code><code class="bash functions">type</code><code class="bash plain">= avro
</code></div>
<div class="line number9 index8 alt2"><code class="bash plain">a1.sources.r1.channels = c1</code></div>
<div class="line number10 index9 alt1"><code class="bash plain">a1.sources.r1.bind = 0.0.0.0</code></div>
<div class="line number11 index10 alt2"><code class="bash plain">a1.sources.r1.port = 5555</code></div>
<div class="line number12 index11 alt1"><code class="bash spaces">  </code> </div>
<div class="line number13 index12 alt2"><code class="bash comments"># Describe the sink</code></div>
<div class="line number14 index13 alt1"><code class="bash plain">a1.sinks.k1.</code><code class="bash functions">type</code><code class="bash plain">= logger
</code></div>
<div class="line number15 index14 alt2"><code class="bash spaces">  </code> </div>
<div class="line number16 index15 alt1"><code class="bash comments"># Use a channel which buffers events in memory</code></div>
<div class="line number17 index16 alt2"><code class="bash plain">a1.channels.c1.</code><code class="bash functions">type</code><code class="bash plain">= memory
</code></div>
<div class="line number18 index17 alt1"><code class="bash plain">a1.channels.c1.capacity = 1000</code></div>
<div class="line number19 index18 alt2"><code class="bash plain">a1.channels.c1.transactionCapacity = 100</code></div>
<div class="line number20 index19 alt1"><code class="bash spaces">  </code> </div>
<div class="line number21 index20 alt2"><code class="bash comments"># Bind the source and sink to the channel</code></div>
<div class="line number22 index21 alt1"><code class="bash plain">a1.sources.r1.channels = c1</code></div>
<div class="line number23 index22 alt2"><code class="bash plain">a1.sinks.k1.channel = c1</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　c)将2个配置文件复制到m2上一份</p>
<div class="jb51code">
<div>
<div id="highlighter_574134" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop/flume-1</code><code class="bash plain">.5.0-bin</code><code class="bash comments"># scp -r /home/hadoop/flume-1.5.0-bin/conf/Flume_Sink_Processors.conf
 root@m2:/home/hadoop/flume-1.5.0-bin/conf/Flume_Sink_Processors.conf </code></div>
<div class="line number2 index1 alt1"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop/flume-1</code><code class="bash plain">.5.0-bin</code><code class="bash comments"># scp -r /home/hadoop/flume-1.5.0-bin/conf/Flume_Sink_Processors_avro.conf
 root@m2:/home/hadoop/flume-1.5.0-bin/conf/Flume_Sink_Processors_avro.conf</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　d)打开4个窗口，在m1和m2上同时启动两个flume agent</p>
<div class="jb51code">
<div>
<div id="highlighter_1520" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># /home/hadoop/flume-1.5.0-bin/bin/flume-ng agent -c . -f /home/hadoop/flume-1.5.0-bin/conf/Flume_Sink_Processors_avro.conf
 -n a1 -Dflume.root.logger=INFO,console </code></div>
<div class="line number2 index1 alt1"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># /home/hadoop/flume-1.5.0-bin/bin/flume-ng agent -c . -f /home/hadoop/flume-1.5.0-bin/conf/Flume_Sink_Processors.conf
 -n a1 -Dflume.root.logger=INFO,console</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　e)然后在m1或m2的任意一台机器上，测试产生log</p>
<div class="jb51code">
<div>
<div id="highlighter_943610" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># echo "idoall.org test1 failover" | nc localhost 5140</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　f)因为m2的优先级高，所以在m2的sink窗口，可以看到以下信息，而m1没有：</p>
<div class="jb51code">
<div>
<div id="highlighter_451758" class="syntaxhighlighter  plain ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">14/08/10 15:02:46 INFO ipc.NettyServer: Connection to /192.168.1.51:48692 disconnected.</code></div>
<div class="line number2 index1 alt1"><code class="plain plain">14/08/10 15:03:12 INFO ipc.NettyServer: [id: 0x09a14036, /192.168.1.51:48704 =&gt; /192.168.1.51:5555] OPEN</code></div>
<div class="line number3 index2 alt2"><code class="plain plain">14/08/10 15:03:12 INFO ipc.NettyServer: [id: 0x09a14036, /192.168.1.51:48704 =&gt; /192.168.1.51:5555] BOUND: /192.168.1.51:5555</code></div>
<div class="line number4 index3 alt1"><code class="plain plain">14/08/10 15:03:12 INFO ipc.NettyServer: [id: 0x09a14036, /192.168.1.51:48704 =&gt; /192.168.1.51:5555] CONNECTED: /192.168.1.51:48704</code></div>
<div class="line number5 index4 alt2"><code class="plain plain">14/08/10 15:03:26 INFO sink.LoggerSink: Event: { headers:{Severity=0, flume.syslog.status=Invalid, Facility=0} body: 69 64 6F 61 6C 6C 2E 6F 72 67 20 74 65 73 74 31 idoall.org test1 }</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　g)这时我们停止掉m2机器上的sink(ctrl+c)，再次输出测试数据：</p>
<div class="jb51code">
<div>
<div id="highlighter_834156" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># echo "idoall.org test2 failover" | nc localhost 5140</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　h)可以在m1的sink窗口，看到读取到了刚才发送的两条测试数据：</p>
<div class="jb51code">
<div>
<div id="highlighter_56807" class="syntaxhighlighter  plain ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">14/08/10 15:02:46 INFO ipc.NettyServer: Connection to /192.168.1.51:47036 disconnected.</code></div>
<div class="line number2 index1 alt1"><code class="plain plain">14/08/10 15:03:12 INFO ipc.NettyServer: [id: 0xbcf79851, /192.168.1.51:47048 =&gt; /192.168.1.50:5555] OPEN</code></div>
<div class="line number3 index2 alt2"><code class="plain plain">14/08/10 15:03:12 INFO ipc.NettyServer: [id: 0xbcf79851, /192.168.1.51:47048 =&gt; /192.168.1.50:5555] BOUND: /192.168.1.50:5555</code></div>
<div class="line number4 index3 alt1"><code class="plain plain">14/08/10 15:03:12 INFO ipc.NettyServer: [id: 0xbcf79851, /192.168.1.51:47048 =&gt; /192.168.1.50:5555] CONNECTED: /192.168.1.51:47048</code></div>
<div class="line number5 index4 alt2"><code class="plain plain">14/08/10 15:07:56 INFO sink.LoggerSink: Event: { headers:{Severity=0, flume.syslog.status=Invalid, Facility=0} body: 69 64 6F 61 6C 6C 2E 6F 72 67 20 74 65 73 74 31 idoall.org test1 }</code></div>
<div class="line number6 index5 alt1"><code class="plain plain">14/08/10 15:07:56 INFO sink.LoggerSink: Event: { headers:{Severity=0, flume.syslog.status=Invalid, Facility=0} body: 69 64 6F 61 6C 6C 2E 6F 72 67 20 74 65 73 74 32 idoall.org test2 }</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　i)我们再在m2的sink窗口中，启动sink：<br>
</p>
<div class="jb51code">
<div>
<div id="highlighter_101932" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># /home/hadoop/flume-1.5.0-bin/bin/flume-ng agent -c . -f /home/hadoop/flume-1.5.0-bin/conf/Flume_Sink_Processors_avro.conf
 -n a1 -Dflume.root.logger=INFO,console</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　j)输入两批测试数据：<br>
</p>
<div class="jb51code">
<div>
<div id="highlighter_875250" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># echo "idoall.org test3 failover" | nc localhost 5140 &amp;&amp; echo "idoall.org test4 failover" | nc localhost 5140</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　k)在m2的sink窗口，我们可以看到以下信息，因为优先级的关系，log消息会再次落到m2上：</p>
<div class="jb51code">
<div>
<div id="highlighter_877896" class="syntaxhighlighter  plain ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">14/08/10 15:09:47 INFO node.Application: Starting Sink k1</code></div>
<div class="line number2 index1 alt1"><code class="plain plain">14/08/10 15:09:47 INFO node.Application: Starting Source r1</code></div>
<div class="line number3 index2 alt2"><code class="plain plain">14/08/10 15:09:47 INFO source.AvroSource: Starting Avro source r1: { bindAddress: 0.0.0.0, port: 5555 }...</code></div>
<div class="line number4 index3 alt1"><code class="plain plain">14/08/10 15:09:47 INFO instrumentation.MonitoredCounterGroup: Monitored counter group for type: SOURCE, name: r1: Successfully registered new MBean.</code></div>
<div class="line number5 index4 alt2"><code class="plain plain">14/08/10 15:09:47 INFO instrumentation.MonitoredCounterGroup: Component type: SOURCE, name: r1 started</code></div>
<div class="line number6 index5 alt1"><code class="plain plain">14/08/10 15:09:47 INFO source.AvroSource: Avro source r1 started.</code></div>
<div class="line number7 index6 alt2"><code class="plain plain">14/08/10 15:09:54 INFO ipc.NettyServer: [id: 0x96615732, /192.168.1.51:48741 =&gt; /192.168.1.51:5555] OPEN</code></div>
<div class="line number8 index7 alt1"><code class="plain plain">14/08/10 15:09:54 INFO ipc.NettyServer: [id: 0x96615732, /192.168.1.51:48741 =&gt; /192.168.1.51:5555] BOUND: /192.168.1.51:5555</code></div>
<div class="line number9 index8 alt2"><code class="plain plain">14/08/10 15:09:54 INFO ipc.NettyServer: [id: 0x96615732, /192.168.1.51:48741 =&gt; /192.168.1.51:5555] CONNECTED: /192.168.1.51:48741</code></div>
<div class="line number10 index9 alt1"><code class="plain plain">14/08/10 15:09:57 INFO sink.LoggerSink: Event: { headers:{Severity=0, flume.syslog.status=Invalid, Facility=0} body: 69 64 6F 61 6C 6C 2E 6F 72 67 20 74 65 73 74 32 idoall.org test2 }</code></div>
<div class="line number11 index10 alt2"><code class="plain plain">14/08/10 15:10:43 INFO ipc.NettyServer: [id: 0x12621f9a, /192.168.1.50:38166 =&gt; /192.168.1.51:5555] OPEN</code></div>
<div class="line number12 index11 alt1"><code class="plain plain">14/08/10 15:10:43 INFO ipc.NettyServer: [id: 0x12621f9a, /192.168.1.50:38166 =&gt; /192.168.1.51:5555] BOUND: /192.168.1.51:5555</code></div>
<div class="line number13 index12 alt2"><code class="plain plain">14/08/10 15:10:43 INFO ipc.NettyServer: [id: 0x12621f9a, /192.168.1.50:38166 =&gt; /192.168.1.51:5555] CONNECTED: /192.168.1.50:38166</code></div>
<div class="line number14 index13 alt1"><code class="plain plain">14/08/10 15:10:43 INFO sink.LoggerSink: Event: { headers:{Severity=0, flume.syslog.status=Invalid, Facility=0} body: 69 64 6F 61 6C 6C 2E 6F 72 67 20 74 65 73 74 33 idoall.org test3 }</code></div>
<div class="line number15 index14 alt2"><code class="plain plain">14/08/10 15:10:43 INFO sink.LoggerSink: Event: { headers:{Severity=0, flume.syslog.status=Invalid, Facility=0} body: 69 64 6F 61 6C 6C 2E 6F 72 67 20 74 65 73 74 34 idoall.org test4 }</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p></p>
<div style="text-align:left"> </div>
<div style="text-align:left">　　　　11)案例11：Load balancing Sink Processor</div>
<div style="text-align:left">　　　　load balance type和failover不同的地方是，load balance有两个配置，一个是轮询，一个是随机。两种情况下如果被选择的sink不可用，就会自动尝试发送到下一个可用的sink上面。</div>
<div style="text-align:left"> </div>
<div style="text-align:left">　　　　　　a)在m1创建Load_balancing_Sink_Processors配置文件</div>
<p></p>
<div class="jb51code">
<div>
<div id="highlighter_845503" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
<div class="line number18 index17 alt1">18</div>
<div class="line number19 index18 alt2">19</div>
<div class="line number20 index19 alt1">20</div>
<div class="line number21 index20 alt2">21</div>
<div class="line number22 index21 alt1">22</div>
<div class="line number23 index22 alt2">23</div>
<div class="line number24 index23 alt1">24</div>
<div class="line number25 index24 alt2">25</div>
<div class="line number26 index25 alt1">26</div>
<div class="line number27 index26 alt2">27</div>
<div class="line number28 index27 alt1">28</div>
<div class="line number29 index28 alt2">29</div>
<div class="line number30 index29 alt1">30</div>
<div class="line number31 index30 alt2">31</div>
<div class="line number32 index31 alt1">32</div>
<div class="line number33 index32 alt2">33</div>
<div class="line number34 index33 alt1">34</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># vi /home/hadoop/flume-1.5.0-bin/conf/Load_balancing_Sink_Processors.conf</code></div>
<div class="line number2 index1 alt1"><code class="bash spaces">  </code> </div>
<div class="line number3 index2 alt2"><code class="bash plain">a1.sources = r1 </code>
</div>
<div class="line number4 index3 alt1"><code class="bash plain">a1.sinks = k1 k2 </code>
</div>
<div class="line number5 index4 alt2"><code class="bash plain">a1.channels = c1 </code>
</div>
<div class="line number6 index5 alt1"><code class="bash spaces">  </code> </div>
<div class="line number7 index6 alt2"><code class="bash comments">#这个是配置Load balancing的关键，需要有一个sink group</code></div>
<div class="line number8 index7 alt1"><code class="bash plain">a1.sinkgroups = g1</code></div>
<div class="line number9 index8 alt2"><code class="bash plain">a1.sinkgroups.g1.sinks = k1 k2</code></div>
<div class="line number10 index9 alt1"><code class="bash plain">a1.sinkgroups.g1.processor.</code><code class="bash functions">type</code><code class="bash plain">= load_balance
</code></div>
<div class="line number11 index10 alt2"><code class="bash plain">a1.sinkgroups.g1.processor.backoff =</code><code class="bash functions">true</code></div>
<div class="line number12 index11 alt1"><code class="bash plain">a1.sinkgroups.g1.processor.selector = round_robin</code></div>
<div class="line number13 index12 alt2"><code class="bash spaces">  </code> </div>
<div class="line number14 index13 alt1"><code class="bash comments"># Describe/configure the source</code></div>
<div class="line number15 index14 alt2"><code class="bash plain">a1.sources.r1.</code><code class="bash functions">type</code><code class="bash plain">= syslogtcp
</code></div>
<div class="line number16 index15 alt1"><code class="bash plain">a1.sources.r1.port = 5140</code></div>
<div class="line number17 index16 alt2"><code class="bash plain">a1.sources.r1.channels = c1</code></div>
<div class="line number18 index17 alt1"><code class="bash spaces">  </code> </div>
<div class="line number19 index18 alt2"><code class="bash spaces">  </code> </div>
<div class="line number20 index19 alt1"><code class="bash comments"># Describe the sink</code></div>
<div class="line number21 index20 alt2"><code class="bash plain">a1.sinks.k1.</code><code class="bash functions">type</code><code class="bash plain">= avro
</code></div>
<div class="line number22 index21 alt1"><code class="bash plain">a1.sinks.k1.channel = c1</code></div>
<div class="line number23 index22 alt2"><code class="bash plain">a1.sinks.k1.</code><code class="bash functions">hostname</code><code class="bash plain">= m1
</code></div>
<div class="line number24 index23 alt1"><code class="bash plain">a1.sinks.k1.port = 5555</code></div>
<div class="line number25 index24 alt2"><code class="bash spaces">  </code> </div>
<div class="line number26 index25 alt1"><code class="bash plain">a1.sinks.k2.</code><code class="bash functions">type</code><code class="bash plain">= avro
</code></div>
<div class="line number27 index26 alt2"><code class="bash plain">a1.sinks.k2.channel = c1</code></div>
<div class="line number28 index27 alt1"><code class="bash plain">a1.sinks.k2.</code><code class="bash functions">hostname</code><code class="bash plain">= m2
</code></div>
<div class="line number29 index28 alt2"><code class="bash plain">a1.sinks.k2.port = 5555</code></div>
<div class="line number30 index29 alt1"><code class="bash spaces">  </code> </div>
<div class="line number31 index30 alt2"><code class="bash comments"># Use a channel which buffers events in memory</code></div>
<div class="line number32 index31 alt1"><code class="bash plain">a1.channels.c1.</code><code class="bash functions">type</code><code class="bash plain">= memory
</code></div>
<div class="line number33 index32 alt2"><code class="bash plain">a1.channels.c1.capacity = 1000</code></div>
<div class="line number34 index33 alt1"><code class="bash plain">a1.channels.c1.transactionCapacity = 100</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　b)在m1创建Load_balancing_Sink_Processors_avro配置文件</p>
<div class="jb51code">
<div>
<div id="highlighter_32942" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
<div class="line number18 index17 alt1">18</div>
<div class="line number19 index18 alt2">19</div>
<div class="line number20 index19 alt1">20</div>
<div class="line number21 index20 alt2">21</div>
<div class="line number22 index21 alt1">22</div>
<div class="line number23 index22 alt2">23</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># vi /home/hadoop/flume-1.5.0-bin/conf/Load_balancing_Sink_Processors_avro.conf</code></div>
<div class="line number2 index1 alt1"><code class="bash spaces">  </code> </div>
<div class="line number3 index2 alt2"><code class="bash plain">a1.sources = r1 </code>
</div>
<div class="line number4 index3 alt1"><code class="bash plain">a1.sinks = k1 </code>
</div>
<div class="line number5 index4 alt2"><code class="bash plain">a1.channels = c1 </code>
</div>
<div class="line number6 index5 alt1"><code class="bash spaces">  </code> </div>
<div class="line number7 index6 alt2"><code class="bash comments"># Describe/configure the source</code></div>
<div class="line number8 index7 alt1"><code class="bash plain">a1.sources.r1.</code><code class="bash functions">type</code><code class="bash plain">= avro
</code></div>
<div class="line number9 index8 alt2"><code class="bash plain">a1.sources.r1.channels = c1</code></div>
<div class="line number10 index9 alt1"><code class="bash plain">a1.sources.r1.bind = 0.0.0.0</code></div>
<div class="line number11 index10 alt2"><code class="bash plain">a1.sources.r1.port = 5555</code></div>
<div class="line number12 index11 alt1"><code class="bash spaces">  </code> </div>
<div class="line number13 index12 alt2"><code class="bash comments"># Describe the sink</code></div>
<div class="line number14 index13 alt1"><code class="bash plain">a1.sinks.k1.</code><code class="bash functions">type</code><code class="bash plain">= logger
</code></div>
<div class="line number15 index14 alt2"><code class="bash spaces">  </code> </div>
<div class="line number16 index15 alt1"><code class="bash comments"># Use a channel which buffers events in memory</code></div>
<div class="line number17 index16 alt2"><code class="bash plain">a1.channels.c1.</code><code class="bash functions">type</code><code class="bash plain">= memory
</code></div>
<div class="line number18 index17 alt1"><code class="bash plain">a1.channels.c1.capacity = 1000</code></div>
<div class="line number19 index18 alt2"><code class="bash plain">a1.channels.c1.transactionCapacity = 100</code></div>
<div class="line number20 index19 alt1"><code class="bash spaces">  </code> </div>
<div class="line number21 index20 alt2"><code class="bash comments"># Bind the source and sink to the channel</code></div>
<div class="line number22 index21 alt1"><code class="bash plain">a1.sources.r1.channels = c1</code></div>
<div class="line number23 index22 alt2"><code class="bash plain">a1.sinks.k1.channel = c1</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　c)将2个配置文件复制到m2上一份</p>
<div class="jb51code">
<div>
<div id="highlighter_978840" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop/flume-1</code><code class="bash plain">.5.0-bin</code><code class="bash comments"># scp -r /home/hadoop/flume-1.5.0-bin/conf/Load_balancing_Sink_Processors.conf
 root@m2:/home/hadoop/flume-1.5.0-bin/conf/Load_balancing_Sink_Processors.conf </code>
</div>
<div class="line number2 index1 alt1"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop/flume-1</code><code class="bash plain">.5.0-bin</code><code class="bash comments"># scp -r /home/hadoop/flume-1.5.0-bin/conf/Load_balancing_Sink_Processors_avro.conf
 root@m2:/home/hadoop/flume-1.5.0-bin/conf/Load_balancing_Sink_Processors_avro.conf</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　d)打开4个窗口，在m1和m2上同时启动两个flume agent</p>
<div class="jb51code">
<div>
<div id="highlighter_550777" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># /home/hadoop/flume-1.5.0-bin/bin/flume-ng agent -c . -f /home/hadoop/flume-1.5.0-bin/conf/Load_balancing_Sink_Processors_avro.conf
 -n a1 -Dflume.root.logger=INFO,console </code></div>
<div class="line number2 index1 alt1"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># /home/hadoop/flume-1.5.0-bin/bin/flume-ng agent -c . -f /home/hadoop/flume-1.5.0-bin/conf/Load_balancing_Sink_Processors.conf
 -n a1 -Dflume.root.logger=INFO,console</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　e)然后在m1或m2的任意一台机器上，测试产生log，一行一行输入，输入太快，容易落到一台机器上</p>
<div class="jb51code">
<div>
<div id="highlighter_768534" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># echo "idoall.org test1" | nc localhost 5140</code></div>
<div class="line number2 index1 alt1"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># echo "idoall.org test2" | nc localhost 5140</code></div>
<div class="line number3 index2 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># echo "idoall.org test3" | nc localhost 5140</code></div>
<div class="line number4 index3 alt1"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># echo "idoall.org test4" | nc localhost 5140</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　f)在m1的sink窗口，可以看到以下信息：</p>
<div class="jb51code">
<div>
<div id="highlighter_693916" class="syntaxhighlighter  plain ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">14/08/10 15:35:29 INFO sink.LoggerSink: Event: { headers:{Severity=0, flume.syslog.status=Invalid, Facility=0} body: 69 64 6F 61 6C 6C 2E 6F 72 67 20 74 65 73 74 32 idoall.org test2 }</code></div>
<div class="line number2 index1 alt1"><code class="plain plain">14/08/10 15:35:33 INFO sink.LoggerSink: Event: { headers:{Severity=0, flume.syslog.status=Invalid, Facility=0} body: 69 64 6F 61 6C 6C 2E 6F 72 67 20 74 65 73 74 34 idoall.org test4 }</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　g)在m2的sink窗口，可以看到以下信息：</p>
<div class="jb51code">
<div>
<div id="highlighter_852897" class="syntaxhighlighter  plain ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="plain plain">14/08/10 15:35:27 INFO sink.LoggerSink: Event: { headers:{Severity=0, flume.syslog.status=Invalid, Facility=0} body: 69 64 6F 61 6C 6C 2E 6F 72 67 20 74 65 73 74 31 idoall.org test1 }</code></div>
<div class="line number2 index1 alt1"><code class="plain plain">14/08/10 15:35:29 INFO sink.LoggerSink: Event: { headers:{Severity=0, flume.syslog.status=Invalid, Facility=0} body: 69 64 6F 61 6C 6C 2E 6F 72 67 20 74 65 73 74 33 idoall.org test3 }</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p></p>
<div style="text-align:left">　　　　说明轮询模式起到了作用。</div>
<div style="text-align:left"> </div>
<div style="text-align:left">　　　　12)案例12：Hbase sink</div>
<div style="text-align:left"> </div>
<div style="text-align:left">　　　　　　a)在测试之前，请先参考《ubuntu12.04+hadoop2.2.0+zookeeper3.4.5+hbase0.96.2+hive0.13.1分布式环境部署》将hbase启动</div>
<div style="text-align:left"> </div>
<div style="text-align:left">　　　　　　b)然后将以下文件复制到flume中：</div>
<p></p>
<div class="jb51code">
<div>
<div id="highlighter_144075" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash functions">cp</code> <code class="bash plain">
/home/hadoop/hbase-0</code><code class="bash plain">.96.2-hadoop2</code><code class="bash plain">/lib/protobuf-java-2</code><code class="bash plain">.5.0.jar</code><code class="bash plain">/home/hadoop/flume-1</code><code class="bash plain">.5.0-bin</code><code class="bash plain">/lib</code></div>
<div class="line number2 index1 alt1"><code class="bash functions">cp</code> <code class="bash plain">
/home/hadoop/hbase-0</code><code class="bash plain">.96.2-hadoop2</code><code class="bash plain">/lib/hbase-client-0</code><code class="bash plain">.96.2-hadoop2.jar</code><code class="bash plain">/home/hadoop/flume-1</code><code class="bash plain">.5.0-bin</code><code class="bash plain">/lib</code></div>
<div class="line number3 index2 alt2"><code class="bash functions">cp</code> <code class="bash plain">
/home/hadoop/hbase-0</code><code class="bash plain">.96.2-hadoop2</code><code class="bash plain">/lib/hbase-common-0</code><code class="bash plain">.96.2-hadoop2.jar</code><code class="bash plain">/home/hadoop/flume-1</code><code class="bash plain">.5.0-bin</code><code class="bash plain">/lib</code></div>
<div class="line number4 index3 alt1"><code class="bash functions">cp</code> <code class="bash plain">
/home/hadoop/hbase-0</code><code class="bash plain">.96.2-hadoop2</code><code class="bash plain">/lib/hbase-protocol-0</code><code class="bash plain">.96.2-hadoop2.jar</code><code class="bash plain">/home/hadoop/flume-1</code><code class="bash plain">.5.0-bin</code><code class="bash plain">/lib</code></div>
<div class="line number5 index4 alt2"><code class="bash functions">cp</code> <code class="bash plain">
/home/hadoop/hbase-0</code><code class="bash plain">.96.2-hadoop2</code><code class="bash plain">/lib/hbase-server-0</code><code class="bash plain">.96.2-hadoop2.jar</code><code class="bash plain">/home/hadoop/flume-1</code><code class="bash plain">.5.0-bin</code><code class="bash plain">/lib</code></div>
<div class="line number6 index5 alt1"><code class="bash functions">cp</code> <code class="bash plain">
/home/hadoop/hbase-0</code><code class="bash plain">.96.2-hadoop2</code><code class="bash plain">/lib/hbase-hadoop2-compat-0</code><code class="bash plain">.96.2-hadoop2.jar</code><code class="bash plain">/home/hadoop/flume-1</code><code class="bash plain">.5.0-bin</code><code class="bash plain">/lib</code></div>
<div class="line number7 index6 alt2"><code class="bash functions">cp</code> <code class="bash plain">
/home/hadoop/hbase-0</code><code class="bash plain">.96.2-hadoop2</code><code class="bash plain">/lib/hbase-hadoop-compat-0</code><code class="bash plain">.96.2-hadoop2.jar</code><code class="bash plain">/home/hadoop/flume-1</code><code class="bash plain">.5.0-bin</code><code class="bash plain">/lib</code><code class="bash plain">@@@</code></div>
<div class="line number8 index7 alt1"><code class="bash functions">cp</code> <code class="bash plain">
/home/hadoop/hbase-0</code><code class="bash plain">.96.2-hadoop2</code><code class="bash plain">/lib/htrace-core-2</code><code class="bash plain">.04.jar</code><code class="bash plain">/home/hadoop/flume-1</code><code class="bash plain">.5.0-bin</code><code class="bash plain">/lib</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p></p>
<div style="text-align:left">　　　　　　c)确保test_idoall_org表在hbase中已经存在，test_idoall_org表的格式以及字段请参考《ubuntu12.04+hadoop2.2.0+zookeeper3.4.5+hbase0.96.2+hive0.13.1分布式环境部署》中关于hbase部分的建表代码。</div>
<div style="text-align:left"> </div>
<div style="text-align:left">　　　　　　d)在m1创建hbase_simple配置文件</div>
<p></p>
<div class="jb51code">
<div>
<div id="highlighter_549489" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
<div class="line number18 index17 alt1">18</div>
<div class="line number19 index18 alt2">19</div>
<div class="line number20 index19 alt1">20</div>
<div class="line number21 index20 alt2">21</div>
<div class="line number22 index21 alt1">22</div>
<div class="line number23 index22 alt2">23</div>
<div class="line number24 index23 alt1">24</div>
<div class="line number25 index24 alt2">25</div>
<div class="line number26 index25 alt1">26</div>
<div class="line number27 index26 alt2">27</div>
<div class="line number28 index27 alt1">28</div>
<div class="line number29 index28 alt2">29</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># vi /home/hadoop/flume-1.5.0-bin/conf/hbase_simple.conf</code></div>
<div class="line number2 index1 alt1"><code class="bash spaces">  </code> </div>
<div class="line number3 index2 alt2"><code class="bash plain">a1.sources = r1 </code>
</div>
<div class="line number4 index3 alt1"><code class="bash plain">a1.sinks = k1 </code>
</div>
<div class="line number5 index4 alt2"><code class="bash plain">a1.channels = c1 </code>
</div>
<div class="line number6 index5 alt1"><code class="bash spaces">  </code> </div>
<div class="line number7 index6 alt2"><code class="bash comments"># Describe/configure the source</code></div>
<div class="line number8 index7 alt1"><code class="bash plain">a1.sources.r1.</code><code class="bash functions">type</code><code class="bash plain">= syslogtcp
</code></div>
<div class="line number9 index8 alt2"><code class="bash plain">a1.sources.r1.port = 5140</code></div>
<div class="line number10 index9 alt1"><code class="bash plain">a1.sources.r1.host = localhost</code></div>
<div class="line number11 index10 alt2"><code class="bash plain">a1.sources.r1.channels = c1</code></div>
<div class="line number12 index11 alt1"><code class="bash spaces">  </code> </div>
<div class="line number13 index12 alt2"><code class="bash comments"># Describe the sink</code></div>
<div class="line number14 index13 alt1"><code class="bash plain">a1.sinks.k1.</code><code class="bash functions">type</code><code class="bash plain">= logger
</code></div>
<div class="line number15 index14 alt2"><code class="bash plain">a1.sinks.k1.</code><code class="bash functions">type</code><code class="bash plain">= hbase
</code></div>
<div class="line number16 index15 alt1"><code class="bash plain">a1.sinks.k1.table = test_idoall_org</code></div>
<div class="line number17 index16 alt2"><code class="bash plain">a1.sinks.k1.columnFamily = name</code></div>
<div class="line number18 index17 alt1"><code class="bash plain">a1.sinks.k1.column = idoall</code></div>
<div class="line number19 index18 alt2"><code class="bash plain">a1.sinks.k1.serializer = org.apache.flume.sink.hbase.RegexHbaseEventSerializer</code></div>
<div class="line number20 index19 alt1"><code class="bash plain">a1.sinks.k1.channel = memoryChannel</code></div>
<div class="line number21 index20 alt2"><code class="bash spaces">  </code> </div>
<div class="line number22 index21 alt1"><code class="bash comments"># Use a channel which buffers events in memory</code></div>
<div class="line number23 index22 alt2"><code class="bash plain">a1.channels.c1.</code><code class="bash functions">type</code><code class="bash plain">= memory
</code></div>
<div class="line number24 index23 alt1"><code class="bash plain">a1.channels.c1.capacity = 1000</code></div>
<div class="line number25 index24 alt2"><code class="bash plain">a1.channels.c1.transactionCapacity = 100</code></div>
<div class="line number26 index25 alt1"><code class="bash spaces">  </code> </div>
<div class="line number27 index26 alt2"><code class="bash comments"># Bind the source and sink to the channel</code></div>
<div class="line number28 index27 alt1"><code class="bash plain">a1.sources.r1.channels = c1</code></div>
<div class="line number29 index28 alt2"><code class="bash plain">a1.sinks.k1.channel = c1</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　e)启动flume agent</p>
<div class="jb51code">
<div>
<div id="highlighter_671363" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">/home/hadoop/flume-1</code><code class="bash plain">.5.0-bin</code><code class="bash plain">/bin/flume-ng</code><code class="bash plain">agent -c . -f
</code><code class="bash plain">/home/hadoop/flume-1</code><code class="bash plain">.5.0-bin</code><code class="bash plain">/conf/hbase_simple</code><code class="bash plain">.conf -n a1 -Dflume.root.logger=INFO,console</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　f)测试产生syslog</p>
<div class="jb51code">
<div>
<div id="highlighter_220539" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># echo "hello idoall.org from flume" | nc localhost 5140</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　　　g)这时登录到hbase中，可以发现新数据已经插入</p>
<div class="jb51code">
<div>
<div id="highlighter_306709" class="syntaxhighlighter  bash ie">
<div class="toolbar" style="text-align:left"><a target="_blank" class="toolbar_item command_help help" href="http://www.jb51.net/article/53542.htm#" rel="nofollow">?</a></div>
<table border="0" cellspacing="0" cellpadding="0" style="text-align:left">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
<div class="line number18 index17 alt1">18</div>
<div class="line number19 index18 alt2">19</div>
<div class="line number20 index19 alt1">20</div>
<div class="line number21 index20 alt2">21</div>
<div class="line number22 index21 alt1">22</div>
<div class="line number23 index22 alt2">23</div>
<div class="line number24 index23 alt1">24</div>
<div class="line number25 index24 alt2">25</div>
<div class="line number26 index25 alt1">26</div>
<div class="line number27 index26 alt2">27</div>
<div class="line number28 index27 alt1">28</div>
<div class="line number29 index28 alt2">29</div>
<div class="line number30 index29 alt1">30</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="bash plain">root@m1:</code><code class="bash plain">/home/hadoop</code><code class="bash comments"># /home/hadoop/hbase-0.96.2-hadoop2/bin/hbase shell</code></div>
<div class="line number2 index1 alt1"><code class="bash plain">2014-08-10 16:09:48,984 INFO [main] Configuration.deprecation: hadoop.native.lib is deprecated. Instead, use io.native.lib.available</code></div>
<div class="line number3 index2 alt2"><code class="bash plain">HBase Shell; enter</code><code class="bash string">'help&lt;RETURN&gt;'</code>
<code class="bash keyword">for</code> <code class="bash plain">list of supported commands.
</code></div>
<div class="line number4 index3 alt1"><code class="bash plain">Type </code><code class="bash string">"exit&lt;RETURN&gt;"</code><code class="bash plain">to leave the HBase Shell
</code></div>
<div class="line number5 index4 alt2"><code class="bash plain">Version 0.96.2-hadoop2, r1581096, Mon Mar 24 16:03:18 PDT 2014</code></div>
<div class="line number6 index5 alt1"><code class="bash spaces">  </code> </div>
<div class="line number7 index6 alt2"><code class="bash plain">hbase(main):001:0&gt; list</code></div>
<div class="line number8 index7 alt1"><code class="bash plain">TABLE                                                                                                         </code></div>
<div class="line number9 index8 alt2"><code class="bash plain">SLF4J: Class path contains multiple SLF4J bindings.</code></div>
<div class="line number10 index9 alt1"><code class="bash plain">SLF4J: Found binding</code><code class="bash keyword">in</code>
<code class="bash plain">[jar:</code><code class="bash functions">file</code><code class="bash plain">:</code><code class="bash plain">/home/hadoop/hbase-0</code><code class="bash plain">.96.2-hadoop2</code><code class="bash plain">/lib/slf4j-log4j12-1</code><code class="bash plain">.6.4.jar!</code><code class="bash plain">/org/slf4j/impl/StaticLoggerBinder</code><code class="bash plain">.class]</code></div>
<div class="line number11 index10 alt2"><code class="bash plain">SLF4J: Found binding</code><code class="bash keyword">in</code>
<code class="bash plain">[jar:</code><code class="bash functions">file</code><code class="bash plain">:</code><code class="bash plain">/home/hadoop/hadoop-2</code><code class="bash plain">.2.0</code><code class="bash plain">/share/hadoop/common/lib/slf4j-log4j12-1</code><code class="bash plain">.7.5.jar!</code><code class="bash plain">/org/slf4j/impl/StaticLoggerBinder</code><code class="bash plain">.class]</code></div>
<div class="line number12 index11 alt1"><code class="bash plain">SLF4J: See http:</code><code class="bash plain">//www</code><code class="bash plain">.slf4j.org</code><code class="bash plain">/codes</code><code class="bash plain">.html</code><code class="bash comments">#multiple_bindings
 for an explanation. </code></div>
<div class="line number13 index12 alt2"><code class="bash plain">hbase2hive_idoall                                                                                                   </code></div>
<div class="line number14 index13 alt1"><code class="bash plain">hive2hbase_idoall                                                                                                   </code></div>
<div class="line number15 index14 alt2"><code class="bash plain">test_idoall_org                                                                                                    </code></div>
<div class="line number16 index15 alt1"><code class="bash plain">3 row(s) </code>
<code class="bash keyword">in</code> <code class="bash plain">2.6880 seconds </code>
</div>
<div class="line number17 index16 alt2"><code class="bash spaces">  </code> </div>
<div class="line number18 index17 alt1"><code class="bash plain">=&gt; [</code><code class="bash string">"hbase2hive_idoall"</code><code class="bash plain">,</code><code class="bash string">"hive2hbase_idoall"</code><code class="bash plain">,</code><code class="bash string">"test_idoall_org"</code><code class="bash plain">]</code></div>
<div class="line number19 index18 alt2"><code class="bash plain">hbase(main):002:0&gt; scan</code><code class="bash string">"test_idoall_org"</code></div>
<div class="line number20 index19 alt1"><code class="bash plain">ROW                          COLUMN+CELL                                                                           </code></div>
<div class="line number21 index20 alt2"><code class="bash spaces"> </code><code class="bash plain">10086                         column=name:idoall, timestamp=1406424831473, value=idoallvalue                                                 </code></div>
<div class="line number22 index21 alt1"><code class="bash plain">1 row(s) </code>
<code class="bash keyword">in</code> <code class="bash plain">0.0550 seconds </code>
</div>
<div class="line number23 index22 alt2"><code class="bash spaces">  </code> </div>
<div class="line number24 index23 alt1"><code class="bash plain">hbase(main):003:0&gt; scan</code><code class="bash string">"test_idoall_org"</code></div>
<div class="line number25 index24 alt2"><code class="bash plain">ROW                          COLUMN+CELL                                                                           </code></div>
<div class="line number26 index25 alt1"><code class="bash spaces"> </code><code class="bash plain">10086                         column=name:idoall, timestamp=1406424831473, value=idoallvalue                                                 </code></div>
<div class="line number27 index26 alt2"><code class="bash spaces"> </code><code class="bash plain">1407658495588-XbQCOZrKK8-0              column=name:payload, timestamp=1407658498203, value=hello idoall.org from flume                                         </code></div>
<div class="line number28 index27 alt1"><code class="bash plain">2 row(s) </code>
<code class="bash keyword">in</code> <code class="bash plain">0.0200 seconds </code>
</div>
<div class="line number29 index28 alt2"><code class="bash spaces">  </code> </div>
<div class="line number30 index29 alt1"><code class="bash plain">hbase(main):004:0&gt; quit</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p style="text-align:left">　　　　经过这么多flume的例子测试，如果你全部做完后，会发现flume的功能真的很强大，可以进行各种搭配来完成你想要的工作，俗话说师傅领进门，修行在个人，如何能够结合你的产品业务，将flume更好的应用起来，快去动手实践吧。<br>
</p>
            </div>
                </div>