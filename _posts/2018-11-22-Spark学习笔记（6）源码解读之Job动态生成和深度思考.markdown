---
layout:     post
title:      Spark学习笔记（6）源码解读之Job动态生成和深度思考
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<span style="font-family:SimSun;font-size:14px;line-height:21px;"><strong>本期内容：</strong></span>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">1 Spark Streaming Job生成深度思考</span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">2 Spark Streaming Job生成源码解析</span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="background-color:inherit;"><strong>1 Spark Streaming Job生成深度思考</strong></span><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　前面的课程中已经讲了，Spark Streaming的Job是通过JobGenerator生成。这里说的Job和Spark Core中的Job不是一回事。Spark Streaming中的Job相当于Java中线程要处理的Runnable的业务逻辑的封装。Spark Core上的Job是一个运行的作业。</span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　JobGenerator会利用DStream来生成Job。从流程上看，DStream一般分三种类型：<br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;">
<div style="line-height:1.5;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;"><span style="line-height:21px;">　　</span>1、输入的DStreams。</span></div>
<div style="line-height:1.5;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;"><span style="line-height:21px;">　　</span>2、输出的DStreams，是一个逻辑级别的Action，它是SparkStreaming框架提出的，它的底层还是会被翻译成物理级别的Action。所谓物理级别的Action是RDD的Action。</span></div>
<div style="line-height:1.5;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;"><span style="line-height:21px;">　　</span>3、中间的业务处理的通过Transformation（转换）产生的DStream。也就是业务处理逻辑的中间过程。</span></div>
<div style="line-height:1.5;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">　　产生DStream也可以说有两类：一类是根据数据源产生DStream，另一类是通过前面的DStream转换后生成DStream。</span></div>
<div style="line-height:1.5;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;"><span style="line-height:21px;">　　</span>所以说，JobGenerator是根据DStream的依赖关系，或者说根据DStreamGraph来产生Job。</span></div>
<div style="line-height:1.5;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;"><span style="line-height:21px;">　　</span>当然从时间维度上讲，JobGenarator会不断地产生Job。我们做连续不断的大数据任务时，如果不采用流式处理，一般会用定时任务。其实我们也是变相地在做流处理。不管是定时1分钟、1小时，甚至是1天，都类似在做流处理。应该更深刻的理解此前说过的一句话吧：一切没有经过流处理或近似流处理的数据，都将是没有价值的数据。原来的定时任务实际上是在做变相的流处理。我们相信，一切处理终将会被流处理完全统一。</span></div>
<div style="line-height:1.5;background-color:inherit;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
</div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="background-color:inherit;"><strong>2 Spark Streaming Job生成源码解析</strong><br style="background-color:inherit;"></span></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="background-color:inherit;"><br style="background-color:inherit;"></span></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="background-color:inherit;"><span style="font-weight:normal;">　　其实，Spark Streaming的流处理实际上就是以时间作为触发器的。这和基于事件触发的Storm不同。</span></span></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="background-color:inherit;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;">　　看看Spark Streaming应用程序代码的最开始的共同之处：<strong><span style="font-weight:normal;"><strong><span style="font-weight:normal;">定义</span></strong></span></strong>SparkStreamingContext。给个例子：</span></span><br style="background-color:inherit;"></span></span></span></div>
<div style="font-size:14px;line-height:21px;">
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;"><strong><span style="font-weight:normal;"><strong><span style="font-weight:normal;"></span></strong></span></strong>val ssc = new StreamingContext(conf, Seconds(5))</span></div>
</div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="background-color:inherit;"><span style="font-weight:normal;"><strong><span style="font-weight:normal;"><strong><span style="font-weight:normal;"><br style="background-color:inherit;"></span></strong></span></strong></span></span></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="background-color:inherit;"><span style="font-weight:normal;"><strong><span style="font-weight:normal;"><strong><span style="font-weight:normal;">　　这个5秒钟的Batch
 Duration（批处理时间间隔）就是用来设置定时器的时间长度。</span></strong><br style="background-color:inherit;"></span></strong></span></span></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="background-color:inherit;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><strong><span style="font-weight:normal;"><strong><span style="font-weight:normal;">　　系统翻译基于DStream的依赖关系，成为了RDD之间的依赖关系，而最后的处理是一个action，但由于这个处理是定义在一个方法中，而此方法没有被马上调用，也就没有马上执行。这是为了便于管理，要形成队列来依次处理。</span></strong></span></strong><br style="background-color:inherit;"></span></span></span></span></span></span></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="background-color:inherit;"><span style="font-weight:normal;"></span></span><span style="line-height:21px;">　　</span>Spark Streaming应用程序代码的最后面的共同之处：运行SparkStreamingContext的start()：<br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="background-color:inherit;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><strong><span style="font-weight:normal;"><span style="background-color:inherit;">  
 ssc.start()</span></span></strong></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="background-color:inherit;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;">　　这里才是真正启动流处理执行的地方。<span style="line-height:21px;">启动</span><span style="line-height:21px;">SparkStreamingContext，会启动<span style="line-height:21px;">JobScheduler。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="background-color:inherit;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><strong><span style="font-weight:normal;"><strong><span style="font-weight:normal;"><br style="background-color:inherit;"></span></strong></span></strong></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="background-color:inherit;"><span style="font-weight:normal;"></span></span>　　Spark Streaming作业的三大核心是：<br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><strong><span style="font-weight:normal;"><strong><span style="font-weight:normal;">　　1.
 JobGenerator：负责Job的生成。</span></strong></span></strong></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><strong><span style="font-weight:normal;"><strong><span style="font-weight:normal;">　　2.
 ReceiverTracker：负责数据的接收。</span></strong></span></strong></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br style="background-color:inherit;"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><strong><span style="font-weight:normal;">　　3.<span style="background-color:inherit;"> JobScheduler：负责Job的调度执行。</span></span></strong></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br style="background-color:inherit;"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><strong><span style="font-weight:normal;"><span style="background-color:inherit;"><br style="background-color:inherit;"></span></span></strong></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;">　　JobGenerator、<span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;">ReceiverTracker其实是在<span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;">JobScheduler的start()中被启动。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　先提供<span style="line-height:21px;">Job生成的</span>总体轮廓。本期剖析的Job生成的主流程图如下所示：</span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><img src="https://img-blog.csdn.net/20160517200016335?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" style="display:inline-block;background-color:inherit;"></span></div>
<span style="font-family:SimSun;font-size:14px;"><br></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;">　　先从JobScheduler.start开始剖析。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;"><span style="font-weight:bold;"><span style="font-weight:normal;">　　JobScheduler.start的代码片段：</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><span style="background-color:inherit;"><br style="background-color:inherit;"></span></span></div>
<div style="font-size:14px;line-height:21px;">
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">class JobScheduler(val ssc: StreamingContext) extends Logging {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  ...</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  private val jobGenerator = new JobGenerator(this)</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  ...</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  def <span style="background-color:inherit;"><strong>start</strong></span>(): Unit = synchronized {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    ...</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    receiverTracker = new ReceiverTracker(ssc)</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    ...</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    receiverTracker.start()</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    </span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">jobGenerator.start</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">()</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    ...</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  }</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  ...</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">}</span></div>
</div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　我们先看JobGenerator的start()：</span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;">
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">/** Start generation of jobs */</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">def <span style="background-color:inherit;"><strong>start</strong></span>(): Unit = synchronized {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  ...</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  eventLoop = new </span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">EventLoop</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">[JobGeneratorEvent]("JobGenerator") {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    override protected def </span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">onReceive</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">(event: JobGeneratorEvent): Unit = </span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">processEvent</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">(event)</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;">    ...<br style="background-color:inherit;"></span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    }</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  }</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  eventLoop.start()</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;"><br style="background-color:inherit;"></span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  if (ssc.isCheckpointPresent) {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    restart()</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  } else {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    startFirstTime()</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  }</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">}</span></div>
</div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　注释也说明这是生成jobs。<br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　代码中生成了EventLoop，并启动它。EventLoop是个消息接收器，其中有个消息队列，用于接收消息；它启动后，其中会有个线程不断地从该队列中取消息进行处理。<br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　代码中覆盖了EventLoop的onReceive方法，OnReceive()里，一般不要做复杂耗时的操作，应该交给别的线程去处理。按照定义，OnReceive也就是调用了processEvent方法。<br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　<span style="line-height:21px;">JobGenerator</span>.processEvent的代码：<br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;">
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">/** Processes all events */</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">private def </span><span style="font-family:SimSun;font-size:14px;"><span style="background-color:inherit;"><span style="background-color:inherit;"><strong>processEvent</strong></span></span><span style="background-color:inherit;">(event: JobGeneratorEvent) {</span></span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  ...</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  event match {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    case </span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">GenerateJobs</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">(time) =&gt; </span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">generateJobs</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">(time)</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    ...</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  }</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">}</span></div>
</div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　一般情况下，会执行 GenerateJobs(time)这种类型的事件消息。其相应的会执行generateJobs(time)：<br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　JobGenerator.generateJobs的代码：<br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;">
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">/** Generate jobs and perform checkpoint for the given `time`.  */</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">private def <span style="background-color:inherit;"><strong>generateJobs</strong></span>(time: Time) {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  ...<br style="background-color:inherit;"></span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;"><span style="line-height:1.5;background-color:inherit;"><span style="background-color:inherit;">  Try {</span></span></span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    jobScheduler.receiverTracker.allocateBlocksToBatch(time) // allocate received blocks to batch</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    </span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">graph.generateJobs</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">(time) // generate jobs using allocated block</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  } match {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    case Success(jobs) =&gt;</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">      val streamIdToInputInfos = jobScheduler.inputInfoTracker.getInfo(time)</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">      jobScheduler.submitJobSet(JobSet(time, jobs, streamIdToInputInfos))</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">      ...<br style="background-color:inherit;"></span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;"><span style="line-height:1.5;background-color:inherit;"><span style="background-color:inherit;">  }</span></span></span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;"><span style="line-height:1.5;background-color:inherit;"><span style="background-color:inherit;"><span style="background-color:inherit;">  ...</span><br style="background-color:inherit;"></span></span></span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">}</span></div>
</div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　主要是先获取数据，然后对这些数据来生成相应的jobs，生成工作是调用DStreamGraph的generateJobs。<br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　DStreamGraph.generateJobs的代码：<br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;">
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">def <span style="background-color:inherit;"><strong>generateJobs</strong></span>(time: Time): Seq[Job] = {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  logDebug("Generating jobs for time " + time)</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  val jobs = this.synchronized {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    outputStreams.flatMap { outputStream =&gt;</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">      val jobOption = outputStream.</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">generateJob</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">(time)</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">      jobOption.foreach(_.setCallSite(outputStream.creationSite))</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">      jobOption</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    }</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  }</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  logDebug("Generated " + jobs.length + " jobs for time " + time)</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  jobs</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">}</span></div>
</div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　这里的outputDStream是DStream中最后处理的Dstream，根据DStreamGraph的最后面的outputDStream，从后往前推，</span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　DStream.generateJob的代码：<br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;">
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">/**</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;"> * Generate a SparkStreaming job for the given time. This is an internal method that</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;"> * should not be called directly. This default implementation creates a job</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;"> * that materializes the corresponding RDD. Subclasses of DStream may override this</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;"> * to generate their own jobs.</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;"> */</span></div>
</div>
<div style="font-size:14px;line-height:21px;">
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;"> private[streaming] def <span style="background-color:inherit;"><strong>generateJob</strong></span>(time: Time): Option[Job] = {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  </span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">getOrCompute</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">(time) match {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    case Some(rdd) =&gt; {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">      val </span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">jobFunc </span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">= () =&gt; {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">        val emptyFunc = { (iterator: Iterator[T]) =&gt; {} }</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">        context.sparkContext.runJob(rdd, emptyFunc)</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">      }</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">      Some(new </span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">Job</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">(time, jobFunc))</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    }</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    case None =&gt; None</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  }</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">}</span></div>
</div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　代码的注释也说明了DStream间的操作是逻辑级别的，RDD之间的操作是物理的。<br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　getOrCompute是获得指定时间的RDD。<br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　其中的Job是Spark Streaming中定义的。这里并不是真正执行了Spark Core的作业。而是用函数jobFunc封装了Spark作业的执行本身。</span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　这个Job类其实就是相当于Java中的Bean，并没有做Spark的作业的执行。<br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　至此，JobGenarator.start中的消息处理的定义就剖析完了。再看其中的后续代码。<br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　JobGenarator.start的代码：<br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;">
<div><span style="font-family:SimSun;font-size:14px;background-color:inherit;">/** Start generation of jobs */</span></div>
<div><span style="font-family:SimSun;font-size:14px;background-color:inherit;">def <span style="background-color:inherit;"><strong>start</strong></span>(): Unit = synchronized {</span></div>
<div><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  ...</span></div>
<div><span style="font-family:SimSun;font-size:14px;background-color:inherit;"><span style="background-color:inherit;">  eventLoop = new </span><span style="background-color:inherit;">EventLoop</span><span style="background-color:inherit;">[JobGeneratorEvent]("JobGenerator") {</span></span></div>
<div><span style="font-family:SimSun;font-size:14px;background-color:inherit;"><span style="background-color:inherit;">    override protected def </span><span style="background-color:inherit;">onReceive</span><span style="background-color:inherit;">(event: JobGeneratorEvent): Unit = </span><span style="background-color:inherit;">processEvent</span><span style="background-color:inherit;">(event)</span></span></div>
<div><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    ...<br style="background-color:inherit;"></span></div>
<div><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    }</span></div>
<div><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  }</span></div>
<div><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  eventLoop.start()</span></div>
<div><span style="font-family:SimSun;font-size:14px;background-color:inherit;"><br style="background-color:inherit;"></span></div>
<div><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  if (ssc.isCheckpointPresent) {</span></div>
<div><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    restart()</span></div>
<div><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  } else {</span></div>
<div><span style="font-family:SimSun;font-size:14px;background-color:inherit;">   <span style="background-color:inherit;"> </span></span><span style="font-family:SimSun;font-size:14px;"><span style="background-color:inherit;"><span style="background-color:inherit;">startFirstTime</span><span style="background-color:inherit;">()</span></span></span></div>
<div><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  }</span></div>
<div><span style="font-family:SimSun;font-size:14px;background-color:inherit;">}</span></div>
<span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　restart是利用checkPoint重新启动JobGenerator。我们主要看看startFirstTime。</span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　JobGenerator.startFirstTime代码：</span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;">
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">/** Starts the generator for the first time */</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">private def <span style="background-color:inherit;"><strong>startFirstTime</strong></span>() {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  val startTime = new Time(timer.getStartTime())</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  </span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">graph.start</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">(startTime - graph.batchDuration)</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  </span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">timer.start</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">(startTime.milliseconds)</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  logInfo("Started JobGenerator at " + startTime)</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">}</span></div>
</div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　其中启动了DStreamGraph和RecurringTimer。</span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　DStreamGraph.start对DStreamGraph中的各DStream做初始化。<br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　RecurringTimer.start代码：</span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;">
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">/**</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;"> * Start at the given start time.</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;"> */</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">def <span style="background-color:inherit;"><strong>start</strong></span>(startTime: Long): Long = synchronized {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  nextTime = startTime</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  </span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">thread.start</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">()</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  logInfo("Started timer for " + name + " at time " + nextTime)</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  nextTime</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">}</span></div>
</div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　实际上是启动一个线程来定时调用回调函数。再回过头看timer的定义：</span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;">
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">private val timer = new RecurringTimer(clock, ssc.graph.batchDuration.milliseconds,</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  </span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">longTime =&gt; eventLoop.post(GenerateJobs(new Time(longTime)))</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">, "JobGenerator")</span></div>
</div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　其中的匿名的回调函数是发送GenerateJobs消息给eventLoop。</span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　原来JobGenerator.processEvent中获得的消息是RecurringTimer定时触发的。</span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　<span style="line-height:21px;">Job</span>Generator中的generateJobs剖析完了，再看后面的代码。<br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;">
<div><span style="font-family:SimSun;font-size:14px;">　　<span style="line-height:21px;">Job</span>Generator.generateJobs的代码：<br style="background-color:inherit;"></span></div>
<div><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">/** Generate jobs and perform checkpoint for the given `time`.  */</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">private def <span style="background-color:inherit;"><strong>generateJobs</strong></span>(time: Time) {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  ...<br style="background-color:inherit;"></span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;"><span style="background-color:inherit;"><span style="background-color:inherit;">  Try {</span></span></span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    jobScheduler.receiverTracker.allocateBlocksToBatch(time) // allocate received blocks to batch</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    </span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">graph.generateJobs</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">(time) // generate jobs using allocated block</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  } match {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    case Success(jobs) =&gt;</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">      val streamIdToInputInfos = jobScheduler.inputInfoTracker.getInfo(time)</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">      </span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">jobScheduler.submitJobSet</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">(JobSet(time, jobs, streamIdToInputInfos))</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">      ...<br style="background-color:inherit;"></span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;"><span style="background-color:inherit;"><span style="background-color:inherit;">  }</span></span></span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;"><span style="background-color:inherit;"><span style="background-color:inherit;"><span style="background-color:inherit;">  ...</span><br style="background-color:inherit;"></span></span></span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">}</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;"><br style="background-color:inherit;"></span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;"><span style="background-color:inherit;"><span style="background-color:inherit;">　　JobScheduler.submitJobSet的代码：</span><br style="background-color:inherit;"></span></span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;"><span style="background-color:inherit;"><span style="background-color:inherit;"><br style="background-color:inherit;"></span></span></span></div>
<div style="background-color:inherit;">
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">def <span style="background-color:inherit;"><strong>submitJobSet</strong></span>(jobSet: JobSet) {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  if (jobSet.jobs.isEmpty) {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    logInfo("No jobs added for time " + jobSet.time)</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  } else {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    listenerBus.post(StreamingListenerBatchSubmitted(jobSet.toBatchInfo))</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    jobSets.put(jobSet.time, jobSet)</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    jobSet.jobs.foreach(job =&gt; </span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">jobExecutor.execute</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">(new </span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">JobHandler</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">(job)))</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    logInfo("Added jobs for time " + jobSet.time)</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  }</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">}</span></div>
</div>
</div>
<span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">jobExecutor是线程池，JobHandler是Runnable的子类。<br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">JobHandler.run的代码：</span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;">
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">private class JobHandler(job: Job) extends Runnable with Logging {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  import JobScheduler._</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">   def <span style="background-color:inherit;"><strong>run</strong></span>() {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    try {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">      ...</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">      if (_eventLoop != null) {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">        ...</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">        PairRDDFunctions.disableOutputSpecValidation.withValue(true) {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">          </span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">job.run</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">()</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">        }</span></div>
<div><span style="font-family:SimSun;font-size:14px;background-color:inherit;">        ...</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">      } else {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">        // JobScheduler has been stopped.</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">      }</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    } finally {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">      ssc.sc.setLocalProperty(JobScheduler.BATCH_TIME_PROPERTY_KEY, null)</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">      ssc.sc.setLocalProperty(JobScheduler.OUTPUT_OP_ID_PROPERTY_KEY, null)</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">    }</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  }</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">}</span></div>
</div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　Job.run的代码：</span></div>
<div style="font-size:14px;line-height:21px;">
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">def <span style="background-color:inherit;"><strong>run</strong></span>() {</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">  _result = Try(</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">func</span><span style="font-family:SimSun;font-size:14px;background-color:inherit;">())</span></div>
<div style="background-color:inherit;"><span style="font-family:SimSun;font-size:14px;background-color:inherit;">}</span></div>
</div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;"><br style="background-color:inherit;"></span></div>
<div style="font-size:14px;line-height:21px;"><span style="font-family:SimSun;font-size:14px;">　　此处，执行了Job中封装的业务逻辑。</span></div>
            </div>
                </div>