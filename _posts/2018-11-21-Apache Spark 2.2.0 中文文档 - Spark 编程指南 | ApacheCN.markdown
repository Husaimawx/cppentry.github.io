---
layout:     post
title:      Apache Spark 2.2.0 中文文档 - Spark 编程指南 | ApacheCN
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                
<div class="container-wrapper" style='padding:0px; margin:10px auto 0px; list-style:none; border:0px; color:rgb(29,31,34); max-width:1024px; position:relative; font-family:"Helvetica Neue",Helvetica,Arial,sans-serif; font-size:14px'>
<div class="content" id="content" style="padding:0px 0px 0px 15px; margin:0px; list-style:none; border:0px; z-index:1; position:relative; max-width:914px; line-height:1.6">
<h1 class="title" id="spark" style="padding:0px; margin:12px 0px 10px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:32px">
Spark 编程指南<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#spark" rel="nofollow" style=""></a></h1>
<ul id="markdown-toc" style="padding:0px; margin:0px 0px 10px 25px; list-style:none; border:0px">
<li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E6%A6%82%E8%BF%B0" rel="nofollow" id="markdown-toc-概述" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">概述</a></li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#spark-%E4%BE%9D%E8%B5%96" rel="nofollow" id="markdown-toc-spark-依赖" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Spark 依赖</a></li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%88%9D%E5%A7%8B%E5%8C%96-spark" rel="nofollow" id="markdown-toc-初始化-spark" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">初始化 Spark</a>
<ul style="padding:0px; margin:0px 0px 0px 25px; list-style:none; border:0px">
<li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E4%BD%BF%E7%94%A8-shell" rel="nofollow" id="markdown-toc-使用-shell" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">使用 Shell</a></li></ul>
</li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%BC%B9%E6%80%A7%E5%88%86%E5%B8%83%E5%BC%8F%E6%95%B0%E6%8D%AE%E9%9B%86-rdds" rel="nofollow" id="markdown-toc-弹性分布式数据集-rdds" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">弹性分布式数据集 (RDDs)</a>
<ul style="padding:0px; margin:0px 0px 0px 25px; list-style:none; border:0px">
<li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%B9%B6%E8%A1%8C%E9%9B%86%E5%90%88" rel="nofollow" id="markdown-toc-并行集合" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">并行集合</a></li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%A4%96%E9%83%A8-datasets%E6%95%B0%E6%8D%AE%E9%9B%86" rel="nofollow" id="markdown-toc-外部-datasets数据集" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">外部 Datasets（数据集）</a></li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#rdd-%E6%93%8D%E4%BD%9C" rel="nofollow" id="markdown-toc-rdd-操作" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">RDD 操作</a>
<ul style="padding:0px; margin:0px 0px 0px 25px; list-style:none; border:0px">
<li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%9F%BA%E7%A1%80" rel="nofollow" id="markdown-toc-基础" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">基础</a></li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E4%BC%A0%E9%80%92-functions%E5%87%BD%E6%95%B0%E7%BB%99-spark" rel="nofollow" id="markdown-toc-传递-functions函数给-spark" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">传递 Functions（函数）给 Spark</a></li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E7%90%86%E8%A7%A3%E9%97%AD%E5%8C%85-" rel="nofollow" id="markdown-toc-理解闭包-" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">理解闭包</a><a target="_blank" name="ClosuresLink" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"></a>
<ul style="padding:0px; margin:0px 0px 0px 25px; list-style:none; border:0px">
<li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E7%A4%BA%E4%BE%8B" rel="nofollow" id="markdown-toc-示例" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">示例</a></li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#local%E6%9C%AC%E5%9C%B0vs-cluster%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F" rel="nofollow" id="markdown-toc-local本地vs-cluster集群模式" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Local（本地）vs. cluster（集群）模式</a></li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E6%89%93%E5%8D%B0-rdd-%E7%9A%84-elements" rel="nofollow" id="markdown-toc-打印-rdd-的-elements" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">打印 RDD 的 elements</a></li></ul>
</li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E4%B8%8E--key-value-pairs-%E4%B8%80%E8%B5%B7%E4%BD%BF%E7%94%A8" rel="nofollow" id="markdown-toc-与--key-value-pairs-一起使用" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">与 Key-Value Pairs
 一起使用</a></li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#transformations%E8%BD%AC%E6%8D%A2" rel="nofollow" id="markdown-toc-transformations转换" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Transformations（转换）</a></li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#actions%E5%8A%A8%E4%BD%9C" rel="nofollow" id="markdown-toc-actions动作" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Actions（动作）</a></li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#shuffle-%E6%93%8D%E4%BD%9C" rel="nofollow" id="markdown-toc-shuffle-操作" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Shuffle 操作</a>
<ul style="padding:0px; margin:0px 0px 0px 25px; list-style:none; border:0px">
<li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#background%E5%B9%95%E5%90%8E" rel="nofollow" id="markdown-toc-background幕后" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Background（幕后）</a></li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E6%80%A7%E8%83%BD%E5%BD%B1%E5%93%8D" rel="nofollow" id="markdown-toc-性能影响" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">性能影响</a></li></ul>
</li></ul>
</li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#rdd-persistence%E6%8C%81%E4%B9%85%E5%8C%96" rel="nofollow" id="markdown-toc-rdd-persistence持久化" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">RDD Persistence（持久化）</a>
<ul style="padding:0px; margin:0px 0px 0px 25px; list-style:none; border:0px">
<li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E5%AD%98%E5%82%A8%E7%BA%A7%E5%88%AB-" rel="nofollow" id="markdown-toc-如何选择存储级别-" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">如何选择存储级别 ?</a></li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE" rel="nofollow" id="markdown-toc-删除数据" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">删除数据</a></li></ul>
</li></ul>
</li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%85%B1%E4%BA%AB%E5%8F%98%E9%87%8F" rel="nofollow" id="markdown-toc-共享变量" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">共享变量</a>
<ul style="padding:0px; margin:0px 0px 0px 25px; list-style:none; border:0px">
<li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%B9%BF%E6%92%AD%E5%8F%98%E9%87%8F" rel="nofollow" id="markdown-toc-广播变量" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">广播变量</a></li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#accumulators%E7%B4%AF%E5%8A%A0%E5%99%A8" rel="nofollow" id="markdown-toc-accumulators累加器" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Accumulators（累加器）</a></li></ul>
</li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8%E5%88%B0%E9%9B%86%E7%BE%A4%E4%B8%AD" rel="nofollow" id="markdown-toc-部署应用到集群中" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">部署应用到集群中</a></li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E4%BB%8E-java--scala-%E5%90%AF%E5%8A%A8-spark-jobs" rel="nofollow" id="markdown-toc-从-java--scala-启动-spark-jobs" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">从 Java
 / Scala 启动 Spark jobs</a></li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95" rel="nofollow" id="markdown-toc-单元测试" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">单元测试</a></li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%BF%AB%E9%80%9F%E9%93%BE%E6%8E%A5" rel="nofollow" id="markdown-toc-快速链接" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">快速链接</a></li></ul>
<h1 id="概述" style="padding:0px; margin:12px 0px 10px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:28px">
概述<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E6%A6%82%E8%BF%B0" rel="nofollow" style=""></a></h1>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
在一个较高的概念上来说，每一个 Spark 应用程序由一个在集群上运行着用户的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>main</code> 函数和执行各种并行操作的 <span style="padding:0px; margin:0px; list-style:none; border:0px">driver
 program</span>（驱动程序）组成。Spark 提供的主要抽象是一个<span style="padding:0px; margin:0px; list-style:none; border:0px">弹性分布式数据集</span>（RDD），它是可以执行并行操作且跨集群节点的元素的集合。RDD 可以从一个 Hadoop 文件系统（或者任何其它 Hadoop 支持的文件系统），或者一个在 driver program（驱动程序）中已存在的 Scala 集合，以及通过 transforming（转换）来创建一个
 RDD。用户为了让它在整个并行操作中更高效的重用，也许会让 Spark persist（持久化）一个 RDD 到内存中。最后，RDD 会自动的从节点故障中恢复。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
在 Spark 中的第二个抽象是能够用于并行操作的 <span style="padding:0px; margin:0px; list-style:none; border:0px">shared variables</span>（共享变量），默认情况下，当 Spark 的一个函数作为一组不同节点上的任务运行时，它将每一个变量的副本应用到每一个任务的函数中去。有时候，一个变量需要在整个任务中，或者在任务和 driver program（驱动程序）之间来共享。Spark 支持两种类型的共享变量 : <span style="padding:0px; margin:0px; list-style:none; border:0px">broadcast
 variables</span>（广播变量），它可以用于在所有节点上缓存一个值，和 <span style="padding:0px; margin:0px; list-style:none; border:0px">accumulators</span>（累加器），他是一个只能被 “added（增加）” 的变量，例如 counters 和 sums。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
本指南介绍了每一种 Spark 所支持的语言的特性。如果您启动 Spark 的交互式 shell - 针对 Scala shell 使用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>bin/spark-shell</code> 或者针对 Python 使用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>bin/pyspark</code> 是很容易来学习的。</p>
<h1 id="spark-依赖" style="padding:0px; margin:12px 0px 10px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:28px">
Spark 依赖<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#spark-%E4%BE%9D%E8%B5%96" rel="nofollow" style=""></a></h1>
<ul class="nav nav-tabs" style="padding:0px; margin:0px 0px 20px; list-style:none; border-width:0px 0px 1px; border-top-style:initial; border-right-style:initial; border-bottom-style:solid; border-left-style:initial; border-top-color:initial; border-right-color:initial; border-bottom-color:rgb(221,221,221); border-left-color:initial">
<li class="active" style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_scala" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_scala_0" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border-width:1px; border-style:solid; border-color:rgb(221,221,221) rgb(221,221,221) transparent; color:rgb(0,136,204); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Scala</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_java" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_java_0" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Java</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_python" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_python_0" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Python</span></a></li></ul>
<div class="codetabs tab-content" style="padding:0px; margin:0px; list-style:none; border:0px; overflow:auto">
<div class="tab-pane active" id="tab_scala_0" style="padding:0px; margin:0px; list-style:none; border:0px">
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
Spark 2.2.0 默认使用 Scala 2.11 来构建和发布直到运行。（当然，Spark 也可以与其它的 Scala 版本一起运行）。为了使用 Scala 编写应用程序，您需要使用可兼容的 Scala 版本（例如，2.11.X）。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
要编写一个 Spark 的应用程序，您需要在 Spark 上添加一个 Maven 依赖。Spark 可以通过 Maven 中央仓库获取:</p>
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:13px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:inherit; background:transparent'>groupId = org.apache.spark
artifactId = spark-core_2.11
version = 2.2.0
</code></pre>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
此外，如果您想访问一个 HDFS 集群，则需要针对您的 HDFS 版本添加一个 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>hadoop-client</code>（hadoop 客户端）依赖。</p>
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:13px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:inherit; background:transparent'>groupId = org.apache.hadoop
artifactId = hadoop-client
version = &lt;your-hdfs-version&gt;
</code></pre>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
最后，您需要导入一些 Spark classes（类）到您的程序中去。添加下面几行:</p>
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code class="language-scala" style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; color:inherit; background:transparent'><span style="padding:0px; margin:0px; list-style:none; border:0px"></span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">import</span> <span class="nn" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(14,132,181); font-weight:bold">org.apache.spark.SparkContext</span>
<span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">import</span> <span class="nn" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(14,132,181); font-weight:bold">org.apache.spark.SparkConf</span></code></pre>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
(在 Spark 1.3.0 之前，您需要明确导入 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>org.apache.spark.SparkContext._</code> 来启用必要的的隐式转换。)</p>
</div>
</div>
<h1 id="初始化-spark" style="padding:0px; margin:12px 0px 10px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:28px">
初始化 Spark<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%88%9D%E5%A7%8B%E5%8C%96-spark" rel="nofollow" style=""></a></h1>
<ul class="nav nav-tabs" style="padding:0px; margin:0px 0px 20px; list-style:none; border-width:0px 0px 1px; border-top-style:initial; border-right-style:initial; border-bottom-style:solid; border-left-style:initial; border-top-color:initial; border-right-color:initial; border-bottom-color:rgb(221,221,221); border-left-color:initial">
<li class="active" style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_scala" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_scala_1" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border-width:1px; border-style:solid; border-color:rgb(221,221,221) rgb(221,221,221) transparent; color:rgb(0,136,204); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Scala</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_java" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_java_1" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Java</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_python" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_python_1" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Python</span></a></li></ul>
<div class="codetabs tab-content" style="padding:0px; margin:0px; list-style:none; border:0px; overflow:auto">
<div class="tab-pane active" id="tab_scala_1" style="padding:0px; margin:0px; list-style:none; border:0px">
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
Spark 程序必须做的第一件事情是创建一个 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/scala/index.html#org.apache.spark.SparkContext" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">SparkContext</a> 对象，它会告诉 Spark 如何访问集群。要创建一个 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>SparkContext</code>，首先需要构建一个包含应用程序的信息的 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/scala/index.html#org.apache.spark.SparkConf" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">SparkConf</a> 对象。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
每一个 JVM 可能只能激活一个 SparkContext 对象。在创新一个新的对象之前，必须调用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>stop()</code> 该方法停止活跃的 SparkContext。</p>
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code class="language-scala" style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; color:inherit; background:transparent'><span style="padding:0px; margin:0px; list-style:none; border:0px"></span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">val</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">conf</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">new</span> <span class="nc" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(14,132,181); font-weight:bold">SparkConf</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">().</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">setAppName</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">appName</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">).</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">setMaster</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">master</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span>
<span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">new</span> <span class="nc" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(14,132,181); font-weight:bold">SparkContext</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">conf</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span></code></pre>
</div>
</div>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
这个 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>appName</code> 参数是一个在集群 UI 上展示应用程序的名称。 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>master</code> 是一个 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/submitting-applications.html#master-urls" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Spark,
 Mesos 或 YARN 的 cluster URL</a>，或者指定为在 local mode（本地模式）中运行的 “local” 字符串。在实际工作中，当在集群上运行时，您不希望在程序中将 master 给硬编码，而是用 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/submitting-applications.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">使用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px'>spark-submit</code> 启动应用</a>并且接收它。然而，对于本地测试和单元测试，您可以通过
 “local” 来运行 Spark 进程。</p>
<h2 id="使用-shell" style="padding:0px; margin:12px 0px 10px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:24px">
使用 Shell<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E4%BD%BF%E7%94%A8-shell" rel="nofollow" style=""></a></h2>
<ul class="nav nav-tabs" style="padding:0px; margin:0px 0px 20px; list-style:none; border-width:0px 0px 1px; border-top-style:initial; border-right-style:initial; border-bottom-style:solid; border-left-style:initial; border-top-color:initial; border-right-color:initial; border-bottom-color:rgb(221,221,221); border-left-color:initial">
<li class="active" style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_scala" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_scala_2" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border-width:1px; border-style:solid; border-color:rgb(221,221,221) rgb(221,221,221) transparent; color:rgb(0,136,204); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Scala</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_python" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_python_2" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Python</span></a></li></ul>
<div class="codetabs tab-content" style="padding:0px; margin:0px; list-style:none; border:0px; overflow:auto">
<div class="tab-pane active" id="tab_scala_2" style="padding:0px; margin:0px; list-style:none; border:0px">
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
在 Spark Shell 中，一个特殊的 interpreter-aware（可用的解析器）SparkContext 已经为您创建好了，称之为 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>sc</code> 的变量。创建您自己的 SparkContext
 将不起作用。您可以使用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>--master</code> 参数设置这个 SparkContext 连接到哪一个 master 上，并且您可以通过 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>--jars</code> 参数传递一个逗号分隔的列表来添加
 JARs 到 classpath 中。也可以通过 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>--packages</code> 参数应用一个用逗号分隔的 maven coordinates（maven 坐标）方式来添加依赖（例如，Spark 包）到您的
 shell session 中去。任何额外存在且依赖的仓库（例如 Sonatype）可以传递到 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>--repositories</code> 参数。例如，要明确使用四个核（CPU）来运行 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>bin/spark-shell</code>，使用:</p>
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code class="language-bash" style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; color:inherit; background:transparent'><span style="padding:0px; margin:0px; list-style:none; border:0px"></span>$ ./bin/spark-shell --master local<span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">[</span><span class="m" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">4</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">]</span></code></pre>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
或者, 也可以添加 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>code.jar</code> 到它的 classpath 中去, 使用:</p>
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code class="language-bash" style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; color:inherit; background:transparent'><span style="padding:0px; margin:0px; list-style:none; border:0px"></span>$ ./bin/spark-shell --master local<span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">[</span><span class="m" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">4</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">]</span> --jars code.jar</code></pre>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
为了包含一个依赖，使用 Maven 坐标:</p>
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code class="language-bash" style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; color:inherit; background:transparent'><span style="padding:0px; margin:0px; list-style:none; border:0px"></span>$ ./bin/spark-shell --master local<span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">[</span><span class="m" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">4</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">]</span> --packages <span class="s2" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,112,160)">"org.example:example:0.1"</span></code></pre>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
有关选项的完整列表, 请运行 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>spark-shell --help</code>. 在幕后, <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>spark-shell</code> 调用了常用的 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/submitting-applications.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"><code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px'>spark-submit</code> 脚本</a>.</p>
</div>
</div>
<h1 id="弹性分布式数据集-rdds" style="padding:0px; margin:12px 0px 10px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:28px">
弹性分布式数据集 (RDDs)<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%BC%B9%E6%80%A7%E5%88%86%E5%B8%83%E5%BC%8F%E6%95%B0%E6%8D%AE%E9%9B%86-rdds" rel="nofollow" style=""></a></h1>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
Spark 主要以一个 <span style="padding:0px; margin:0px; list-style:none; border:0px">弹性分布式数据集</span>（RDD）的概念为中心，它是一个容错且可以执行并行操作的元素的集合。有两种方法可以创建 RDD : 在你的 driver program（驱动程序）中 <span style="padding:0px; margin:0px; list-style:none; border:0px">parallelizing</span> 一个已存在的集合，或者在外部存储系统中引用一个数据集，例如，一个共享文件系统，HDFS，HBase，或者提供
 Hadoop InputFormat 的任何数据源。</p>
<h2 id="并行集合" style="padding:0px; margin:12px 0px 10px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:24px">
并行集合<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%B9%B6%E8%A1%8C%E9%9B%86%E5%90%88" rel="nofollow" style=""></a></h2>
<ul class="nav nav-tabs" style="padding:0px; margin:0px 0px 20px; list-style:none; border-width:0px 0px 1px; border-top-style:initial; border-right-style:initial; border-bottom-style:solid; border-left-style:initial; border-top-color:initial; border-right-color:initial; border-bottom-color:rgb(221,221,221); border-left-color:initial">
<li class="active" style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_scala" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_scala_3" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border-width:1px; border-style:solid; border-color:rgb(221,221,221) rgb(221,221,221) transparent; color:rgb(0,136,204); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Scala</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_java" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_java_3" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Java</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_python" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_python_3" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Python</span></a></li></ul>
<div class="codetabs tab-content" style="padding:0px; margin:0px; list-style:none; border:0px; overflow:auto">
<div class="tab-pane active" id="tab_scala_3" style="padding:0px; margin:0px; list-style:none; border:0px">
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
可以在您的 driver program (a Scala <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>Seq</code>) 中已存在的集合上通过调用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>SparkContext</code> 的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>parallelize</code> 方法来创建并行集合。该集合的元素从一个可以并行操作的
 distributed dataset（分布式数据集）中复制到另一个 dataset（数据集）中去。例如，这里是一个如何去创建一个保存数字 1 ~ 5 的并行集合。</p>
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code class="language-scala" style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; color:inherit; background:transparent'><span style="padding:0px; margin:0px; list-style:none; border:0px"></span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">val</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">data</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="nc" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(14,132,181); font-weight:bold">Array</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">1</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">,</span> <span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">2</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">,</span> <span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">3</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">,</span> <span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">4</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">,</span> <span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">5</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span>
<span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">val</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">distData</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">sc</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">parallelize</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">data</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span></code></pre>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
在创建后，该 distributed dataset（分布式数据集）（<code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>distData</code>）可以并行的执行操作。例如，我们可以调用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>distData.reduce((a,
 b) =&gt; a + b</code>) 来合计数组中的元素。后面我们将介绍 distributed dataset（分布式数据集）上的操作。</p>
</div>
</div>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
并行集合中一个很重要参数是 <span style="padding:0px; margin:0px; list-style:none; border:0px">partitions</span>（分区）的数量，它可用来切割 dataset（数据集）。Spark 将在集群中的每一个分区上运行一个任务。通常您希望群集中的每一个 CPU 计算 2-4 个分区。一般情况下，Spark 会尝试根据您的群集情况来自动的设置的分区的数量。当然，您也可以将分区数作为第二个参数传递到 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>parallelize</code> (e.g. <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>sc.parallelize(data,
 10)</code>) 方法中来手动的设置它。注意: 代码中的一些地方会使用 term slices (a synonym for partitions) 以保持向后兼容.</p>
<h2 id="外部-datasets数据集" style="padding:0px; margin:12px 0px 10px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:24px">
外部 Datasets（数据集）<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%A4%96%E9%83%A8-datasets%E6%95%B0%E6%8D%AE%E9%9B%86" rel="nofollow" style=""></a></h2>
<ul class="nav nav-tabs" style="padding:0px; margin:0px 0px 20px; list-style:none; border-width:0px 0px 1px; border-top-style:initial; border-right-style:initial; border-bottom-style:solid; border-left-style:initial; border-top-color:initial; border-right-color:initial; border-bottom-color:rgb(221,221,221); border-left-color:initial">
<li class="active" style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_scala" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_scala_4" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border-width:1px; border-style:solid; border-color:rgb(221,221,221) rgb(221,221,221) transparent; color:rgb(0,136,204); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Scala</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_java" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_java_4" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Java</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_python" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_python_4" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Python</span></a></li></ul>
<div class="codetabs tab-content" style="padding:0px; margin:0px; list-style:none; border:0px; overflow:auto">
<div class="tab-pane active" id="tab_scala_4" style="padding:0px; margin:0px; list-style:none; border:0px">
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
Spark 可以从 Hadoop 所支持的任何存储源中创建 distributed dataset（分布式数据集），包括本地文件系统，HDFS，Cassandra，HBase，<a target="_blank" href="http://wiki.apache.org/hadoop/AmazonS3" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Amazon S3</a> 等等。 Spark
 支持文本文件，<a target="_blank" href="http://hadoop.apache.org/common/docs/current/api/org/apache/hadoop/mapred/SequenceFileInputFormat.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">SequenceFiles</a>，以及任何其它的 Hadoop <a target="_blank" href="http://hadoop.apache.org/docs/stable/api/org/apache/hadoop/mapred/InputFormat.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">InputFormat</a>。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
可以使用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>SparkContext</code> 的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>textFile</code> 方法来创建文本文件的
 RDD。此方法需要一个文件的 URI（计算机上的本地路径 ，<code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>hdfs://</code>，<code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>s3n://</code> 等等的
 URI），并且读取它们作为一个 lines（行）的集合。下面是一个调用示例:</p>
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code class="language-scala" style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; color:inherit; background:transparent'><span style="padding:0px; margin:0px; list-style:none; border:0px"></span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">scala</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">&gt;</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">val</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">distFile</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">sc</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">textFile</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="s" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,112,160)">"data.txt"</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span>
<span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">distFile</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">org.apache.spark.rdd.RDD</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">[</span><span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">String</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">]</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">data</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">txt</span> <span class="nc" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(14,132,181); font-weight:bold">MapPartitionsRDD</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">[</span><span class="err" style="padding:0px; margin:0px; list-style:none; border:0px">10</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">]</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">at</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">textFile</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">at</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">&lt;</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">console</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">&gt;:</span><span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">26</span></code></pre>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
在创建后，<code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>distFile</code> 可以使用 dataset（数据集）的操作。例如，我们可以使用下面的 map 和 reduce 操作来合计所有行的数量: <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>distFile.map(s
 =&gt; s.length).reduce((a, b) =&gt; a + b)</code>。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
使用 Spark 读取文件时需要注意:</p>
<ul style="padding:0px; margin:0px 0px 10px 25px; list-style:none; border:0px">
<li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
如果使用本地文件系统的路径，所工作节点的相同访问路径下该文件必须可以访问。复制文件到所有工作节点上，或着使用共享的网络挂载文件系统。</p>
</li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
所有 Spark 基于文件的 input 方法, 包括 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>textFile</code>, 支持在目录上运行, 压缩文件, 和通配符. 例如, 您可以使用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>textFile("/my/directory")</code>, <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>textFile("/my/directory/*.txt")</code>,
 and <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>textFile("/my/directory/*.gz")</code>.</p>
</li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
<code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>textFile</code> 方法也可以通过第二个可选的参数来控制该文件的分区数量. 默认情况下, Spark 为文件的每一个 block（块）创建的一 个 partition 分区（HDFS 中块大小默认是
 128MB），当然你也可以通过传递一个较大的值来要求一个较高的分区数量。请注意，分区的数量不能够小于块的数量。</p>
</li></ul>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
除了文本文件之外，Spark 的 Scala API 也支持一些其它的数据格式:</p>
<ul style="padding:0px; margin:0px 0px 10px 25px; list-style:none; border:0px">
<li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
<code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>SparkContext.wholeTextFiles</code> 可以读取包含多个小文本文件的目录, 并且将它们作为一个 (filename, content) pairs 来返回. 这与 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>textFile</code> 相比,
 它的每一个文件中的每一行将返回一个记录. 分区由数据量来确定, 某些情况下, 可能导致分区太少. 针对这些情况, <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>wholeTextFiles</code> 在第二个位置提供了一个可选的参数用户控制分区的最小数量.</p>
</li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
针对 <a target="_blank" href="http://hadoop.apache.org/common/docs/current/api/org/apache/hadoop/mapred/SequenceFileInputFormat.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">SequenceFiles</a>, 使用 SparkContext 的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>sequenceFile[K,
 V]</code> 方法，其中 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>K</code> 和 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>V</code> 指的是文件中
 key 和 values 的类型. 这些应该是 Hadoop 的 <a target="_blank" href="http://hadoop.apache.org/common/docs/current/api/org/apache/hadoop/io/Writable.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Writable</a> 接口的子类, 像 <a target="_blank" href="http://hadoop.apache.org/common/docs/current/api/org/apache/hadoop/io/IntWritable.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">IntWritable</a> and <a target="_blank" href="http://hadoop.apache.org/common/docs/current/api/org/apache/hadoop/io/Text.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Text</a>.
 此外, Spark 可以让您为一些常见的 Writables 指定原生类型; 例如, <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>sequenceFile[Int, String]</code>会自动读取 IntWritables 和 Texts.</p>
</li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
针对其它的 Hadoop InputFormats, 您可以使用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>SparkContext.hadoopRDD</code> 方法, 它接受一个任意的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>JobConf</code> 和
 input format class, key class 和 value class. 通过相同的方法你可以设置你的 input source（输入源）. 你还可以针对 InputFormats 使用基于 “new” MapReduce API (<code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>org.apache.hadoop.mapreduce</code>)
 的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>SparkContext.newAPIHadoopRDD</code>.</p>
</li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
<code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>RDD.saveAsObjectFile</code> 和 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>SparkContext.objectFile</code> 支持使用简单的序列化的
 Java objects 来保存 RDD. 虽然这不像 Avro 这种专用的格式一样高效，但其提供了一种更简单的方式来保存任何的 RDD。.</p>
</li></ul>
</div>
</div>
<h2 id="rdd-操作" style="padding:0px; margin:12px 0px 10px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:24px">
RDD 操作<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#rdd-%E6%93%8D%E4%BD%9C" rel="nofollow" style=""></a></h2>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
RDDs support 两种类型的操作: <span style="padding:0px; margin:0px; list-style:none; border:0px">transformations（转换）</span>, 它会在一个已存在的 dataset 上创建一个新的 dataset, 和 <span style="padding:0px; margin:0px; list-style:none; border:0px">actions（动作）</span>, 将在 dataset 上运行的计算后返回到
 driver 程序. 例如, <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>map</code> 是一个通过让每个数据集元素都执行一个函数，并返回的新 RDD 结果的 transformation, <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>reduce</code>reduce
 通过执行一些函数，聚合 RDD 中所有元素，并将最终结果给返回驱动程序（虽然也有一个并行 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>reduceByKey</code> 返回一个分布式数据集）的 action.</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
Spark 中所有的 transformations 都是 <span style="padding:0px; margin:0px; list-style:none; border:0px">lazy（懒加载的）</span>, 因此它不会立刻计算出结果. 相反, 他们只记得应用于一些基本数据集的转换 (例如. 文件). 只有当需要返回结果给驱动程序时，transformations 才开始计算. 这种设计使 Spark 的运行更高效. 例如, 我们可以了解到，<code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>map</code> 所创建的数据集将被用在 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>reduce</code> 中，并且只有 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>reduce</code> 的计算结果返回给驱动程序，而不是映射一个更大的数据集.</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
默认情况下，每次你在 RDD 运行一个 action 的时， 每个 transformed RDD 都会被重新计算。但是，您也可用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>persist</code> (或 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>cache</code>)
 方法将 RDD persist（持久化）到内存中；在这种情况下，Spark 为了下次查询时可以更快地访问，会把数据保存在集群上。此外，还支持持续持久化 RDDs 到磁盘，或复制到多个结点。</p>
<h3 id="基础" style="padding:0px; margin:10px 0px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:21px">
基础<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%9F%BA%E7%A1%80" rel="nofollow" style=""></a></h3>
<ul class="nav nav-tabs" style="padding:0px; margin:0px 0px 20px; list-style:none; border-width:0px 0px 1px; border-top-style:initial; border-right-style:initial; border-bottom-style:solid; border-left-style:initial; border-top-color:initial; border-right-color:initial; border-bottom-color:rgb(221,221,221); border-left-color:initial">
<li class="active" style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_scala" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_scala_5" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border-width:1px; border-style:solid; border-color:rgb(221,221,221) rgb(221,221,221) transparent; color:rgb(0,136,204); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Scala</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_java" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_java_5" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Java</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_python" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_python_5" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Python</span></a></li></ul>
<div class="codetabs tab-content" style="padding:0px; margin:0px; list-style:none; border:0px; overflow:auto">
<div class="tab-pane active" id="tab_scala_5" style="padding:0px; margin:0px; list-style:none; border:0px">
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
为了说明 RDD 基础，请思考下面这个的简单程序:</p>
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code class="language-scala" style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; color:inherit; background:transparent'><span style="padding:0px; margin:0px; list-style:none; border:0px"></span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">val</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">lines</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">sc</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">textFile</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="s" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,112,160)">"data.txt"</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span>
<span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">val</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">lineLengths</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">lines</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">map</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">s</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=&gt;</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">s</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">length</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span>
<span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">val</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">totalLength</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">lineLengths</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">reduce</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">((</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">a</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">,</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">b</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=&gt;</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">a</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">+</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">b</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span></code></pre>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
第一行从外部文件中定义了一个基本的 RDD，但这个数据集并未加载到内存中或即将被行动: <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>line</code> 仅仅是一个类似指针的东西，指向该文件. 第二行定义了 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>lineLengths</code> 作为 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>map</code> transformation
 的结果。请注意，由于 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>laziness</code>（延迟加载）<code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>lineLengths</code> 不会被立即计算.
 最后，我们运行 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>reduce</code>，这是一个 action。此时，Spark 分发计算任务到不同的机器上运行，每台机器都运行在 map 的一部分并本地运行 reduce，仅仅返回它聚合后的结果给驱动程序.</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
如果我们也希望以后再次使用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>lineLengths</code>，我们还可以添加:</p>
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code class="language-scala" style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; color:inherit; background:transparent'><span style="padding:0px; margin:0px; list-style:none; border:0px"></span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">lineLengths</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">persist</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">()</span></code></pre>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
在 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>reduce</code> 之前，这将导致 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>lineLengths</code> 在第一次计算之后就被保存在
 memory 中。</p>
</div>
</div>
<h3 id="传递-functions函数给-spark" style="padding:0px; margin:10px 0px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:21px">
传递 Functions（函数）给 Spark<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E4%BC%A0%E9%80%92-functions%E5%87%BD%E6%95%B0%E7%BB%99-spark" rel="nofollow" style=""></a></h3>
<ul class="nav nav-tabs" style="padding:0px; margin:0px 0px 20px; list-style:none; border-width:0px 0px 1px; border-top-style:initial; border-right-style:initial; border-bottom-style:solid; border-left-style:initial; border-top-color:initial; border-right-color:initial; border-bottom-color:rgb(221,221,221); border-left-color:initial">
<li class="active" style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_scala" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_scala_6" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border-width:1px; border-style:solid; border-color:rgb(221,221,221) rgb(221,221,221) transparent; color:rgb(0,136,204); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Scala</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_java" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_java_6" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Java</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_python" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_python_6" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Python</span></a></li></ul>
<div class="codetabs tab-content" style="padding:0px; margin:0px; list-style:none; border:0px; overflow:auto">
<div class="tab-pane active" id="tab_scala_6" style="padding:0px; margin:0px; list-style:none; border:0px">
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
当 driver 程序在集群上运行时，Spark 的 API 在很大程度上依赖于传递函数。有 2 种推荐的方式来做到这一点:</p>
<ul style="padding:0px; margin:0px 0px 10px 25px; list-style:none; border:0px">
<li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<a target="_blank" href="http://docs.scala-lang.org/tutorials/tour/anonymous-function-syntax.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Anonymous function syntax（匿名函数语法）</a>, 它可以用于短的代码片断.</li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
在全局单例对象中的静态方法. 例如, 您可以定义 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>object MyFunctions</code> 然后传递 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>MyFunctions.func1</code>,
 如下:</li></ul>
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code class="language-scala" style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; color:inherit; background:transparent'><span style="padding:0px; margin:0px; list-style:none; border:0px"></span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">object</span> <span class="nc" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(14,132,181); font-weight:bold">MyFunctions</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">{</span>
  <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">def</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">func1</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">s</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">String</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">String</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">=</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">{</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">...</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">}</span>
<span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">}</span>

<span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">myRdd</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">map</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="nc" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(14,132,181); font-weight:bold">MyFunctions</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">func1</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span></code></pre>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
请注意，虽然也有可能传递一个类的实例（与单例对象相反）的方法的引用，这需要发送整个对象，包括类中其它方法。例如，考虑:</p>
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code class="language-scala" style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; color:inherit; background:transparent'><span style="padding:0px; margin:0px; list-style:none; border:0px"></span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">class</span> <span class="nc" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(14,132,181); font-weight:bold">MyClass</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">{</span>
  <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">def</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">func1</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">s</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">String</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">String</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">=</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">{</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">...</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">}</span>
  <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">def</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">doStuff</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">rdd</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">RDD</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">[</span><span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">String</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">])</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">RDD</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">[</span><span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">String</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">]</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">{</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">rdd</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">map</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">func1</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">}</span>
<span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">}</span></code></pre>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
这里，如果我们创建一个 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>MyClass</code> 的实例，并调用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>doStuff</code>，在 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>map</code> 内有 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>MyClass</code> 实例的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>func1</code> 方法的引用，所以整个对象需要被发送到集群的。它类似于 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>rdd.map(x
 =&gt; this.func1(x))</code></p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
类似的方式，访问外部对象的字段将引用整个对象:</p>
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code class="language-scala" style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; color:inherit; background:transparent'><span style="padding:0px; margin:0px; list-style:none; border:0px"></span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">class</span> <span class="nc" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(14,132,181); font-weight:bold">MyClass</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">{</span>
  <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">val</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">field</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="s" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,112,160)">"Hello"</span>
  <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">def</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">doStuff</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">rdd</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">RDD</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">[</span><span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">String</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">])</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">RDD</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">[</span><span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">String</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">]</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">{</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">rdd</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">map</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">x</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=&gt;</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">field</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">+</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">x</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">}</span>
<span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">}</span></code></pre>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
相当于写 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>rdd.map(x =&gt; this.field + x)</code>, 它引用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>this</code> 所有的东西.
 为了避免这个问题, 最简单的方式是复制 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>field</code> 到一个本地变量，而不是外部访问它:</p>
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code class="language-scala" style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; color:inherit; background:transparent'><span style="padding:0px; margin:0px; list-style:none; border:0px"></span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">def</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">doStuff</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">rdd</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">RDD</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">[</span><span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">String</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">])</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">RDD</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">[</span><span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">String</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">]</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">{</span>
  <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">val</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">field_</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">this</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">field</span>
  <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">rdd</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">map</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">x</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=&gt;</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">field_</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">+</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">x</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span>
<span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">}</span></code></pre>
</div>
</div>
<h3 id="理解闭包-" style="padding:0px; margin:10px 0px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:21px">
理解闭包 <a target="_blank" name="ClosuresLink" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"></a><a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E7%90%86%E8%A7%A3%E9%97%AD%E5%8C%85-" rel="nofollow" style=""></a></h3>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
在集群中执行代码时，一个关于 Spark 更难的事情是理解变量和方法的范围和生命周期. 修改其范围之外的变量 RDD 操作可以混淆的常见原因。在下面的例子中，我们将看一下使用的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>foreach()</code> 代码递增累加计数器，但类似的问题，也可能会出现其他操作上.</p>
<h4 id="示例" style="padding:0px; margin:10px 0px; list-style:none; border:0px; font-family:inherit; line-height:20px; color:inherit; font-size:18px">
示例<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E7%A4%BA%E4%BE%8B" rel="nofollow" style=""></a></h4>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
考虑一个简单的 RDD 元素求和，以下行为可能不同，具体取决于是否在同一个 JVM 中执行. 一个常见的例子是当 Spark 运行在 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>local</code> 本地模式（<code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>--master
 = local[n]</code>）时，与部署 Spark 应用到群集（例如，通过 spark-submit 到 YARN）:</p>
<ul class="nav nav-tabs" style="padding:0px; margin:0px 0px 20px; list-style:none; border-width:0px 0px 1px; border-top-style:initial; border-right-style:initial; border-bottom-style:solid; border-left-style:initial; border-top-color:initial; border-right-color:initial; border-bottom-color:rgb(221,221,221); border-left-color:initial">
<li class="active" style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_scala" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_scala_7" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border-width:1px; border-style:solid; border-color:rgb(221,221,221) rgb(221,221,221) transparent; color:rgb(0,136,204); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Scala</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_java" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_java_7" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Java</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_python" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_python_7" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Python</span></a></li></ul>
<div class="codetabs tab-content" style="padding:0px; margin:0px; list-style:none; border:0px; overflow:auto">
<div class="tab-pane active" id="tab_scala_7" style="padding:0px; margin:0px; list-style:none; border:0px">
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code class="language-scala" style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; color:inherit; background:transparent'><span style="padding:0px; margin:0px; list-style:none; border:0px"></span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">var</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">counter</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">0</span>
<span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">var</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">rdd</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">sc</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">parallelize</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">data</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span>

<span class="c1" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(96,160,176); font-style:italic">// Wrong: Don't do this!!</span>
<span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">rdd</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">foreach</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">x</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=&gt;</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">counter</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">+=</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">x</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span>

<span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">println</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="s" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,112,160)">"Counter value: "</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">+</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">counter</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span></code></pre>
</div>
</div>
<h4 id="local本地vs-cluster集群模式" style="padding:0px; margin:10px 0px; list-style:none; border:0px; font-family:inherit; line-height:20px; color:inherit; font-size:18px">
Local（本地）vs. cluster（集群）模式<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#local%E6%9C%AC%E5%9C%B0vs-cluster%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F" rel="nofollow" style=""></a></h4>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
上面的代码行为是不确定的，并且可能无法按预期正常工作。执行作业时，Spark 会分解 RDD 操作到每个 executor 中的 task 里。在执行之前，Spark 计算任务的 <span style="padding:0px; margin:0px; list-style:none; border:0px">closure</span>（闭包）。而闭包是在 RDD 上的 executor 必须能够访问的变量和方法（在此情况下的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>foreach()</code>）。闭包被序列化并被发送到每个执行器。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
闭包的变量副本发给每个 <span style="padding:0px; margin:0px; list-style:none; border:0px">counter</span> ，当 <span style="padding:0px; margin:0px; list-style:none; border:0px">counter</span> 被 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>foreach</code> 函数引用的时候，它已经不再是
 driver node 的 <span style="padding:0px; margin:0px; list-style:none; border:0px">counter</span> 了。虽然在 driver node 仍然有一个 counter 在内存中，但是对 executors 已经不可见。executor 看到的只是序列化的闭包一个副本。所以 <span style="padding:0px; margin:0px; list-style:none; border:0px">counter</span> 最终的值还是
 0，因为对 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>counter</code> 所有的操作均引用序列化的 closure 内的值。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
在 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>local</code> 本地模式，在某些情况下的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>foreach</code> 功能实际上是同一
 JVM 上的驱动程序中执行，并会引用同一个原始的 <span style="padding:0px; margin:0px; list-style:none; border:0px">counter</span> 计数器，实际上可能更新.</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
为了确保这些类型的场景明确的行为应该使用的 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#accumulators" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"><code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px'>Accumulator</code></a> 累加器。当一个执行的任务分配到集群中的各个
 worker 结点时，Spark 的累加器是专门提供安全更新变量的机制。本指南的累加器的部分会更详细地讨论这些。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
在一般情况下，closures - constructs 像循环或本地定义的方法，不应该被用于改动一些全局状态。Spark 没有规定或保证突变的行为，以从封闭件的外侧引用的对象。一些代码，这可能以本地模式运行，但是这只是偶然和这样的代码如预期在分布式模式下不会表现。如果需要一些全局的聚合功能，应使用 Accumulator（累加器）。</p>
<h4 id="打印-rdd-的-elements" style="padding:0px; margin:10px 0px; list-style:none; border:0px; font-family:inherit; line-height:20px; color:inherit; font-size:18px">
打印 RDD 的 elements<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E6%89%93%E5%8D%B0-rdd-%E7%9A%84-elements" rel="nofollow" style=""></a></h4>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
另一种常见的语法用于打印 RDD 的所有元素使用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>rdd.foreach(println)</code> 或 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>rdd.map(println)</code>。在一台机器上，这将产生预期的输出和打印
 RDD 的所有元素。然而，在集群 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>cluster</code> 模式下，<code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>stdout</code> 输出正在被执行写操作
 executors 的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>stdout</code> 代替，而不是在一个驱动程序上，因此 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>stdout</code> 的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>driver</code> 程序不会显示这些！要打印 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>driver</code> 程序的所有元素，可以使用的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>collect()</code> 方法首先把
 RDD 放到 driver 程序节点上: <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>rdd.collect().foreach(println)</code>。这可能会导致 driver 程序耗尽内存，虽说，因为 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>collect()</code> 获取整个
 RDD 到一台机器; 如果你只需要打印 RDD 的几个元素，一个更安全的方法是使用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>take()</code>: <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>rdd.take(100).foreach(println)</code>。</p>
<h3 id="与--key-value-pairs-一起使用" style="padding:0px; margin:10px 0px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:21px">
与 Key-Value Pairs 一起使用<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E4%B8%8E--key-value-pairs-%E4%B8%80%E8%B5%B7%E4%BD%BF%E7%94%A8" rel="nofollow" style=""></a></h3>
<ul class="nav nav-tabs" style="padding:0px; margin:0px 0px 20px; list-style:none; border-width:0px 0px 1px; border-top-style:initial; border-right-style:initial; border-bottom-style:solid; border-left-style:initial; border-top-color:initial; border-right-color:initial; border-bottom-color:rgb(221,221,221); border-left-color:initial">
<li class="active" style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_scala" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_scala_8" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border-width:1px; border-style:solid; border-color:rgb(221,221,221) rgb(221,221,221) transparent; color:rgb(0,136,204); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Scala</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_java" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_java_8" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Java</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_python" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_python_8" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Python</span></a></li></ul>
<div class="codetabs tab-content" style="padding:0px; margin:0px; list-style:none; border:0px; overflow:auto">
<div class="tab-pane active" id="tab_scala_8" style="padding:0px; margin:0px; list-style:none; border:0px">
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
虽然大多数 Spark 操作工作在包含任何类型对象的 RDDs 上，只有少数特殊的操作可用于 Key-Value 对的 RDDs. 最常见的是分布式 “shuffle” 操作，如通过元素的 key 来进行 grouping 或 aggregating 操作.</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
在 Scala 中，这些操作在 RDD 上是自动可用，它包含了 <a target="_blank" href="http://www.scala-lang.org/api/2.11.8/index.html#scala.Tuple2" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Tuple2</a> objects (the built-in tuples in the language,
 created by simply writing <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>(a, b)</code>). 在 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/scala/index.html#org.apache.spark.rdd.PairRDDFunctions" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">PairRDDFunctions</a> class
 中该 key-value pair 操作是可用的, 其中围绕 tuple 的 RDD 进行自动封装.</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
例如，下面的代码使用的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>Key-Value</code> 对的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>reduceByKey</code> 操作统计文本文件中每一行出现了多少次:</p>
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code class="language-scala" style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; color:inherit; background:transparent'><span style="padding:0px; margin:0px; list-style:none; border:0px"></span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">val</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">lines</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">sc</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">textFile</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="s" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,112,160)">"data.txt"</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span>
<span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">val</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">pairs</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">lines</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">map</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">s</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=&gt;</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">s</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">,</span> <span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">1</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">))</span>
<span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">val</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">counts</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">pairs</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">reduceByKey</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">((</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">a</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">,</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">b</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=&gt;</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">a</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">+</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">b</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span></code></pre>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
我们也可以使用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>counts.sortByKey()</code> ，例如，在对按字母顺序排序，最后 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>counts.collect()</code> 把他们作为一个数据对象返回给
 driver 程序。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
<span style="padding:0px; margin:0px; list-style:none; border:0px">Note（注意）:</span> 当在 key-value pair 操作中使用自定义的 objects 作为 key 时, 您必须确保有一个自定义的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>equals()</code> 方法有一个 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>hashCode()</code> 方法相匹配.
 有关详情, 请参阅 <a target="_blank" href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html#hashCode()" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Object.hashCode() documentation</a> 中列出的约定.</p>
</div>
</div>
<h3 id="transformations转换" style="padding:0px; margin:10px 0px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:21px">
Transformations（转换）<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#transformations%E8%BD%AC%E6%8D%A2" rel="nofollow" style=""></a></h3>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
下表列出了一些 Spark 常用的 transformations（转换）. 详情请参考 RDD API 文档 (<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/scala/index.html#org.apache.spark.rdd.RDD" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Scala</a>, <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/java/index.html?org/apache/spark/api/java/JavaRDD.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Java</a>, <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/python/pyspark.html#pyspark.RDD" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Python</a>, <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/R/index.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">R</a>)
 和 pair RDD 函数文档 (<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/scala/index.html#org.apache.spark.rdd.PairRDDFunctions" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Scala</a>, <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/java/index.html?org/apache/spark/api/java/JavaPairRDD.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Java</a>).</p>
<table class="table " style="padding:0px; margin:0px 0px 20px; list-style:none; border:0px; max-width:100%; background-color:transparent; border-collapse:collapse; border-spacing:0px; width:914px">
<tbody style="padding:0px; margin:0px; list-style:none; border:0px">
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<th style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; text-align:left; vertical-align:top; width:301px">
Transformation（转换）</th>
<th style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; text-align:left; vertical-align:top">
Meaning（含义）</th>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">map</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">func</span>)</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
返回一个新的 distributed dataset（分布式数据集），它由每个 source（数据源）中的元素应用一个函数 <span style="padding:0px; margin:0px; list-style:none; border:0px">func</span> 来生成.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">filter</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">func</span>)</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
返回一个新的 distributed dataset（分布式数据集），它由每个 source（数据源）中应用一个函数 <span style="padding:0px; margin:0px; list-style:none; border:0px">func</span> 且返回值为 true 的元素来生成.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">flatMap</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">func</span>)</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
与 map 类似，但是每一个输入的 item 可以被映射成 0 个或多个输出的 items（所以 <span style="padding:0px; margin:0px; list-style:none; border:0px">func</span> 应该返回一个 Seq 而不是一个单独的 item）.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">mapPartitions</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">func</span>)<a target="_blank" name="MapPartLink" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"></a></td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
与 map 类似，但是单独的运行在在每个 RDD 的 partition（分区，block）上，所以在一个类型为 T 的 RDD 上运行时 <span style="padding:0px; margin:0px; list-style:none; border:0px">func</span> 必须是 Iterator&lt;T&gt; =&gt; Iterator&lt;U&gt; 类型.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">mapPartitionsWithIndex</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">func</span>)</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
与 mapPartitions 类似，但是也需要提供一个代表 partition 的 index（索引）的 interger value（整型值）作为参数的 <span style="padding:0px; margin:0px; list-style:none; border:0px">func</span>，所以在一个类型为 T 的 RDD 上运行时 <span style="padding:0px; margin:0px; list-style:none; border:0px">func</span> 必须是
 (Int, Iterator&lt;T&gt;) =&gt; Iterator&lt;U&gt; 类型.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">sample</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">withReplacement</span>, <span style="padding:0px; margin:0px; list-style:none; border:0px">fraction</span>, <span style="padding:0px; margin:0px; list-style:none; border:0px">seed</span>)</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
样本数据，设置是否放回（withReplacement）, 采样的百分比（<span style="padding:0px; margin:0px; list-style:none; border:0px">fraction</span>）、使用指定的随机数生成器的种子（seed）.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">union</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">otherDataset</span>)</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
反回一个新的 dataset，它包含了 source dataset（源数据集）和 otherDataset（其它数据集）的并集.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">intersection</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">otherDataset</span>)</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
返回一个新的 RDD，它包含了 source dataset（源数据集）和 otherDataset（其它数据集）的交集.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">distinct</span>([<span style="padding:0px; margin:0px; list-style:none; border:0px">numTasks</span>]))</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
返回一个新的 dataset，它包含了 source dataset（源数据集）中去重的元素.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">groupByKey</span>([<span style="padding:0px; margin:0px; list-style:none; border:0px">numTasks</span>])<a target="_blank" name="GroupByLink" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"></a></td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
在一个 (K, V) pair 的 dataset 上调用时，返回一个 (K, Iterable&lt;V&gt;) . <br style="padding:0px; margin:0px; list-style:none; border:0px">
<span style="padding:0px; margin:0px; list-style:none; border:0px">Note:</span> 如果分组是为了在每一个 key 上执行聚合操作（例如，sum 或 average)，此时使用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; color:rgb(68,68,68)'>reduceByKey</code> 或 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; color:rgb(68,68,68)'>aggregateByKey</code> 来计算性能会更好. <br style="padding:0px; margin:0px; list-style:none; border:0px">
<span style="padding:0px; margin:0px; list-style:none; border:0px">Note:</span> 默认情况下，并行度取决于父 RDD 的分区数。可以传递一个可选的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; color:rgb(68,68,68)'>numTasks</code> 参数来设置不同的任务数.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">reduceByKey</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">func</span>, [<span style="padding:0px; margin:0px; list-style:none; border:0px">numTasks</span>])<a target="_blank" name="ReduceByLink" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"></a></td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
在 (K, V) pairs 的 dataset 上调用时, 返回 dataset of (K, V) pairs 的 dataset, 其中的 values 是针对每个 key 使用给定的函数 <span style="padding:0px; margin:0px; list-style:none; border:0px">func</span> 来进行聚合的, 它必须是 type (V,V) =&gt; V 的类型. 像 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; color:rgb(68,68,68)'>groupByKey</code> 一样,
 reduce tasks 的数量是可以通过第二个可选的参数来配置的.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">aggregateByKey</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">zeroValue</span>)(<span style="padding:0px; margin:0px; list-style:none; border:0px">seqOp</span>, <span style="padding:0px; margin:0px; list-style:none; border:0px">combOp</span>,
 [<span style="padding:0px; margin:0px; list-style:none; border:0px">numTasks</span>])<a target="_blank" name="AggregateByLink" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"></a></td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
在 (K, V) pairs 的 dataset 上调用时, 返回 (K, U) pairs 的 dataset，其中的 values 是针对每个 key 使用给定的 combine 函数以及一个 neutral "0" 值来进行聚合的. 允许聚合值的类型与输入值的类型不一样, 同时避免不必要的配置. 像 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; color:rgb(68,68,68)'>groupByKey</code> 一样,
 reduce tasks 的数量是可以通过第二个可选的参数来配置的.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">sortByKey</span>([<span style="padding:0px; margin:0px; list-style:none; border:0px">ascending</span>], [<span style="padding:0px; margin:0px; list-style:none; border:0px">numTasks</span>])<a target="_blank" name="SortByLink" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"></a></td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
在一个 (K, V) pair 的 dataset 上调用时，其中的 K 实现了 Ordered，返回一个按 keys 升序或降序的 (K, V) pairs 的 dataset, 由 boolean 类型的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; color:rgb(68,68,68)'>ascending</code> 参数来指定.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">join</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">otherDataset</span>, [<span style="padding:0px; margin:0px; list-style:none; border:0px">numTasks</span>])<a target="_blank" name="JoinLink" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"></a></td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
在一个 (K, V) 和 (K, W) 类型的 dataset 上调用时，返回一个 (K, (V, W)) pairs 的 dataset，它拥有每个 key 中所有的元素对。Outer joins 可以通过 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; color:rgb(68,68,68)'>leftOuterJoin</code>, <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; color:rgb(68,68,68)'>rightOuterJoin</code> 和 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; color:rgb(68,68,68)'>fullOuterJoin</code> 来实现.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">cogroup</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">otherDataset</span>, [<span style="padding:0px; margin:0px; list-style:none; border:0px">numTasks</span>])<a target="_blank" name="CogroupLink" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"></a></td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
在一个 (K, V) 和的 dataset 上调用时，返回一个 (K, (Iterable&lt;V&gt;, Iterable&lt;W&gt;)) tuples 的 dataset. 这个操作也调用了 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; color:rgb(68,68,68)'>groupWith</code>.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">cartesian</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">otherDataset</span>)</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
在一个 T 和 U 类型的 dataset 上调用时，返回一个 (T, U) pairs 类型的 dataset（所有元素的 pairs，即笛卡尔积）.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">pipe</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">command</span>, <span style="padding:0px; margin:0px; list-style:none; border:0px">[envVars]</span>)</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
通过使用 shell 命令来将每个 RDD 的分区给 Pipe。例如，一个 Perl 或 bash 脚本。RDD 的元素会被写入进程的标准输入（stdin），并且 lines（行）输出到它的标准输出（stdout）被作为一个字符串型 RDD 的 string 返回.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">coalesce</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">numPartitions</span>)<a target="_blank" name="CoalesceLink" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"></a></td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
Decrease（降低）RDD 中 partitions（分区）的数量为 numPartitions。对于执行过滤后一个大的 dataset 操作是更有效的.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">repartition</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">numPartitions</span>)</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
Reshuffle（重新洗牌）RDD 中的数据以创建或者更多的 partitions（分区）并将每个分区中的数据尽量保持均匀. 该操作总是通过网络来 shuffles 所有的数据.<a target="_blank" name="RepartitionLink" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"></a></td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">repartitionAndSortWithinPartitions</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">partitioner</span>)<a target="_blank" name="Repartition2Link" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"></a></td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
根据给定的 partitioner（分区器）对 RDD 进行重新分区，并在每个结果分区中，按照 key 值对记录排序。这比每一个分区中先调用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; color:rgb(68,68,68)'>repartition</code> 然后再 sorting（排序）效率更高，因为它可以将排序过程推送到
 shuffle 操作的机器上进行.</td>
</tr>
</tbody>
</table>
<h3 id="actions动作" style="padding:0px; margin:10px 0px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:21px">
Actions（动作）<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#actions%E5%8A%A8%E4%BD%9C" rel="nofollow" style=""></a></h3>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
下表列出了一些 Spark 常用的 actions 操作。详细请参考 RDD API 文档 (<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/scala/index.html#org.apache.spark.rdd.RDD" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Scala</a>, <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/java/index.html?org/apache/spark/api/java/JavaRDD.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Java</a>, <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/python/pyspark.html#pyspark.RDD" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Python</a>, <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/R/index.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">R</a>)</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
和 pair RDD 函数文档 (<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/scala/index.html#org.apache.spark.rdd.PairRDDFunctions" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Scala</a>, <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/java/index.html?org/apache/spark/api/java/JavaPairRDD.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Java</a>).</p>
<table class="table " style="padding:0px; margin:0px 0px 20px; list-style:none; border:0px; max-width:100%; background-color:transparent; border-collapse:collapse; border-spacing:0px; width:914px">
<tbody style="padding:0px; margin:0px; list-style:none; border:0px">
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<th style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; text-align:left; vertical-align:top">
Action（动作）</th>
<th style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; text-align:left; vertical-align:top">
Meaning（含义）</th>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">reduce</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">func</span>)</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
使用函数 <span style="padding:0px; margin:0px; list-style:none; border:0px">func</span> 聚合 dataset 中的元素，这个函数 <span style="padding:0px; margin:0px; list-style:none; border:0px">func</span> 输入为两个元素，返回为一个元素。这个函数应该是可交换（commutative ）和关联（associative）的，这样才能保证它可以被并行地正确计算.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">collect</span>()</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
在 driver 程序中，以一个 array 数组的形式返回 dataset 的所有元素。这在过滤器（filter）或其他操作（other operation）之后返回足够小（sufficiently small）的数据子集通常是有用的.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">count</span>()</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
返回 dataset 中元素的个数.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">first</span>()</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
返回 dataset 中的第一个元素（类似于 take(1).</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">take</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">n</span>)</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
将数据集中的前 <span style="padding:0px; margin:0px; list-style:none; border:0px">n</span> 个元素作为一个 array 数组返回.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">takeSample</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">withReplacement</span>, <span style="padding:0px; margin:0px; list-style:none; border:0px">num</span>, [<span style="padding:0px; margin:0px; list-style:none; border:0px">seed</span>])</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
对一个 dataset 进行随机抽样，返回一个包含 <span style="padding:0px; margin:0px; list-style:none; border:0px">num</span> 个随机抽样（random sample）元素的数组，参数 withReplacement 指定是否有放回抽样，参数 seed 指定生成随机数的种子.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">takeOrdered</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">n</span>, <span style="padding:0px; margin:0px; list-style:none; border:0px">[ordering]</span>)</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
返回 RDD 按自然顺序（natural order）或自定义比较器（custom comparator）排序后的前 <span style="padding:0px; margin:0px; list-style:none; border:0px">n</span> 个元素.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">saveAsTextFile</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">path</span>)</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
将 dataset 中的元素以文本文件（或文本文件集合）的形式写入本地文件系统、HDFS 或其它 Hadoop 支持的文件系统中的给定目录中。Spark 将对每个元素调用 toString 方法，将数据元素转换为文本文件中的一行记录.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">saveAsSequenceFile</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">path</span>) <br style="padding:0px; margin:0px; list-style:none; border:0px">
(Java and Scala)</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
将 dataset 中的元素以 Hadoop SequenceFile 的形式写入到本地文件系统、HDFS 或其它 Hadoop 支持的文件系统指定的路径中。该操作可以在实现了 Hadoop 的 Writable 接口的键值对（key-value pairs）的 RDD 上使用。在 Scala 中，它还可以隐式转换为 Writable 的类型（Spark 包括了基本类型的转换，例如 Int, Double, String 等等).</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">saveAsObjectFile</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">path</span>) <br style="padding:0px; margin:0px; list-style:none; border:0px">
(Java and Scala)</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
使用 Java 序列化（serialization）以简单的格式（simple format）编写数据集的元素，然后使用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; color:rgb(68,68,68)'>SparkContext.objectFile()</code> 进行加载.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">countByKey</span>()<a target="_blank" name="CountByLink" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"></a></td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
仅适用于（K,V）类型的 RDD 。返回具有每个 key 的计数的 （K , Int）pairs 的 hashmap.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
<span style="padding:0px; margin:0px; list-style:none; border:0px">foreach</span>(<span style="padding:0px; margin:0px; list-style:none; border:0px">func</span>)</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
对 dataset 中每个元素运行函数 <span style="padding:0px; margin:0px; list-style:none; border:0px">func</span> 。这通常用于副作用（side effects），例如更新一个 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#accumulators" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Accumulator</a>（累加器）或与外部存储系统（external
 storage systems）进行交互。<span style="padding:0px; margin:0px; list-style:none; border:0px">Note</span>：修改除 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; color:rgb(68,68,68)'>foreach()</code>之外的累加器以外的变量（variables）可能会导致未定义的行为（undefined
 behavior）。详细介绍请阅读 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#understanding-closures-a-nameclosureslinka" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Understanding closures（理解闭包）</a> 部分.</td>
</tr>
</tbody>
</table>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
该 Spark RDD API 还暴露了一些 actions（操作）的异步版本，例如针对 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>foreach</code> 的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>foreachAsync</code>，它们会立即返回一个<code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>FutureAction</code> 到调用者，而不是在完成
 action 时阻塞。 这可以用于管理或等待 action 的异步执行。.</p>
<h3 id="shuffle-操作" style="padding:0px; margin:10px 0px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:21px">
Shuffle 操作<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#shuffle-%E6%93%8D%E4%BD%9C" rel="nofollow" style=""></a></h3>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
Spark 里的某些操作会触发 shuffle。shuffle 是spark 重新分配数据的一种机制，使得这些数据可以跨不同的区域进行分组。这通常涉及在 executors 和 机器之间拷贝数据，这使得 shuffle 成为一个复杂的、代价高的操作。</p>
<h4 id="background幕后" style="padding:0px; margin:10px 0px; list-style:none; border:0px; font-family:inherit; line-height:20px; color:inherit; font-size:18px">
Background（幕后）<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#background%E5%B9%95%E5%90%8E" rel="nofollow" style=""></a></h4>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
为了明白 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#ReduceByLink" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"><code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px'>reduceByKey</code></a> 操作的过程，我们以 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>reduceByKey</code> 为例。reduceBykey
 操作产生一个新的 RDD，其中 key 所有相同的的值组合成为一个 tuple - key 以及与 key 相关联的所有值在 reduce 函数上的执行结果。面临的挑战是，一个 key 的所有值不一定都在一个同一个 paritition 分区里，甚至是不一定在同一台机器里，但是它们必须共同被计算。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
在 spark 里，特定的操作需要数据不跨分区分布。在计算期间，一个任务在一个分区上执行，为了所有数据都在单个 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>reduceByKey</code> 的 reduce 任务上运行，我们需要执行一个 all-to-all
 操作。它必须从所有分区读取所有的 key 和 key对应的所有的值，并且跨分区聚集去计算每个 key 的结果 - 这个过程就叫做 <span style="padding:0px; margin:0px; list-style:none; border:0px">shuffle</span>.。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
Although the set of elements in each partition of newly shuffled data will be deterministic, and so is the ordering of partitions themselves, the ordering of these elements is not. If one desires predictably ordered data following shuffle then it’s possible
 to use:</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
尽管每个分区新 shuffle 的数据集将是确定的，分区本身的顺序也是这样，但是这些数据的顺序是不确定的。如果希望 shuffle 后的数据是有序的，可以使用:</p>
<ul style="padding:0px; margin:0px 0px 10px 25px; list-style:none; border:0px">
<li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>mapPartitions</code> 对每个 partition 分区进行排序，例如, <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>.sorted</code></li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>repartitionAndSortWithinPartitions</code> 在分区的同时对分区进行高效的排序.</li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>sortBy</code> 对 RDD 进行全局的排序</li></ul>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
触发的 shuffle 操作包括 <span style="padding:0px; margin:0px; list-style:none; border:0px">repartition</span> 操作，如 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#RepartitionLink" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"><code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px'>repartition</code></a> 和 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#CoalesceLink" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"><code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px'>coalesce</code></a>, <span style="padding:0px; margin:0px; list-style:none; border:0px">‘ByKey</span> 操作
 (除了 counting 之外) 像 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#GroupByLink" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"><code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px'>groupByKey</code></a> 和 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#ReduceByLink" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"><code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px'>reduceByKey</code></a>,
 和 <span style="padding:0px; margin:0px; list-style:none; border:0px">join</span>操作, 像 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#CogroupLink" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"><code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px'>cogroup</code></a> 和 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#JoinLink" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"><code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px'>join</code></a>.</p>
<h4 id="性能影响" style="padding:0px; margin:10px 0px; list-style:none; border:0px; font-family:inherit; line-height:20px; color:inherit; font-size:18px">
性能影响<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E6%80%A7%E8%83%BD%E5%BD%B1%E5%93%8D" rel="nofollow" style=""></a></h4>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
该 <span style="padding:0px; margin:0px; list-style:none; border:0px">Shuffle</span> 是一个代价比较高的操作，它涉及磁盘 I/O、数据序列化、网络 I/O。为了准备 shuffle 操作的数据，Spark 启动了一系列的任务，<span style="padding:0px; margin:0px; list-style:none; border:0px">map</span> 任务组织数据，<span style="padding:0px; margin:0px; list-style:none; border:0px">reduce</span> 完成数据的聚合。这些术语来自
 MapReduce，跟 Spark 的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>map</code> 操作和 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>reduce</code> 操作没有关系。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
在内部，一个 map 任务的所有结果数据会保存在内存，直到内存不能全部存储为止。然后，这些数据将基于目标分区进行排序并写入一个单独的文件中。在 reduce 时，任务将读取相关的已排序的数据块。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
某些 shuffle 操作会大量消耗堆内存空间，因为 shuffle 操作在数据转换前后，需要在使用内存中的数据结构对数据进行组织。需要特别说明的是，<code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>reduceByKey</code> 和 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>aggregateByKey</code> 在
 map 时会创建这些数据结构，<code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>'ByKey</code> 操作在 reduce 时创建这些数据结构。当内存满的时候，Spark 会把溢出的数据存到磁盘上，这将导致额外的磁盘 I/O 开销和垃圾回收开销的增加。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
shuffle 操作还会在磁盘上生成大量的中间文件。在 Spark 1.3 中，这些文件将会保留至对应的 RDD 不在使用并被垃圾回收为止。这么做的好处是，如果在 Spark 重新计算 RDD 的血统关系（lineage）时，shuffle 操作产生的这些中间文件不需要重新创建。如果 Spark 应用长期保持对 RDD 的引用，或者垃圾回收不频繁，这将导致垃圾回收的周期比较长。这意味着，长期运行 Spark 任务可能会消耗大量的磁盘空间。临时数据存储路径可以通过 SparkContext 中设置参数 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>spark.local.dir</code> 进行配置。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
shuffle 操作的行为可以通过调节多个参数进行设置。详细的说明请看 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/configuration.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Spark 配置指南</a> 中的 “Shuffle 行为” 部分。</p>
<h2 id="rdd-persistence持久化" style="padding:0px; margin:12px 0px 10px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:24px">
RDD Persistence（持久化）<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#rdd-persistence%E6%8C%81%E4%B9%85%E5%8C%96" rel="nofollow" style=""></a></h2>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
Spark 中一个很重要的能力是将数据 <span style="padding:0px; margin:0px; list-style:none; border:0px">persisting</span> 持久化（或称为 <span style="padding:0px; margin:0px; list-style:none; border:0px">caching</span> 缓存），在多个操作间都可以访问这些持久化的数据。当持久化一个 RDD 时，每个节点的其它分区都可以使用 RDD 在内存中进行计算，在该数据上的其他
 action 操作将直接使用内存中的数据。这样会让以后的 action 操作计算速度加快（通常运行速度会加速 10 倍）。缓存是迭代算法和快速的交互式使用的重要工具。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
RDD 可以使用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>persist()</code> 方法或 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>cache()</code> 方法进行持久化。数据将会在第一次
 action 操作时进行计算，并缓存在节点的内存中。Spark 的缓存具有容错机制，如果一个缓存的 RDD 的某个分区丢失了，Spark 将按照原来的计算过程，自动重新计算并进行缓存。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
另外，每个持久化的 RDD 可以使用不同的 <span style="padding:0px; margin:0px; list-style:none; border:0px">storage level</span> 存储级别进行缓存，例如，持久化到磁盘、已序列化的 Java 对象形式持久化到内存（可以节省空间）、跨节点间复制、以 off-heap 的方式存储在 Tachyon。这些存储级别通过传递一个 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>StorageLevel</code> 对象
 (<a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/scala/index.html#org.apache.spark.storage.StorageLevel" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Scala</a>, <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/java/index.html?org/apache/spark/storage/StorageLevel.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Java</a>, <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/python/pyspark.html#pyspark.StorageLevel" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Python</a>)
 给 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>persist()</code> 方法进行设置。<code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>cache()</code> 方法是使用默认存储级别的快捷设置方法，默认的存储级别是 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>StorageLevel.MEMORY_ONLY</code>（将反序列化的对象存储到内存中）。详细的存储级别介绍如下:</p>
<table class="table " style="padding:0px; margin:0px 0px 20px; list-style:none; border:0px; max-width:100%; background-color:transparent; border-collapse:collapse; border-spacing:0px; width:914px">
<tbody style="padding:0px; margin:0px; list-style:none; border:0px">
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<th style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; text-align:left; vertical-align:top; width:194px">
Storage Level（存储级别）</th>
<th style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; text-align:left; vertical-align:top">
Meaning（含义）</th>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
MEMORY_ONLY</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
将 RDD 以反序列化的 Java 对象的形式存储在 JVM 中. 如果内存空间不够，部分数据分区将不再缓存，在每次需要用到这些数据时重新进行计算. 这是默认的级别.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
MEMORY_AND_DISK</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
将 RDD 以反序列化的 Java 对象的形式存储在 JVM 中。如果内存空间不够，将未缓存的数据分区存储到磁盘，在需要使用这些分区时从磁盘读取.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
MEMORY_ONLY_SER <br style="padding:0px; margin:0px; list-style:none; border:0px">
(Java and Scala)</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
将 RDD 以序列化的 Java 对象的形式进行存储（每个分区为一个 byte 数组）。这种方式会比反序列化对象的方式节省很多空间，尤其是在使用 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/tuning.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">fast serializer</a> 时会节省更多的空间，但是在读取时会增加
 CPU 的计算负担.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
MEMORY_AND_DISK_SER <br style="padding:0px; margin:0px; list-style:none; border:0px">
(Java and Scala)</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
类似于 MEMORY_ONLY_SER ，但是溢出的分区会存储到磁盘，而不是在用到它们时重新计算.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
DISK_ONLY</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
只在磁盘上缓存 RDD.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
MEMORY_ONLY_2, MEMORY_AND_DISK_2, etc.</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
与上面的级别功能相同，只不过每个分区在集群中两个节点上建立副本.</td>
</tr>
<tr style="padding:0px; margin:0px; list-style:none; border:0px">
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
OFF_HEAP (experimental 实验性)</td>
<td style="padding:8px; margin:0px; list-style:none; border-width:1px 0px 0px; border-top-style:solid; border-right-style:initial; border-bottom-style:initial; border-left-style:initial; border-top-color:rgb(221,221,221); border-right-color:initial; border-bottom-color:initial; border-left-color:initial; line-height:20px; vertical-align:top">
类似于 MEMORY_ONLY_SER, 但是将数据存储在 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/configuration.html#memory-management" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">off-heap memory</a> 中. 这需要启用 off-heap 内存.</td>
</tr>
</tbody>
</table>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
<span style="padding:0px; margin:0px; list-style:none; border:0px">Note:</span> <span style="padding:0px; margin:0px; list-style:none; border:0px">在 Python 中, stored objects will 总是使用 <a target="_blank" href="https://docs.python.org/2/library/pickle.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Pickle</a> library
 来序列化对象, 所以无论你选择序列化级别都没关系. 在 Python 中可用的存储级别有 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>MEMORY_ONLY</code>, <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>MEMORY_ONLY_2</code>, <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>MEMORY_AND_DISK</code>, <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>MEMORY_AND_DISK_2</code>, <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>DISK_ONLY</code>,
 和 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>DISK_ONLY_2</code>.</span></p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
在 shuffle 操作中（例如 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>reduceByKey</code>），即便是用户没有调用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>persist</code> 方法，Spark
 也会自动缓存部分中间数据.这么做的目的是，在 shuffle 的过程中某个节点运行失败时，不需要重新计算所有的输入数据。如果用户想多次使用某个 RDD，强烈推荐在该 RDD 上调用 persist 方法.</p>
<h3 id="如何选择存储级别-" style="padding:0px; margin:10px 0px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:21px">
如何选择存储级别 ?<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E5%AD%98%E5%82%A8%E7%BA%A7%E5%88%AB-" rel="nofollow" style=""></a></h3>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
Spark 的存储级别的选择，核心问题是在 memory 内存使用率和 CPU 效率之间进行权衡。建议按下面的过程进行存储级别的选择:</p>
<ul style="padding:0px; margin:0px 0px 10px 25px; list-style:none; border:0px">
<li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
如果您的 RDD 适合于默认存储级别 (<code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>MEMORY_ONLY</code>), leave them that way. 这是CPU效率最高的选项，允许RDD上的操作尽可能快地运行.</p>
</li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
如果不是, 试着使用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>MEMORY_ONLY_SER</code> 和 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/tuning.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">selecting
 a fast serialization library</a> 以使对象更加节省空间，但仍然能够快速访问。 (Java和Scala)</p>
</li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
不要溢出到磁盘，除非计算您的数据集的函数是昂贵的, 或者它们过滤大量的数据. 否则, 重新计算分区可能与从磁盘读取分区一样快.</p>
</li><li style="padding:0px; margin:0px; list-style:none; border:0px; line-height:20px">
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
如果需要快速故障恢复，请使用复制的存储级别 (e.g. 如果使用Spark来服务 来自网络应用程序的请求). <span style="padding:0px; margin:0px; list-style:none; border:0px">All</span> 存储级别通过重新计算丢失的数据来提供完整的容错能力，但复制的数据可让您继续在 RDD 上运行任务，而无需等待重新计算一个丢失的分区.</p>
</li></ul>
<h3 id="删除数据" style="padding:0px; margin:10px 0px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:21px">
删除数据<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE" rel="nofollow" style=""></a></h3>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
Spark 会自动监视每个节点上的缓存使用情况，并使用 least-recently-used（LRU）的方式来丢弃旧数据分区。 如果您想手动删除 RDD 而不是等待它掉出缓存，使用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>RDD.unpersist()</code> 方法。</p>
<h1 id="共享变量" style="padding:0px; margin:12px 0px 10px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:28px">
共享变量<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%85%B1%E4%BA%AB%E5%8F%98%E9%87%8F" rel="nofollow" style=""></a></h1>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
通常情况下，一个传递给 Spark 操作（例如 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>map</code> 或 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>reduce</code>）的函数
 func 是在远程的集群节点上执行的。该函数 func 在多个节点执行过程中使用的变量，是同一个变量的多个副本。这些变量的以副本的方式拷贝到每个机器上，并且各个远程机器上变量的更新并不会传播回 driver program（驱动程序）。通用且支持 read-write（读-写） 的共享变量在任务间是不能胜任的。所以，Spark 提供了两种特定类型的共享变量 : broadcast variables（广播变量）和 accumulators（累加器）。</p>
<h2 id="广播变量" style="padding:0px; margin:12px 0px 10px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:24px">
广播变量<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%B9%BF%E6%92%AD%E5%8F%98%E9%87%8F" rel="nofollow" style=""></a></h2>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
Broadcast variables（广播变量）允许程序员将一个 read-only（只读的）变量缓存到每台机器上，而不是给任务传递一个副本。它们是如何来使用呢，例如，广播变量可以用一种高效的方式给每个节点传递一份比较大的 input dataset（输入数据集）副本。在使用广播变量时，Spark 也尝试使用高效广播算法分发 broadcast variables（广播变量）以降低通信成本。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
Spark 的 action（动作）操作是通过一系列的 stage（阶段）进行执行的，这些 stage（阶段）是通过分布式的 “shuffle” 操作进行拆分的。Spark 会自动广播出每个 stage（阶段）内任务所需要的公共数据。这种情况下广播的数据使用序列化的形式进行缓存，并在每个任务运行前进行反序列化。这也就意味着，只有在跨越多个 stage（阶段）的多个任务会使用相同的数据，或者在使用反序列化形式的数据特别重要的情况下，使用广播变量会有比较好的效果。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
广播变量通过在一个变量 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>v</code> 上调用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>SparkContext.broadcast(v)</code> 方法来进行创建。广播变量是 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>v</code> 的一个
 wrapper（包装器），可以通过调用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>value</code>方法来访问它的值。代码示例如下:</p>
<ul class="nav nav-tabs" style="padding:0px; margin:0px 0px 20px; list-style:none; border-width:0px 0px 1px; border-top-style:initial; border-right-style:initial; border-bottom-style:solid; border-left-style:initial; border-top-color:initial; border-right-color:initial; border-bottom-color:rgb(221,221,221); border-left-color:initial">
<li class="active" style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_scala" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_scala_9" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border-width:1px; border-style:solid; border-color:rgb(221,221,221) rgb(221,221,221) transparent; color:rgb(0,136,204); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Scala</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_java" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_java_9" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Java</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_python" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_python_9" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Python</span></a></li></ul>
<div class="codetabs tab-content" style="padding:0px; margin:0px; list-style:none; border:0px; overflow:auto">
<div class="tab-pane active" id="tab_scala_9" style="padding:0px; margin:0px; list-style:none; border:0px">
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code class="language-scala" style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; color:inherit; background:transparent'><span style="padding:0px; margin:0px; list-style:none; border:0px"></span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">scala</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">&gt;</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">val</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">broadcastVar</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">sc</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">broadcast</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="nc" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(14,132,181); font-weight:bold">Array</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">1</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">,</span> <span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">2</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">,</span> <span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">3</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">))</span>
<span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">broadcastVar</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">org.apache.spark.broadcast.Broadcast</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">[</span><span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">Array</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">[</span><span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">Int</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">]]</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="nc" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(14,132,181); font-weight:bold">Broadcast</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">0</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span>

<span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">scala</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">&gt;</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">broadcastVar</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">value</span>
<span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">res0</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">Array</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">[</span><span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">Int</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">]</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="nc" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(14,132,181); font-weight:bold">Array</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">1</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">,</span> <span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">2</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">,</span> <span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">3</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span></code></pre>
</div>
</div>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
在创建广播变量之后，在集群上执行的所有的函数中，应该使用该广播变量代替原来的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>v</code> 值，所以节点上的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>v</code> 最多分发一次。另外，对象 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>v</code> 在广播后不应该再被修改，以保证分发到所有的节点上的广播变量具有同样的值（例如，如果以后该变量会被运到一个新的节点）。</p>
<h2 id="accumulators累加器" style="padding:0px; margin:12px 0px 10px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:24px">
Accumulators（累加器）<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#accumulators%E7%B4%AF%E5%8A%A0%E5%99%A8" rel="nofollow" style=""></a></h2>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
Accumulators（累加器）是一个仅可以执行 “added”（添加）的变量来通过一个关联和交换操作，因此可以高效地执行支持并行。累加器可以用于实现 counter（ 计数，类似在 MapReduce 中那样）或者 sums（求和）。原生 Spark 支持数值型的累加器，并且程序员可以添加新的支持类型。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
作为一个用户，您可以创建 accumulators（累加器）并且重命名. 如下图所示, 一个命名的 accumulator 累加器（在这个例子中是 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>counter</code>）将显示在 web UI 中，用于修改该累加器的阶段。
 Spark 在 “Tasks” 任务表中显示由任务修改的每个累加器的值.</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px; text-align:center">
<img src="http://spark.apachecn.org/docs/cn/2.2.0/img/spark-webui-accumulators.png" title="Accumulators in the Spark UI" alt="Accumulators in the Spark UI" style="padding:0px; margin:0px; list-style:none; border:0px; height:auto; max-width:100%; vertical-align:middle"></p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
在 UI 中跟踪累加器可以有助于了解运行阶段的进度（注: 这在 Python 中尚不支持）.</p>
<ul class="nav nav-tabs" style="padding:0px; margin:0px 0px 20px; list-style:none; border-width:0px 0px 1px; border-top-style:initial; border-right-style:initial; border-bottom-style:solid; border-left-style:initial; border-top-color:initial; border-right-color:initial; border-bottom-color:rgb(221,221,221); border-left-color:initial">
<li class="active" style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_scala" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_scala_10" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border-width:1px; border-style:solid; border-color:rgb(221,221,221) rgb(221,221,221) transparent; color:rgb(0,136,204); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Scala</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_java" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_java_10" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Java</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_python" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_python_10" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Python</span></a></li></ul>
<div class="codetabs tab-content" style="padding:0px; margin:0px; list-style:none; border:0px; overflow:auto">
<div class="tab-pane active" id="tab_scala_10" style="padding:0px; margin:0px; list-style:none; border:0px">
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
可以通过调用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>SparkContext.longAccumulator()</code> 或 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>SparkContext.doubleAccumulator()</code> 方法创建数值类型的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>accumulator</code>（累加器）以分别累加
 Long 或 Double 类型的值。集群上正在运行的任务就可以使用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>add</code> 方法来累计数值。然而，它们不能够读取它的值。只有 driver program（驱动程序）才可以使用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>value</code> 方法读取累加器的值。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
下面的代码展示了一个 accumulator（累加器）被用于对一个数组中的元素求和:</p>
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code class="language-scala" style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; color:inherit; background:transparent'><span style="padding:0px; margin:0px; list-style:none; border:0px"></span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">scala</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">&gt;</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">val</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">accum</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">sc</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">longAccumulator</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="s" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,112,160)">"My Accumulator"</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span>
<span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">accum</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">org.apache.spark.util.LongAccumulator</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">=</span> <span class="nc" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(14,132,181); font-weight:bold">LongAccumulator</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">id</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="err" style="padding:0px; margin:0px; list-style:none; border:0px">0</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">,</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">name</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">Some</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">My</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">Accumulator</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">),</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">value</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="err" style="padding:0px; margin:0px; list-style:none; border:0px">0</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span>

<span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">scala</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">&gt;</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">sc</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">parallelize</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="nc" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(14,132,181); font-weight:bold">Array</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">1</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">,</span> <span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">2</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">,</span> <span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">3</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">,</span> <span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">4</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)).</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">foreach</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">x</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=&gt;</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">accum</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">add</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">x</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">))</span>
<span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">...</span>
<span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">10</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">/</span><span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">09</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">/</span><span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">29</span> <span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">18</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span><span class="err" style="padding:0px; margin:0px; list-style:none; border:0px">41</span><span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">:</span><span class="err" style="padding:0px; margin:0px; list-style:none; border:0px">08</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">INFO</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">SparkContext:</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">Tasks</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">finished</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">in</span> <span class="err" style="padding:0px; margin:0px; list-style:none; border:0px">0</span><span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">.</span><span class="err" style="padding:0px; margin:0px; list-style:none; border:0px">317106</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">s</span>

<span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">scala</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">&gt;</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">accum</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">value</span>
<span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">res2</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">Long</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">=</span> <span class="mi" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,160,112)">10</span></code></pre>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
虽然此代码使用 Long 类型的累加器的内置支持, 但是开发者通过 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/scala/index.html#org.apache.spark.util.AccumulatorV2" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">AccumulatorV2</a> 它的子类来创建自己的类型.
 AccumulatorV2 抽象类有几个需要 override（重写）的方法: <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>reset</code> 方法可将累加器重置为 0, <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>add</code> 方法可将其它值添加到累加器中, <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>merge</code> 方法可将其他同样类型的累加器合并为一个.
 其他需要重写的方法可参考 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/scala/index.html#org.apache.spark.util.AccumulatorV2" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">API documentation</a>. 例如, 假设我们有一个表示数学上
 vectors（向量）的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>MyVector</code> 类，我们可以写成:</p>
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code class="language-scala" style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; color:inherit; background:transparent'><span style="padding:0px; margin:0px; list-style:none; border:0px"></span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">class</span> <span class="nc" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(14,132,181); font-weight:bold">VectorAccumulatorV2</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">extends</span> <span class="nc" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(14,132,181); font-weight:bold">AccumulatorV2</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">[</span><span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">MyVector</span>, <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">MyVector</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">]</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">{</span>

  <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">private</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">val</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">myVector</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">MyVector</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">=</span> <span class="nc" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(14,132,181); font-weight:bold">MyVector</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">createZeroVector</span>

  <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">def</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">reset</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">()</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">Unit</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">=</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">{</span>
    <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">myVector</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">reset</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">()</span>
  <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">}</span>

  <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">def</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">add</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">v</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">MyVector</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">:</span> <span class="kt" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(144,32,0)">Unit</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">=</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">{</span>
    <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">myVector</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">add</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">v</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span>
  <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">}</span>
  <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">...</span>
<span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">}</span>

<span class="c1" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(96,160,176); font-style:italic">// Then, create an Accumulator of this type:</span>
<span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">val</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">myVectorAcc</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">new</span> <span class="nc" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(14,132,181); font-weight:bold">VectorAccumulatorV2</span>
<span class="c1" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(96,160,176); font-style:italic">// Then, register it into spark context:</span>
<span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">sc</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">register</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">myVectorAcc</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">,</span> <span class="s" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(64,112,160)">"MyVectorAcc1"</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">)</span></code></pre>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
注意，在开发者定义自己的 AccumulatorV2 类型时， resulting type（返回值类型）可能与添加的元素的类型不一致。</p>
</div>
</div>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
累加器的更新只发生在 <span style="padding:0px; margin:0px; list-style:none; border:0px">action</span> 操作中，Spark 保证每个任务只更新累加器一次，例如，重启任务不会更新值。在 transformations（转换）中， 用户需要注意的是，如果 task（任务）或 job stages（阶段）重新执行，每个任务的更新操作可能会执行多次。</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
累加器不会改变 Spark lazy evaluation（懒加载）的模式。如果累加器在 RDD 中的一个操作中进行更新，它们的值仅被更新一次，RDD 被作为 action 的一部分来计算。因此，在一个像 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>map()</code> 这样的
 transformation（转换）时，累加器的更新并没有执行。下面的代码片段证明了这个特性:</p>
<ul class="nav nav-tabs" style="padding:0px; margin:0px 0px 20px; list-style:none; border-width:0px 0px 1px; border-top-style:initial; border-right-style:initial; border-bottom-style:solid; border-left-style:initial; border-top-color:initial; border-right-color:initial; border-bottom-color:rgb(221,221,221); border-left-color:initial">
<li class="active" style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_scala" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_scala_11" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border-width:1px; border-style:solid; border-color:rgb(221,221,221) rgb(221,221,221) transparent; color:rgb(0,136,204); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Scala</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_java" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_java_11" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Java</span></a></li><li style="padding:0px; margin:0px 0px -1px; list-style:none; border:0px; line-height:20px; float:left">
<a target="_blank" class="tab_python" href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#tab_python_11" rel="nofollow" style="padding:8px 12px; margin:0px 2px 0px 0px; list-style:none; border:1px solid transparent; color:rgb(51,51,51); display:block; line-height:20px"><span style="padding:0px; margin:0px; list-style:none; border:0px">Python</span></a></li></ul>
<div class="codetabs tab-content" style="padding:0px; margin:0px; list-style:none; border:0px; overflow:auto">
<div class="tab-pane active" id="tab_scala_11" style="padding:0px; margin:0px; list-style:none; border:0px">
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code class="language-scala" style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; color:inherit; background:transparent'><span style="padding:0px; margin:0px; list-style:none; border:0px"></span><span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">val</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">accum</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">sc</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">longAccumulator</span>
<span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">data</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">map</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">{</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">x</span> <span class="k" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,112,32); font-weight:bold">=&gt;</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">accum</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">.</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">add</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">(</span><span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">x</span><span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">);</span> <span class="n" style="padding:0px; margin:0px; list-style:none; border:0px">x</span> <span class="o" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(102,102,102)">}</span>
<span class="c1" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(96,160,176); font-style:italic">// Here, accum is still 0 because no actions have caused the map operation to be computed.</span></code></pre>
</div>
</div>
<h1 id="部署应用到集群中" style="padding:0px; margin:12px 0px 10px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:28px">
部署应用到集群中<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8%E5%88%B0%E9%9B%86%E7%BE%A4%E4%B8%AD" rel="nofollow" style=""></a></h1>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
该 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/submitting-applications.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">应用提交指南</a> 描述了如何将应用提交到集群中. 简单的说, 在您将应用打包成一个JAR(针对 Java/Scala) 或者一组 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>.py</code> 或 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>.zip</code> 文件
 (针对Python), 该 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>bin/spark-submit</code> 脚本可以让你提交它到任何所支持的 cluster manager 上去.</p>
<h1 id="从-java--scala-启动-spark-jobs" style="padding:0px; margin:12px 0px 10px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:28px">
从 Java / Scala 启动 Spark jobs<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E4%BB%8E-java--scala-%E5%90%AF%E5%8A%A8-spark-jobs" rel="nofollow" style=""></a></h1>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
该 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/java/index.html?org/apache/spark/launcher/package-summary.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">org.apache.spark.launcher</a> package 提供了
 classes 用于使用简单的 Java API 来作为一个子进程启动 Spark jobs.</p>
<h1 id="单元测试" style="padding:0px; margin:12px 0px 10px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:28px">
单元测试<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95" rel="nofollow" style=""></a></h1>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
Spark 可以友好的使用流行的单元测试框架进行单元测试。在将 master URL 设置为 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>local</code> 来测试时会简单的创建一个 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>SparkContext</code>，运行您的操作，然后调用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>SparkContext.stop()</code> 将该作业停止。因为
 Spark 不支持在同一个程序中并行的运行两个 contexts，所以需要确保使用 finally 块或者测试框架的 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>tearDown</code> 方法将 context 停止。</p>
<h1 id="快速链接" style="padding:0px; margin:12px 0px 10px; list-style:none; border:0px; font-family:inherit; line-height:40px; color:inherit; font-size:28px">
快速链接<a target="_blank" class="anchorjs-link " href="http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html#%E5%BF%AB%E9%80%9F%E9%93%BE%E6%8E%A5" rel="nofollow" style=""></a></h1>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
您可以在 Spark 网站上看一下 <a target="_blank" href="http://spark.apache.org/examples.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Spark 程序示例</a>. 此外, Spark 在 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>examples</code> 目录中包含了许多示例
 (<a target="_blank" href="https://github.com/apache/spark/tree/master/examples/src/main/scala/org/apache/spark/examples" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Scala</a>, <a target="_blank" href="https://github.com/apache/spark/tree/master/examples/src/main/java/org/apache/spark/examples" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Java</a>, <a target="_blank" href="https://github.com/apache/spark/tree/master/examples/src/main/python" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Python</a>, <a target="_blank" href="https://github.com/apache/spark/tree/master/examples/src/main/r" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">R</a>).
 您可以通过传递 class name 到 Spark 的 bin/run-example 脚本以运行 Java 和 Scala 示例; 例如:</p>
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:13px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:inherit; background:transparent'>./bin/run-example SparkPi
</code></pre>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
针对 Python 示例，使用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>spark-submit</code> 来代替:</p>
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:13px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:inherit; background:transparent'>./bin/spark-submit examples/src/main/python/pi.py
</code></pre>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
针对 R 示例，使用 <code style='padding:0px; margin:0px; list-style:none; border:none; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:rgb(68,68,68)'>spark-submit</code> 来代替:</p>
<pre style='padding:9.5px; margin-top:0px; margin-bottom:10px; list-style:none; font-family:Menlo,"Lucida Console",monospace; font-size:13px; color:rgb(51,51,51); line-height:20px; word-break:break-all; word-wrap:break-word; white-space:pre-wrap; background-color:rgb(245,245,245)'><code style='padding:0px; margin:0px; list-style:none; border:0px; font-family:Menlo,"Lucida Console",monospace; font-size:12px; color:inherit; background:transparent'>./bin/spark-submit examples/src/main/r/dataframe.R
</code></pre>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
针对应用程序的优化, 该 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/configuration.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">配置</a> 和 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/tuning.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">优化</a> 指南一些最佳实践的信息.
 这些优化建议在确保你的数据以高效的格式存储在内存中尤其重要. 针对部署参考, 该 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/cluster-overview.html" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">集群模式概述</a> 描述了分布式操作和支持的 cluster managers 集群管理器的组件.</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
最后,所有的 API 文档可在 <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/scala/#org.apache.spark.package" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Scala</a>, <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/java/" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Java</a>, <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/python/" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">Python</a> and <a target="_blank" href="http://spark.apachecn.org/docs/cn/2.2.0/api/R/" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">R</a> 中获取.</p>
</div>
</div>
<br style='padding:0px; margin:0px; list-style:none; border:0px; color:rgb(51,51,51); font-family:"Helvetica Neue",Helvetica,Arial,sans-serif; font-size:14px'>
<hr class="container-wrapper" style='padding:0px; margin:10px auto 20px; list-style:none; border-style:solid none none; border-top-color:rgb(0,255,255); border-right-width:initial; border-right-color:initial; border-bottom-width:initial; border-bottom-color:initial; border-left-width:initial; border-left-color:initial; color:rgb(29,31,34); max-width:1024px; position:relative; font-family:"Helvetica Neue",Helvetica,Arial,sans-serif; font-size:14px; height:1px'>
<div class="wrapper" style="padding:0px; margin:0px; list-style:none; border:0px">
<div class="footer-wrapper" align="center" style="padding:0px; margin:0px; list-style:none; border:0px">
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
<a target="_blank" href="http://www.apachecn.org/" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"><span style="font-family:KaiTi; font-size:32px; color:red; padding:0px; margin:0px; list-style:none; border:0px">我们一直在努力</span></a></p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
</p>
<p style="padding-top:0px; padding-bottom:0px; margin-top:0px; margin-bottom:10px; list-style:none; border:0px">
<a target="_blank" href="https://github.com/apachecn/spark-doc-zh/" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)">apachecn/spark-doc-zh</a></p>
   <a target="_blank" href="http://shang.qq.com/wpa/qunwpa?idkey=01e5f9ed9436c173e7961386861c59482c2a1010c0c2caa669d3101bc9b5e706" rel="nofollow" style="padding:0px; margin:0px; list-style:none; border:0px; color:rgb(0,136,204)"><img border="0" src="http://pub.idqqimg.com/wpa/images/group.png" alt="云计算之嫣然伊笑" title="云计算之嫣然伊笑" style="padding:0px; margin:0px; list-style:none; border:0px; height:auto; max-width:100%; vertical-align:middle"></a></div>
<div class="footer-wrapper" align="center" style="padding:0px; margin:0px; list-style:none; border:0px">
<br>
</div>
<div class="footer-wrapper" align="center" style="padding:0px; margin:0px; list-style:none; border:0px">
原文地址: http://spark.apachecn.org/docs/cn/2.2.0/rdd-programming-guide.html<br>
网页地址: http://spark.apachecn.org/<br>
github: https://github.com/apachecn/spark-doc-zh（觉得不错麻烦给个 Star，谢谢！~）<br>
</div>
<div class="footer-wrapper" align="center" style="padding:0px; margin:0px; list-style:none; border:0px">
<br>
</div>
<div><br>
</div>
</div>
<div id="gitalk-container" class="container-wrapper" style='padding:0px; margin:10px auto 0px; list-style:none; border:0px; color:rgb(29,31,34); max-width:1024px; position:relative; font-family:"Helvetica Neue",Helvetica,Arial,sans-serif; font-size:14px'>
<div class="gt-container" style="padding:0px; margin:0px; list-style:none; border:0px; font-size:16px">
</div>
</div>
            </div>
                </div>