---
layout:     post
title:      Kafka集群环境搭建
---
<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f76675cdea.css">
						<div class="htmledit_views" id="content_views">
                <h2 style="font-size:20px;font-weight:normal;line-height:1.5;color:rgb(0,0,0);border-bottom-color:rgb(46,61,84);font-family:Arial, sans-serif;background-color:rgb(255,255,255);"><strong>Kafka简介</strong></h2><p style="margin-left:30px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial, sans-serif;font-size:14px;"><span style="color:rgb(0,0,0);">Kafka是一个分布式、可分区、可复制的消息系统。Kafka将消息以topic为单位进行归纳；Kafka发布消息的程序称为producer，也叫生产者；Kafka预订topics并消费消息的程序称为consumer，也叫消费者；当Kafka以集群的方式运行时，可以由一个服务或者多个服务组成，每个服务叫做一个broker，运行过程中producer通过网络将消息发送到Kafka集群，集群向消费者提供消息。</span></p><p style="margin-left:30px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial, sans-serif;font-size:14px;"><img class="confluence-embedded-image confluence-external-resource" alt="kafka消息传递" src="http://www.aboutyun.com/data/attachment/forum/201505/02/225851j2s4eq67aq9llaol.png" style="border:0px;"></p><h2 style="font-size:20px;font-weight:normal;line-height:1.5;color:rgb(0,0,0);border-bottom-color:rgb(46,61,84);font-family:Arial, sans-serif;background-color:rgb(255,255,255);"><strong>第一步：Kafka下载</strong></h2><p style="margin-left:30px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial, sans-serif;font-size:14px;"><span style="color:rgb(0,0,0);">下载地址：<a href="http://kafka.apache.org/" rel="nofollow" class="external-link" style="color:rgb(50,108,166);">http://kafka.apache.org</a></span></p><p style="margin-left:30px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial, sans-serif;font-size:14px;">下载下来为kafka_2.12-1.0.0.tgz。请使用tar -zxvf /home/kafka_2.12-1.0.0.tgz解压至/opt目录</p><h2 style="font-size:20px;font-weight:normal;line-height:1.5;color:rgb(0,0,0);border-bottom-color:rgb(46,61,84);font-family:Arial, sans-serif;background-color:rgb(255,255,255);"><strong>第二步：安装前准备</strong></h2><p style="margin-left:60px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial, sans-serif;font-size:14px;">IP及端口分配： <strong>   </strong></p><div class="table-wrap" style="color:rgb(51,51,51);font-family:Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><table class="confluenceTable" style="color:rgb(51,51,51);"><tbody style="margin-left:60px;"><tr style="margin-left:60px;"><td class="confluenceTd" style="color:rgb(51,51,51);vertical-align:top;margin-left:30px;"><p style="margin-left:60px;color:rgb(51,51,51);background-color:transparent;">IP</p></td><td class="confluenceTd" style="color:rgb(51,51,51);vertical-align:top;margin-left:30px;"><p style="margin-left:60px;color:rgb(51,51,51);background-color:transparent;">服务端口</p></td></tr><tr style="margin-left:60px;"><td class="confluenceTd" style="color:rgb(51,51,51);vertical-align:top;margin-left:30px;"><p style="margin-left:60px;color:rgb(51,51,51);background-color:transparent;">10.100.104.135</p></td><td class="confluenceTd" style="color:rgb(51,51,51);vertical-align:top;margin-left:30px;"><p style="margin-left:60px;color:rgb(51,51,51);background-color:transparent;">9092</p></td></tr><tr style="margin-left:60px;"><td class="confluenceTd" style="color:rgb(51,51,51);vertical-align:top;margin-left:30px;"><p style="margin-left:60px;color:rgb(51,51,51);background-color:transparent;">10.100.104.136</p></td><td class="confluenceTd" style="color:rgb(51,51,51);vertical-align:top;margin-left:30px;"><p style="margin-left:60px;color:rgb(51,51,51);background-color:transparent;">9092</p></td></tr><tr style="margin-left:60px;"><td class="confluenceTd" style="color:rgb(51,51,51);vertical-align:top;margin-left:30px;"><p style="margin-left:60px;color:rgb(51,51,51);background-color:transparent;">10.100.104.137</p></td><td class="confluenceTd" style="color:rgb(51,51,51);vertical-align:top;margin-left:30px;"><p style="margin-left:60px;color:rgb(51,51,51);background-color:transparent;">9092</p></td></tr></tbody></table></div><h2 style="font-size:20px;font-weight:normal;line-height:1.5;color:rgb(0,0,0);border-bottom-color:rgb(46,61,84);font-family:Arial, sans-serif;background-color:rgb(255,255,255);"><strong>第三步：Kafka安装</strong></h2><p style="margin-left:30px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial, sans-serif;font-size:14px;">vim config/server.properties，修改kafka配置：<a href="https://confluence.evergrande.com/download/attachments/5570891/server.properties?version=1&amp;modificationDate=1522221993000&amp;api=v2" rel="nofollow" style="color:rgb(50,108,166);">server.properties</a><br>broker.id=1 <span style="color:rgb(255,0,0);"> ##注意集群中不同机器上配置的<span style="color:rgb(255,0,0);font-family:Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);">“</span>数字”不能相同</span></p><p style="margin-left:30px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial, sans-serif;font-size:14px;">num.partitions=4<br>host.name=10.100.104.136  <span style="color:rgb(255,0,0);font-family:Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);">##注意集群中不同机器上配置的<span style="color:rgb(255,0,0);font-family:Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);">“</span>IP<span style="color:rgb(255,0,0);font-family:Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);">”</span>不能相同</span><br>listeners=PLAINTEXT://10.100.104.136:9092  <span style="color:rgb(255,0,0);font-family:Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);">##注意集群中不同机器上配置的<span style="color:rgb(255,0,0);font-family:Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);">“</span><span style="color:rgb(255,0,0);font-family:Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);">IP</span><span style="color:rgb(255,0,0);font-family:Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);">”</span>不能相同</span><br>advertised.listeners=PLAINTEXT://10.100.104.136:9092  <span style="color:rgb(255,0,0);font-family:Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);">##注意集群中不同机器上配置的<span style="color:rgb(255,0,0);font-family:Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);">“</span><span style="color:rgb(255,0,0);font-family:Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);">IP</span><span style="color:rgb(255,0,0);font-family:Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);">”</span>不能相同</span><br>log.dirs=/opt/kafka_2.12-1.0.0/logs<br>zookeeper.connect=10.100.160.132:2181,10.100.160.133:2181,10.100.160.134:2181</p><h2 style="font-size:20px;font-weight:normal;line-height:1.5;color:rgb(0,0,0);border-bottom-color:rgb(46,61,84);font-family:Arial, sans-serif;background-color:rgb(255,255,255);"><strong>第四步：启动</strong></h2><p style="margin-left:30px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial, sans-serif;font-size:14px;">执行命令：bin/kafka-server-start.sh -daemon config/server.properties</p><h2 class="L0" style="font-size:20px;font-weight:normal;line-height:1.5;color:rgb(0,0,0);border-bottom-color:rgb(46,61,84);font-family:Arial, sans-serif;background-color:rgb(255,255,255);"><strong>问题及解决方案</strong></h2><p style="margin-left:30px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial, sans-serif;font-size:14px;">如果broker.id更换，需清空log目录的所有文件：<br>cd /opt/kafka_2.12-1.0.0/logs<br>rm -rf *</p><h2 class="L0" style="font-size:20px;font-weight:normal;line-height:1.5;color:rgb(0,0,0);border-bottom-color:rgb(46,61,84);font-family:Arial, sans-serif;background-color:rgb(255,255,255);"><strong>测试</strong></h2><ol style="color:rgb(51,51,51);font-family:Arial, sans-serif;font-size:14px;background-color:rgb(255,255,255);"><li><p style="color:rgb(51,51,51);background-color:transparent;">显示所有topic<br>bin/kafka-topics.sh --list --zookeeper 10.100.160.132:2181,10.100.160.133:2181,10.100.160.134:2181</p></li><li><p style="color:rgb(51,51,51);background-color:transparent;">创建测试用的topic，其中10.100.160.132:2181为zookeeper 地址和端口<br>bin/kafka-topics.sh --create --zookeeper 10.100.160.132:2181 --replication-factor 1 --partitions 4 --topic cmy_nbd_topic1<br>执行会显示出cmy_nbd_topic1</p></li><li><p style="color:rgb(51,51,51);background-color:transparent;">登录一台执行，然后输入如 aaabbbccc 回车<br>bin/kafka-console-producer.sh --broker-list 10.100.104.136:9092 --topic cmy_nbd_topic1<br>aaabbbccc</p></li><li><p style="color:rgb(51,51,51);background-color:transparent;">登录另外一台执行，会收到aaabbbccc<br>bin/kafka-console-consumer.sh --zookeeper 10.100.160.132:2181 --topic cmy_nbd_topic1 --from-beginning<br>aaabbbccc</p></li></ol>            </div>
                </div>